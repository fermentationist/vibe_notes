(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const we=()=>new Map,Jn=t=>{const e=we();return t.forEach((n,s)=>{e.set(s,n)}),e},ve=(t,e,n)=>{let s=t.get(e);return s===void 0&&t.set(e,s=n()),s},Wi=(t,e)=>{const n=[];for(const[s,o]of t)n.push(e(o,s));return n},Hi=(t,e)=>{for(const[n,s]of t)if(e(s,n))return!0;return!1},et=()=>new Set,Nn=t=>t[t.length-1],qi=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},We=Array.from,zi=Array.isArray;class ws{constructor(){this._observers=we()}on(e,n){return ve(this._observers,e,et).add(n),n}once(e,n){const s=(...o)=>{this.off(e,s),n(...o)};this.on(e,s)}off(e,n){const s=this._observers.get(e);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(e))}emit(e,n){return We((this._observers.get(e)||we()).values()).forEach(s=>s(...n))}destroy(){this._observers=we()}}class bs{constructor(){this._observers=we()}on(e,n){ve(this._observers,e,et).add(n)}once(e,n){const s=(...o)=>{this.off(e,s),n(...o)};this.on(e,s)}off(e,n){const s=this._observers.get(e);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(e))}emit(e,n){return We((this._observers.get(e)||we()).values()).forEach(s=>s(...n))}destroy(){this._observers=we()}}const Ne=Math.floor,ln=Math.abs,Yi=Math.log10,ar=(t,e)=>t<e?t:e,ft=(t,e)=>t>e?t:e,_s=t=>t!==0?t<0:1/t<0,Mr=1,Ur=2,Mn=4,Un=8,Ht=32,$e=64,_e=128,kn=31,Kn=63,ot=127,Gi=2147483647,vs=Number.MAX_SAFE_INTEGER,Ji=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Ne(t)===t),Ki=String.fromCharCode,Xi=t=>t.toLowerCase(),Zi=/^\s*/g,Qi=t=>t.replace(Zi,""),eo=/([A-Z])/g,Fr=(t,e)=>Qi(t.replace(eo,n=>`${e}${Xi(n)}`)),to=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=e.codePointAt(o);return s},qt=typeof TextEncoder<"u"?new TextEncoder:null,no=t=>qt.encode(t),Xn=qt?no:to;let $t=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});$t&&$t.decode(new Uint8Array).length===1&&($t=null);class Zt{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ue=()=>new Zt,ro=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},re=t=>{const e=new Uint8Array(ro(t));let n=0;for(let s=0;s<t.bufs.length;s++){const o=t.bufs[s];e.set(o,n),n+=o.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},so=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ft(n,e)*2),t.cpos=0)},le=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},zt=le,W=(t,e)=>{for(;e>ot;)le(t,_e|ot&e),e=Ne(e/128);le(t,ot&e)},lr=(t,e)=>{const n=_s(e);for(n&&(e=-e),le(t,(e>Kn?_e:0)|(n?$e:0)|Kn&e),e=Ne(e/64);e>0;)le(t,(e>ot?_e:0)|ot&e),e=Ne(e/128)},Zn=new Uint8Array(3e4),io=Zn.length/3,oo=(t,e)=>{if(e.length<io){const n=qt.encodeInto(e,Zn).written||0;W(t,n);for(let s=0;s<n;s++)le(t,Zn[s])}else ie(t,Xn(e))},co=(t,e)=>{const n=unescape(encodeURIComponent(e)),s=n.length;W(t,s);for(let o=0;o<s;o++)le(t,n.codePointAt(o))},Ie=qt&&qt.encodeInto?oo:co,Rn=(t,e)=>{const n=t.cbuf.length,s=t.cpos,o=ar(n-s,e.length),i=e.length-o;t.cbuf.set(e.subarray(0,o),s),t.cpos+=o,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ft(n*2,i)),t.cbuf.set(e.subarray(o)),t.cpos=i)},ie=(t,e)=>{W(t,e.byteLength),Rn(t,e)},hr=(t,e)=>{so(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},ao=(t,e)=>hr(t,4).setFloat32(0,e,!1),lo=(t,e)=>hr(t,8).setFloat64(0,e,!1),ho=(t,e)=>hr(t,8).setBigInt64(0,e,!1),Br=new DataView(new ArrayBuffer(4)),uo=t=>(Br.setFloat32(0,t),Br.getFloat32(0)===t),Et=(t,e)=>{switch(typeof e){case"string":le(t,119),Ie(t,e);break;case"number":Ji(e)&&ln(e)<=Gi?(le(t,125),lr(t,e)):uo(e)?(le(t,124),ao(t,e)):(le(t,123),lo(t,e));break;case"bigint":le(t,122),ho(t,e);break;case"object":if(e===null)le(t,126);else if(zi(e)){le(t,117),W(t,e.length);for(let n=0;n<e.length;n++)Et(t,e[n])}else if(e instanceof Uint8Array)le(t,116),ie(t,e);else{le(t,118);const n=Object.keys(e);W(t,n.length);for(let s=0;s<n.length;s++){const o=n[s];Ie(t,o),Et(t,e[o])}}break;case"boolean":le(t,e?120:121);break;default:le(t,127)}};class jr extends Zt{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&W(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Pr=t=>{t.count>0&&(lr(t.encoder,t.count===1?t.s:-t.s),t.count>1&&W(t.encoder,t.count-2))};class hn{constructor(){this.encoder=new Zt,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Pr(this),this.count=1,this.s=e)}toUint8Array(){return Pr(this),re(this.encoder)}}const $r=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);lr(t.encoder,e),t.count>1&&W(t.encoder,t.count-2)}};class Fn{constructor(){this.encoder=new Zt,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):($r(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return $r(this),re(this.encoder)}}class fo{constructor(){this.sarr=[],this.s="",this.lensE=new hn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Zt;return this.sarr.push(this.s),this.s="",Ie(e,this.sarr.join("")),Rn(e,this.lensE.toUint8Array()),re(e)}}const Me=t=>new Error(t),Oe=()=>{throw Me("Method unimplemented")},Ue=()=>{throw Me("Unexpected case")},Ss=Me("Unexpected end of array"),Cs=Me("Integer out of Range");class Tn{constructor(e){this.arr=e,this.pos=0}}const je=t=>new Tn(t),go=t=>t.pos!==t.arr.length,po=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},he=t=>po(t,z(t)),at=t=>t.arr[t.pos++],z=t=>{let e=0,n=1;const s=t.arr.length;for(;t.pos<s;){const o=t.arr[t.pos++];if(e=e+(o&ot)*n,n*=128,o<_e)return e;if(e>vs)throw Cs}throw Ss},ur=t=>{let e=t.arr[t.pos++],n=e&Kn,s=64;const o=(e&$e)>0?-1:1;if(!(e&_e))return o*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n=n+(e&ot)*s,s*=128,e<_e)return o*n;if(n>vs)throw Cs}throw Ss},yo=t=>{let e=z(t);if(e===0)return"";{let n=String.fromCodePoint(at(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(at(t));else for(;e>0;){const s=e<1e4?e:1e4,o=t.arr.subarray(t.pos,t.pos+s);t.pos+=s,n+=String.fromCodePoint.apply(null,o),e-=s}return decodeURIComponent(escape(n))}},mo=t=>$t.decode(he(t)),Ve=$t?mo:yo,dr=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},wo=t=>dr(t,4).getFloat32(0,!1),bo=t=>dr(t,8).getFloat64(0,!1),_o=t=>dr(t,8).getBigInt64(0,!1),vo=[t=>{},t=>null,ur,wo,bo,_o,t=>!1,t=>!0,Ve,t=>{const e=z(t),n={};for(let s=0;s<e;s++){const o=Ve(t);n[o]=kt(t)}return n},t=>{const e=z(t),n=[];for(let s=0;s<e;s++)n.push(kt(t));return n},he],kt=t=>vo[127-at(t)](t);class Vr extends Tn{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),go(this)?this.count=z(this)+1:this.count=-1),this.count--,this.s}}class un extends Tn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=ur(this);const e=_s(this.s);this.count=1,e&&(this.s=-this.s,this.count=z(this)+2)}return this.count--,this.s}}class Bn extends Tn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=ur(this),n=e&1;this.diff=Ne(e/2),this.count=1,n&&(this.count=z(this)+2)}return this.s+=this.diff,this.count--,this.s}}class So{constructor(e){this.decoder=new un(e),this.str=Ve(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const Co=crypto.getRandomValues.bind(crypto),Eo=Math.random,Es=()=>Co(new Uint32Array(1))[0],ko=[1e7]+-1e3+-4e3+-8e3+-1e11,ks=()=>ko.replace(/[018]/g,t=>(t^Es()&15>>t/4).toString(16)),He=Date.now,Wr=t=>new Promise(t);Promise.all.bind(Promise);const Ro=t=>Promise.reject(t),fr=t=>Promise.resolve(t),Hr=t=>t===void 0?null:t;class To{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Rs=new To,gr=!0;try{typeof localStorage<"u"&&localStorage&&(Rs=localStorage,gr=!1)}catch{}const Ts=Rs,Ao=t=>gr||addEventListener("storage",t),Do=t=>gr||removeEventListener("storage",t),xo=Object.assign,As=Object.keys,Lo=(t,e)=>{for(const n in t)e(t[n],n)},qr=t=>As(t).length,zr=t=>As(t).length,Io=t=>{for(const e in t)return!1;return!0},Oo=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Ds=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),No=(t,e)=>t===e||zr(t)===zr(e)&&Oo(t,(n,s)=>(n!==void 0||Ds(e,s))&&e[s]===n),Mo=Object.freeze,xs=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&xs(t[e])}return Mo(t)},Yr=Symbol("Equality"),pr=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&pr(t,e,n+1)}},Uo=()=>{},Fo=t=>t,Vt=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[Yr]!=null)return t[Yr](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Vt(t.get(n),e.get(n)))return!1;break}case Object:if(qr(t)!==qr(e))return!1;for(const n in t)if(!Ds(t,n)||!Vt(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Vt(t[n],e[n]))return!1;break;default:return!1}return!0},Bo=(t,e)=>e.includes(t),Rt=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Ls=typeof window<"u"&&typeof document<"u"&&!Rt;let xe;const jo=()=>{if(xe===void 0)if(Rt){xe=we();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const s=t[n];s[0]==="-"?(e!==null&&xe.set(e,""),e=s):e!==null&&(xe.set(e,s),e=null)}e!==null&&xe.set(e,"")}else typeof location=="object"?(xe=we(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");xe.set(`--${Fr(e,"-")}`,n),xe.set(`-${Fr(e,"-")}`,n)}})):xe=we();return xe},Qn=t=>jo().has(t),Yt=t=>Hr(Rt?process.env[t.toUpperCase().replaceAll("-","_")]:Ts.getItem(t)),Is=t=>Qn("--"+t)||Yt(t)!==null;Is("production");const Po=Rt&&Bo({}.FORCE_COLOR,["true","1","2"]),$o=Po||!Qn("--no-colors")&&!Is("no-color")&&(!Rt||process.stdout.isTTY)&&(!Rt||Qn("--color")||Yt("COLORTERM")!==null||(Yt("TERM")||"").includes("color")),Os=t=>new Uint8Array(t),Vo=(t,e,n)=>new Uint8Array(t,e,n),Wo=t=>new Uint8Array(t),Ho=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=Ki(t[n]);return btoa(e)},qo=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),zo=t=>{const e=atob(t),n=Os(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n},Yo=t=>{const e=Buffer.from(t,"base64");return Vo(e.buffer,e.byteOffset,e.byteLength)},Ns=Ls?Ho:qo,Ms=Ls?zo:Yo,Go=t=>{const e=Os(t.byteLength);return e.set(t),e};class Jo{constructor(e,n){this.left=e,this.right=n}}const Pe=(t,e)=>new Jo(t,e);typeof DOMParser<"u"&&new DOMParser;const Ko=t=>Wi(t,(e,n)=>`${n}:${e};`).join(""),Xo=JSON.stringify,qe=Symbol,Ee=qe(),lt=qe(),Us=qe(),yr=qe(),Fs=qe(),Bs=qe(),js=qe(),An=qe(),Dn=qe(),Zo=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[];let s=0;for(;s<t.length;s++){const i=t[s];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(s>0&&n.push(e.join(""));s<t.length;s++){const i=t[s];i instanceof Symbol||n.push(i)}return n},Gr=[Fs,js,An,Us];let jn=0,Jr=He();const Qo=(t,e)=>{const n=Gr[jn],s=Yt("log"),o=s!==null&&(s==="*"||s==="true"||new RegExp(s,"gi").test(e));return jn=(jn+1)%Gr.length,e+=": ",o?(...i)=>{var a;i.length===1&&((a=i[0])==null?void 0:a.constructor)===Function&&(i=i[0]());const l=He(),h=l-Jr;Jr=l,t(n,e,Dn,...i.map(y=>{switch(y!=null&&y.constructor===Uint8Array&&(y=Array.from(y)),typeof y){case"string":case"symbol":return y;default:return Xo(y)}}),n," +"+h+"ms")}:Uo},ec={[Ee]:Pe("font-weight","bold"),[lt]:Pe("font-weight","normal"),[Us]:Pe("color","blue"),[Fs]:Pe("color","green"),[yr]:Pe("color","grey"),[Bs]:Pe("color","red"),[js]:Pe("color","purple"),[An]:Pe("color","orange"),[Dn]:Pe("color","black")},tc=t=>{var l;t.length===1&&((l=t[0])==null?void 0:l.constructor)===Function&&(t=t[0]());const e=[],n=[],s=we();let o=[],i=0;for(;i<t.length;i++){const h=t[i],a=ec[h];if(a!==void 0)s.set(a.left,a.right);else{if(h===void 0)break;if(h.constructor===String||h.constructor===Number){const y=Ko(s);i>0||y.length>0?(e.push("%c"+h),n.push(y)):e.push(h)}else break}}for(i>0&&(o=n,o.unshift(e.join("")));i<t.length;i++){const h=t[i];h instanceof Symbol||o.push(h)}return o},Ps=$o?tc:Zo,$s=(...t)=>{console.log(...Ps(t)),Vs.forEach(e=>e.print(t))},nc=(...t)=>{console.warn(...Ps(t)),t.unshift(An),Vs.forEach(e=>e.print(t))},Vs=et(),rc=t=>Qo($s,t),Ws=t=>({[Symbol.iterator](){return this},next:t}),sc=(t,e)=>Ws(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Pn=(t,e)=>Ws(()=>{const{done:n,value:s}=t.next();return{done:n,value:n?void 0:e(s)}});class mr{constructor(e,n){this.clock=e,this.len=n}}class Qt{constructor(){this.clients=new Map}}const Hs=(t,e,n)=>e.clients.forEach((s,o)=>{const i=t.doc.store.clients.get(o);if(i!=null){const l=i[i.length-1],h=l.id.clock+l.length;for(let a=0,y=s[a];a<s.length&&y.clock<h;y=s[++a])ri(t,i,y.clock,y.len,n)}}),ic=(t,e)=>{let n=0,s=t.length-1;for(;n<=s;){const o=Ne((n+s)/2),i=t[o],l=i.clock;if(l<=e){if(e<l+i.len)return o;n=o+1}else s=o-1}return null},qs=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&ic(n,e.clock)!==null},wr=t=>{t.clients.forEach(e=>{e.sort((o,i)=>o.clock-i.clock);let n,s;for(n=1,s=1;n<e.length;n++){const o=e[s-1],i=e[n];o.clock+o.len>=i.clock?o.len=ft(o.len,i.clock+i.len-o.clock):(s<n&&(e[s]=i),s++)}e.length=s})},oc=t=>{const e=new Qt;for(let n=0;n<t.length;n++)t[n].clients.forEach((s,o)=>{if(!e.clients.has(o)){const i=s.slice();for(let l=n+1;l<t.length;l++)qi(i,t[l].clients.get(o)||[]);e.clients.set(o,i)}});return wr(e),e},fn=(t,e,n,s)=>{ve(t.clients,e,()=>[]).push(new mr(n,s))},cc=()=>new Qt,ac=t=>{const e=cc();return t.clients.forEach((n,s)=>{const o=[];for(let i=0;i<n.length;i++){const l=n[i];if(l.deleted){const h=l.id.clock;let a=l.length;if(i+1<n.length)for(let y=n[i+1];i+1<n.length&&y.deleted;y=n[++i+1])a+=y.length;o.push(new mr(h,a))}}o.length>0&&e.clients.set(s,o)}),e},Lt=(t,e)=>{W(t.restEncoder,e.clients.size),We(e.clients.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{t.resetDsCurVal(),W(t.restEncoder,n);const o=s.length;W(t.restEncoder,o);for(let i=0;i<o;i++){const l=s[i];t.writeDsClock(l.clock),t.writeDsLen(l.len)}})},br=t=>{const e=new Qt,n=z(t.restDecoder);for(let s=0;s<n;s++){t.resetDsCurVal();const o=z(t.restDecoder),i=z(t.restDecoder);if(i>0){const l=ve(e.clients,o,()=>[]);for(let h=0;h<i;h++)l.push(new mr(t.readDsClock(),t.readDsLen()))}}return e},Kr=(t,e,n)=>{const s=new Qt,o=z(t.restDecoder);for(let i=0;i<o;i++){t.resetDsCurVal();const l=z(t.restDecoder),h=z(t.restDecoder),a=n.clients.get(l)||[],y=de(n,l);for(let m=0;m<h;m++){const u=t.readDsClock(),d=u+t.readDsLen();if(u<y){y<d&&fn(s,l,y,d-y);let p=Fe(a,u),g=a[p];for(!g.deleted&&g.id.clock<u&&(a.splice(p+1,0,_n(e,g,u-g.id.clock)),p++);p<a.length&&(g=a[p++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&a.splice(p,0,_n(e,g,d-g.id.clock)),g.delete(e))}else fn(s,l,u,d-u)}}if(s.clients.size>0){const i=new ht;return W(i.restEncoder,0),Lt(i,s),i.toUint8Array()}return null},zs=Es;class It extends ws{constructor({guid:e=ks(),collectionid:n=null,gc:s=!0,gcFilter:o=()=>!0,meta:i=null,autoLoad:l=!1,shouldLoad:h=!0}={}){super(),this.gc=s,this.gcFilter=o,this.clientID=zs(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new ti,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=h,this.autoLoad=l,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Wr(y=>{this.on("load",()=>{this.isLoaded=!0,y(this)})});const a=()=>Wr(y=>{const m=u=>{(u===void 0||u===!0)&&(this.off("sync",m),y())};this.on("sync",m)});this.on("sync",y=>{y===!1&&this.isSynced&&(this.whenSynced=a()),this.isSynced=y===void 0||y===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=a()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ee(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(We(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ee(this,e,n)}get(e,n=pe){const s=ve(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),o=s.constructor;if(n!==pe&&o!==n)if(o===pe){const i=new n;i._map=s._map,s._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=i}),i._start=s._start;for(let l=i._start;l!==null;l=l.right)l.parent=i;return i._length=s._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return s}getArray(e=""){return this.get(e,vt)}getText(e=""){return this.get(e,Dt)}getMap(e=""){return this.get(e,At)}getXmlElement(e=""){return this.get(e,xt)}getXmlFragment(e=""){return this.get(e,ut)}toJSON(){const e={};return this.share.forEach((n,s)=>{e[s]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,We(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new It({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ee(e.parent.doc,s=>{const o=n.doc;e.deleted||s.subdocsAdded.add(o),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ys{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return z(this.restDecoder)}readDsLen(){return z(this.restDecoder)}}class Gs extends Ys{readLeftID(){return X(z(this.restDecoder),z(this.restDecoder))}readRightID(){return X(z(this.restDecoder),z(this.restDecoder))}readClient(){return z(this.restDecoder)}readInfo(){return at(this.restDecoder)}readString(){return Ve(this.restDecoder)}readParentInfo(){return z(this.restDecoder)===1}readTypeRef(){return z(this.restDecoder)}readLen(){return z(this.restDecoder)}readAny(){return kt(this.restDecoder)}readBuf(){return Go(he(this.restDecoder))}readJSON(){return JSON.parse(Ve(this.restDecoder))}readKey(){return Ve(this.restDecoder)}}class lc{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=z(this.restDecoder),this.dsCurrVal}readDsLen(){const e=z(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Tt extends lc{constructor(e){super(e),this.keys=[],z(e),this.keyClockDecoder=new Bn(he(e)),this.clientDecoder=new un(he(e)),this.leftClockDecoder=new Bn(he(e)),this.rightClockDecoder=new Bn(he(e)),this.infoDecoder=new Vr(he(e),at),this.stringDecoder=new So(he(e)),this.parentInfoDecoder=new Vr(he(e),at),this.typeRefDecoder=new un(he(e)),this.lenDecoder=new un(he(e))}readLeftID(){return new _t(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new _t(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return kt(this.restDecoder)}readBuf(){return he(this.restDecoder)}readJSON(){return kt(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Js{constructor(){this.restEncoder=ue()}toUint8Array(){return re(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){W(this.restEncoder,e)}writeDsLen(e){W(this.restEncoder,e)}}class en extends Js{writeLeftID(e){W(this.restEncoder,e.client),W(this.restEncoder,e.clock)}writeRightID(e){W(this.restEncoder,e.client),W(this.restEncoder,e.clock)}writeClient(e){W(this.restEncoder,e)}writeInfo(e){zt(this.restEncoder,e)}writeString(e){Ie(this.restEncoder,e)}writeParentInfo(e){W(this.restEncoder,e?1:0)}writeTypeRef(e){W(this.restEncoder,e)}writeLen(e){W(this.restEncoder,e)}writeAny(e){Et(this.restEncoder,e)}writeBuf(e){ie(this.restEncoder,e)}writeJSON(e){Ie(this.restEncoder,JSON.stringify(e))}writeKey(e){Ie(this.restEncoder,e)}}class Ks{constructor(){this.restEncoder=ue(),this.dsCurrVal=0}toUint8Array(){return re(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,W(this.restEncoder,n)}writeDsLen(e){e===0&&Ue(),W(this.restEncoder,e-1),this.dsCurrVal+=e}}class ht extends Ks{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Fn,this.clientEncoder=new hn,this.leftClockEncoder=new Fn,this.rightClockEncoder=new Fn,this.infoEncoder=new jr(zt),this.stringEncoder=new fo,this.parentInfoEncoder=new jr(zt),this.typeRefEncoder=new hn,this.lenEncoder=new hn}toUint8Array(){const e=ue();return W(e,0),ie(e,this.keyClockEncoder.toUint8Array()),ie(e,this.clientEncoder.toUint8Array()),ie(e,this.leftClockEncoder.toUint8Array()),ie(e,this.rightClockEncoder.toUint8Array()),ie(e,re(this.infoEncoder)),ie(e,this.stringEncoder.toUint8Array()),ie(e,re(this.parentInfoEncoder)),ie(e,this.typeRefEncoder.toUint8Array()),ie(e,this.lenEncoder.toUint8Array()),Rn(e,re(this.restEncoder)),re(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Et(this.restEncoder,e)}writeBuf(e){ie(this.restEncoder,e)}writeJSON(e){Et(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const hc=(t,e,n,s)=>{s=ft(s,e[0].id.clock);const o=Fe(e,s);W(t.restEncoder,e.length-o),t.writeClient(n),W(t.restEncoder,s);const i=e[o];i.write(t,s-i.id.clock);for(let l=o+1;l<e.length;l++)e[l].write(t,0)},_r=(t,e,n)=>{const s=new Map;n.forEach((o,i)=>{de(e,i)>o&&s.set(i,o)}),xn(e).forEach((o,i)=>{n.has(i)||s.set(i,0)}),W(t.restEncoder,s.size),We(s.entries()).sort((o,i)=>i[0]-o[0]).forEach(([o,i])=>{hc(t,e.clients.get(o),o,i)})},uc=(t,e)=>{const n=we(),s=z(t.restDecoder);for(let o=0;o<s;o++){const i=z(t.restDecoder),l=new Array(i),h=t.readClient();let a=z(t.restDecoder);n.set(h,{i:0,refs:l});for(let y=0;y<i;y++){const m=t.readInfo();switch(kn&m){case 0:{const u=t.readLen();l[y]=new Se(X(h,a),u),a+=u;break}case 10:{const u=z(t.restDecoder);l[y]=new Ce(X(h,a),u),a+=u;break}default:{const u=(m&($e|_e))===0,d=new ce(X(h,a),null,(m&_e)===_e?t.readLeftID():null,null,(m&$e)===$e?t.readRightID():null,u?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,u&&(m&Ht)===Ht?t.readString():null,Si(t,m));l[y]=d,a+=d.length}}}}return n},dc=(t,e,n)=>{const s=[];let o=We(n.keys()).sort((p,g)=>p-g);if(o.length===0)return null;const i=()=>{if(o.length===0)return null;let p=n.get(o[o.length-1]);for(;p.refs.length===p.i;)if(o.pop(),o.length>0)p=n.get(o[o.length-1]);else return null;return p};let l=i();if(l===null)return null;const h=new ti,a=new Map,y=(p,g)=>{const _=a.get(p);(_==null||_>g)&&a.set(p,g)};let m=l.refs[l.i++];const u=new Map,d=()=>{for(const p of s){const g=p.id.client,_=n.get(g);_?(_.i--,h.clients.set(g,_.refs.slice(_.i)),n.delete(g),_.i=0,_.refs=[]):h.clients.set(g,[p]),o=o.filter(I=>I!==g)}s.length=0};for(;;){if(m.constructor!==Ce){const g=ve(u,m.id.client,()=>de(e,m.id.client))-m.id.clock;if(g<0)s.push(m),y(m.id.client,m.id.clock-1),d();else{const _=m.getMissing(t,e);if(_!==null){s.push(m);const I=n.get(_)||{refs:[],i:0};if(I.refs.length===I.i)y(_,de(e,_)),d();else{m=I.refs[I.i++];continue}}else(g===0||g<m.length)&&(m.integrate(t,g),u.set(m.id.client,m.id.clock+m.length))}}if(s.length>0)m=s.pop();else if(l!==null&&l.i<l.refs.length)m=l.refs[l.i++];else{if(l=i(),l===null)break;m=l.refs[l.i++]}}if(h.clients.size>0){const p=new ht;return _r(p,h,new Map),W(p.restEncoder,0),{missing:a,update:p.toUint8Array()}}return null},fc=(t,e)=>_r(t,e.doc.store,e.beforeState),gc=(t,e,n,s=new Tt(t))=>ee(e,o=>{o.local=!1;let i=!1;const l=o.doc,h=l.store,a=uc(s,l),y=dc(o,h,a),m=h.pendingStructs;if(m){for(const[d,p]of m.missing)if(p<de(h,d)){i=!0;break}if(y){for(const[d,p]of y.missing){const g=m.missing.get(d);(g==null||g>p)&&m.missing.set(d,p)}m.update=gn([m.update,y.update])}}else h.pendingStructs=y;const u=Kr(s,o,h);if(h.pendingDs){const d=new Tt(je(h.pendingDs));z(d.restDecoder);const p=Kr(d,o,h);u&&p?h.pendingDs=gn([u,p]):h.pendingDs=u||p}else h.pendingDs=u;if(i){const d=h.pendingStructs.update;h.pendingStructs=null,Xs(o.doc,d)}},n,!1),Xs=(t,e,n,s=Tt)=>{const o=je(e);gc(o,t,n,new s(o))},pc=(t,e,n)=>Xs(t,e,n,Gs),yc=(t,e,n=new Map)=>{_r(t,e.store,n),Lt(t,ac(e.store))},mc=(t,e=new Uint8Array([0]),n=new ht)=>{const s=Zs(e);yc(n,t,s);const o=[n.toUint8Array()];if(t.store.pendingDs&&o.push(t.store.pendingDs),t.store.pendingStructs&&o.push(Oc(t.store.pendingStructs.update,e)),o.length>1){if(n.constructor===en)return Lc(o.map((i,l)=>l===0?i:Mc(i)));if(n.constructor===ht)return gn(o)}return o[0]},wc=(t,e)=>mc(t,e,new en),bc=t=>{const e=new Map,n=z(t.restDecoder);for(let s=0;s<n;s++){const o=z(t.restDecoder),i=z(t.restDecoder);e.set(o,i)}return e},Zs=t=>bc(new Ys(je(t))),Qs=(t,e)=>(W(t.restEncoder,e.size),We(e.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{W(t.restEncoder,n),W(t.restEncoder,s)}),t),_c=(t,e)=>Qs(t,xn(e.store)),vc=(t,e=new Ks)=>(t instanceof Map?Qs(e,t):_c(e,t),e.toUint8Array()),Sc=t=>vc(t,new Js);class Cc{constructor(){this.l=[]}}const Xr=()=>new Cc,Zr=(t,e)=>t.l.push(e),Qr=(t,e)=>{const n=t.l,s=n.length;t.l=n.filter(o=>e!==o),s===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ei=(t,e,n)=>pr(t.l,[e,n]);class _t{constructor(e,n){this.client=e,this.clock=n}}const sn=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,X=(t,e)=>new _t(t,e),Ec=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ue()},bt=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!qs(e.ds,t.id),er=(t,e)=>{const n=ve(t.meta,er,et),s=t.doc.store;n.has(e)||(e.sv.forEach((o,i)=>{o<de(s,i)&&tt(t,X(i,o))}),Hs(t,e.ds,o=>{}),n.add(e))};class ti{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const xn=t=>{const e=new Map;return t.clients.forEach((n,s)=>{const o=n[n.length-1];e.set(s,o.id.clock+o.length)}),e},de=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const s=n[n.length-1];return s.id.clock+s.length},ni=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const s=n[n.length-1];if(s.id.clock+s.length!==e.id.clock)throw Ue()}n.push(e)},Fe=(t,e)=>{let n=0,s=t.length-1,o=t[s],i=o.id.clock;if(i===e)return s;let l=Ne(e/(i+o.length-1)*s);for(;n<=s;){if(o=t[l],i=o.id.clock,i<=e){if(e<i+o.length)return l;n=l+1}else s=l-1;l=Ne((n+s)/2)}throw Ue()},kc=(t,e)=>{const n=t.clients.get(e.client);return n[Fe(n,e.clock)]},$n=kc,tr=(t,e,n)=>{const s=Fe(e,n),o=e[s];return o.id.clock<n&&o instanceof ce?(e.splice(s+1,0,_n(t,o,n-o.id.clock)),s+1):s},tt=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[tr(t,n,e.clock)]},es=(t,e,n)=>{const s=e.clients.get(n.client),o=Fe(s,n.clock),i=s[o];return n.clock!==i.id.clock+i.length-1&&i.constructor!==Se&&s.splice(o+1,0,_n(t,i,n.clock-i.id.clock+1)),i},Rc=(t,e,n)=>{const s=t.clients.get(e.id.client);s[Fe(s,e.id.clock)]=n},ri=(t,e,n,s,o)=>{if(s===0)return;const i=n+s;let l=tr(t,e,n),h;do h=e[l++],i<h.id.clock+h.length&&tr(t,e,i),o(h);while(l<e.length&&e[l].id.clock<i)};class Tc{constructor(e,n,s){this.doc=e,this.deleteSet=new Qt,this.beforeState=xn(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ts=(t,e)=>e.deleteSet.clients.size===0&&!Hi(e.afterState,(n,s)=>e.beforeState.get(s)!==n)?!1:(wr(e.deleteSet),fc(t,e),Lt(t,e.deleteSet),!0),ns=(t,e,n)=>{const s=e._item;(s===null||s.id.clock<(t.beforeState.get(s.id.client)||0)&&!s.deleted)&&ve(t.changed,e,et).add(n)},dn=(t,e)=>{let n=t[e],s=t[e-1],o=e;for(;o>0;n=s,s=t[--o-1]){if(s.deleted===n.deleted&&s.constructor===n.constructor&&s.mergeWith(n)){n instanceof ce&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,s);continue}break}const i=e-o;return i&&t.splice(e+1-i,i),i},Ac=(t,e,n)=>{for(const[s,o]of t.clients.entries()){const i=e.clients.get(s);for(let l=o.length-1;l>=0;l--){const h=o[l],a=h.clock+h.len;for(let y=Fe(i,h.clock),m=i[y];y<i.length&&m.id.clock<a;m=i[++y]){const u=i[y];if(h.clock+h.len<=u.id.clock)break;u instanceof ce&&u.deleted&&!u.keep&&n(u)&&u.gc(e,!1)}}}},Dc=(t,e)=>{t.clients.forEach((n,s)=>{const o=e.clients.get(s);for(let i=n.length-1;i>=0;i--){const l=n[i],h=ar(o.length-1,1+Fe(o,l.clock+l.len-1));for(let a=h,y=o[a];a>0&&y.id.clock>=l.clock;y=o[a])a-=1+dn(o,a)}})},si=(t,e)=>{if(e<t.length){const n=t[e],s=n.doc,o=s.store,i=n.deleteSet,l=n._mergeStructs;try{wr(i),n.afterState=xn(n.doc.store),s.emit("beforeObserverCalls",[n,s]);const h=[];n.changed.forEach((a,y)=>h.push(()=>{(y._item===null||!y._item.deleted)&&y._callObserver(n,a)})),h.push(()=>{n.changedParentTypes.forEach((a,y)=>{y._dEH.l.length>0&&(y._item===null||!y._item.deleted)&&(a=a.filter(m=>m.target._item===null||!m.target._item.deleted),a.forEach(m=>{m.currentTarget=y,m._path=null}),a.sort((m,u)=>m.path.length-u.path.length),ei(y._dEH,a,n))})}),h.push(()=>s.emit("afterTransaction",[n,s])),pr(h,[]),n._needFormattingCleanup&&Jc(n)}finally{s.gc&&Ac(i,o,s.gcFilter),Dc(i,o),n.afterState.forEach((m,u)=>{const d=n.beforeState.get(u)||0;if(d!==m){const p=o.clients.get(u),g=ft(Fe(p,d),1);for(let _=p.length-1;_>=g;)_-=1+dn(p,_)}});for(let m=l.length-1;m>=0;m--){const{client:u,clock:d}=l[m].id,p=o.clients.get(u),g=Fe(p,d);g+1<p.length&&dn(p,g+1)>1||g>0&&dn(p,g)}if(!n.local&&n.afterState.get(s.clientID)!==n.beforeState.get(s.clientID)&&($s(An,Ee,"[yjs] ",lt,Bs,"Changed the client-id because another client seems to be using it."),s.clientID=zs()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const m=new en;ts(m,n)&&s.emit("update",[m.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const m=new ht;ts(m,n)&&s.emit("updateV2",[m.toUint8Array(),n.origin,s,n])}const{subdocsAdded:h,subdocsLoaded:a,subdocsRemoved:y}=n;(h.size>0||y.size>0||a.size>0)&&(h.forEach(m=>{m.clientID=s.clientID,m.collectionid==null&&(m.collectionid=s.collectionid),s.subdocs.add(m)}),y.forEach(m=>s.subdocs.delete(m)),s.emit("subdocs",[{loaded:a,added:h,removed:y},s,n]),y.forEach(m=>m.destroy())),t.length<=e+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,t])):si(t,e+1)}}},ee=(t,e,n=null,s=!0)=>{const o=t._transactionCleanups;let i=!1,l=null;t._transaction===null&&(i=!0,t._transaction=new Tc(t,n,s),o.push(t._transaction),o.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{l=e(t._transaction)}finally{if(i){const h=t._transaction===o[0];t._transaction=null,h&&si(o,0)}}return l};function*xc(t){const e=z(t.restDecoder);for(let n=0;n<e;n++){const s=z(t.restDecoder),o=t.readClient();let i=z(t.restDecoder);for(let l=0;l<s;l++){const h=t.readInfo();if(h===10){const a=z(t.restDecoder);yield new Ce(X(o,i),a),i+=a}else if(kn&h){const a=(h&($e|_e))===0,y=new ce(X(o,i),null,(h&_e)===_e?t.readLeftID():null,null,(h&$e)===$e?t.readRightID():null,a?t.readParentInfo()?t.readString():t.readLeftID():null,a&&(h&Ht)===Ht?t.readString():null,Si(t,h));yield y,i+=y.length}else{const a=t.readLen();yield new Se(X(o,i),a),i+=a}}}}class vr{constructor(e,n){this.gen=xc(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ce);return this.curr}}class Sr{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Lc=t=>gn(t,Gs,en),Ic=(t,e)=>{if(t.constructor===Se){const{client:n,clock:s}=t.id;return new Se(X(n,s+e),t.length-e)}else if(t.constructor===Ce){const{client:n,clock:s}=t.id;return new Ce(X(n,s+e),t.length-e)}else{const n=t,{client:s,clock:o}=n.id;return new ce(X(s,o+e),null,X(s,o+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},gn=(t,e=Tt,n=ht)=>{if(t.length===1)return t[0];const s=t.map(m=>new e(je(m)));let o=s.map(m=>new vr(m,!0)),i=null;const l=new n,h=new Sr(l);for(;o=o.filter(d=>d.curr!==null),o.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){const g=d.curr.id.clock-p.curr.id.clock;return g===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===Ce?1:-1:g}else return p.curr.id.client-d.curr.id.client}),o.length!==0;){const m=o[0],u=m.curr.id.client;if(i!==null){let d=m.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=m.next(),p=!0;if(d===null||d.id.client!==u||p&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(u!==i.struct.id.client)Ze(h,i.struct,i.offset),i={struct:d,offset:0},m.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===Ce)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Ze(h,i.struct,i.offset);const g=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Ce(X(u,i.struct.id.clock+i.struct.length),g),offset:0}}else{const g=i.struct.id.clock+i.struct.length-d.id.clock;g>0&&(i.struct.constructor===Ce?i.struct.length-=g:d=Ic(d,g)),i.struct.mergeWith(d)||(Ze(h,i.struct,i.offset),i={struct:d,offset:0},m.next())}}else i={struct:m.curr,offset:0},m.next();for(let d=m.curr;d!==null&&d.id.client===u&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==Ce;d=m.next())Ze(h,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Ze(h,i.struct,i.offset),i=null),Cr(h);const a=s.map(m=>br(m)),y=oc(a);return Lt(l,y),l.toUint8Array()},Oc=(t,e,n=Tt,s=ht)=>{const o=Zs(e),i=new s,l=new Sr(i),h=new n(je(t)),a=new vr(h,!1);for(;a.curr;){const m=a.curr,u=m.id.client,d=o.get(u)||0;if(a.curr.constructor===Ce){a.next();continue}if(m.id.clock+m.length>d)for(Ze(l,m,ft(d-m.id.clock,0)),a.next();a.curr&&a.curr.id.client===u;)Ze(l,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===u&&a.curr.id.clock+a.curr.length<=d;)a.next()}Cr(l);const y=br(h);return Lt(i,y),i.toUint8Array()},ii=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:re(t.encoder.restEncoder)}),t.encoder.restEncoder=ue(),t.written=0)},Ze=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&ii(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),W(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Cr=t=>{ii(t);const e=t.encoder.restEncoder;W(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const s=t.clientStructs[n];W(e,s.written),Rn(e,s.restEncoder)}},Nc=(t,e,n,s)=>{const o=new n(je(t)),i=new vr(o,!1),l=new s,h=new Sr(l);for(let y=i.curr;y!==null;y=i.next())Ze(h,e(y),0);Cr(h);const a=br(o);return Lt(l,a),l.toUint8Array()},Mc=t=>Nc(t,Fo,Tt,en),rs="You must not compute changes after the event-handler fired.";class Ln{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Uc(this.currentTarget,this.target))}deletes(e){return qs(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(rs);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(o=>{if(o!==null){const i=n._map.get(o);let l,h;if(this.adds(i)){let a=i.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(i))if(a!==null&&this.deletes(a))l="delete",h=Nn(a.content.getContent());else return;else a!==null&&this.deletes(a)?(l="update",h=Nn(a.content.getContent())):(l="add",h=void 0)}else if(this.deletes(i))l="delete",h=Nn(i.content.getContent());else return;e.set(o,{action:l,oldValue:h})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(rs);const n=this.target,s=et(),o=et(),i=[];if(e={added:s,deleted:o,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let h=null;const a=()=>{h&&i.push(h)};for(let y=n._start;y!==null;y=y.right)y.deleted?this.deletes(y)&&!this.adds(y)&&((h===null||h.delete===void 0)&&(a(),h={delete:0}),h.delete+=y.length,o.add(y)):this.adds(y)?((h===null||h.insert===void 0)&&(a(),h={insert:[]}),h.insert=h.insert.concat(y.content.getContent()),s.add(y)):((h===null||h.retain===void 0)&&(a(),h={retain:0}),h.retain+=y.length);h!==null&&h.retain===void 0&&a()}this._changes=e}return e}}const Uc=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let s=0,o=e._item.parent._start;for(;o!==e._item&&o!==null;)!o.deleted&&o.countable&&(s+=o.length),o=o.right;n.unshift(s)}e=e._item.parent}return n},ye=()=>{nc("Invalid access: Add Yjs type to a document before reading data.")},oi=80;let Er=0;class Fc{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Er++}}const Bc=t=>{t.timestamp=Er++},ci=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Er++},jc=(t,e,n)=>{if(t.length>=oi){const s=t.reduce((o,i)=>o.timestamp<i.timestamp?o:i);return ci(s,e,n),s}else{const s=new Fc(e,n);return t.push(s),s}},In=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,l)=>ln(e-i.index)<ln(e-l.index)?i:l);let s=t._start,o=0;for(n!==null&&(s=n.p,o=n.index,Bc(n));s.right!==null&&o<e;){if(!s.deleted&&s.countable){if(e<o+s.length)break;o+=s.length}s=s.right}for(;s.left!==null&&o>e;)s=s.left,!s.deleted&&s.countable&&(o-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(o-=s.length);return n!==null&&ln(n.index-o)<s.parent.length/oi?(ci(n,s,o),n):jc(t._searchMarker,s,o)},Gt=(t,e,n)=>{for(let s=t.length-1;s>=0;s--){const o=t[s];if(n>0){let i=o.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(o.index-=i.length);if(i===null||i.marker===!0){t.splice(s,1);continue}o.p=i,i.marker=!0}(e<o.index||n>0&&e===o.index)&&(o.index=ft(e,o.index+n))}},On=(t,e,n)=>{const s=t,o=e.changedParentTypes;for(;ve(o,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;ei(s._eH,n,e)};class pe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xr(),this._dEH=Xr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Oe()}clone(){throw Oe()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Zr(this._eH,e)}observeDeep(e){Zr(this._dEH,e)}unobserve(e){Qr(this._eH,e)}unobserveDeep(e){Qr(this._dEH,e)}toJSON(){}}const ai=(t,e,n)=>{t.doc??ye(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let s=n-e;const o=[];let i=t._start;for(;i!==null&&s>0;){if(i.countable&&!i.deleted){const l=i.content.getContent();if(l.length<=e)e-=l.length;else{for(let h=e;h<l.length&&s>0;h++)o.push(l[h]),s--;e=0}}i=i.right}return o},li=t=>{t.doc??ye();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let o=0;o<s.length;o++)e.push(s[o])}n=n.right}return e},Jt=(t,e)=>{let n=0,s=t._start;for(t.doc??ye();s!==null;){if(s.countable&&!s.deleted){const o=s.content.getContent();for(let i=0;i<o.length;i++)e(o[i],n++,t)}s=s.right}},hi=(t,e)=>{const n=[];return Jt(t,(s,o)=>{n.push(e(s,o,t))}),n},Pc=t=>{let e=t._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),s=0,e=e.right}const o=n[s++];return n.length<=s&&(n=null),{done:!1,value:o}}}},ui=(t,e)=>{t.doc??ye();const n=In(t,e);let s=t._start;for(n!==null&&(s=n.p,e-=n.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(e<s.length)return s.content.getContent()[e];e-=s.length}},pn=(t,e,n,s)=>{let o=n;const i=t.doc,l=i.clientID,h=i.store,a=n===null?e._start:n.right;let y=[];const m=()=>{y.length>0&&(o=new ce(X(l,de(h,l)),o,o&&o.lastId,a,a&&a.id,e,null,new dt(y)),o.integrate(t,0),y=[])};s.forEach(u=>{if(u===null)y.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:y.push(u);break;default:switch(m(),u.constructor){case Uint8Array:case ArrayBuffer:o=new ce(X(l,de(h,l)),o,o&&o.lastId,a,a&&a.id,e,null,new tn(new Uint8Array(u))),o.integrate(t,0);break;case It:o=new ce(X(l,de(h,l)),o,o&&o.lastId,a,a&&a.id,e,null,new nn(u)),o.integrate(t,0);break;default:if(u instanceof pe)o=new ce(X(l,de(h,l)),o,o&&o.lastId,a,a&&a.id,e,null,new ze(u)),o.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),m()},di=()=>Me("Length exceeded!"),fi=(t,e,n,s)=>{if(n>e._length)throw di();if(n===0)return e._searchMarker&&Gt(e._searchMarker,n,s.length),pn(t,e,null,s);const o=n,i=In(e,n);let l=e._start;for(i!==null&&(l=i.p,n-=i.index,n===0&&(l=l.prev,n+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(n<=l.length){n<l.length&&tt(t,X(l.id.client,l.id.clock+n));break}n-=l.length}return e._searchMarker&&Gt(e._searchMarker,o,s.length),pn(t,e,l,s)},$c=(t,e,n)=>{let o=(e._searchMarker||[]).reduce((i,l)=>l.index>i.index?l:i,{index:0,p:e._start}).p;if(o)for(;o.right;)o=o.right;return pn(t,e,o,n)},gi=(t,e,n,s)=>{if(s===0)return;const o=n,i=s,l=In(e,n);let h=e._start;for(l!==null&&(h=l.p,n-=l.index);h!==null&&n>0;h=h.right)!h.deleted&&h.countable&&(n<h.length&&tt(t,X(h.id.client,h.id.clock+n)),n-=h.length);for(;s>0&&h!==null;)h.deleted||(s<h.length&&tt(t,X(h.id.client,h.id.clock+s)),h.delete(t),s-=h.length),h=h.right;if(s>0)throw di();e._searchMarker&&Gt(e._searchMarker,o,-i+s)},yn=(t,e,n)=>{const s=e._map.get(n);s!==void 0&&s.delete(t)},kr=(t,e,n,s)=>{const o=e._map.get(n)||null,i=t.doc,l=i.clientID;let h;if(s==null)h=new dt([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:h=new dt([s]);break;case Uint8Array:h=new tn(s);break;case It:h=new nn(s);break;default:if(s instanceof pe)h=new ze(s);else throw new Error("Unexpected content type")}new ce(X(l,de(i.store,l)),o,o&&o.lastId,null,null,e,n,h).integrate(t,0)},Rr=(t,e)=>{t.doc??ye();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},pi=t=>{const e={};return t.doc??ye(),t._map.forEach((n,s)=>{n.deleted||(e[s]=n.content.getContent()[n.length-1])}),e},yi=(t,e)=>{t.doc??ye();const n=t._map.get(e);return n!==void 0&&!n.deleted},Vc=(t,e)=>{const n={};return t._map.forEach((s,o)=>{let i=s;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&bt(i,e)&&(n[o]=i.content.getContent()[i.length-1])}),n},on=t=>(t.doc??ye(),sc(t._map.entries(),e=>!e[1].deleted));class Wc extends Ln{}class vt extends pe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new vt;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new vt}clone(){const e=new vt;return e.insert(0,this.toArray().map(n=>n instanceof pe?n.clone():n)),e}get length(){return this.doc??ye(),this._length}_callObserver(e,n){super._callObserver(e,n),On(this,e,new Wc(this,e))}insert(e,n){this.doc!==null?ee(this.doc,s=>{fi(s,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ee(this.doc,n=>{$c(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ee(this.doc,s=>{gi(s,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return ui(this,e)}toArray(){return li(this)}slice(e=0,n=this.length){return ai(this,e,n)}toJSON(){return this.map(e=>e instanceof pe?e.toJSON():e)}map(e){return hi(this,e)}forEach(e){Jt(this,e)}[Symbol.iterator](){return Pc(this)}_write(e){e.writeTypeRef(ga)}}const Hc=t=>new vt;class qc extends Ln{constructor(e,n,s){super(e,n),this.keysChanged=s}}class At extends pe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((s,o)=>{this.set(o,s)}),this._prelimContent=null}_copy(){return new At}clone(){const e=new At;return this.forEach((n,s)=>{e.set(s,n instanceof pe?n.clone():n)}),e}_callObserver(e,n){On(this,e,new qc(this,e,n))}toJSON(){this.doc??ye();const e={};return this._map.forEach((n,s)=>{if(!n.deleted){const o=n.content.getContent()[n.length-1];e[s]=o instanceof pe?o.toJSON():o}}),e}get size(){return[...on(this)].length}keys(){return Pn(on(this),e=>e[0])}values(){return Pn(on(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Pn(on(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ye(),this._map.forEach((n,s)=>{n.deleted||e(n.content.getContent()[n.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ee(this.doc,n=>{yn(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ee(this.doc,s=>{kr(s,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Rr(this,e)}has(e){return yi(this,e)}clear(){this.doc!==null?ee(this.doc,e=>{this.forEach(function(n,s,o){yn(e,o,s)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(pa)}}const zc=t=>new At,Qe=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&No(t,e);class nr{constructor(e,n,s,o){this.left=e,this.right=n,this.index=s,this.currentAttributes=o}forward(){switch(this.right===null&&Ue(),this.right.content.constructor){case ae:this.right.deleted||Ot(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ss=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case ae:e.right.deleted||Ot(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&tt(t,X(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},cn=(t,e,n,s)=>{const o=new Map,i=s?In(e,n):null;if(i){const l=new nr(i.p.left,i.p,i.index,o);return ss(t,l,n-i.index)}else{const l=new nr(null,e._start,0,o);return ss(t,l,n)}},mi=(t,e,n,s)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ae&&Qe(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const o=t.doc,i=o.clientID;s.forEach((l,h)=>{const a=n.left,y=n.right,m=new ce(X(i,de(o.store,i)),a,a&&a.lastId,y,y&&y.id,e,null,new ae(h,l));m.integrate(t,0),n.right=m,n.forward()})},Ot=(t,e)=>{const{key:n,value:s}=e;s===null?t.delete(n):t.set(n,s)},wi=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===ae&&Qe(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},bi=(t,e,n,s)=>{const o=t.doc,i=o.clientID,l=new Map;for(const h in s){const a=s[h],y=n.currentAttributes.get(h)??null;if(!Qe(y,a)){l.set(h,y);const{left:m,right:u}=n;n.right=new ce(X(i,de(o.store,i)),m,m&&m.lastId,u,u&&u.id,e,null,new ae(h,a)),n.right.integrate(t,0),n.forward()}}return l},Vn=(t,e,n,s,o)=>{n.currentAttributes.forEach((d,p)=>{o[p]===void 0&&(o[p]=null)});const i=t.doc,l=i.clientID;wi(n,o);const h=bi(t,e,n,o),a=s.constructor===String?new Be(s):s instanceof pe?new ze(s):new gt(s);let{left:y,right:m,index:u}=n;e._searchMarker&&Gt(e._searchMarker,n.index,a.getLength()),m=new ce(X(l,de(i.store,l)),y,y&&y.lastId,m,m&&m.id,e,null,a),m.integrate(t,0),n.right=m,n.index=u,n.forward(),mi(t,e,n,h)},is=(t,e,n,s,o)=>{const i=t.doc,l=i.clientID;wi(n,o);const h=bi(t,e,n,o);e:for(;n.right!==null&&(s>0||h.size>0&&(n.right.deleted||n.right.content.constructor===ae));){if(!n.right.deleted)switch(n.right.content.constructor){case ae:{const{key:a,value:y}=n.right.content,m=o[a];if(m!==void 0){if(Qe(m,y))h.delete(a);else{if(s===0)break e;h.set(a,y)}n.right.delete(t)}else n.currentAttributes.set(a,y);break}default:s<n.right.length&&tt(t,X(n.right.id.client,n.right.id.clock+s)),s-=n.right.length;break}n.forward()}if(s>0){let a="";for(;s>0;s--)a+=`
`;n.right=new ce(X(l,de(i.store,l)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Be(a)),n.right.integrate(t,0),n.forward()}mi(t,e,n,h)},_i=(t,e,n,s,o)=>{let i=e;const l=we();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===ae){const y=i.content;l.set(y.key,y)}i=i.right}let h=0,a=!1;for(;e!==i;){if(n===e&&(a=!0),!e.deleted){const y=e.content;switch(y.constructor){case ae:{const{key:m,value:u}=y,d=s.get(m)??null;(l.get(m)!==y||d===u)&&(e.delete(t),h++,!a&&(o.get(m)??null)===u&&d!==u&&(d===null?o.delete(m):o.set(m,d))),!a&&!e.deleted&&Ot(o,y);break}}}e=e.right}return h},Yc=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ae){const s=e.content.key;n.has(s)?e.delete(t):n.add(s)}e=e.left}},Gc=t=>{let e=0;return ee(t.doc,n=>{let s=t._start,o=t._start,i=we();const l=Jn(i);for(;o;){if(o.deleted===!1)switch(o.content.constructor){case ae:Ot(l,o.content);break;default:e+=_i(n,s,o,i,l),i=Jn(l),s=o;break}o=o.right}}),e},Jc=t=>{const e=new Set,n=t.doc;for(const[s,o]of t.afterState.entries()){const i=t.beforeState.get(s)||0;o!==i&&ri(t,n.store.clients.get(s),i,o,l=>{!l.deleted&&l.content.constructor===ae&&l.constructor!==Se&&e.add(l.parent)})}ee(n,s=>{Hs(t,t.deleteSet,o=>{if(o instanceof Se||!o.parent._hasFormatting||e.has(o.parent))return;const i=o.parent;o.content.constructor===ae?e.add(i):Yc(s,o)});for(const o of e)Gc(o)})},os=(t,e,n)=>{const s=n,o=Jn(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ze:case gt:case Be:n<e.right.length&&tt(t,X(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&_i(t,i,e.right,o,e.currentAttributes);const l=(e.left||e.right).parent;return l._searchMarker&&Gt(l._searchMarker,e.index,-s+n),e};class Kc extends Ln{constructor(e,n,s){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(o=>{o===null?this.childListChanged=!0:this.keysChanged.add(o)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ee(e,s=>{const o=new Map,i=new Map;let l=this.target._start,h=null;const a={};let y="",m=0,u=0;const d=()=>{if(h!==null){let p=null;switch(h){case"delete":u>0&&(p={delete:u}),u=0;break;case"insert":(typeof y=="object"||y.length>0)&&(p={insert:y},o.size>0&&(p.attributes={},o.forEach((g,_)=>{g!==null&&(p.attributes[_]=g)}))),y="";break;case"retain":m>0&&(p={retain:m},Io(a)||(p.attributes=xo({},a))),m=0;break}p&&n.push(p),h=null}};for(;l!==null;){switch(l.content.constructor){case ze:case gt:this.adds(l)?this.deletes(l)||(d(),h="insert",y=l.content.getContent()[0],d()):this.deletes(l)?(h!=="delete"&&(d(),h="delete"),u+=1):l.deleted||(h!=="retain"&&(d(),h="retain"),m+=1);break;case Be:this.adds(l)?this.deletes(l)||(h!=="insert"&&(d(),h="insert"),y+=l.content.str):this.deletes(l)?(h!=="delete"&&(d(),h="delete"),u+=l.length):l.deleted||(h!=="retain"&&(d(),h="retain"),m+=l.length);break;case ae:{const{key:p,value:g}=l.content;if(this.adds(l)){if(!this.deletes(l)){const _=o.get(p)??null;Qe(_,g)?g!==null&&l.delete(s):(h==="retain"&&d(),Qe(g,i.get(p)??null)?delete a[p]:a[p]=g)}}else if(this.deletes(l)){i.set(p,g);const _=o.get(p)??null;Qe(_,g)||(h==="retain"&&d(),a[p]=_)}else if(!l.deleted){i.set(p,g);const _=a[p];_!==void 0&&(Qe(_,g)?_!==null&&l.delete(s):(h==="retain"&&d(),g===null?delete a[p]:a[p]=g))}l.deleted||(h==="insert"&&d(),Ot(o,l.content));break}}l=l.right}for(d();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Dt extends pe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ye(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new Dt}clone(){const e=new Dt;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const s=new Kc(this,e,n);On(this,e,s),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ye();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Be&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ee(this.doc,s=>{const o=new nr(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const l=e[i];if(l.insert!==void 0){const h=!n&&typeof l.insert=="string"&&i===e.length-1&&o.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof h!="string"||h.length>0)&&Vn(s,this,o,h,l.attributes||{})}else l.retain!==void 0?is(s,this,o,l.retain,l.attributes||{}):l.delete!==void 0&&os(s,o,l.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,s){this.doc??ye();const o=[],i=new Map,l=this.doc;let h="",a=this._start;function y(){if(h.length>0){const u={};let d=!1;i.forEach((g,_)=>{d=!0,u[_]=g});const p={insert:h};d&&(p.attributes=u),o.push(p),h=""}}const m=()=>{for(;a!==null;){if(bt(a,e)||n!==void 0&&bt(a,n))switch(a.content.constructor){case Be:{const u=i.get("ychange");e!==void 0&&!bt(a,e)?(u===void 0||u.user!==a.id.client||u.type!=="removed")&&(y(),i.set("ychange",s?s("removed",a.id):{type:"removed"})):n!==void 0&&!bt(a,n)?(u===void 0||u.user!==a.id.client||u.type!=="added")&&(y(),i.set("ychange",s?s("added",a.id):{type:"added"})):u!==void 0&&(y(),i.delete("ychange")),h+=a.content.str;break}case ze:case gt:{y();const u={insert:a.content.getContent()[0]};if(i.size>0){const d={};u.attributes=d,i.forEach((p,g)=>{d[g]=p})}o.push(u);break}case ae:bt(a,e)&&(y(),Ot(i,a.content));break}a=a.right}y()};return e||n?ee(l,u=>{e&&er(u,e),n&&er(u,n),m()},"cleanup"):m(),o}insert(e,n,s){if(n.length<=0)return;const o=this.doc;o!==null?ee(o,i=>{const l=cn(i,this,e,!s);s||(s={},l.currentAttributes.forEach((h,a)=>{s[a]=h})),Vn(i,this,l,n,s)}):this._pending.push(()=>this.insert(e,n,s))}insertEmbed(e,n,s){const o=this.doc;o!==null?ee(o,i=>{const l=cn(i,this,e,!s);Vn(i,this,l,n,s||{})}):this._pending.push(()=>this.insertEmbed(e,n,s||{}))}delete(e,n){if(n===0)return;const s=this.doc;s!==null?ee(s,o=>{os(o,cn(o,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,s){if(n===0)return;const o=this.doc;o!==null?ee(o,i=>{const l=cn(i,this,e,!1);l.right!==null&&is(i,this,l,n,s)}):this._pending.push(()=>this.format(e,n,s))}removeAttribute(e){this.doc!==null?ee(this.doc,n=>{yn(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ee(this.doc,s=>{kr(s,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Rr(this,e)}getAttributes(){return pi(this)}_write(e){e.writeTypeRef(ya)}}const Xc=t=>new Dt;class Wn{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ye()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===xt||n.constructor===ut)&&n._start!==null)e=n._start;else for(;e!==null;){const s=e.next;if(s!==null){e=s;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ut extends pe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ut}clone(){const e=new ut;return e.insert(0,this.toArray().map(n=>n instanceof pe?n.clone():n)),e}get length(){return this.doc??ye(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Wn(this,e)}querySelector(e){e=e.toUpperCase();const s=new Wn(this,o=>o.nodeName&&o.nodeName.toUpperCase()===e).next();return s.done?null:s.value}querySelectorAll(e){return e=e.toUpperCase(),We(new Wn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){On(this,e,new ea(this,n,e))}toString(){return hi(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},s){const o=e.createDocumentFragment();return s!==void 0&&s._createAssociation(o,this),Jt(this,i=>{o.insertBefore(i.toDOM(e,n,s),null)}),o}insert(e,n){this.doc!==null?ee(this.doc,s=>{fi(s,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ee(this.doc,s=>{const o=e&&e instanceof pe?e._item:e;pn(s,this,o,n)});else{const s=this._prelimContent,o=e===null?0:s.findIndex(i=>i===e)+1;if(o===0&&e!==null)throw Me("Reference item not found");s.splice(o,0,...n)}}delete(e,n=1){this.doc!==null?ee(this.doc,s=>{gi(s,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return li(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return ui(this,e)}slice(e=0,n=this.length){return ai(this,e,n)}forEach(e){Jt(this,e)}_write(e){e.writeTypeRef(wa)}}const Zc=t=>new ut;class xt extends ut{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((s,o)=>{this.setAttribute(o,s)}),this._prelimAttrs=null}_copy(){return new xt(this.nodeName)}clone(){const e=new xt(this.nodeName),n=this.getAttributes();return Lo(n,(s,o)=>{typeof s=="string"&&e.setAttribute(o,s)}),e.insert(0,this.toArray().map(s=>s instanceof pe?s.clone():s)),e}toString(){const e=this.getAttributes(),n=[],s=[];for(const h in e)s.push(h);s.sort();const o=s.length;for(let h=0;h<o;h++){const a=s[h];n.push(a+'="'+e[a]+'"')}const i=this.nodeName.toLocaleLowerCase(),l=n.length>0?" "+n.join(" "):"";return`<${i}${l}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?ee(this.doc,n=>{yn(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ee(this.doc,s=>{kr(s,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Rr(this,e)}hasAttribute(e){return yi(this,e)}getAttributes(e){return e?Vc(this,e):pi(this)}toDOM(e=document,n={},s){const o=e.createElement(this.nodeName),i=this.getAttributes();for(const l in i){const h=i[l];typeof h=="string"&&o.setAttribute(l,h)}return Jt(this,l=>{o.appendChild(l.toDOM(e,n,s))}),s!==void 0&&s._createAssociation(o,this),o}_write(e){e.writeTypeRef(ma),e.writeKey(this.nodeName)}}const Qc=t=>new xt(t.readKey());class ea extends Ln{constructor(e,n,s){super(e,s),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(o=>{o===null?this.childListChanged=!0:this.attributesChanged.add(o)})}}class mn extends At{constructor(e){super(),this.hookName=e}_copy(){return new mn(this.hookName)}clone(){const e=new mn(this.hookName);return this.forEach((n,s)=>{e.set(s,n)}),e}toDOM(e=document,n={},s){const o=n[this.hookName];let i;return o!==void 0?i=o.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(i,this),i}_write(e){e.writeTypeRef(ba),e.writeKey(this.hookName)}}const ta=t=>new mn(t.readKey());class wn extends Dt{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new wn}clone(){const e=new wn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,s){const o=e.createTextNode(this.toString());return s!==void 0&&s._createAssociation(o,this),o}toString(){return this.toDelta().map(e=>{const n=[];for(const o in e.attributes){const i=[];for(const l in e.attributes[o])i.push({key:l,value:e.attributes[o][l]});i.sort((l,h)=>l.key<h.key?-1:1),n.push({nodeName:o,attrs:i})}n.sort((o,i)=>o.nodeName<i.nodeName?-1:1);let s="";for(let o=0;o<n.length;o++){const i=n[o];s+=`<${i.nodeName}`;for(let l=0;l<i.attrs.length;l++){const h=i.attrs[l];s+=` ${h.key}="${h.value}"`}s+=">"}s+=e.insert;for(let o=n.length-1;o>=0;o--)s+=`</${n[o].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(_a)}}const na=t=>new wn;class Tr{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Oe()}mergeWith(e){return!1}write(e,n,s){throw Oe()}integrate(e,n){throw Oe()}}const ra=0;class Se extends Tr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ni(e.doc.store,this)}write(e,n){e.writeInfo(ra),e.writeLen(this.length-n)}getMissing(e,n){return null}}class tn{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new tn(this.content)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const sa=t=>new tn(t.readBuf());class Kt{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Kt(this.len)}splice(e){const n=new Kt(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){fn(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const ia=t=>new Kt(t.readLen()),vi=(t,e)=>new It({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class nn{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new nn(vi(this.doc.guid,this.opts))}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const oa=t=>new nn(vi(t.readString(),t.readAny()));class gt{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new gt(this.embed)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const ca=t=>new gt(t.readJSON());class ae{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ae(this.key,this.value)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){const s=n.parent;s._searchMarker=null,s._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const aa=t=>new ae(t.readKey(),t.readJSON());class bn{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new bn(this.arr)}splice(e){const n=new bn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const s=this.arr.length;e.writeLen(s-n);for(let o=n;o<s;o++){const i=this.arr[o];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const la=t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++){const o=t.readString();o==="undefined"?n.push(void 0):n.push(JSON.parse(o))}return new bn(n)},ha=Yt("node_env")==="development";class dt{constructor(e){this.arr=e,ha&&xs(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new dt(this.arr)}splice(e){const n=new dt(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const s=this.arr.length;e.writeLen(s-n);for(let o=n;o<s;o++){const i=this.arr[o];e.writeAny(i)}}getRef(){return 8}}const ua=t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++)n.push(t.readAny());return new dt(n)};class Be{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Be(this.str)}splice(e){const n=new Be(this.str.slice(e));this.str=this.str.slice(0,e);const s=this.str.charCodeAt(e-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const da=t=>new Be(t.readString()),fa=[Hc,zc,Xc,Qc,Zc,ta,na],ga=0,pa=1,ya=2,ma=3,wa=4,ba=5,_a=6;class ze{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ze(this.type._copy())}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(s=>{s.deleted?s.id.clock<(e.beforeState.get(s.id.client)||0)&&e._mergeStructs.push(s):s.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(e,!0),s=s.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const va=t=>new ze(fa[t.readTypeRef()](t)),_n=(t,e,n)=>{const{client:s,clock:o}=e.id,i=new ce(X(s,o+n),e,X(s,o+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=X(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class ce extends Tr{constructor(e,n,s,o,i,l,h,a){super(e,a.getLength()),this.origin=s,this.left=n,this.right=o,this.rightOrigin=i,this.parent=l,this.parentSub=h,this.redone=null,this.content=a,this.info=this.content.isCountable()?Ur:0}set marker(e){(this.info&Un)>0!==e&&(this.info^=Un)}get marker(){return(this.info&Un)>0}get keep(){return(this.info&Mr)>0}set keep(e){this.keep!==e&&(this.info^=Mr)}get countable(){return(this.info&Ur)>0}get deleted(){return(this.info&Mn)>0}set deleted(e){this.deleted!==e&&(this.info^=Mn)}markDeleted(){this.info|=Mn}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=de(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=de(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===_t&&this.id.client!==this.parent.client&&this.parent.clock>=de(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=es(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=tt(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Se||this.right&&this.right.constructor===Se)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ce?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ce&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===_t){const s=$n(n,this.parent);s.constructor===Se?this.parent=null:this.parent=s.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=es(e,e.doc.store,X(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,o;if(s!==null)o=s.right;else if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start;const i=new Set,l=new Set;for(;o!==null&&o!==this.right;){if(l.add(o),i.add(o),sn(this.origin,o.origin)){if(o.id.client<this.id.client)s=o,i.clear();else if(sn(this.rightOrigin,o.rightOrigin))break}else if(o.origin!==null&&l.has($n(e.doc.store,o.origin)))i.has($n(e.doc.store,o.origin))||(s=o,i.clear());else break;o=o.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ni(e.doc.store,this),this.content.integrate(e,this),ns(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Se(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:X(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&sn(e.origin,this.lastId)&&this.right===e&&sn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(s=>{s.p===e&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),fn(e.deleteSet,this.id.client,this.id.clock,this.length),ns(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ue();this.content.gc(e),n?Rc(e,this,new Se(this.id,this.length)):this.content=new Kt(this.length)}write(e,n){const s=n>0?X(this.id.client,this.id.clock+n-1):this.origin,o=this.rightOrigin,i=this.parentSub,l=this.content.getRef()&kn|(s===null?0:_e)|(o===null?0:$e)|(i===null?0:Ht);if(e.writeInfo(l),s!==null&&e.writeLeftID(s),o!==null&&e.writeRightID(o),s===null&&o===null){const h=this.parent;if(h._item!==void 0){const a=h._item;if(a===null){const y=Ec(h);e.writeParentInfo(!0),e.writeString(y)}else e.writeParentInfo(!1),e.writeLeftID(a.id)}else h.constructor===String?(e.writeParentInfo(!0),e.writeString(h)):h.constructor===_t?(e.writeParentInfo(!1),e.writeLeftID(h)):Ue();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Si=(t,e)=>Sa[e&kn](t),Sa=[()=>{Ue()},ia,la,sa,da,ca,aa,va,ua,oa,()=>{Ue()}],Ca=10;class Ce extends Tr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Ue()}write(e,n){e.writeInfo(Ca),W(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Ei="__ $YJS$ __";Ci[Ei]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ci[Ei]=!0;const Ea=1200,ka=2500,vn=3e4,rr=t=>{if(t.shouldConnect&&t.ws===null){const e=new WebSocket(t.url),n=t.binaryType;let s=null;n&&(e.binaryType=n),t.ws=e,t.connecting=!0,t.connected=!1,e.onmessage=l=>{t.lastMessageReceived=He();const h=l.data,a=typeof h=="string"?JSON.parse(h):h;a&&a.type==="pong"&&(clearTimeout(s),s=setTimeout(i,vn/2)),t.emit("message",[a,t])};const o=l=>{t.ws!==null&&(t.ws=null,t.connecting=!1,t.connected?(t.connected=!1,t.emit("disconnect",[{type:"disconnect",error:l},t])):t.unsuccessfulReconnects++,setTimeout(rr,ar(Yi(t.unsuccessfulReconnects+1)*Ea,ka),t)),clearTimeout(s)},i=()=>{t.ws===e&&t.send({type:"ping"})};e.onclose=()=>o(null),e.onerror=l=>o(l),e.onopen=()=>{t.lastMessageReceived=He(),t.connecting=!1,t.connected=!0,t.unsuccessfulReconnects=0,t.emit("connect",[{type:"connect"},t]),s=setTimeout(i,vn/2)}}};class Ra extends bs{constructor(e,{binaryType:n}={}){super(),this.url=e,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&vn<He()-this.lastMessageReceived&&this.ws.close()},vn/2),rr(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&rr(this)}}const ki=new Map;class Ta{constructor(e){this.room=e,this.onmessage=null,this._onChange=n=>n.key===e&&this.onmessage!==null&&this.onmessage({data:Ms(n.newValue||"")}),Ao(this._onChange)}postMessage(e){Ts.setItem(this.room,Ns(Wo(e)))}close(){Do(this._onChange)}}const Aa=typeof BroadcastChannel>"u"?Ta:BroadcastChannel,Ar=t=>ve(ki,t,()=>{const e=et(),n=new Aa(t);return n.onmessage=s=>e.forEach(o=>o(s.data,"broadcastchannel")),{bc:n,subs:e}}),Da=(t,e)=>(Ar(t).subs.add(e),e),xa=(t,e)=>{const n=Ar(t),s=n.subs.delete(e);return s&&n.subs.size===0&&(n.bc.close(),ki.delete(t)),s},La=(t,e,n=null)=>{const s=Ar(t);s.bc.postMessage(e),s.subs.forEach(o=>o(e,n))},Ia=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else n!==void 0&&n()}};var Le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function an(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ri={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){var n=Math.floor,s=Math.abs,o=Math.pow;return function(){function i(l,h,a){function y(d,p){if(!h[d]){if(!l[d]){var g=typeof an=="function"&&an;if(!p&&g)return g(d,!0);if(m)return m(d,!0);var _=new Error("Cannot find module '"+d+"'");throw _.code="MODULE_NOT_FOUND",_}var I=h[d]={exports:{}};l[d][0].call(I.exports,function(L){var M=l[d][1][L];return y(M||L)},I,I.exports,i,l,h,a)}return h[d].exports}for(var m=typeof an=="function"&&an,u=0;u<a.length;u++)y(a[u]);return y}return i}()({1:[function(i,l,h){function a(v){var S=v.length;if(0<S%4)throw new Error("Invalid string. Length must be a multiple of 4");var T=v.indexOf("=");T===-1&&(T=S);var E=T===S?0:4-T%4;return[T,E]}function y(v,S,T){return 3*(S+T)/4-T}function m(v){var S,T,E=a(v),x=E[0],U=E[1],k=new I(y(v,x,U)),A=0,F=0<U?x-4:x;for(T=0;T<F;T+=4)S=_[v.charCodeAt(T)]<<18|_[v.charCodeAt(T+1)]<<12|_[v.charCodeAt(T+2)]<<6|_[v.charCodeAt(T+3)],k[A++]=255&S>>16,k[A++]=255&S>>8,k[A++]=255&S;return U===2&&(S=_[v.charCodeAt(T)]<<2|_[v.charCodeAt(T+1)]>>4,k[A++]=255&S),U===1&&(S=_[v.charCodeAt(T)]<<10|_[v.charCodeAt(T+1)]<<4|_[v.charCodeAt(T+2)]>>2,k[A++]=255&S>>8,k[A++]=255&S),k}function u(v){return g[63&v>>18]+g[63&v>>12]+g[63&v>>6]+g[63&v]}function d(v,S,T){for(var E,x=[],U=S;U<T;U+=3)E=(16711680&v[U]<<16)+(65280&v[U+1]<<8)+(255&v[U+2]),x.push(u(E));return x.join("")}function p(v){for(var S,T=v.length,E=T%3,x=[],U=16383,k=0,A=T-E;k<A;k+=U)x.push(d(v,k,k+U>A?A:k+U));return E===1?(S=v[T-1],x.push(g[S>>2]+g[63&S<<4]+"==")):E===2&&(S=(v[T-2]<<8)+v[T-1],x.push(g[S>>10]+g[63&S>>4]+g[63&S<<2]+"=")),x.join("")}h.byteLength=function(v){var S=a(v),T=S[0],E=S[1];return 3*(T+E)/4-E},h.toByteArray=m,h.fromByteArray=p;for(var g=[],_=[],I=typeof Uint8Array>"u"?Array:Uint8Array,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=0,w=L.length;M<w;++M)g[M]=L[M],_[L.charCodeAt(M)]=M;_[45]=62,_[95]=63},{}],2:[function(){},{}],3:[function(i,l,h){(function(){(function(){var a=String.fromCharCode,y=Math.min;function m(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var c=new Uint8Array(r);return c.__proto__=u.prototype,c}function u(r,c,f){if(typeof r=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(r)}return d(r,c,f)}function d(r,c,f){if(typeof r=="string")return I(r,c);if(ArrayBuffer.isView(r))return L(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(D(r,ArrayBuffer)||r&&D(r.buffer,ArrayBuffer))return M(r,c,f);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var C=r.valueOf&&r.valueOf();if(C!=null&&C!==r)return u.from(C,c,f);var R=w(r);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),c,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function p(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function g(r,c,f){return p(r),0>=r||c===void 0?m(r):typeof f=="string"?m(r).fill(c,f):m(r).fill(c)}function _(r){return p(r),m(0>r?0:0|v(r))}function I(r,c){if((typeof c!="string"||c==="")&&(c="utf8"),!u.isEncoding(c))throw new TypeError("Unknown encoding: "+c);var f=0|S(r,c),C=m(f),R=C.write(r,c);return R!==f&&(C=C.slice(0,R)),C}function L(r){for(var c=0>r.length?0:0|v(r.length),f=m(c),C=0;C<c;C+=1)f[C]=255&r[C];return f}function M(r,c,f){if(0>c||r.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<c+(f||0))throw new RangeError('"length" is outside of buffer bounds');var C;return C=c===void 0&&f===void 0?new Uint8Array(r):f===void 0?new Uint8Array(r,c):new Uint8Array(r,c,f),C.__proto__=u.prototype,C}function w(r){if(u.isBuffer(r)){var c=0|v(r.length),f=m(c);return f.length===0||r.copy(f,0,0,c),f}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?L(r.data):void 0:typeof r.length!="number"||O(r.length)?m(0):L(r)}function v(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|r}function S(r,c){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||D(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var f=r.length,C=2<arguments.length&&arguments[2]===!0;if(!C&&f===0)return 0;for(var R=!1;;)switch(c){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return rt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*f;case"hex":return f>>>1;case"base64":return Te(r).length;default:if(R)return C?-1:rt(r).length;c=(""+c).toLowerCase(),R=!0}}function T(r,c,f){var C=!1;if((c===void 0||0>c)&&(c=0),c>this.length||((f===void 0||f>this.length)&&(f=this.length),0>=f)||(f>>>=0,c>>>=0,f<=c))return"";for(r||(r="utf8");;)switch(r){case"hex":return ke(this,c,f);case"utf8":case"utf-8":return oe(this,c,f);case"ascii":return H(this,c,f);case"latin1":case"binary":return pt(this,c,f);case"base64":return Z(this,c,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ye(this,c,f);default:if(C)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),C=!0}}function E(r,c,f){var C=r[c];r[c]=r[f],r[f]=C}function x(r,c,f,C,R){if(r.length===0)return-1;if(typeof f=="string"?(C=f,f=0):2147483647<f?f=2147483647:-2147483648>f&&(f=-2147483648),f=+f,O(f)&&(f=R?0:r.length-1),0>f&&(f=r.length+f),f>=r.length){if(R)return-1;f=r.length-1}else if(0>f)if(R)f=0;else return-1;if(typeof c=="string"&&(c=u.from(c,C)),u.isBuffer(c))return c.length===0?-1:U(r,c,f,C,R);if(typeof c=="number")return c&=255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(r,c,f):Uint8Array.prototype.lastIndexOf.call(r,c,f):U(r,[c],f,C,R);throw new TypeError("val must be string, number or Buffer")}function U(r,c,f,C,R){function N(yt,Ut){return $===1?yt[Ut]:yt.readUInt16BE(Ut*$)}var $=1,J=r.length,te=c.length;if(C!==void 0&&(C=(C+"").toLowerCase(),C==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(2>r.length||2>c.length)return-1;$=2,J/=2,te/=2,f/=2}var K;if(R){var G=-1;for(K=f;K<J;K++)if(N(r,K)!==N(c,G===-1?0:K-G))G!==-1&&(K-=K-G),G=-1;else if(G===-1&&(G=K),K-G+1===te)return G*$}else for(f+te>J&&(f=J-te),K=f;0<=K;K--){for(var fe=!0,st=0;st<te;st++)if(N(r,K+st)!==N(c,st)){fe=!1;break}if(fe)return K}return-1}function k(r,c,f,C){f=+f||0;var R=r.length-f;C?(C=+C,C>R&&(C=R)):C=R;var N=c.length;C>N/2&&(C=N/2);for(var $,J=0;J<C;++J){if($=parseInt(c.substr(2*J,2),16),O($))return J;r[f+J]=$}return J}function A(r,c,f,C){return Ae(rt(c,r.length-f),r,f,C)}function F(r,c,f,C){return Ae(Mt(c),r,f,C)}function j(r,c,f,C){return F(r,c,f,C)}function q(r,c,f,C){return Ae(Te(c),r,f,C)}function Y(r,c,f,C){return Ae(Ke(c,r.length-f),r,f,C)}function Z(r,c,f){return c===0&&f===r.length?B.fromByteArray(r):B.fromByteArray(r.slice(c,f))}function oe(r,c,f){f=y(r.length,f);for(var C=[],R=c;R<f;){var N=r[R],$=null,J=239<N?4:223<N?3:191<N?2:1;if(R+J<=f){var te,K,G,fe;J===1?128>N&&($=N):J===2?(te=r[R+1],(192&te)==128&&(fe=(31&N)<<6|63&te,127<fe&&($=fe))):J===3?(te=r[R+1],K=r[R+2],(192&te)==128&&(192&K)==128&&(fe=(15&N)<<12|(63&te)<<6|63&K,2047<fe&&(55296>fe||57343<fe)&&($=fe))):J===4&&(te=r[R+1],K=r[R+2],G=r[R+3],(192&te)==128&&(192&K)==128&&(192&G)==128&&(fe=(15&N)<<18|(63&te)<<12|(63&K)<<6|63&G,65535<fe&&1114112>fe&&($=fe)))}$===null?($=65533,J=1):65535<$&&($-=65536,C.push(55296|1023&$>>>10),$=56320|1023&$),C.push($),R+=J}return me(C)}function me(r){var c=r.length;if(c<=4096)return a.apply(String,r);for(var f="",C=0;C<c;)f+=a.apply(String,r.slice(C,C+=4096));return f}function H(r,c,f){var C="";f=y(r.length,f);for(var R=c;R<f;++R)C+=a(127&r[R]);return C}function pt(r,c,f){var C="";f=y(r.length,f);for(var R=c;R<f;++R)C+=a(r[R]);return C}function ke(r,c,f){var C=r.length;(!c||0>c)&&(c=0),(!f||0>f||f>C)&&(f=C);for(var R="",N=c;N<f;++N)R+=nt(r[N]);return R}function Ye(r,c,f){for(var C=r.slice(c,f),R="",N=0;N<C.length;N+=2)R+=a(C[N]+256*C[N+1]);return R}function se(r,c,f){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+c>f)throw new RangeError("Trying to access beyond buffer length")}function Q(r,c,f,C,R,N){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>R||c<N)throw new RangeError('"value" argument is out of bounds');if(f+C>r.length)throw new RangeError("Index out of range")}function Re(r,c,f,C){if(f+C>r.length)throw new RangeError("Index out of range");if(0>f)throw new RangeError("Index out of range")}function Ge(r,c,f,C,R){return c=+c,f>>>=0,R||Re(r,c,f,4),V.write(r,c,f,C,23,4),f+4}function Je(r,c,f,C,R){return c=+c,f>>>=0,R||Re(r,c,f,8),V.write(r,c,f,C,52,8),f+8}function Nt(r){if(r=r.split("=")[0],r=r.trim().replace(b,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function nt(r){return 16>r?"0"+r.toString(16):r.toString(16)}function rt(r,c){c=c||1/0;for(var f,C=r.length,R=null,N=[],$=0;$<C;++$){if(f=r.charCodeAt($),55295<f&&57344>f){if(!R){if(56319<f){-1<(c-=3)&&N.push(239,191,189);continue}else if($+1===C){-1<(c-=3)&&N.push(239,191,189);continue}R=f;continue}if(56320>f){-1<(c-=3)&&N.push(239,191,189),R=f;continue}f=(R-55296<<10|f-56320)+65536}else R&&-1<(c-=3)&&N.push(239,191,189);if(R=null,128>f){if(0>(c-=1))break;N.push(f)}else if(2048>f){if(0>(c-=2))break;N.push(192|f>>6,128|63&f)}else if(65536>f){if(0>(c-=3))break;N.push(224|f>>12,128|63&f>>6,128|63&f)}else if(1114112>f){if(0>(c-=4))break;N.push(240|f>>18,128|63&f>>12,128|63&f>>6,128|63&f)}else throw new Error("Invalid code point")}return N}function Mt(r){for(var c=[],f=0;f<r.length;++f)c.push(255&r.charCodeAt(f));return c}function Ke(r,c){for(var f,C,R,N=[],$=0;$<r.length&&!(0>(c-=2));++$)f=r.charCodeAt($),C=f>>8,R=f%256,N.push(R),N.push(C);return N}function Te(r){return B.toByteArray(Nt(r))}function Ae(r,c,f,C){for(var R=0;R<C&&!(R+f>=c.length||R>=r.length);++R)c[R+f]=r[R];return R}function D(r,c){return r instanceof c||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===c.name}function O(r){return r!==r}var B=i("base64-js"),V=i("ieee754");h.Buffer=u,h.SlowBuffer=function(r){return+r!=r&&(r=0),u.alloc(+r)},h.INSPECT_MAX_BYTES=50,h.kMaxLength=2147483647,u.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),u.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){return u.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){return u.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(r,c,f){return d(r,c,f)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(r,c,f){return g(r,c,f)},u.allocUnsafe=function(r){return _(r)},u.allocUnsafeSlow=function(r){return _(r)},u.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==u.prototype},u.compare=function(r,c){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),D(c,Uint8Array)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(r)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===c)return 0;for(var f=r.length,C=c.length,R=0,N=y(f,C);R<N;++R)if(r[R]!==c[R]){f=r[R],C=c[R];break}return f<C?-1:C<f?1:0},u.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(r,c){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return u.alloc(0);var f;if(c===void 0)for(c=0,f=0;f<r.length;++f)c+=r[f].length;var C=u.allocUnsafe(c),R=0;for(f=0;f<r.length;++f){var N=r[f];if(D(N,Uint8Array)&&(N=u.from(N)),!u.isBuffer(N))throw new TypeError('"list" argument must be an Array of Buffers');N.copy(C,R),R+=N.length}return C},u.byteLength=S,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var c=0;c<r;c+=2)E(this,c,c+1);return this},u.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var c=0;c<r;c+=4)E(this,c,c+3),E(this,c+1,c+2);return this},u.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var c=0;c<r;c+=8)E(this,c,c+7),E(this,c+1,c+6),E(this,c+2,c+5),E(this,c+3,c+4);return this},u.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?oe(this,0,r):T.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(r){if(!u.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||u.compare(this,r)===0},u.prototype.inspect=function(){var r="",c=h.INSPECT_MAX_BYTES;return r=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(r+=" ... "),"<Buffer "+r+">"},u.prototype.compare=function(r,c,f,C,R){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(c===void 0&&(c=0),f===void 0&&(f=r?r.length:0),C===void 0&&(C=0),R===void 0&&(R=this.length),0>c||f>r.length||0>C||R>this.length)throw new RangeError("out of range index");if(C>=R&&c>=f)return 0;if(C>=R)return-1;if(c>=f)return 1;if(c>>>=0,f>>>=0,C>>>=0,R>>>=0,this===r)return 0;for(var N=R-C,$=f-c,J=y(N,$),te=this.slice(C,R),K=r.slice(c,f),G=0;G<J;++G)if(te[G]!==K[G]){N=te[G],$=K[G];break}return N<$?-1:$<N?1:0},u.prototype.includes=function(r,c,f){return this.indexOf(r,c,f)!==-1},u.prototype.indexOf=function(r,c,f){return x(this,r,c,f,!0)},u.prototype.lastIndexOf=function(r,c,f){return x(this,r,c,f,!1)},u.prototype.write=function(r,c,f,C){if(c===void 0)C="utf8",f=this.length,c=0;else if(f===void 0&&typeof c=="string")C=c,f=this.length,c=0;else if(isFinite(c))c>>>=0,isFinite(f)?(f>>>=0,C===void 0&&(C="utf8")):(C=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-c;if((f===void 0||f>R)&&(f=R),0<r.length&&(0>f||0>c)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");C||(C="utf8");for(var N=!1;;)switch(C){case"hex":return k(this,r,c,f);case"utf8":case"utf-8":return A(this,r,c,f);case"ascii":return F(this,r,c,f);case"latin1":case"binary":return j(this,r,c,f);case"base64":return q(this,r,c,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,r,c,f);default:if(N)throw new TypeError("Unknown encoding: "+C);C=(""+C).toLowerCase(),N=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(r,c){var f=this.length;r=~~r,c=c===void 0?f:~~c,0>r?(r+=f,0>r&&(r=0)):r>f&&(r=f),0>c?(c+=f,0>c&&(c=0)):c>f&&(c=f),c<r&&(c=r);var C=this.subarray(r,c);return C.__proto__=u.prototype,C},u.prototype.readUIntLE=function(r,c,f){r>>>=0,c>>>=0,f||se(r,c,this.length);for(var C=this[r],R=1,N=0;++N<c&&(R*=256);)C+=this[r+N]*R;return C},u.prototype.readUIntBE=function(r,c,f){r>>>=0,c>>>=0,f||se(r,c,this.length);for(var C=this[r+--c],R=1;0<c&&(R*=256);)C+=this[r+--c]*R;return C},u.prototype.readUInt8=function(r,c){return r>>>=0,c||se(r,1,this.length),this[r]},u.prototype.readUInt16LE=function(r,c){return r>>>=0,c||se(r,2,this.length),this[r]|this[r+1]<<8},u.prototype.readUInt16BE=function(r,c){return r>>>=0,c||se(r,2,this.length),this[r]<<8|this[r+1]},u.prototype.readUInt32LE=function(r,c){return r>>>=0,c||se(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},u.prototype.readUInt32BE=function(r,c){return r>>>=0,c||se(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},u.prototype.readIntLE=function(r,c,f){r>>>=0,c>>>=0,f||se(r,c,this.length);for(var C=this[r],R=1,N=0;++N<c&&(R*=256);)C+=this[r+N]*R;return R*=128,C>=R&&(C-=o(2,8*c)),C},u.prototype.readIntBE=function(r,c,f){r>>>=0,c>>>=0,f||se(r,c,this.length);for(var C=c,R=1,N=this[r+--C];0<C&&(R*=256);)N+=this[r+--C]*R;return R*=128,N>=R&&(N-=o(2,8*c)),N},u.prototype.readInt8=function(r,c){return r>>>=0,c||se(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},u.prototype.readInt16LE=function(r,c){r>>>=0,c||se(r,2,this.length);var f=this[r]|this[r+1]<<8;return 32768&f?4294901760|f:f},u.prototype.readInt16BE=function(r,c){r>>>=0,c||se(r,2,this.length);var f=this[r+1]|this[r]<<8;return 32768&f?4294901760|f:f},u.prototype.readInt32LE=function(r,c){return r>>>=0,c||se(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},u.prototype.readInt32BE=function(r,c){return r>>>=0,c||se(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},u.prototype.readFloatLE=function(r,c){return r>>>=0,c||se(r,4,this.length),V.read(this,r,!0,23,4)},u.prototype.readFloatBE=function(r,c){return r>>>=0,c||se(r,4,this.length),V.read(this,r,!1,23,4)},u.prototype.readDoubleLE=function(r,c){return r>>>=0,c||se(r,8,this.length),V.read(this,r,!0,52,8)},u.prototype.readDoubleBE=function(r,c){return r>>>=0,c||se(r,8,this.length),V.read(this,r,!1,52,8)},u.prototype.writeUIntLE=function(r,c,f,C){if(r=+r,c>>>=0,f>>>=0,!C){var R=o(2,8*f)-1;Q(this,r,c,f,R,0)}var N=1,$=0;for(this[c]=255&r;++$<f&&(N*=256);)this[c+$]=255&r/N;return c+f},u.prototype.writeUIntBE=function(r,c,f,C){if(r=+r,c>>>=0,f>>>=0,!C){var R=o(2,8*f)-1;Q(this,r,c,f,R,0)}var N=f-1,$=1;for(this[c+N]=255&r;0<=--N&&($*=256);)this[c+N]=255&r/$;return c+f},u.prototype.writeUInt8=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,1,255,0),this[c]=255&r,c+1},u.prototype.writeUInt16LE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,2,65535,0),this[c]=255&r,this[c+1]=r>>>8,c+2},u.prototype.writeUInt16BE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,2,65535,0),this[c]=r>>>8,this[c+1]=255&r,c+2},u.prototype.writeUInt32LE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,4,4294967295,0),this[c+3]=r>>>24,this[c+2]=r>>>16,this[c+1]=r>>>8,this[c]=255&r,c+4},u.prototype.writeUInt32BE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,4,4294967295,0),this[c]=r>>>24,this[c+1]=r>>>16,this[c+2]=r>>>8,this[c+3]=255&r,c+4},u.prototype.writeIntLE=function(r,c,f,C){if(r=+r,c>>>=0,!C){var R=o(2,8*f-1);Q(this,r,c,f,R-1,-R)}var N=0,$=1,J=0;for(this[c]=255&r;++N<f&&($*=256);)0>r&&J===0&&this[c+N-1]!==0&&(J=1),this[c+N]=255&(r/$>>0)-J;return c+f},u.prototype.writeIntBE=function(r,c,f,C){if(r=+r,c>>>=0,!C){var R=o(2,8*f-1);Q(this,r,c,f,R-1,-R)}var N=f-1,$=1,J=0;for(this[c+N]=255&r;0<=--N&&($*=256);)0>r&&J===0&&this[c+N+1]!==0&&(J=1),this[c+N]=255&(r/$>>0)-J;return c+f},u.prototype.writeInt8=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,1,127,-128),0>r&&(r=255+r+1),this[c]=255&r,c+1},u.prototype.writeInt16LE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,2,32767,-32768),this[c]=255&r,this[c+1]=r>>>8,c+2},u.prototype.writeInt16BE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,2,32767,-32768),this[c]=r>>>8,this[c+1]=255&r,c+2},u.prototype.writeInt32LE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,4,2147483647,-2147483648),this[c]=255&r,this[c+1]=r>>>8,this[c+2]=r>>>16,this[c+3]=r>>>24,c+4},u.prototype.writeInt32BE=function(r,c,f){return r=+r,c>>>=0,f||Q(this,r,c,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[c]=r>>>24,this[c+1]=r>>>16,this[c+2]=r>>>8,this[c+3]=255&r,c+4},u.prototype.writeFloatLE=function(r,c,f){return Ge(this,r,c,!0,f)},u.prototype.writeFloatBE=function(r,c,f){return Ge(this,r,c,!1,f)},u.prototype.writeDoubleLE=function(r,c,f){return Je(this,r,c,!0,f)},u.prototype.writeDoubleBE=function(r,c,f){return Je(this,r,c,!1,f)},u.prototype.copy=function(r,c,f,C){if(!u.isBuffer(r))throw new TypeError("argument should be a Buffer");if(f||(f=0),C||C===0||(C=this.length),c>=r.length&&(c=r.length),c||(c=0),0<C&&C<f&&(C=f),C===f||r.length===0||this.length===0)return 0;if(0>c)throw new RangeError("targetStart out of bounds");if(0>f||f>=this.length)throw new RangeError("Index out of range");if(0>C)throw new RangeError("sourceEnd out of bounds");C>this.length&&(C=this.length),r.length-c<C-f&&(C=r.length-c+f);var R=C-f;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(c,f,C);else if(this===r&&f<c&&c<C)for(var N=R-1;0<=N;--N)r[N+c]=this[N+f];else Uint8Array.prototype.set.call(r,this.subarray(f,C),c);return R},u.prototype.fill=function(r,c,f,C){if(typeof r=="string"){if(typeof c=="string"?(C=c,c=0,f=this.length):typeof f=="string"&&(C=f,f=this.length),C!==void 0&&typeof C!="string")throw new TypeError("encoding must be a string");if(typeof C=="string"&&!u.isEncoding(C))throw new TypeError("Unknown encoding: "+C);if(r.length===1){var R=r.charCodeAt(0);(C==="utf8"&&128>R||C==="latin1")&&(r=R)}}else typeof r=="number"&&(r&=255);if(0>c||this.length<c||this.length<f)throw new RangeError("Out of range index");if(f<=c)return this;c>>>=0,f=f===void 0?this.length:f>>>0,r||(r=0);var N;if(typeof r=="number")for(N=c;N<f;++N)this[N]=r;else{var $=u.isBuffer(r)?r:u.from(r,C),J=$.length;if(J===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(N=0;N<f-c;++N)this[N+c]=$[N%J]}return this};var b=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,i("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(i,l,h){(function(a){(function(){function y(){let u;try{u=h.storage.getItem("debug")}catch{}return!u&&typeof a<"u"&&"env"in a&&(u=a.env.DEBUG),u}h.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+l.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let p=0,g=0;u[0].replace(/%[a-zA-Z%]/g,_=>{_==="%%"||(p++,_==="%c"&&(g=p))}),u.splice(g,0,d)},h.save=function(u){try{u?h.storage.setItem("debug",u):h.storage.removeItem("debug")}catch{}},h.load=y,h.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},h.storage=function(){try{return localStorage}catch{}}(),h.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],h.log=console.debug||console.log||(()=>{}),l.exports=i("./common")(h);const{formatters:m}=l.exports;m.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}).call(this)}).call(this,i("_process"))},{"./common":5,_process:12}],5:[function(i,l){l.exports=function(h){function a(u){function d(..._){if(!d.enabled)return;const I=d,L=+new Date,M=L-(p||L);I.diff=M,I.prev=p,I.curr=L,p=L,_[0]=a.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let w=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(S,T)=>{if(S==="%%")return"%";w++;const E=a.formatters[T];if(typeof E=="function"){const x=_[w];S=E.call(I,x),_.splice(w,1),w--}return S}),a.formatArgs.call(I,_),(I.log||a.log).apply(I,_)}let p,g=null;return d.namespace=u,d.useColors=a.useColors(),d.color=a.selectColor(u),d.extend=y,d.destroy=a.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?a.enabled(u):g,set:_=>{g=_}}),typeof a.init=="function"&&a.init(d),d}function y(u,d){const p=a(this.namespace+(typeof d>"u"?":":d)+u);return p.log=this.log,p}function m(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(u){return u instanceof Error?u.stack||u.message:u},a.disable=function(){const u=[...a.names.map(m),...a.skips.map(m).map(d=>"-"+d)].join(",");return a.enable(""),u},a.enable=function(u){a.save(u),a.names=[],a.skips=[];let d;const p=(typeof u=="string"?u:"").split(/[\s,]+/),g=p.length;for(d=0;d<g;d++)p[d]&&(u=p[d].replace(/\*/g,".*?"),u[0]==="-"?a.skips.push(new RegExp("^"+u.substr(1)+"$")):a.names.push(new RegExp("^"+u+"$")))},a.enabled=function(u){if(u[u.length-1]==="*")return!0;let d,p;for(d=0,p=a.skips.length;d<p;d++)if(a.skips[d].test(u))return!1;for(d=0,p=a.names.length;d<p;d++)if(a.names[d].test(u))return!0;return!1},a.humanize=i("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(h).forEach(u=>{a[u]=h[u]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(u){let d=0;for(let p=0;p<u.length;p++)d=(d<<5)-d+u.charCodeAt(p),d|=0;return a.colors[s(d)%a.colors.length]},a.enable(a.load()),a}},{ms:11}],6:[function(i,l){function h(a,y){for(const m in y)Object.defineProperty(a,m,{value:y[m],enumerable:!0,configurable:!0});return a}l.exports=function(a,y,m){if(!a||typeof a=="string")throw new TypeError("Please pass an Error to err-code");m||(m={}),typeof y=="object"&&(m=y,y=""),y&&(m.code=y);try{return h(a,m)}catch{m.message=a.message,m.stack=a.stack;const d=function(){};return d.prototype=Object.create(Object.getPrototypeOf(a)),h(new d,m)}}},{}],7:[function(i,l){function h(k){console&&console.warn&&console.warn(k)}function a(){a.init.call(this)}function y(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function m(k){return k._maxListeners===void 0?a.defaultMaxListeners:k._maxListeners}function u(k,A,F,j){var q,Y,Z;if(y(F),Y=k._events,Y===void 0?(Y=k._events=Object.create(null),k._eventsCount=0):(Y.newListener!==void 0&&(k.emit("newListener",A,F.listener?F.listener:F),Y=k._events),Z=Y[A]),Z===void 0)Z=Y[A]=F,++k._eventsCount;else if(typeof Z=="function"?Z=Y[A]=j?[F,Z]:[Z,F]:j?Z.unshift(F):Z.push(F),q=m(k),0<q&&Z.length>q&&!Z.warned){Z.warned=!0;var oe=new Error("Possible EventEmitter memory leak detected. "+Z.length+" "+(A+" listeners added. Use emitter.setMaxListeners() to increase limit"));oe.name="MaxListenersExceededWarning",oe.emitter=k,oe.type=A,oe.count=Z.length,h(oe)}return k}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(k,A,F){var j={fired:!1,wrapFn:void 0,target:k,type:A,listener:F},q=d.bind(j);return q.listener=F,j.wrapFn=q,q}function g(k,A,F){var j=k._events;if(j===void 0)return[];var q=j[A];return q===void 0?[]:typeof q=="function"?F?[q.listener||q]:[q]:F?M(q):I(q,q.length)}function _(k){var A=this._events;if(A!==void 0){var F=A[k];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function I(k,A){for(var F=Array(A),j=0;j<A;++j)F[j]=k[j];return F}function L(k,A){for(;A+1<k.length;A++)k[A]=k[A+1];k.pop()}function M(k){for(var A=Array(k.length),F=0;F<A.length;++F)A[F]=k[F].listener||k[F];return A}function w(k,A,F){typeof k.on=="function"&&v(k,"error",A,F)}function v(k,A,F,j){if(typeof k.on=="function")j.once?k.once(A,F):k.on(A,F);else if(typeof k.addEventListener=="function")k.addEventListener(A,function q(Y){j.once&&k.removeEventListener(A,q),F(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var S,T=typeof Reflect=="object"?Reflect:null,E=T&&typeof T.apply=="function"?T.apply:function(k,A,F){return Function.prototype.apply.call(k,A,F)};S=T&&typeof T.ownKeys=="function"?T.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var x=Number.isNaN||function(k){return k!==k};l.exports=a,l.exports.once=function(k,A){return new Promise(function(F,j){function q(Z){k.removeListener(A,Y),j(Z)}function Y(){typeof k.removeListener=="function"&&k.removeListener("error",q),F([].slice.call(arguments))}v(k,A,Y,{once:!0}),A!=="error"&&w(k,q,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var U=10;Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(k){if(typeof k!="number"||0>k||x(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");U=k}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||x(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},a.prototype.getMaxListeners=function(){return m(this)},a.prototype.emit=function(k){for(var A=[],F=1;F<arguments.length;F++)A.push(arguments[F]);var j=k==="error",q=this._events;if(q!==void 0)j=j&&q.error===void 0;else if(!j)return!1;if(j){var Y;if(0<A.length&&(Y=A[0]),Y instanceof Error)throw Y;var Z=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw Z.context=Y,Z}var oe=q[k];if(oe===void 0)return!1;if(typeof oe=="function")E(oe,this,A);else for(var me=oe.length,H=I(oe,me),F=0;F<me;++F)E(H[F],this,A);return!0},a.prototype.addListener=function(k,A){return u(this,k,A,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(k,A){return u(this,k,A,!0)},a.prototype.once=function(k,A){return y(A),this.on(k,p(this,k,A)),this},a.prototype.prependOnceListener=function(k,A){return y(A),this.prependListener(k,p(this,k,A)),this},a.prototype.removeListener=function(k,A){var F,j,q,Y,Z;if(y(A),j=this._events,j===void 0)return this;if(F=j[k],F===void 0)return this;if(F===A||F.listener===A)--this._eventsCount==0?this._events=Object.create(null):(delete j[k],j.removeListener&&this.emit("removeListener",k,F.listener||A));else if(typeof F!="function"){for(q=-1,Y=F.length-1;0<=Y;Y--)if(F[Y]===A||F[Y].listener===A){Z=F[Y].listener,q=Y;break}if(0>q)return this;q===0?F.shift():L(F,q),F.length===1&&(j[k]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",k,Z||A)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(k){var A,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[k]),this;if(arguments.length===0){var q,Y=Object.keys(F);for(j=0;j<Y.length;++j)q=Y[j],q!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=F[k],typeof A=="function")this.removeListener(k,A);else if(A!==void 0)for(j=A.length-1;0<=j;j--)this.removeListener(k,A[j]);return this},a.prototype.listeners=function(k){return g(this,k,!0)},a.prototype.rawListeners=function(k){return g(this,k,!1)},a.listenerCount=function(k,A){return typeof k.listenerCount=="function"?k.listenerCount(A):_.call(k,A)},a.prototype.listenerCount=_,a.prototype.eventNames=function(){return 0<this._eventsCount?S(this._events):[]}},{}],8:[function(i,l){l.exports=function(){if(typeof globalThis>"u")return null;var h={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return h.RTCPeerConnection?h:null}},{}],9:[function(i,l,h){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */h.read=function(a,y,m,u,d){var p,g,_=8*d-u-1,I=(1<<_)-1,L=I>>1,M=-7,w=m?d-1:0,v=m?-1:1,S=a[y+w];for(w+=v,p=S&(1<<-M)-1,S>>=-M,M+=_;0<M;p=256*p+a[y+w],w+=v,M-=8);for(g=p&(1<<-M)-1,p>>=-M,M+=u;0<M;g=256*g+a[y+w],w+=v,M-=8);if(p===0)p=1-L;else{if(p===I)return g?NaN:(S?-1:1)*(1/0);g+=o(2,u),p-=L}return(S?-1:1)*g*o(2,p-u)},h.write=function(a,y,m,u,d,p){var g,_,I,L=Math.LN2,M=Math.log,w=8*p-d-1,v=(1<<w)-1,S=v>>1,T=d===23?o(2,-24)-o(2,-77):0,E=u?0:p-1,x=u?1:-1,U=0>y||y===0&&0>1/y?1:0;for(y=s(y),isNaN(y)||y===1/0?(_=isNaN(y)?1:0,g=v):(g=n(M(y)/L),1>y*(I=o(2,-g))&&(g--,I*=2),y+=1<=g+S?T/I:T*o(2,1-S),2<=y*I&&(g++,I/=2),g+S>=v?(_=0,g=v):1<=g+S?(_=(y*I-1)*o(2,d),g+=S):(_=y*o(2,S-1)*o(2,d),g=0));8<=d;a[m+E]=255&_,E+=x,_/=256,d-=8);for(g=g<<d|_,w+=d;0<w;a[m+E]=255&g,E+=x,g/=256,w-=8);a[m+E-x]|=128*U}},{}],10:[function(i,l){l.exports=typeof Object.create=="function"?function(h,a){a&&(h.super_=a,h.prototype=Object.create(a.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:function(h,a){if(a){h.super_=a;var y=function(){};y.prototype=a.prototype,h.prototype=new y,h.prototype.constructor=h}}},{}],11:[function(i,l){var h=Math.round;function a(d){if(d+="",!(100<d.length)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(p){var g=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();return _==="years"||_==="year"||_==="yrs"||_==="yr"||_==="y"?315576e5*g:_==="weeks"||_==="week"||_==="w"?6048e5*g:_==="days"||_==="day"||_==="d"?864e5*g:_==="hours"||_==="hour"||_==="hrs"||_==="hr"||_==="h"?36e5*g:_==="minutes"||_==="minute"||_==="mins"||_==="min"||_==="m"?6e4*g:_==="seconds"||_==="second"||_==="secs"||_==="sec"||_==="s"?1e3*g:_==="milliseconds"||_==="millisecond"||_==="msecs"||_==="msec"||_==="ms"?g:void 0}}}function y(d){var p=s(d);return 864e5<=p?h(d/864e5)+"d":36e5<=p?h(d/36e5)+"h":6e4<=p?h(d/6e4)+"m":1e3<=p?h(d/1e3)+"s":d+"ms"}function m(d){var p=s(d);return 864e5<=p?u(d,p,864e5,"day"):36e5<=p?u(d,p,36e5,"hour"):6e4<=p?u(d,p,6e4,"minute"):1e3<=p?u(d,p,1e3,"second"):d+" ms"}function u(d,p,g,_){return h(d/g)+" "+_+(p>=1.5*g?"s":"")}l.exports=function(d,p){p=p||{};var g=typeof d;if(g=="string"&&0<d.length)return a(d);if(g==="number"&&isFinite(d))return p.long?m(d):y(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(i,l){function h(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function y(T){if(_===setTimeout)return setTimeout(T,0);if((_===h||!_)&&setTimeout)return _=setTimeout,setTimeout(T,0);try{return _(T,0)}catch{try{return _.call(null,T,0)}catch{return _.call(this,T,0)}}}function m(T){if(I===clearTimeout)return clearTimeout(T);if((I===a||!I)&&clearTimeout)return I=clearTimeout,clearTimeout(T);try{return I(T)}catch{try{return I.call(null,T)}catch{return I.call(this,T)}}}function u(){v&&M&&(v=!1,M.length?w=M.concat(w):S=-1,w.length&&d())}function d(){if(!v){var T=y(u);v=!0;for(var E=w.length;E;){for(M=w,w=[];++S<E;)M&&M[S].run();S=-1,E=w.length}M=null,v=!1,m(T)}}function p(T,E){this.fun=T,this.array=E}function g(){}var _,I,L=l.exports={};(function(){try{_=typeof setTimeout=="function"?setTimeout:h}catch{_=h}try{I=typeof clearTimeout=="function"?clearTimeout:a}catch{I=a}})();var M,w=[],v=!1,S=-1;L.nextTick=function(T){var E=Array(arguments.length-1);if(1<arguments.length)for(var x=1;x<arguments.length;x++)E[x-1]=arguments[x];w.push(new p(T,E)),w.length!==1||v||y(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=g,L.addListener=g,L.once=g,L.off=g,L.removeListener=g,L.removeAllListeners=g,L.emit=g,L.prependListener=g,L.prependOnceListener=g,L.listeners=function(){return[]},L.binding=function(){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],13:[function(i,l){(function(h){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let a;l.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?h:window):y=>(a||(a=Promise.resolve())).then(y).catch(m=>setTimeout(()=>{throw m},0))}).call(this)}).call(this,typeof Le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Le)},{}],14:[function(i,l){(function(h,a){(function(){var y=i("safe-buffer").Buffer,m=a.crypto||a.msCrypto;l.exports=m&&m.getRandomValues?function(u,d){if(u>4294967295)throw new RangeError("requested too many random bytes");var p=y.allocUnsafe(u);if(0<u)if(65536<u)for(var g=0;g<u;g+=65536)m.getRandomValues(p.slice(g,g+65536));else m.getRandomValues(p);return typeof d=="function"?h.nextTick(function(){d(null,p)}):p}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,i("_process"),typeof Le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Le)},{_process:12,"safe-buffer":30}],15:[function(i,l){function h(g,_){g.prototype=Object.create(_.prototype),g.prototype.constructor=g,g.__proto__=_}function a(g,_,I){function L(w,v,S){return typeof _=="string"?_:_(w,v,S)}I||(I=Error);var M=function(w){function v(S,T,E){return w.call(this,L(S,T,E))||this}return h(v,w),v}(I);M.prototype.name=I.name,M.prototype.code=g,p[g]=M}function y(g,_){if(Array.isArray(g)){var I=g.length;return g=g.map(function(L){return L+""}),2<I?"one of ".concat(_," ").concat(g.slice(0,I-1).join(", "),", or ")+g[I-1]:I===2?"one of ".concat(_," ").concat(g[0]," or ").concat(g[1]):"of ".concat(_," ").concat(g[0])}return"of ".concat(_," ").concat(g+"")}function m(g,_,I){return g.substr(!I||0>I?0:+I,_.length)===_}function u(g,_,I){return(I===void 0||I>g.length)&&(I=g.length),g.substring(I-_.length,I)===_}function d(g,_,I){return typeof I!="number"&&(I=0),!(I+_.length>g.length)&&g.indexOf(_,I)!==-1}var p={};a("ERR_INVALID_OPT_VALUE",function(g,_){return'The value "'+_+'" is invalid for option "'+g+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(g,_,I){var L;typeof _=="string"&&m(_,"not ")?(L="must not be",_=_.replace(/^not /,"")):L="must be";var M;if(u(g," argument"))M="The ".concat(g," ").concat(L," ").concat(y(_,"type"));else{var w=d(g,".")?"property":"argument";M='The "'.concat(g,'" ').concat(w," ").concat(L," ").concat(y(_,"type"))}return M+=". Received type ".concat(typeof I),M},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),l.exports.codes=p},{}],16:[function(i,l){(function(h){(function(){function a(L){return this instanceof a?(d.call(this,L),p.call(this,L),this.allowHalfOpen=!0,void(L&&(L.readable===!1&&(this.readable=!1),L.writable===!1&&(this.writable=!1),L.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",y))))):new a(L)}function y(){this._writableState.ended||h.nextTick(m,this)}function m(L){L.end()}var u=Object.keys||function(L){var M=[];for(var w in L)M.push(w);return M};l.exports=a;var d=i("./_stream_readable"),p=i("./_stream_writable");i("inherits")(a,d);for(var g,_=u(p.prototype),I=0;I<_.length;I++)g=_[I],a.prototype[g]||(a.prototype[g]=p.prototype[g]);Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(L){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=L,this._writableState.destroyed=L)}})}).call(this)}).call(this,i("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(i,l){function h(y){return this instanceof h?void a.call(this,y):new h(y)}l.exports=h;var a=i("./_stream_transform");i("inherits")(h,a),h.prototype._transform=function(y,m,u){u(null,y)}},{"./_stream_transform":19,inherits:10}],18:[function(i,l){(function(h,a){(function(){function y(b){return Ye.from(b)}function m(b){return Ye.isBuffer(b)||b instanceof se}function u(b,r,c){return typeof b.prependListener=="function"?b.prependListener(r,c):void(b._events&&b._events[r]?Array.isArray(b._events[r])?b._events[r].unshift(c):b._events[r]=[c,b._events[r]]:b.on(r,c))}function d(b,r,c){me=me||i("./_stream_duplex"),b=b||{},typeof c!="boolean"&&(c=r instanceof me),this.objectMode=!!b.objectMode,c&&(this.objectMode=this.objectMode||!!b.readableObjectMode),this.highWaterMark=Mt(this,b,"readableHighWaterMark",c),this.buffer=new Nt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=b.emitClose!==!1,this.autoDestroy=!!b.autoDestroy,this.destroyed=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(!Re&&(Re=i("string_decoder/").StringDecoder),this.decoder=new Re(b.encoding),this.encoding=b.encoding)}function p(b){if(me=me||i("./_stream_duplex"),!(this instanceof p))return new p(b);var r=this instanceof me;this._readableState=new d(b,this,r),this.readable=!0,b&&(typeof b.read=="function"&&(this._read=b.read),typeof b.destroy=="function"&&(this._destroy=b.destroy)),ke.call(this)}function g(b,r,c,f,C){H("readableAddChunk",r);var R=b._readableState;if(r===null)R.reading=!1,w(b,R);else{var N;if(C||(N=I(R,r)),N)B(b,N);else if(!(R.objectMode||r&&0<r.length))f||(R.reading=!1,T(b,R));else if(typeof r=="string"||R.objectMode||Object.getPrototypeOf(r)===Ye.prototype||(r=y(r)),f)R.endEmitted?B(b,new O):_(b,R,r,!0);else if(R.ended)B(b,new Ae);else{if(R.destroyed)return!1;R.reading=!1,R.decoder&&!c?(r=R.decoder.write(r),R.objectMode||r.length!==0?_(b,R,r,!1):T(b,R)):_(b,R,r,!1)}}return!R.ended&&(R.length<R.highWaterMark||R.length===0)}function _(b,r,c,f){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,b.emit("data",c)):(r.length+=r.objectMode?1:c.length,f?r.buffer.unshift(c):r.buffer.push(c),r.needReadable&&v(b)),T(b,r)}function I(b,r){var c;return m(r)||typeof r=="string"||r===void 0||b.objectMode||(c=new Te("chunk",["string","Buffer","Uint8Array"],r)),c}function L(b){return 1073741824<=b?b=1073741824:(b--,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,b|=b>>>16,b++),b}function M(b,r){return 0>=b||r.length===0&&r.ended?0:r.objectMode?1:b===b?(b>r.highWaterMark&&(r.highWaterMark=L(b)),b<=r.length?b:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function w(b,r){if(H("onEofChunk"),!r.ended){if(r.decoder){var c=r.decoder.end();c&&c.length&&(r.buffer.push(c),r.length+=r.objectMode?1:c.length)}r.ended=!0,r.sync?v(b):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,S(b)))}}function v(b){var r=b._readableState;H("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(H("emitReadable",r.flowing),r.emittedReadable=!0,h.nextTick(S,b))}function S(b){var r=b._readableState;H("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(b.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,j(b)}function T(b,r){r.readingMore||(r.readingMore=!0,h.nextTick(E,b,r))}function E(b,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var c=r.length;if(H("maybeReadMore read 0"),b.read(0),c===r.length)break}r.readingMore=!1}function x(b){return function(){var r=b._readableState;H("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&pt(b,"data")&&(r.flowing=!0,j(b))}}function U(b){var r=b._readableState;r.readableListening=0<b.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<b.listenerCount("data")&&b.resume()}function k(b){H("readable nexttick read 0"),b.read(0)}function A(b,r){r.resumeScheduled||(r.resumeScheduled=!0,h.nextTick(F,b,r))}function F(b,r){H("resume",r.reading),r.reading||b.read(0),r.resumeScheduled=!1,b.emit("resume"),j(b),r.flowing&&!r.reading&&b.read(0)}function j(b){var r=b._readableState;for(H("flow",r.flowing);r.flowing&&b.read()!==null;);}function q(b,r){if(r.length===0)return null;var c;return r.objectMode?c=r.buffer.shift():!b||b>=r.length?(c=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):c=r.buffer.consume(b,r.decoder),c}function Y(b){var r=b._readableState;H("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,h.nextTick(Z,r,b))}function Z(b,r){if(H("endReadableNT",b.endEmitted,b.length),!b.endEmitted&&b.length===0&&(b.endEmitted=!0,r.readable=!1,r.emit("end"),b.autoDestroy)){var c=r._writableState;(!c||c.autoDestroy&&c.finished)&&r.destroy()}}function oe(b,r){for(var c=0,f=b.length;c<f;c++)if(b[c]===r)return c;return-1}l.exports=p;var me;p.ReadableState=d;var H;i("events").EventEmitter;var pt=function(b,r){return b.listeners(r).length},ke=i("./internal/streams/stream"),Ye=i("buffer").Buffer,se=a.Uint8Array||function(){},Q=i("util");H=Q&&Q.debuglog?Q.debuglog("stream"):function(){};var Re,Ge,Je,Nt=i("./internal/streams/buffer_list"),nt=i("./internal/streams/destroy"),rt=i("./internal/streams/state"),Mt=rt.getHighWaterMark,Ke=i("../errors").codes,Te=Ke.ERR_INVALID_ARG_TYPE,Ae=Ke.ERR_STREAM_PUSH_AFTER_EOF,D=Ke.ERR_METHOD_NOT_IMPLEMENTED,O=Ke.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("inherits")(p,ke);var B=nt.errorOrDestroy,V=["error","close","destroy","pause","resume"];Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(b){this._readableState&&(this._readableState.destroyed=b)}}),p.prototype.destroy=nt.destroy,p.prototype._undestroy=nt.undestroy,p.prototype._destroy=function(b,r){r(b)},p.prototype.push=function(b,r){var c,f=this._readableState;return f.objectMode?c=!0:typeof b=="string"&&(r=r||f.defaultEncoding,r!==f.encoding&&(b=Ye.from(b,r),r=""),c=!0),g(this,b,r,!1,c)},p.prototype.unshift=function(b){return g(this,b,null,!0,!1)},p.prototype.isPaused=function(){return this._readableState.flowing===!1},p.prototype.setEncoding=function(b){Re||(Re=i("string_decoder/").StringDecoder);var r=new Re(b);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var c=this._readableState.buffer.head,f="";c!==null;)f+=r.write(c.data),c=c.next;return this._readableState.buffer.clear(),f!==""&&this._readableState.buffer.push(f),this._readableState.length=f.length,this},p.prototype.read=function(b){H("read",b),b=parseInt(b,10);var r=this._readableState,c=b;if(b!==0&&(r.emittedReadable=!1),b===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return H("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?Y(this):v(this),null;if(b=M(b,r),b===0&&r.ended)return r.length===0&&Y(this),null;var f=r.needReadable;H("need readable",f),(r.length===0||r.length-b<r.highWaterMark)&&(f=!0,H("length less than watermark",f)),r.ended||r.reading?(f=!1,H("reading or ended",f)):f&&(H("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(b=M(c,r)));var C;return C=0<b?q(b,r):null,C===null?(r.needReadable=r.length<=r.highWaterMark,b=0):(r.length-=b,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),c!==b&&r.ended&&Y(this)),C!==null&&this.emit("data",C),C},p.prototype._read=function(){B(this,new D("_read()"))},p.prototype.pipe=function(b,r){function c(mt,wt){H("onunpipe"),mt===K&&wt&&wt.hasUnpiped===!1&&(wt.hasUnpiped=!0,C())}function f(){H("onend"),b.end()}function C(){H("cleanup"),b.removeListener("close",$),b.removeListener("finish",J),b.removeListener("drain",yt),b.removeListener("error",N),b.removeListener("unpipe",c),K.removeListener("end",f),K.removeListener("end",te),K.removeListener("data",R),Ut=!0,G.awaitDrain&&(!b._writableState||b._writableState.needDrain)&&yt()}function R(mt){H("ondata");var wt=b.write(mt);H("dest.write",wt),wt===!1&&((G.pipesCount===1&&G.pipes===b||1<G.pipesCount&&oe(G.pipes,b)!==-1)&&!Ut&&(H("false write response, pause",G.awaitDrain),G.awaitDrain++),K.pause())}function N(mt){H("onerror",mt),te(),b.removeListener("error",N),pt(b,"error")===0&&B(b,mt)}function $(){b.removeListener("finish",J),te()}function J(){H("onfinish"),b.removeListener("close",$),te()}function te(){H("unpipe"),K.unpipe(b)}var K=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=b;break;case 1:G.pipes=[G.pipes,b];break;default:G.pipes.push(b)}G.pipesCount+=1,H("pipe count=%d opts=%j",G.pipesCount,r);var fe=(!r||r.end!==!1)&&b!==h.stdout&&b!==h.stderr,st=fe?f:te;G.endEmitted?h.nextTick(st):K.once("end",st),b.on("unpipe",c);var yt=x(K);b.on("drain",yt);var Ut=!1;return K.on("data",R),u(b,"error",N),b.once("close",$),b.once("finish",J),b.emit("pipe",K),G.flowing||(H("pipe resume"),K.resume()),b},p.prototype.unpipe=function(b){var r=this._readableState,c={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return b&&b!==r.pipes?this:(b||(b=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,b&&b.emit("unpipe",this,c),this);if(!b){var f=r.pipes,C=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var R=0;R<C;R++)f[R].emit("unpipe",this,{hasUnpiped:!1});return this}var N=oe(r.pipes,b);return N===-1?this:(r.pipes.splice(N,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),b.emit("unpipe",this,c),this)},p.prototype.on=function(b,r){var c=ke.prototype.on.call(this,b,r),f=this._readableState;return b==="data"?(f.readableListening=0<this.listenerCount("readable"),f.flowing!==!1&&this.resume()):b=="readable"&&!f.endEmitted&&!f.readableListening&&(f.readableListening=f.needReadable=!0,f.flowing=!1,f.emittedReadable=!1,H("on readable",f.length,f.reading),f.length?v(this):!f.reading&&h.nextTick(k,this)),c},p.prototype.addListener=p.prototype.on,p.prototype.removeListener=function(b,r){var c=ke.prototype.removeListener.call(this,b,r);return b==="readable"&&h.nextTick(U,this),c},p.prototype.removeAllListeners=function(b){var r=ke.prototype.removeAllListeners.apply(this,arguments);return(b==="readable"||b===void 0)&&h.nextTick(U,this),r},p.prototype.resume=function(){var b=this._readableState;return b.flowing||(H("resume"),b.flowing=!b.readableListening,A(this,b)),b.paused=!1,this},p.prototype.pause=function(){return H("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(H("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},p.prototype.wrap=function(b){var r=this,c=this._readableState,f=!1;for(var C in b.on("end",function(){if(H("wrapped end"),c.decoder&&!c.ended){var N=c.decoder.end();N&&N.length&&r.push(N)}r.push(null)}),b.on("data",function(N){if(H("wrapped data"),c.decoder&&(N=c.decoder.write(N)),!(c.objectMode&&N==null)&&(c.objectMode||N&&N.length)){var $=r.push(N);$||(f=!0,b.pause())}}),b)this[C]===void 0&&typeof b[C]=="function"&&(this[C]=function(N){return function(){return b[N].apply(b,arguments)}}(C));for(var R=0;R<V.length;R++)b.on(V[R],this.emit.bind(this,V[R]));return this._read=function(N){H("wrapped _read",N),f&&(f=!1,b.resume())},this},typeof Symbol=="function"&&(p.prototype[Symbol.asyncIterator]=function(){return Ge===void 0&&(Ge=i("./internal/streams/async_iterator")),Ge(this)}),Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(p.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(p.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(b){this._readableState&&(this._readableState.flowing=b)}}),p._fromList=q,Object.defineProperty(p.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(p.from=function(b,r){return Je===void 0&&(Je=i("./internal/streams/from")),Je(p,b,r)})}).call(this)}).call(this,i("_process"),typeof Le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Le)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(i,l){function h(L,M){var w=this._transformState;w.transforming=!1;var v=w.writecb;if(v===null)return this.emit("error",new p);w.writechunk=null,w.writecb=null,M!=null&&this.push(M),v(L);var S=this._readableState;S.reading=!1,(S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}function a(L){return this instanceof a?(I.call(this,L),this._transformState={afterTransform:h.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,L&&(typeof L.transform=="function"&&(this._transform=L.transform),typeof L.flush=="function"&&(this._flush=L.flush)),void this.on("prefinish",y)):new a(L)}function y(){var L=this;typeof this._flush!="function"||this._readableState.destroyed?m(this,null,null):this._flush(function(M,w){m(L,M,w)})}function m(L,M,w){if(M)return L.emit("error",M);if(w!=null&&L.push(w),L._writableState.length)throw new _;if(L._transformState.transforming)throw new g;return L.push(null)}l.exports=a;var u=i("../errors").codes,d=u.ERR_METHOD_NOT_IMPLEMENTED,p=u.ERR_MULTIPLE_CALLBACK,g=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,_=u.ERR_TRANSFORM_WITH_LENGTH_0,I=i("./_stream_duplex");i("inherits")(a,I),a.prototype.push=function(L,M){return this._transformState.needTransform=!1,I.prototype.push.call(this,L,M)},a.prototype._transform=function(L,M,w){w(new d("_transform()"))},a.prototype._write=function(L,M,w){var v=this._transformState;if(v.writecb=w,v.writechunk=L,v.writeencoding=M,!v.transforming){var S=this._readableState;(v.needTransform||S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}},a.prototype._read=function(){var L=this._transformState;L.writechunk===null||L.transforming?L.needTransform=!0:(L.transforming=!0,this._transform(L.writechunk,L.writeencoding,L.afterTransform))},a.prototype._destroy=function(L,M){I.prototype._destroy.call(this,L,function(w){M(w)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(i,l){(function(h,a){(function(){function y(D){var O=this;this.next=null,this.entry=null,this.finish=function(){Y(O,D)}}function m(D){return H.from(D)}function u(D){return H.isBuffer(D)||D instanceof pt}function d(){}function p(D,O,B){Z=Z||i("./_stream_duplex"),D=D||{},typeof B!="boolean"&&(B=O instanceof Z),this.objectMode=!!D.objectMode,B&&(this.objectMode=this.objectMode||!!D.writableObjectMode),this.highWaterMark=se(this,D,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=D.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(b){T(O,b)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new y(this)}function g(D){Z=Z||i("./_stream_duplex");var O=this instanceof Z;return O||Ae.call(g,this)?(this._writableState=new p(D,this,O),this.writable=!0,D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final)),void me.call(this)):new g(D)}function _(D,O){var B=new Mt;Te(D,B),h.nextTick(O,B)}function I(D,O,B,V){var b;return B===null?b=new rt:typeof B!="string"&&!O.objectMode&&(b=new Re("chunk",["string","Buffer"],B)),!b||(Te(D,b),h.nextTick(V,b),!1)}function L(D,O,B){return D.objectMode||D.decodeStrings===!1||typeof O!="string"||(O=H.from(O,B)),O}function M(D,O,B,V,b,r){if(!B){var c=L(O,V,b);V!==c&&(B=!0,b="buffer",V=c)}var f=O.objectMode?1:V.length;O.length+=f;var C=O.length<O.highWaterMark;if(C||(O.needDrain=!0),O.writing||O.corked){var R=O.lastBufferedRequest;O.lastBufferedRequest={chunk:V,encoding:b,isBuf:B,callback:r,next:null},R?R.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else w(D,O,!1,f,V,b,r);return C}function w(D,O,B,V,b,r,c){O.writelen=V,O.writecb=c,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new nt("write")):B?D._writev(b,O.onwrite):D._write(b,r,O.onwrite),O.sync=!1}function v(D,O,B,V,b){--O.pendingcb,B?(h.nextTick(b,V),h.nextTick(j,D,O),D._writableState.errorEmitted=!0,Te(D,V)):(b(V),D._writableState.errorEmitted=!0,Te(D,V),j(D,O))}function S(D){D.writing=!1,D.writecb=null,D.length-=D.writelen,D.writelen=0}function T(D,O){var B=D._writableState,V=B.sync,b=B.writecb;if(typeof b!="function")throw new Je;if(S(B),O)v(D,B,V,O,b);else{var r=k(B)||D.destroyed;r||B.corked||B.bufferProcessing||!B.bufferedRequest||U(D,B),V?h.nextTick(E,D,B,r,b):E(D,B,r,b)}}function E(D,O,B,V){B||x(D,O),O.pendingcb--,V(),j(D,O)}function x(D,O){O.length===0&&O.needDrain&&(O.needDrain=!1,D.emit("drain"))}function U(D,O){O.bufferProcessing=!0;var B=O.bufferedRequest;if(D._writev&&B&&B.next){var V=O.bufferedRequestCount,b=Array(V),r=O.corkedRequestsFree;r.entry=B;for(var c=0,f=!0;B;)b[c]=B,B.isBuf||(f=!1),B=B.next,c+=1;b.allBuffers=f,w(D,O,!0,O.length,b,"",r.finish),O.pendingcb++,O.lastBufferedRequest=null,r.next?(O.corkedRequestsFree=r.next,r.next=null):O.corkedRequestsFree=new y(O),O.bufferedRequestCount=0}else{for(;B;){var C=B.chunk,R=B.encoding,N=B.callback,$=O.objectMode?1:C.length;if(w(D,O,!1,$,C,R,N),B=B.next,O.bufferedRequestCount--,O.writing)break}B===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=B,O.bufferProcessing=!1}function k(D){return D.ending&&D.length===0&&D.bufferedRequest===null&&!D.finished&&!D.writing}function A(D,O){D._final(function(B){O.pendingcb--,B&&Te(D,B),O.prefinished=!0,D.emit("prefinish"),j(D,O)})}function F(D,O){O.prefinished||O.finalCalled||(typeof D._final!="function"||O.destroyed?(O.prefinished=!0,D.emit("prefinish")):(O.pendingcb++,O.finalCalled=!0,h.nextTick(A,D,O)))}function j(D,O){var B=k(O);if(B&&(F(D,O),O.pendingcb===0&&(O.finished=!0,D.emit("finish"),O.autoDestroy))){var V=D._readableState;(!V||V.autoDestroy&&V.endEmitted)&&D.destroy()}return B}function q(D,O,B){O.ending=!0,j(D,O),B&&(O.finished?h.nextTick(B):D.once("finish",B)),O.ended=!0,D.writable=!1}function Y(D,O,B){var V=D.entry;for(D.entry=null;V;){var b=V.callback;O.pendingcb--,b(B),V=V.next}O.corkedRequestsFree.next=D}l.exports=g;var Z;g.WritableState=p;var oe={deprecate:i("util-deprecate")},me=i("./internal/streams/stream"),H=i("buffer").Buffer,pt=a.Uint8Array||function(){},ke=i("./internal/streams/destroy"),Ye=i("./internal/streams/state"),se=Ye.getHighWaterMark,Q=i("../errors").codes,Re=Q.ERR_INVALID_ARG_TYPE,Ge=Q.ERR_METHOD_NOT_IMPLEMENTED,Je=Q.ERR_MULTIPLE_CALLBACK,Nt=Q.ERR_STREAM_CANNOT_PIPE,nt=Q.ERR_STREAM_DESTROYED,rt=Q.ERR_STREAM_NULL_VALUES,Mt=Q.ERR_STREAM_WRITE_AFTER_END,Ke=Q.ERR_UNKNOWN_ENCODING,Te=ke.errorOrDestroy;i("inherits")(g,me),p.prototype.getBuffer=function(){for(var D=this.bufferedRequest,O=[];D;)O.push(D),D=D.next;return O},function(){try{Object.defineProperty(p.prototype,"buffer",{get:oe.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Ae;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Ae=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(D){return!!Ae.call(this,D)||this===g&&D&&D._writableState instanceof p}})):Ae=function(D){return D instanceof this},g.prototype.pipe=function(){Te(this,new Nt)},g.prototype.write=function(D,O,B){var V=this._writableState,b=!1,r=!V.objectMode&&u(D);return r&&!H.isBuffer(D)&&(D=m(D)),typeof O=="function"&&(B=O,O=null),r?O="buffer":!O&&(O=V.defaultEncoding),typeof B!="function"&&(B=d),V.ending?_(this,B):(r||I(this,V,D,B))&&(V.pendingcb++,b=M(this,V,r,D,O,B)),b},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var D=this._writableState;D.corked&&(D.corked--,!D.writing&&!D.corked&&!D.bufferProcessing&&D.bufferedRequest&&U(this,D))},g.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())))throw new Ke(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(D,O,B){B(new Ge("_write()"))},g.prototype._writev=null,g.prototype.end=function(D,O,B){var V=this._writableState;return typeof D=="function"?(B=D,D=null,O=null):typeof O=="function"&&(B=O,O=null),D!=null&&this.write(D,O),V.corked&&(V.corked=1,this.uncork()),V.ending||q(this,V,B),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),g.prototype.destroy=ke.destroy,g.prototype._undestroy=ke.undestroy,g.prototype._destroy=function(D,O){O(D)}}).call(this)}).call(this,i("_process"),typeof Le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Le)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(i,l){(function(h){(function(){function a(x,U,k){return U in x?Object.defineProperty(x,U,{value:k,enumerable:!0,configurable:!0,writable:!0}):x[U]=k,x}function y(x,U){return{value:x,done:U}}function m(x){var U=x[_];if(U!==null){var k=x[S].read();k!==null&&(x[w]=null,x[_]=null,x[I]=null,U(y(k,!1)))}}function u(x){h.nextTick(m,x)}function d(x,U){return function(k,A){x.then(function(){return U[M]?void k(y(void 0,!0)):void U[v](k,A)},A)}}var p,g=i("./end-of-stream"),_=Symbol("lastResolve"),I=Symbol("lastReject"),L=Symbol("error"),M=Symbol("ended"),w=Symbol("lastPromise"),v=Symbol("handlePromise"),S=Symbol("stream"),T=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((p={get stream(){return this[S]},next:function(){var x=this,U=this[L];if(U!==null)return Promise.reject(U);if(this[M])return Promise.resolve(y(void 0,!0));if(this[S].destroyed)return new Promise(function(j,q){h.nextTick(function(){x[L]?q(x[L]):j(y(void 0,!0))})});var k,A=this[w];if(A)k=new Promise(d(A,this));else{var F=this[S].read();if(F!==null)return Promise.resolve(y(F,!1));k=new Promise(this[v])}return this[w]=k,k}},a(p,Symbol.asyncIterator,function(){return this}),a(p,"return",function(){var x=this;return new Promise(function(U,k){x[S].destroy(null,function(A){return A?void k(A):void U(y(void 0,!0))})})}),p),T);l.exports=function(x){var U,k=Object.create(E,(U={},a(U,S,{value:x,writable:!0}),a(U,_,{value:null,writable:!0}),a(U,I,{value:null,writable:!0}),a(U,L,{value:null,writable:!0}),a(U,M,{value:x._readableState.endEmitted,writable:!0}),a(U,v,{value:function(A,F){var j=k[S].read();j?(k[w]=null,k[_]=null,k[I]=null,A(y(j,!1))):(k[_]=A,k[I]=F)},writable:!0}),U));return k[w]=null,g(x,function(A){if(A&&A.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=k[I];return F!==null&&(k[w]=null,k[_]=null,k[I]=null,F(A)),void(k[L]=A)}var j=k[_];j!==null&&(k[w]=null,k[_]=null,k[I]=null,j(y(void 0,!0))),k[M]=!0}),x.on("readable",u.bind(null,k)),k}}).call(this)}).call(this,i("_process"))},{"./end-of-stream":24,_process:12}],22:[function(i,l){function h(w,v){var S=Object.keys(w);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(w);v&&(T=T.filter(function(E){return Object.getOwnPropertyDescriptor(w,E).enumerable})),S.push.apply(S,T)}return S}function a(w){for(var v,S=1;S<arguments.length;S++)v=arguments[S]==null?{}:arguments[S],S%2?h(Object(v),!0).forEach(function(T){y(w,T,v[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(v)):h(Object(v)).forEach(function(T){Object.defineProperty(w,T,Object.getOwnPropertyDescriptor(v,T))});return w}function y(w,v,S){return v in w?Object.defineProperty(w,v,{value:S,enumerable:!0,configurable:!0,writable:!0}):w[v]=S,w}function m(w,v){if(!(w instanceof v))throw new TypeError("Cannot call a class as a function")}function u(w,v){for(var S,T=0;T<v.length;T++)S=v[T],S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(w,S.key,S)}function d(w,v,S){return v&&u(w.prototype,v),S&&u(w,S),w}function p(w,v,S){_.prototype.copy.call(w,v,S)}var g=i("buffer"),_=g.Buffer,I=i("util"),L=I.inspect,M=L&&L.custom||"inspect";l.exports=function(){function w(){m(this,w),this.head=null,this.tail=null,this.length=0}return d(w,[{key:"push",value:function(v){var S={data:v,next:null};0<this.length?this.tail.next=S:this.head=S,this.tail=S,++this.length}},{key:"unshift",value:function(v){var S={data:v,next:this.head};this.length===0&&(this.tail=S),this.head=S,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var S=this.head,T=""+S.data;S=S.next;)T+=v+S.data;return T}},{key:"concat",value:function(v){if(this.length===0)return _.alloc(0);for(var S=_.allocUnsafe(v>>>0),T=this.head,E=0;T;)p(T.data,S,E),E+=T.data.length,T=T.next;return S}},{key:"consume",value:function(v,S){var T;return v<this.head.data.length?(T=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):v===this.head.data.length?T=this.shift():T=S?this._getString(v):this._getBuffer(v),T}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var S=this.head,T=1,E=S.data;for(v-=E.length;S=S.next;){var x=S.data,U=v>x.length?x.length:v;if(E+=U===x.length?x:x.slice(0,v),v-=U,v===0){U===x.length?(++T,this.head=S.next?S.next:this.tail=null):(this.head=S,S.data=x.slice(U));break}++T}return this.length-=T,E}},{key:"_getBuffer",value:function(v){var S=_.allocUnsafe(v),T=this.head,E=1;for(T.data.copy(S),v-=T.data.length;T=T.next;){var x=T.data,U=v>x.length?x.length:v;if(x.copy(S,S.length-v,0,U),v-=U,v===0){U===x.length?(++E,this.head=T.next?T.next:this.tail=null):(this.head=T,T.data=x.slice(U));break}++E}return this.length-=E,S}},{key:M,value:function(v,S){return L(this,a({},S,{depth:0,customInspect:!1}))}}]),w}()},{buffer:3,util:2}],23:[function(i,l){(function(h){(function(){function a(u,d){m(u,d),y(u)}function y(u){u._writableState&&!u._writableState.emitClose||u._readableState&&!u._readableState.emitClose||u.emit("close")}function m(u,d){u.emit("error",d)}l.exports={destroy:function(u,d){var p=this,g=this._readableState&&this._readableState.destroyed,_=this._writableState&&this._writableState.destroyed;return g||_?(d?d(u):u&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,h.nextTick(m,this,u)):h.nextTick(m,this,u)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(u||null,function(I){!d&&I?p._writableState?p._writableState.errorEmitted?h.nextTick(y,p):(p._writableState.errorEmitted=!0,h.nextTick(a,p,I)):h.nextTick(a,p,I):d?(h.nextTick(y,p),d(I)):h.nextTick(y,p)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(u,d){var p=u._readableState,g=u._writableState;p&&p.autoDestroy||g&&g.autoDestroy?u.destroy(d):u.emit("error",d)}}}).call(this)}).call(this,i("_process"))},{_process:12}],24:[function(i,l){function h(d){var p=!1;return function(){if(!p){p=!0;for(var g=arguments.length,_=Array(g),I=0;I<g;I++)_[I]=arguments[I];d.apply(this,_)}}}function a(){}function y(d){return d.setHeader&&typeof d.abort=="function"}function m(d,p,g){if(typeof p=="function")return m(d,null,p);p||(p={}),g=h(g||a);var _=p.readable||p.readable!==!1&&d.readable,I=p.writable||p.writable!==!1&&d.writable,L=function(){d.writable||w()},M=d._writableState&&d._writableState.finished,w=function(){I=!1,M=!0,_||g.call(d)},v=d._readableState&&d._readableState.endEmitted,S=function(){_=!1,v=!0,I||g.call(d)},T=function(U){g.call(d,U)},E=function(){var U;return _&&!v?(d._readableState&&d._readableState.ended||(U=new u),g.call(d,U)):I&&!M?(d._writableState&&d._writableState.ended||(U=new u),g.call(d,U)):void 0},x=function(){d.req.on("finish",w)};return y(d)?(d.on("complete",w),d.on("abort",E),d.req?x():d.on("request",x)):I&&!d._writableState&&(d.on("end",L),d.on("close",L)),d.on("end",S),d.on("finish",w),p.error!==!1&&d.on("error",T),d.on("close",E),function(){d.removeListener("complete",w),d.removeListener("abort",E),d.removeListener("request",x),d.req&&d.req.removeListener("finish",w),d.removeListener("end",L),d.removeListener("close",L),d.removeListener("finish",w),d.removeListener("end",S),d.removeListener("error",T),d.removeListener("close",E)}}var u=i("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;l.exports=m},{"../../../errors":15}],25:[function(i,l){l.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(i,l){function h(M){var w=!1;return function(){w||(w=!0,M.apply(void 0,arguments))}}function a(M){if(M)throw M}function y(M){return M.setHeader&&typeof M.abort=="function"}function m(M,w,v,S){S=h(S);var T=!1;M.on("close",function(){T=!0}),g===void 0&&(g=i("./end-of-stream")),g(M,{readable:w,writable:v},function(x){return x?S(x):(T=!0,void S())});var E=!1;return function(x){if(!T)return E?void 0:(E=!0,y(M)?M.abort():typeof M.destroy=="function"?M.destroy():void S(x||new L("pipe")))}}function u(M){M()}function d(M,w){return M.pipe(w)}function p(M){return M.length&&typeof M[M.length-1]=="function"?M.pop():a}var g,_=i("../../../errors").codes,I=_.ERR_MISSING_ARGS,L=_.ERR_STREAM_DESTROYED;l.exports=function(){for(var M=arguments.length,w=Array(M),v=0;v<M;v++)w[v]=arguments[v];var S=p(w);if(Array.isArray(w[0])&&(w=w[0]),2>w.length)throw new I("streams");var T,E=w.map(function(x,U){var k=U<w.length-1;return m(x,k,0<U,function(A){T||(T=A),A&&E.forEach(u),k||(E.forEach(u),S(T))})});return w.reduce(d)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(i,l){function h(y,m,u){return y.highWaterMark==null?m?y[u]:null:y.highWaterMark}var a=i("../../../errors").codes.ERR_INVALID_OPT_VALUE;l.exports={getHighWaterMark:function(y,m,u,d){var p=h(m,d,u);if(p!=null){if(!(isFinite(p)&&n(p)===p)||0>p){var g=d?u:"highWaterMark";throw new a(g,p)}return n(p)}return y.objectMode?16:16384}}},{"../../../errors":15}],28:[function(i,l){l.exports=i("events").EventEmitter},{events:7}],29:[function(i,l,h){h=l.exports=i("./lib/_stream_readable.js"),h.Stream=h,h.Readable=h,h.Writable=i("./lib/_stream_writable.js"),h.Duplex=i("./lib/_stream_duplex.js"),h.Transform=i("./lib/_stream_transform.js"),h.PassThrough=i("./lib/_stream_passthrough.js"),h.finished=i("./lib/internal/streams/end-of-stream.js"),h.pipeline=i("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(i,l,h){function a(d,p){for(var g in d)p[g]=d[g]}function y(d,p,g){return u(d,p,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var m=i("buffer"),u=m.Buffer;u.from&&u.alloc&&u.allocUnsafe&&u.allocUnsafeSlow?l.exports=m:(a(m,h),h.Buffer=y),y.prototype=Object.create(u.prototype),a(u,y),y.from=function(d,p,g){if(typeof d=="number")throw new TypeError("Argument must not be a number");return u(d,p,g)},y.alloc=function(d,p,g){if(typeof d!="number")throw new TypeError("Argument must be a number");var _=u(d);return p===void 0?_.fill(0):typeof g=="string"?_.fill(p,g):_.fill(p),_},y.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return u(d)},y.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return m.SlowBuffer(d)}},{buffer:3}],31:[function(i,l,h){function a(E){if(!E)return"utf8";for(var x;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(x)return;E=(""+E).toLowerCase(),x=!0}}function y(E){var x=a(E);if(typeof x!="string"&&(S.isEncoding===T||!T(E)))throw new Error("Unknown encoding: "+E);return x||E}function m(E){this.encoding=y(E);var x;switch(this.encoding){case"utf16le":this.text=_,this.end=I,x=4;break;case"utf8":this.fillLast=g,x=4;break;case"base64":this.text=L,this.end=M,x=3;break;default:return this.write=w,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=S.allocUnsafe(x)}function u(E){return 127>=E?0:E>>5==6?2:E>>4==14?3:E>>3==30?4:E>>6==2?-1:-2}function d(E,x,U){var k=x.length-1;if(k<U)return 0;var A=u(x[k]);return 0<=A?(0<A&&(E.lastNeed=A-1),A):--k<U||A===-2?0:(A=u(x[k]),0<=A?(0<A&&(E.lastNeed=A-2),A):--k<U||A===-2?0:(A=u(x[k]),0<=A?(0<A&&(A===2?A=0:E.lastNeed=A-3),A):0))}function p(E,x){if((192&x[0])!=128)return E.lastNeed=0,"";if(1<E.lastNeed&&1<x.length){if((192&x[1])!=128)return E.lastNeed=1,"";if(2<E.lastNeed&&2<x.length&&(192&x[2])!=128)return E.lastNeed=2,""}}function g(E){var x=this.lastTotal-this.lastNeed,U=p(this,E);return U===void 0?this.lastNeed<=E.length?(E.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,x,0,E.length),void(this.lastNeed-=E.length)):U}function _(E,x){if((E.length-x)%2==0){var U=E.toString("utf16le",x);if(U){var k=U.charCodeAt(U.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",x,E.length-1)}function I(E){var x=E&&E.length?this.write(E):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,U)}return x}function L(E,x){var U=(E.length-x)%3;return U==0?E.toString("base64",x):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",x,E.length-U))}function M(E){var x=E&&E.length?this.write(E):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function w(E){return E.toString(this.encoding)}function v(E){return E&&E.length?this.write(E):""}var S=i("safe-buffer").Buffer,T=S.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};h.StringDecoder=m,m.prototype.write=function(E){if(E.length===0)return"";var x,U;if(this.lastNeed){if(x=this.fillLast(E),x===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<E.length?x?x+this.text(E,U):this.text(E,U):x||""},m.prototype.end=function(E){var x=E&&E.length?this.write(E):"";return this.lastNeed?x+"":x},m.prototype.text=function(E,x){var U=d(this,E,x);if(!this.lastNeed)return E.toString("utf8",x);this.lastTotal=U;var k=E.length-(U-this.lastNeed);return E.copy(this.lastChar,0,k),E.toString("utf8",x,k)},m.prototype.fillLast=function(E){return this.lastNeed<=E.length?(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),void(this.lastNeed-=E.length))}},{"safe-buffer":30}],32:[function(i,l){(function(h){(function(){function a(y){try{if(!h.localStorage)return!1}catch{return!1}var m=h.localStorage[y];return m!=null&&(m+"").toLowerCase()==="true"}l.exports=function(y,m){function u(){if(!d){if(a("throwDeprecation"))throw new Error(m);a("traceDeprecation")?console.trace(m):console.warn(m),d=!0}return y.apply(this,arguments)}if(a("noDeprecation"))return y;var d=!1;return u}}).call(this)}).call(this,typeof Le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Le)},{}],"/":[function(i,l){function h(M){return M.replace(/a=ice-options:trickle\s\n/g,"")}function a(M){console.warn(M)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const y=i("debug")("simple-peer"),m=i("get-browser-rtc"),u=i("randombytes"),d=i("readable-stream"),p=i("queue-microtask"),g=i("err-code"),{Buffer:_}=i("buffer"),I=65536;class L extends d.Duplex{constructor(w){if(w=Object.assign({allowHalfOpen:!1},w),super(w),this._id=u(4).toString("hex").slice(0,7),this._debug("new peer %o",w),this.channelName=w.initiator?w.channelName||u(20).toString("hex"):null,this.initiator=w.initiator||!1,this.channelConfig=w.channelConfig||L.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},L.config,w.config),this.offerOptions=w.offerOptions||{},this.answerOptions=w.answerOptions||{},this.sdpTransform=w.sdpTransform||(v=>v),this.streams=w.streams||(w.stream?[w.stream]:[]),this.trickle=w.trickle===void 0||w.trickle,this.allowHalfTrickle=w.allowHalfTrickle!==void 0&&w.allowHalfTrickle,this.iceCompleteTimeout=w.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=w.wrtc&&typeof w.wrtc=="object"?w.wrtc:m(),!this._wrtc)throw g(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(v){return void this.destroy(g(v,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=v=>{this._onIceCandidate(v)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(v=>{this.destroy(g(v,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=v=>{this._setupData(v)},this.streams&&this.streams.forEach(v=>{this.addStream(v)}),this._pc.ontrack=v=>{this._onTrack(v)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof w=="string")try{w=JSON.parse(w)}catch{w={}}this._debug("signal()"),w.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),w.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(w.transceiverRequest.kind,w.transceiverRequest.init)),w.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(w.candidate):this._pendingCandidates.push(w.candidate)),w.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(w)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(v=>{this._addIceCandidate(v)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(v=>{this.destroy(g(v,"ERR_SET_REMOTE_DESCRIPTION"))}),w.sdp||w.candidate||w.renegotiate||w.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(w){const v=new this._wrtc.RTCIceCandidate(w);this._pc.addIceCandidate(v).catch(S=>{!v.address||v.address.endsWith(".local")?a("Ignoring unsupported ICE candidate."):this.destroy(g(S,"ERR_ADD_ICE_CANDIDATE"))})}send(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(w)}}addTransceiver(w,v){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(w,v),this._needsNegotiation()}catch(S){this.destroy(g(S,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:w,init:v}})}}addStream(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),w.getTracks().forEach(v=>{this.addTrack(v,w)})}}addTrack(w,v){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const S=this._senderMap.get(w)||new Map;let T=S.get(v);if(!T)T=this._pc.addTrack(w,v),S.set(v,T),this._senderMap.set(w,S),this._needsNegotiation();else throw T.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(w,v,S){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const T=this._senderMap.get(w),E=T?T.get(S):null;if(!E)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");v&&this._senderMap.set(v,T),E.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):E.replaceTrack(v)}removeTrack(w,v){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const S=this._senderMap.get(w),T=S?S.get(v):null;if(!T)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{T.removed=!0,this._pc.removeTrack(T)}catch(E){E.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(T):this.destroy(g(E,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),w.getTracks().forEach(v=>{this.removeTrack(v,w)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,p(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(w){this._destroy(w,()=>{})}_destroy(w,v){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",w&&(w.message||w)),p(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",w&&(w.message||w)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,w&&this.emit("error",w),this.emit("close"),v()}))}_setupData(w){if(!w.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=w.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=I),this.channelName=this._channel.label,this._channel.onmessage=S=>{this._onChannelMessage(S)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=S=>{const T=S.error instanceof Error?S.error:new Error(`Datachannel error: ${S.message} ${S.filename}:${S.lineno}:${S.colno}`);this.destroy(g(T,"ERR_DATA_CHANNEL"))};let v=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(v&&this._onChannelClose(),v=!0):v=!1},5e3)}_read(){}_write(w,v,S){if(this.destroyed)return S(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(w)}catch(T){return this.destroy(g(T,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>I?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=S):S(null)}else this._debug("write before connect"),this._chunk=w,this._cb=S}_onFinish(){if(!this.destroyed){const w=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?w():this.once("connect",w)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(w=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(w.sdp=h(w.sdp)),w.sdp=this.sdpTransform(w.sdp);const v=()=>{if(!this.destroyed){const S=this._pc.localDescription||w;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp})}};this._pc.setLocalDescription(w).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?v():this.once("_iceComplete",v))}).catch(S=>{this.destroy(g(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(w=>{this.destroy(g(w,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(w=>{w.mid||!w.sender.track||w.requested||(w.requested=!0,this.addTransceiver(w.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(w=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(w.sdp=h(w.sdp)),w.sdp=this.sdpTransform(w.sdp);const v=()=>{if(!this.destroyed){const S=this._pc.localDescription||w;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(w).then(()=>{this.destroyed||(this.trickle||this._iceComplete?v():this.once("_iceComplete",v))}).catch(S=>{this.destroy(g(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(w=>{this.destroy(g(w,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const w=this._pc.iceConnectionState,v=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",w,v),this.emit("iceStateChange",w,v),(w==="connected"||w==="completed")&&(this._pcReady=!0,this._maybeReady()),w==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),w==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(w){const v=S=>(Object.prototype.toString.call(S.values)==="[object Array]"&&S.values.forEach(T=>{Object.assign(S,T)}),S);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(S=>{const T=[];S.forEach(E=>{T.push(v(E))}),w(null,T)},S=>w(S)):0<this._pc.getStats.length?this._pc.getStats(S=>{if(this.destroyed)return;const T=[];S.result().forEach(E=>{const x={};E.names().forEach(U=>{x[U]=E.stat(U)}),x.id=E.id,x.type=E.type,x.timestamp=E.timestamp,T.push(v(x))}),w(null,T)},S=>w(S)):w(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const w=()=>{this.destroyed||this.getStats((v,S)=>{if(this.destroyed)return;v&&(S=[]);const T={},E={},x={};let U=!1;S.forEach(A=>{(A.type==="remotecandidate"||A.type==="remote-candidate")&&(T[A.id]=A),(A.type==="localcandidate"||A.type==="local-candidate")&&(E[A.id]=A),(A.type==="candidatepair"||A.type==="candidate-pair")&&(x[A.id]=A)});const k=A=>{U=!0;let F=E[A.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof A.googLocalAddress=="string"&&(F=A.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=T[A.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof A.googRemoteAddress=="string"&&(j=A.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(S.forEach(A=>{A.type==="transport"&&A.selectedCandidatePairId&&k(x[A.selectedCandidatePairId]),(A.type==="googCandidatePair"&&A.googActiveConnection==="true"||(A.type==="candidatepair"||A.type==="candidate-pair")&&A.selected)&&k(A)}),!U&&(!Object.keys(x).length||Object.keys(E).length))return void setTimeout(w,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(g(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const A=this._cb;this._cb=null,A(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};w()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>I)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(w=>{this._pc.removeTrack(w),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(w){this.destroyed||(w.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:w.candidate.candidate,sdpMLineIndex:w.candidate.sdpMLineIndex,sdpMid:w.candidate.sdpMid}}):!w.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),w.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(w){if(this.destroyed)return;let v=w.data;v instanceof ArrayBuffer&&(v=_.from(v)),this.push(v)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const w=this._cb;this._cb=null,w(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(w){this.destroyed||w.streams.forEach(v=>{this._debug("on track"),this.emit("track",w.track,v),this._remoteTracks.push({track:w.track,stream:v}),this._remoteStreams.some(S=>S.id===v.id)||(this._remoteStreams.push(v),p(()=>{this._debug("on stream"),this.emit("stream",v)}))})}_debug(){const w=[].slice.call(arguments);w[0]="["+this._id+"] "+w[0],y.apply(null,w)}}L.WEBRTC_SUPPORT=!!m(),L.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},L.channelConfig={},l.exports=L},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(Ri);var Na=Ri.exports;const Ma=Oa(Na),Dr=0,xr=1,Ti=2,Ai=(t,e)=>{W(t,Dr);const n=Sc(e);ie(t,n)},Di=(t,e,n)=>{W(t,xr),ie(t,wc(e,n))},Ua=(t,e,n)=>Di(e,n,he(t)),xi=(t,e,n)=>{try{pc(e,he(t),n)}catch(s){console.error("Caught error while handling a Yjs update",s)}},Fa=(t,e)=>{W(t,Ti),ie(t,e)},Ba=xi,ja=(t,e,n,s)=>{const o=z(t);switch(o){case Dr:Ua(t,e,n);break;case xr:xi(t,n,s);break;case Ti:Ba(t,n,s);break;default:throw new Error("Unknown message type")}return o},Hn=3e4;class Pa extends bs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=He();this.getLocalState()!==null&&Hn/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const s=[];this.meta.forEach((o,i)=>{i!==this.clientID&&Hn<=n-o.lastUpdated&&this.states.has(i)&&s.push(i)}),s.length>0&&sr(this,s,"timeout")},Ne(Hn/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,s=this.meta.get(n),o=s===void 0?0:s.clock+1,i=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:o,lastUpdated:He()});const l=[],h=[],a=[],y=[];e===null?y.push(n):i==null?e!=null&&l.push(n):(h.push(n),Vt(i,e)||a.push(n)),(l.length>0||a.length>0||y.length>0)&&this.emit("change",[{added:l,updated:a,removed:y},"local"]),this.emit("update",[{added:l,updated:h,removed:y},"local"])}setLocalStateField(e,n){const s=this.getLocalState();s!==null&&this.setLocalState({...s,[e]:n})}getStates(){return this.states}}const sr=(t,e,n)=>{const s=[];for(let o=0;o<e.length;o++){const i=e[o];if(t.states.has(i)){if(t.states.delete(i),i===t.clientID){const l=t.meta.get(i);t.meta.set(i,{clock:l.clock+1,lastUpdated:He()})}s.push(i)}}s.length>0&&(t.emit("change",[{added:[],updated:[],removed:s},n]),t.emit("update",[{added:[],updated:[],removed:s},n]))},Sn=(t,e,n=t.states)=>{const s=e.length,o=ue();W(o,s);for(let i=0;i<s;i++){const l=e[i],h=n.get(l)||null,a=t.meta.get(l).clock;W(o,l),W(o,a),Ie(o,JSON.stringify(h))}return re(o)},$a=(t,e,n)=>{const s=je(e),o=He(),i=[],l=[],h=[],a=[],y=z(s);for(let m=0;m<y;m++){const u=z(s);let d=z(s);const p=JSON.parse(Ve(s)),g=t.meta.get(u),_=t.states.get(u),I=g===void 0?0:g.clock;(I<d||I===d&&p===null&&t.states.has(u))&&(p===null?u===t.clientID&&t.getLocalState()!=null?d++:t.states.delete(u):t.states.set(u,p),t.meta.set(u,{clock:d,lastUpdated:o}),g===void 0&&p!==null?i.push(u):g!==void 0&&p===null?a.push(u):p!==null&&(Vt(p,_)||h.push(u),l.push(u)))}(i.length>0||h.length>0||a.length>0)&&t.emit("change",[{added:i,updated:h,removed:a},n]),(i.length>0||l.length>0||a.length>0)&&t.emit("update",[{added:i,updated:l,removed:a},n])},Va=(t,e)=>{const n=Xn(t).buffer,s=Xn(e).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(o=>crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},Li=(t,e)=>{if(!e)return fr(t);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,t).then(s=>{const o=ue();return Ie(o,"AES-GCM"),ie(o,n),ie(o,new Uint8Array(s)),re(o)})},Wa=(t,e)=>{const n=ue();return Et(n,t),Li(re(n),e)},Ii=(t,e)=>{if(!e)return fr(t);const n=je(t);Ve(n)!=="AES-GCM"&&Ro(Me("Unknown encryption algorithm"));const o=he(n),i=he(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:o},e,i).then(l=>new Uint8Array(l))},Ha=(t,e)=>Ii(t,e).then(n=>kt(je(new Uint8Array(n)))),be=rc("y-webrtc"),St=0,Oi=3,Xt=1,Lr=4,Cn=new Map,ct=new Map,Ni=t=>{let e=!0;t.webrtcConns.forEach(n=>{n.synced||(e=!1)}),(!e&&t.synced||e&&!t.synced)&&(t.synced=e,t.provider.emit("synced",[{synced:e}]),be("synced ",Ee,t.name,lt," with all peers"))},Mi=(t,e,n)=>{const s=je(e),o=ue(),i=z(s);if(t===void 0)return null;const l=t.awareness,h=t.doc;let a=!1;switch(i){case St:{W(o,St);const y=ja(s,o,h,t);y===xr&&!t.synced&&n(),y===Dr&&(a=!0);break}case Oi:W(o,Xt),ie(o,Sn(l,Array.from(l.getStates().keys()))),a=!0;break;case Xt:$a(l,he(s),t);break;case Lr:{const y=at(s)===1,m=Ve(s);if(m!==t.peerId&&(t.bcConns.has(m)&&!y||!t.bcConns.has(m)&&y)){const u=[],d=[];y?(t.bcConns.add(m),d.push(m)):(t.bcConns.delete(m),u.push(m)),t.provider.emit("peers",[{added:d,removed:u,webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]),Ui(t)}break}default:return console.error("Unable to compute message"),o}return a?o:null},qa=(t,e)=>{const n=t.room;return be("received message from ",Ee,t.remotePeerId,yr," (",n.name,")",lt,Dn),Mi(n,e,()=>{t.synced=!0,be("synced ",Ee,n.name,lt," with ",Ee,t.remotePeerId),Ni(n)})},qn=(t,e)=>{be("send message to ",Ee,t.remotePeerId,lt,yr," (",t.room.name,")",Dn);try{t.peer.send(re(e))}catch{}},za=(t,e)=>{be("broadcast message in ",Ee,t.name,lt),t.webrtcConns.forEach(n=>{try{n.peer.send(e)}catch{}})};class cs{constructor(e,n,s,o){be("establishing connection to ",Ee,s),this.room=o,this.remotePeerId=s,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new Ma({initiator:n,...o.provider.peerOpts}),this.peer.on("signal",i=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),Ir(e,o,{to:s,from:o.peerId,type:"signal",token:this.glareToken,signal:i})}),this.peer.on("connect",()=>{be("connected to ",Ee,s),this.connected=!0;const l=o.provider.doc,h=o.awareness,a=ue();W(a,St),Ai(a,l),qn(this,a);const y=h.getStates();if(y.size>0){const m=ue();W(m,Xt),ie(m,Sn(h,Array.from(y.keys()))),qn(this,m)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,o.webrtcConns.has(this.remotePeerId)&&(o.webrtcConns.delete(this.remotePeerId),o.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}])),Ni(o),this.peer.destroy(),be("closed connection to ",Ee,s),ir(o)}),this.peer.on("error",i=>{be("Error in connection to ",Ee,s,": ",i),ir(o)}),this.peer.on("data",i=>{const l=qa(this,i);l!==null&&qn(this,l)})}destroy(){this.peer.destroy()}}const Xe=(t,e)=>Li(e,t.key).then(n=>t.mux(()=>La(t.name,n))),as=(t,e)=>{t.bcconnected&&Xe(t,e),za(t,e)},ir=t=>{Cn.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[t.name]}),t.webrtcConns.size<t.provider.maxConns&&Ir(e,t,{type:"announce",from:t.peerId}))})},Ui=t=>{if(t.provider.filterBcConns){const e=ue();W(e,Lr),zt(e,1),Ie(e,t.peerId),Xe(t,re(e))}};class Ya{constructor(e,n,s,o){this.peerId=ks(),this.doc=e,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=s,this.key=o,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Ia(),this.bcconnected=!1,this._bcSubscriber=i=>Ii(new Uint8Array(i),o).then(l=>this.mux(()=>{const h=Mi(this,l,()=>{});h&&Xe(this,re(h))})),this._docUpdateHandler=(i,l)=>{const h=ue();W(h,St),Fa(h,i),as(this,re(h))},this._awarenessUpdateHandler=({added:i,updated:l,removed:h},a)=>{const y=i.concat(l).concat(h),m=ue();W(m,Xt),ie(m,Sn(this.awareness,y)),as(this,re(m))},this._beforeUnloadHandler=()=>{sr(this.awareness,[e.clientID],"window unload"),ct.forEach(i=>{i.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),ir(this);const e=this.name;Da(e,this._bcSubscriber),this.bcconnected=!0,Ui(this);const n=ue();W(n,St),Ai(n,this.doc),Xe(this,re(n));const s=ue();W(s,St),Di(s,this.doc),Xe(this,re(s));const o=ue();W(o,Oi),Xe(this,re(o));const i=ue();W(i,Xt),ie(i,Sn(this.awareness,[this.doc.clientID])),Xe(this,re(i))}disconnect(){Cn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),sr(this.awareness,[this.doc.clientID],"disconnect");const e=ue();W(e,Lr),zt(e,0),Ie(e,this.peerId),Xe(this,re(e)),xa(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const Ga=(t,e,n,s)=>{if(ct.has(n))throw Me(`A Yjs Doc connected to room "${n}" already exists!`);const o=new Ya(t,e,n,s);return ct.set(n,o),o},Ir=(t,e,n)=>{e.key?Wa(n,e.key).then(s=>{t.send({type:"publish",topic:e.name,data:Ns(s)})}):t.send({type:"publish",topic:e.name,data:n})};class Ja extends Ra{constructor(e){super(e),this.providers=new Set,this.on("connect",()=>{be(`connected (${e})`);const n=Array.from(ct.keys());this.send({type:"subscribe",topics:n}),ct.forEach(s=>Ir(this,s,{type:"announce",from:s.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const s=n.topic,o=ct.get(s);if(o==null||typeof s!="string")return;const i=l=>{const h=o.webrtcConns,a=o.peerId;if(l==null||l.from===a||l.to!==void 0&&l.to!==a||o.bcConns.has(l.from))return;const y=h.has(l.from)?()=>{}:()=>o.provider.emit("peers",[{removed:[],added:[l.from],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}]);switch(l.type){case"announce":h.size<o.provider.maxConns&&(ve(h,l.from,()=>new cs(this,!0,l.from,o)),y());break;case"signal":if(l.signal.type==="offer"){const m=h.get(l.from);if(m){const u=l.token,d=m.glareToken;if(d&&d>u){be("offer rejected: ",l.from);return}m.glareToken=void 0}}if(l.signal.type==="answer"){be("offer answered by: ",l.from);const m=h.get(l.from);m.glareToken=void 0}l.to===a&&(ve(h,l.from,()=>new cs(this,!1,l.from,o)).peer.signal(l.signal),y());break}};o.key?typeof n.data=="string"&&Ha(Ms(n.data),o.key).then(i):i(n.data)}}}),this.on("disconnect",()=>be(`disconnect (${e})`))}}const zn=t=>{t.emit("status",[{connected:t.connected}])};class Ka extends ws{constructor(e,n,{signaling:s=["wss://y-webrtc-eu.fly.dev"],password:o=null,awareness:i=new Pa(n),maxConns:l=20+Ne(Eo()*15),filterBcConns:h=!0,peerOpts:a={}}={}){super(),this.roomName=e,this.doc=n,this.filterBcConns=h,this.awareness=i,this.shouldConnect=!1,this.signalingUrls=s,this.signalingConns=[],this.maxConns=l,this.peerOpts=a,this.key=o?Va(o,e):fr(null),this.room=null,this.key.then(y=>{this.room=Ga(n,this,e,y),this.shouldConnect?this.room.connect():this.room.disconnect(),zn(this)}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{const n=ve(Cn,e,()=>new Ja(e));this.signalingConns.push(n),n.providers.add(this)}),this.room&&(this.room.connect(),zn(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),e.providers.size===0&&(e.destroy(),Cn.delete(e.url))}),this.room&&(this.room.disconnect(),zn(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ct.delete(this.roomName)}),super.destroy()}}const ls=["#FF5733","#33A8FF","#33FF57","#FF33A8","#A833FF","#FFBD33","#33FFC1","#FF5733"],ne=document.getElementById("editor"),Wt=document.getElementById("status"),Or=document.getElementById("username"),hs=document.getElementById("session-id"),Xa=document.getElementById("join-btn"),Za=document.getElementById("save-btn"),Qa=document.getElementById("session-display"),el=document.getElementById("current-session"),us=document.getElementById("copy-notification"),tl=document.getElementById("theme-toggle"),ds=document.getElementById("moon-icon"),fs=document.getElementById("sun-icon");Or.value="User"+Math.floor(Math.random()*1e3);let De=null,Bt=[];function nl(){if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.location.search.includes("debug=true")){De=document.createElement("div"),De.id="mobile-debug-console",De.style.cssText=`
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      font-family: monospace;
      font-size: 10px;
      padding: 10px;
      padding-top: 40px;
      overflow-y: auto;
      z-index: 10000;
      border-top: 2px solid #333;
      display: none;
    `;const e=document.createElement("button");e.textContent=" Copy",e.style.cssText=`
      position: fixed;
      top: auto;
      bottom: 160px;
      right: 10px;
      background: #444;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      z-index: 10002;
      min-height: 32px;
      min-width: 70px;
      touch-action: manipulation;
    `,e.onclick=async()=>{try{const a=Bt.map(m=>`[${m.timestamp}] ${m.type}: ${m.message}`).join(`
`);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(a);else{const m=document.createElement("textarea");m.value=a,m.style.position="fixed",m.style.left="-999999px",m.style.top="-999999px",document.body.appendChild(m),m.focus(),m.select(),document.execCommand("copy"),document.body.removeChild(m)}const y=e.textContent;e.textContent=" Copied!",e.style.background="#28a745",setTimeout(()=>{e.textContent=y,e.style.background="#444"},2e3)}catch(a){console.error("Failed to copy debug console:",a),e.textContent=" Failed",e.style.background="#dc3545",setTimeout(()=>{e.textContent=" Copy",e.style.background="#444"},2e3)}};const n=()=>{e.style.display=De.style.display==="block"?"block":"none"};document.body.appendChild(e),document.body.appendChild(De);const s=document.createElement("button");s.textContent=" Debug",s.style.cssText=`
      position: fixed;
      bottom: 63px;
      right: 16px;
      z-index: 10001;
      background: #333;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      touch-action: manipulation;
    `,s.onclick=()=>{const a=De.style.display==="block";De.style.display=a?"none":"block",s.textContent=a?" Debug":" Close",n()};const o=document.createElement("button");o.textContent=" Diagnostics",o.style.cssText=`
      position: fixed;
      bottom: 105px;
      right: 16px;
      z-index: 10001;
      background: #007acc;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      touch-action: manipulation;
    `,o.onclick=async()=>{var y,m,u,d;console.log(" Mobile diagnostics triggered...");const a=o.textContent;o.textContent=" Running...",o.style.background="#ffa500";try{await Fi(),P?(console.log("Provider exists:",!!P),console.log("Provider room:",P.room),console.log("Signaling connections:",((y=P.signalingConns)==null?void 0:y.length)||0),console.log("WebRTC connections:",((u=(m=P.room)==null?void 0:m.webrtcConns)==null?void 0:u.size)||0),console.log("Awareness states:",P.awareness.getStates().size),console.log("Document synced:",P.synced),(d=P.room)!=null&&d.webrtcConns&&P.room.webrtcConns.forEach((p,g)=>{p.peer&&console.log(`Peer ${g} details:`,{connectionState:p.peer.connectionState,iceConnectionState:p.peer.iceConnectionState,iceGatheringState:p.peer.iceGatheringState,signalingState:p.peer.signalingState})})):console.log(" No provider found"),o.textContent=" Complete",o.style.background="#28a745"}catch(p){console.error("Diagnostic error:",p),o.textContent=" Error",o.style.background="#dc3545"}setTimeout(()=>{o.textContent=a,o.style.background="#007acc"},3e3)},document.body.appendChild(s),document.body.appendChild(o),n();const i=console.log,l=console.error,h=console.warn;console.log=function(...a){i.apply(console,a),Yn("LOG",a.join(" "))},console.error=function(...a){l.apply(console,a),Yn("ERROR",a.join(" "))},console.warn=function(...a){h.apply(console,a),Yn("WARN",a.join(" "))}}}function Yn(t,e){if(!De)return;const n=new Date().toLocaleTimeString();Bt.push({type:t,message:e,timestamp:n}),Bt.length>100&&Bt.shift(),De.innerHTML=Bt.map(s=>`<div style="color: ${s.type==="ERROR"?"#ff4444":s.type==="WARN"?"#ffaa00":"#00ff00"}; margin-bottom: 2px; word-wrap: break-word;">[${s.timestamp}] ${s.type}: ${s.message}</div>`).join(""),De.scrollTop=De.scrollHeight}async function Fi(){console.log(" Testing network connectivity...");const t=[{name:"Google DNS",url:"https://dns.google/resolve?name=example.com&type=A"},{name:"Cloudflare DNS",url:"https://cloudflare-dns.com/dns-query?name=example.com&type=A",headers:{Accept:"application/dns-json"}},{name:"YJS Signaling",url:"https://demos.yjs.dev"}],e={};for(const n of t)try{const s=Date.now(),o=await fetch(n.url,{method:"GET",headers:n.headers||{},mode:"cors",cache:"no-cache"}),i=Date.now();e[n.name]={success:o.ok,status:o.status,latency:i-s,error:null},console.log(` ${n.name}: ${o.status} (${i-s}ms)`)}catch(s){e[n.name]={success:!1,status:null,latency:null,error:s.message},console.error(` ${n.name}: ${s.message}`)}try{console.log(" Testing WebSocket connectivity...");const n=new WebSocket("wss://demos.yjs.dev/ws");await new Promise((s,o)=>{const i=setTimeout(()=>{n.close(),o(new Error("WebSocket connection timeout"))},5e3);n.onopen=()=>{clearTimeout(i),console.log(" WebSocket connection successful"),e.WebSocket={success:!0,error:null},n.close(),s()},n.onerror=l=>{clearTimeout(i),console.error(" WebSocket connection failed:",l),e.WebSocket={success:!1,error:"Connection failed"},o(l)}})}catch(n){e.WebSocket={success:!1,error:n.message}}return console.log(" Network connectivity test results:",e),e}nl();function rl(){const t=localStorage.getItem("theme");if(t)or(t);else{const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;or(e?"dark":"light")}}function or(t){t==="dark"?(document.documentElement.setAttribute("data-theme","dark"),ds.style.display="none",fs.style.display="block"):(document.documentElement.removeAttribute("data-theme"),ds.style.display="block",fs.style.display="none")}function sl(){const e=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";or(e),localStorage.setItem("theme",e)}rl();tl.addEventListener("click",sl);const En=document.getElementById("header-toggle"),cr=document.querySelector(".header");let jt=!1;function Bi(){jt=!jt,jt?(cr.classList.add("header--hidden"),En.classList.add("header-toggle--hidden")):(cr.classList.remove("header--hidden"),En.classList.remove("header-toggle--hidden")),localStorage.setItem("headerHidden",jt)}function il(){localStorage.getItem("headerHidden")==="true"&&(jt=!0,cr.classList.add("header--hidden"),En.classList.add("header-toggle--hidden"))}En.addEventListener("click",Bi);il();function ji(){return crypto===void 0||!crypto.randomUUID?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}):crypto.randomUUID()}function ol(){return new URLSearchParams(window.location.search).get("session")||ji()}function cl(t){const e=new URL(window.location);e.searchParams.set("session",t),window.history.pushState({},"",e)}function al(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}let it,P,ge,rn=ol(),Ct={},Pt={};function Pi(t){var h,a,y,m,u;P&&P.destroy(),it&&it.destroy(),it=new It,ge=it.getText("content");const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=n?n.effectiveType:"unknown";console.log(`Network detection - Mobile: ${e}, Type: ${s}`);const o=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:["turn:openrelay.metered.ca:80","turn:openrelay.metered.ca:443"],username:"openrelayproject",credential:"openrelayproject"},{urls:["turn:openrelay.metered.ca:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:relay1.expressturn.com:3478",username:"efSLANXM7179I8RTB5",credential:"T0C0Ej5r6eWBjNppC"},{urls:["turn:turn.anyfirewall.com:443?transport=tcp"],username:"webrtc",credential:"webrtc"},{urls:"turn:global.turn.twilio.com:3478?transport=udp",username:"dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",credential:"tE2DajzSJwnsSbc123"},{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.voiparound.com"}],i={iceServers:o,iceCandidatePoolSize:e?5:10,iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",...e&&{iceConnectionReceivingTimeout:1e4,iceInactiveTimeout:3e4}};P=new Ka(`vibe_notes_${t}`,it,{signaling:["wss://demos.yjs.dev/ws","wss://signaling.yjs.dev"],maxConns:e?10:20,filterBcConns:!0,peerOpts:{config:i}}),console.log("=== WebRTC Debug Info ==="),console.log(`Session ID: ${t}`),console.log(`Room: ${P.roomName}`),console.log(`URL: ${window.location.href}`),console.log(`User Agent: ${navigator.userAgent}`),console.log(`Is Secure Context: ${window.isSecureContext}`),console.log(`Mobile Device: ${e}`),console.log(`Network Type: ${s}`),console.log(`ICE Servers Count: ${o.length}`),console.log("RTCConfiguration:",i),P.on("status",d=>{console.log(`[${new Date().toISOString()}] Provider Status:`,d),d.status==="connected"?console.log(" Connected to signaling server"):d.status==="disconnected"&&console.log(" Disconnected from signaling server")}),setTimeout(()=>{P.signalingConns&&P.signalingConns.length>0?P.signalingConns.forEach((d,p)=>{console.log(`Signaling connection ${p}:`,d.url||d),d&&typeof d.addEventListener=="function"?(d.addEventListener("open",()=>{console.log(`[${new Date().toISOString()}] Signaling ${p} opened: ${d.url}`)}),d.addEventListener("close",g=>{console.log(`[${new Date().toISOString()}] Signaling ${p} closed:`,g.code,g.reason)}),d.addEventListener("error",g=>{console.log(`[${new Date().toISOString()}] Signaling ${p} error:`,g)}),d.addEventListener("message",g=>{try{const _=JSON.parse(g.data);console.log(`[${new Date().toISOString()}] Signaling ${p} message:`,_),(_.type==="announce"||_.type==="peer")&&console.log(`[${new Date().toISOString()}]  Peer announcement detected:`,_)}catch{console.log(`[${new Date().toISOString()}] Signaling ${p} raw message:`,g.data)}})):console.log(`Signaling connection ${p} is not a WebSocket:`,typeof d,d)}):console.log(" No signaling connections found")},500),P.on("peers",d=>{console.log(`[${new Date().toISOString()}] Peers Event:`,d);const p=P.awareness.getStates().size-1;console.log(`Current peer count: ${p}`)}),P.awareness.on("change",d=>{var g,_,I;console.log(`[${new Date().toISOString()}] Awareness Change:`,d),console.log(`Awareness Change: added=${((g=d.added)==null?void 0:g.length)||0}, updated=${((_=d.updated)==null?void 0:_.length)||0}, removed=${((I=d.removed)==null?void 0:I.length)||0}`);const p=P.awareness.getStates();console.log("All connected clients:",Array.from(p.keys()).join(", ")),p.forEach((L,M)=>{console.log(`Client ${M} state:`,L)}),d.added&&d.added.length>0&&d.added.forEach(L=>{const M=p.get(L);console.log(`[${new Date().toISOString()}]  New client joined: ${L}`,M)}),d.removed&&d.removed.length>0&&d.removed.forEach(L=>{console.log(`[${new Date().toISOString()}]  Client left: ${L}`)}),ps()}),P.on("connection-error",d=>{console.error(`[${new Date().toISOString()}] WebRTC Connection Error:`,d)}),P.room&&P.room.webrtcConns&&setTimeout(()=>{P.room.webrtcConns.forEach((d,p)=>{d.peer&&d.peer.connectionState&&(console.log(`Peer ${p} connection state: ${d.peer.connectionState}`),d.peer.addEventListener("connectionstatechange",()=>{console.log(` Peer ${p} connection state changed: ${d.peer.connectionState}`),d.peer.connectionState==="failed"?(console.error(` Connection to peer ${p} failed`),d.peer.iceConnectionState&&console.error(`ICE connection state: ${d.peer.iceConnectionState}`)):d.peer.connectionState==="connected"&&console.log(` Successfully connected to peer ${p}`)}),d.peer.addEventListener("icegatheringstatechange",()=>{console.log(` Peer ${p} ICE gathering state: ${d.peer.iceGatheringState}`)}),d.peer.addEventListener("icecandidate",g=>{g.candidate?console.log(` ICE candidate for peer ${p}:`,{type:g.candidate.type,protocol:g.candidate.protocol,address:g.candidate.address,port:g.candidate.port,priority:g.candidate.priority}):console.log(` ICE candidate gathering complete for peer ${p}`)}))})},1e3),P.on("sync",d=>{console.log(`[${new Date().toISOString()}] Document Sync:`,d?" Synced":" Syncing...")}),setTimeout(()=>{var d,p;console.log(`Provider Client ID: ${P.awareness.clientID}`),console.log(`Connected Peers: ${P.awareness.getStates().size-1}`),console.log(`Provider roomName property: ${P.roomName}`),console.log(`Provider connected: ${P.connected}`),console.log(`Signaling connections: ${((d=P.signalingConns)==null?void 0:d.length)||0}`),console.log("Provider properties:",Object.getOwnPropertyNames(P)),(p=P.signalingConns)==null||p.forEach((g,_)=>{console.log(`Signaling ${_}: ${g.url||"no url"} - connected: ${g.connected||"false"}`)})},2e3),P.on("peers",d=>{console.log("Peer connection event:",d)}),Qa.textContent=t,rn=t,cl(t);const l=Or.value.trim()||"User"+Math.floor(Math.random()*1e3);if(P.awareness.setLocalStateField("user",{name:l,cursor:null}),P.awareness.on("change",()=>{gs(),ps()}),P.on("status",d=>{d.status==="connected"?Wt.style.backgroundColor="rgba(0,255,0,0.2)":Wt.style.backgroundColor="rgba(255,0,0,0.2)"}),gs(),ul(),P.room){const d=(y=(a=(h=P.room.webrtcConns)==null?void 0:h.constructor)==null?void 0:a.prototype)==null?void 0:y.createPeer;d&&(P.room.webrtcConns.constructor.prototype.createPeer=function(p,g){const _=d.call(this,p,g);return console.log(`[${new Date().toISOString()}]  Creating peer connection to ${p}, initiator: ${g}`),_.addEventListener("icecandidate",I=>{I.candidate?console.log(`[${new Date().toISOString()}] ICE candidate for peer ${p}:`,{type:I.candidate.type,protocol:I.candidate.protocol,address:I.candidate.address,port:I.candidate.port,priority:I.candidate.priority,foundation:I.candidate.foundation}):console.log(`[${new Date().toISOString()}] ICE gathering complete for peer ${p}`)}),_.addEventListener("iceconnectionstatechange",()=>{console.log(`[${new Date().toISOString()}] ICE connection state changed for peer ${p}:`,_.iceConnectionState)}),_.addEventListener("connectionstatechange",()=>{console.log(`[${new Date().toISOString()}] Connection state changed for peer ${p}:`,_.connectionState)}),_.addEventListener("datachannel",I=>{console.log(`[${new Date().toISOString()}] Data channel opened for peer ${p}:`,I.channel.label)}),_.addEventListener("track",I=>{console.log(`[${new Date().toISOString()}] Track received from peer ${p}:`,I.track.kind)}),_}),P.room.on&&P.room.on("peer",(p,g)=>{console.log(`[${new Date().toISOString()}]  Room peer event: ${g}`)}),console.log(`[${new Date().toISOString()}] Room initialized:`,{name:P.room.name,peersCount:((m=P.room.webrtcConns)==null?void 0:m.size)||0,bcConns:((u=P.room.bcConns)==null?void 0:u.size)||0})}}function ll(t,e,n){let s=0;const o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let i;for(;i=o.nextNode();){if(i===e)return s+n;s+=i.textContent.length}return t.textContent.length}function hl(t,e){const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let s=0,o;for(;o=n.nextNode();){const i=o.textContent.length;if(s+i>=e){const l=document.createRange();return l.setStart(o,Math.min(e-s,i)),l.setEnd(o,Math.min(e-s,i)),l}s+=i}if(t.lastChild&&t.lastChild.nodeType===Node.TEXT_NODE){const i=document.createRange();return i.setStart(t.lastChild,t.lastChild.textContent.length),i.setEnd(t.lastChild,t.lastChild.textContent.length),i}return null}function ul(){let t=!1;ne.textContent=ge.toString(),ge.observe(e=>{if(e.transaction.origin!==P.awareness.clientID&&!t){const n=window.getSelection(),s=n.rangeCount>0;let o=null;if(s&&ne.contains(n.anchorNode)){const i=n.getRangeAt(0);o=ll(ne,i.startContainer,i.startOffset)}if(ne.textContent=ge.toString(),s&&o!==null)try{const i=hl(ne,o);i&&(n.removeAllRanges(),n.addRange(i))}catch(i){console.warn("Failed to restore cursor position:",i)}}}),ne.addEventListener("input",()=>{t=!0;const e=al(ne.innerText);ge.delete(0,ge.length),ge.insert(0,e),t=!1,Ft()}),ne.addEventListener("mouseup",Ft),ne.addEventListener("keyup",Ft),ne.addEventListener("click",Ft),setTimeout(()=>{ne.focus(),Ft()},100)}function gs(){if(!P)return;const t=P.awareness.getStates().size;Wt.textContent=`Connected with ${t-1} peer${t!==2?"s":""}`,t>1?Wt.style.backgroundColor="rgba(0,255,0,0.2)":Wt.style.backgroundColor="rgba(255,165,0,0.2)"}Xa.addEventListener("click",()=>{const t=hs.value.trim()||ji();Nr(),Pt={},Pi(t),hs.value=""});Pi(rn);el.addEventListener("click",()=>{const t=new URL(window.location);t.searchParams.set("session",rn);const e=t.toString();navigator.clipboard.writeText(e).then(()=>{us.classList.add("show"),setTimeout(()=>{us.classList.remove("show")},2e3)}).catch(n=>{console.error("Failed to copy URL: ",n)})});window.addEventListener("beforeunload",()=>{P&&P.destroy(),it&&it.destroy(),Nr()});function Ft(){if(!P||!P.awareness)return;const t=window.getSelection();if(!t.rangeCount)return;const e=t.getRangeAt(0);if(!ne.contains(e.startContainer))return;let n;const s=document.createElement("span");if(s.innerHTML="&#8203;",e.cloneRange().insertNode(s),n=s.getBoundingClientRect(),n.height===0){const a=(s.parentNode||ne).getBoundingClientRect(),y=window.getComputedStyle(ne),m=parseInt(y.lineHeight)||27;n={left:a.left+24,top:a.top,width:0,height:m}}if(s.parentNode&&s.parentNode.removeChild(s),t.removeAllRanges(),t.addRange(e),e.startContainer===ne&&e.startOffset===0){const h=ne.getBoundingClientRect();n={left:h.left+24,top:h.top+24,width:0,height:27}}const i=ne.getBoundingClientRect(),l={left:n.left-i.left,top:n.top-i.top};P.awareness.setLocalStateField("user",{name:Or.value.trim()||"User"+Math.floor(Math.random()*1e3),cursor:l})}function ps(){if(!P||!P.awareness)return;Nr();const t=P.awareness.getStates(),e=P.awareness.clientID;t.forEach((n,s)=>{s===e||!n.user||!n.user.cursor||fl(s,n.user)})}function dl(){if(!P||!P.awareness)return;const t=P.awareness.getStates(),e=P.awareness.clientID;t.forEach((n,s)=>{if(s===e||!n.user||!n.user.cursor)return;const o=Ct[s];if(o){const i=n.user.cursor,l=ne.getBoundingClientRect(),h=l.left+i.left,a=l.top+i.top;o.style.left=`${h}px`,o.style.top=`${a}px`}})}function fl(t,e){if(!Pt[t]){const a=Object.keys(Pt).length%ls.length;Pt[t]=ls[a]}const n=Pt[t],s=e.cursor;if(!s||typeof s.left!="number"||typeof s.top!="number")return;if(!Ct[t]){const a=document.createElement("div");a.className="remote-cursor",a.style.backgroundColor=n;const y=document.createElement("div");y.className="cursor-label",y.style.backgroundColor=n,y.textContent=e.name||"Anonymous",a.appendChild(y),document.body.appendChild(a),Ct[t]=a}const o=Ct[t],i=ne.getBoundingClientRect(),l=i.left+s.left,h=i.top+s.top;o.style.left=`${l}px`,o.style.top=`${h}px`,o.style.display="block"}function Nr(){Object.values(Ct).forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),Ct={}}async function $i(){var o;const t=ne.innerText||ne.textContent||"";if(!t.trim()){alert("No content to save!");return}const e=new Date,n=e.toISOString().slice(0,19).replace(/[T:]/g,"-"),s=`${roomName??"vibe_notes"}_${n}`;if("showSaveFilePicker"in window&&window.isSecureContext)try{const i=await window.showSaveFilePicker({suggestedName:s,excludeAcceptAllOption:!1,types:[{description:"All files",accept:{"*/*":[]}}]}),l=i.name,h=((o=l.split(".").pop())==null?void 0:o.toLowerCase())||"txt";let a=t;switch(h){case"html":case"htm":a=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${l.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":a=JSON.stringify({title:l.replace(/\.[^/.]+$/,""),content:t,timestamp:e.toISOString(),sessionId:rn},null,2);break;default:a=t}const y=await i.createWritable();await y.write(a),await y.close(),console.log(` Notes saved as: ${l}`);return}catch(i){if(i.name==="AbortError"){console.log("User cancelled save dialog");return}console.error("Native save dialog failed:",i.message)}gl(t,s)}function gl(t,e){var y;const n=prompt("Enter filename with extension:",e);if(n===null||!n.trim())return;const s=((y=n.split(".").pop())==null?void 0:y.toLowerCase())||"txt";let o=t,i="text/plain;charset=utf-8";switch(s){case"md":case"markdown":i="text/markdown;charset=utf-8";break;case"html":case"htm":i="text/html;charset=utf-8",o=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${n.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":i="application/json;charset=utf-8",o=JSON.stringify({title:n.replace(/\.[^/.]+$/,""),content:t,timestamp:new Date().toISOString(),sessionId:rn},null,2);break;default:i="text/plain;charset=utf-8"}const l=new Blob([o],{type:i}),h=URL.createObjectURL(l),a=document.createElement("a");a.href=h,a.download=n,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(h),console.log(` Notes downloaded as: ${n}`)}let Gn=!1;async function Vi(){if(Gn){console.log(" Load already in progress, ignoring duplicate call");return}Gn=!0;try{if("showOpenFilePicker"in window&&window.isSecureContext){const[t]=await window.showOpenFilePicker({multiple:!1,excludeAcceptAllOption:!1,types:[{description:"Text files",accept:{"text/plain":[".txt",".md",".markdown"],"text/javascript":[".js",".mjs"],"text/typescript":[".ts"],"text/html":[".html",".htm"],"application/json":[".json"],"text/css":[".css"],"text/xml":[".xml"],"application/xml":[".xml"],"text/*":[".log",".conf",".ini",".cfg"]}}]}),e=await t.getFile(),n=await e.text();ne&&ge&&ge.doc.transact(()=>{ge.delete(0,ge.length),ge.insert(0,n)}),console.log(` Loaded file: ${e.name} (${e.size} bytes)`)}else ys()}catch(t){t.name==="AbortError"?console.log("User cancelled file selection"):(console.error("Error loading file:",t),ys())}finally{Gn=!1}}function ys(){const t=document.createElement("input");t.type="file",t.accept=".txt,.md,.markdown,.js,.mjs,.ts,.html,.htm,.json,.css,.xml,.log,.conf,.ini,.cfg,text/*",t.style.display="none",t.addEventListener("change",async e=>{const n=e.target.files[0];if(n)try{const s=await n.text();ne&&ge&&ge.doc.transact(()=>{ge.delete(0,ge.length),ge.insert(0,s)}),console.log(` Loaded file: ${n.name} (${n.size} bytes)`)}catch(s){console.error("Error reading file:",s),alert("Error reading file: "+s.message)}finally{document.body.removeChild(t)}}),document.body.appendChild(t),t.click()}Za.addEventListener("click",$i);const pl=document.getElementById("load-btn");pl.addEventListener("click",Vi);let ms;window.addEventListener("resize",()=>{clearTimeout(ms),ms=setTimeout(()=>{dl()},100)});document.addEventListener("keydown",t=>{var e,n,s,o;(t.ctrlKey||t.metaKey)&&t.key==="o"&&(t.preventDefault(),Vi()),(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),$i()),t.key==="F11"&&(t.preventDefault(),Bi()),t.ctrlKey&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),console.log(" Manual diagnostics triggered..."),Fi(),P?(console.log("Provider exists:",!!P),console.log("Provider room:",P.room),console.log("Signaling connections:",((e=P.signalingConns)==null?void 0:e.length)||0),console.log("WebRTC connections:",((s=(n=P.room)==null?void 0:n.webrtcConns)==null?void 0:s.size)||0),console.log("Awareness states:",P.awareness.getStates().size),console.log("Document synced:",P.synced),(o=P.room)!=null&&o.webrtcConns&&P.room.webrtcConns.forEach((i,l)=>{i.peer&&console.log(`Peer ${l} details:`,{connectionState:i.peer.connectionState,iceConnectionState:i.peer.iceConnectionState,iceGatheringState:i.peer.iceGatheringState,signalingState:i.peer.signalingState})})):console.log(" No provider found"))});
