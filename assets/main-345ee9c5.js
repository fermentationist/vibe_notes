(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const mt=()=>new Map,qn=e=>{const t=mt();return e.forEach((n,i)=>{t.set(i,n)}),t},_t=(e,t,n)=>{let i=e.get(t);return i===void 0&&e.set(t,i=n()),i},Ds=(e,t)=>{const n=[];for(const[i,o]of e)n.push(t(o,i));return n},Ls=(e,t)=>{for(const[n,i]of e)if(t(i,n))return!0;return!1},Zt=()=>new Set,Dn=e=>e[e.length-1],Is=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Vt=Array.from,xs=Array.isArray;class ai{constructor(){this._observers=mt()}on(t,n){return _t(this._observers,t,Zt).add(n),n}once(t,n){const i=(...o)=>{this.off(t,i),n(...o)};this.on(t,i)}off(t,n){const i=this._observers.get(t);i!==void 0&&(i.delete(n),i.size===0&&this._observers.delete(t))}emit(t,n){return Vt((this._observers.get(t)||mt()).values()).forEach(i=>i(...n))}destroy(){this._observers=mt()}}class li{constructor(){this._observers=mt()}on(t,n){_t(this._observers,t,Zt).add(n)}once(t,n){const i=(...o)=>{this.off(t,i),n(...o)};this.on(t,i)}off(t,n){const i=this._observers.get(t);i!==void 0&&(i.delete(n),i.size===0&&this._observers.delete(t))}emit(t,n){return Vt((this._observers.get(t)||mt()).values()).forEach(i=>i(...n))}destroy(){this._observers=mt()}}const xt=Math.floor,sn=Math.abs,Os=Math.log10,tr=(e,t)=>e<t?e:t,de=(e,t)=>e>t?e:t,hi=e=>e!==0?e<0:1/e<0,Tr=1,Dr=2,Ln=4,In=8,Ve=32,jt=64,bt=128,_n=31,Wn=63,se=127,Ms=2147483647,ui=Number.MAX_SAFE_INTEGER,Ns=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&xt(e)===e),Us=String.fromCharCode,Fs=e=>e.toLowerCase(),Bs=/^\s*/g,js=e=>e.replace(Bs,""),Ps=/([A-Z])/g,Lr=(e,t)=>js(e.replace(Ps,n=>`${t}${Fs(n)}`)),Vs=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=t.codePointAt(o);return i},qe=typeof TextEncoder<"u"?new TextEncoder:null,qs=e=>qe.encode(e),Hn=qe?qs:Vs;let Fe=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fe&&Fe.decode(new Uint8Array).length===1&&(Fe=null);class Je{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const lt=()=>new Je,Ws=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},et=e=>{const t=new Uint8Array(Ws(e));let n=0;for(let i=0;i<e.bufs.length;i++){const o=e.bufs[i];t.set(o,n),n+=o.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Hs=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(de(n,t)*2),e.cpos=0)},ct=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},We=ct,q=(e,t)=>{for(;t>se;)ct(e,bt|se&t),t=xt(t/128);ct(e,se&t)},er=(e,t)=>{const n=hi(t);for(n&&(t=-t),ct(e,(t>Wn?bt:0)|(n?jt:0)|Wn&t),t=xt(t/64);t>0;)ct(e,(t>se?bt:0)|se&t),t=xt(t/128)},Yn=new Uint8Array(3e4),Ys=Yn.length/3,zs=(e,t)=>{if(t.length<Ys){const n=qe.encodeInto(t,Yn).written||0;q(e,n);for(let i=0;i<n;i++)ct(e,Yn[i])}else rt(e,Hn(t))},$s=(e,t)=>{const n=unescape(encodeURIComponent(t)),i=n.length;q(e,i);for(let o=0;o<i;o++)ct(e,n.codePointAt(o))},Lt=qe&&qe.encodeInto?zs:$s,vn=(e,t)=>{const n=e.cbuf.length,i=e.cpos,o=tr(n-i,t.length),s=t.length-o;e.cbuf.set(t.subarray(0,o),i),e.cpos+=o,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(de(n*2,s)),e.cbuf.set(t.subarray(o)),e.cpos=s)},rt=(e,t)=>{q(e,t.byteLength),vn(e,t)},nr=(e,t)=>{Hs(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Gs=(e,t)=>nr(e,4).setFloat32(0,t,!1),Js=(e,t)=>nr(e,8).setFloat64(0,t,!1),Ks=(e,t)=>nr(e,8).setBigInt64(0,t,!1),Ir=new DataView(new ArrayBuffer(4)),Xs=e=>(Ir.setFloat32(0,e),Ir.getFloat32(0)===e),Ce=(e,t)=>{switch(typeof t){case"string":ct(e,119),Lt(e,t);break;case"number":Ns(t)&&sn(t)<=Ms?(ct(e,125),er(e,t)):Xs(t)?(ct(e,124),Gs(e,t)):(ct(e,123),Js(e,t));break;case"bigint":ct(e,122),Ks(e,t);break;case"object":if(t===null)ct(e,126);else if(xs(t)){ct(e,117),q(e,t.length);for(let n=0;n<t.length;n++)Ce(e,t[n])}else if(t instanceof Uint8Array)ct(e,116),rt(e,t);else{ct(e,118);const n=Object.keys(t);q(e,n.length);for(let i=0;i<n.length;i++){const o=n[i];Lt(e,o),Ce(e,t[o])}}break;case"boolean":ct(e,t?120:121);break;default:ct(e,127)}};class xr extends Je{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&q(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Or=e=>{e.count>0&&(er(e.encoder,e.count===1?e.s:-e.s),e.count>1&&q(e.encoder,e.count-2))};class on{constructor(){this.encoder=new Je,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Or(this),this.count=1,this.s=t)}toUint8Array(){return Or(this),et(this.encoder)}}const Mr=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);er(e.encoder,t),e.count>1&&q(e.encoder,e.count-2)}};class xn{constructor(){this.encoder=new Je,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Mr(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Mr(this),et(this.encoder)}}class Zs{constructor(){this.sarr=[],this.s="",this.lensE=new on}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Je;return this.sarr.push(this.s),this.s="",Lt(t,this.sarr.join("")),vn(t,this.lensE.toUint8Array()),et(t)}}const Ot=e=>new Error(e),It=()=>{throw Ot("Method unimplemented")},Mt=()=>{throw Ot("Unexpected case")},di=Ot("Unexpected end of array"),fi=Ot("Integer out of Range");class Cn{constructor(t){this.arr=t,this.pos=0}}const Ft=e=>new Cn(e),Qs=e=>e.pos!==e.arr.length,to=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},at=e=>to(e,Y(e)),ce=e=>e.arr[e.pos++],Y=e=>{let t=0,n=1;const i=e.arr.length;for(;e.pos<i;){const o=e.arr[e.pos++];if(t=t+(o&se)*n,n*=128,o<bt)return t;if(t>ui)throw fi}throw di},rr=e=>{let t=e.arr[e.pos++],n=t&Wn,i=64;const o=(t&jt)>0?-1:1;if(!(t&bt))return o*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&se)*i,i*=128,t<bt)return o*n;if(n>ui)throw fi}throw di},eo=e=>{let t=Y(e);if(t===0)return"";{let n=String.fromCodePoint(ce(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ce(e));else for(;t>0;){const i=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+i);e.pos+=i,n+=String.fromCodePoint.apply(null,o),t-=i}return decodeURIComponent(escape(n))}},no=e=>Fe.decode(at(e)),Pt=Fe?no:eo,ir=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},ro=e=>ir(e,4).getFloat32(0,!1),io=e=>ir(e,8).getFloat64(0,!1),so=e=>ir(e,8).getBigInt64(0,!1),oo=[e=>{},e=>null,rr,ro,io,so,e=>!1,e=>!0,Pt,e=>{const t=Y(e),n={};for(let i=0;i<t;i++){const o=Pt(e);n[o]=Ee(e)}return n},e=>{const t=Y(e),n=[];for(let i=0;i<t;i++)n.push(Ee(e));return n},at],Ee=e=>oo[127-ce(e)](e);class Nr extends Cn{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Qs(this)?this.count=Y(this)+1:this.count=-1),this.count--,this.s}}class cn extends Cn{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=rr(this);const t=hi(this.s);this.count=1,t&&(this.s=-this.s,this.count=Y(this)+2)}return this.count--,this.s}}class On extends Cn{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=rr(this),n=t&1;this.diff=xt(t/2),this.count=1,n&&(this.count=Y(this)+2)}return this.s+=this.diff,this.count--,this.s}}class co{constructor(t){this.decoder=new cn(t),this.str=Pt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const ao=crypto.getRandomValues.bind(crypto),lo=Math.random,gi=()=>ao(new Uint32Array(1))[0],ho=[1e7]+-1e3+-4e3+-8e3+-1e11,pi=()=>ho.replace(/[018]/g,e=>(e^gi()&15>>e/4).toString(16)),qt=Date.now,Ur=e=>new Promise(e);Promise.all.bind(Promise);const uo=e=>Promise.reject(e),sr=e=>Promise.resolve(e),Fr=e=>e===void 0?null:e;class fo{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let yi=new fo,or=!0;try{typeof localStorage<"u"&&localStorage&&(yi=localStorage,or=!1)}catch{}const mi=yi,go=e=>or||addEventListener("storage",e),po=e=>or||removeEventListener("storage",e),yo=Object.assign,wi=Object.keys,mo=(e,t)=>{for(const n in e)t(e[n],n)},Br=e=>wi(e).length,jr=e=>wi(e).length,wo=e=>{for(const t in e)return!1;return!0},bo=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},bi=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_o=(e,t)=>e===t||jr(e)===jr(t)&&bo(e,(n,i)=>(n!==void 0||bi(t,i))&&t[i]===n),vo=Object.freeze,_i=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&_i(e[t])}return vo(e)},Pr=Symbol("Equality"),cr=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&cr(e,t,n+1)}},Co=()=>{},Eo=e=>e,Be=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor)return!1;if(e[Pr]!=null)return e[Pr](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Be(e.get(n),t.get(n)))return!1;break}case Object:if(Br(e)!==Br(t))return!1;for(const n in e)if(!bi(e,n)||!Be(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Be(e[n],t[n]))return!1;break;default:return!1}return!0},So=(e,t)=>t.includes(e),Se=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",vi=typeof window<"u"&&typeof document<"u"&&!Se;let Tt;const ko=()=>{if(Tt===void 0)if(Se){Tt=mt();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const i=e[n];i[0]==="-"?(t!==null&&Tt.set(t,""),t=i):t!==null&&(Tt.set(t,i),t=null)}t!==null&&Tt.set(t,"")}else typeof location=="object"?(Tt=mt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Tt.set(`--${Lr(t,"-")}`,n),Tt.set(`-${Lr(t,"-")}`,n)}})):Tt=mt();return Tt},zn=e=>ko().has(e),He=e=>Fr(Se?process.env[e.toUpperCase().replaceAll("-","_")]:mi.getItem(e)),Ci=e=>zn("--"+e)||He(e)!==null;Ci("production");const Ro=Se&&So({}.FORCE_COLOR,["true","1","2"]),Ao=Ro||!zn("--no-colors")&&!Ci("no-color")&&(!Se||process.stdout.isTTY)&&(!Se||zn("--color")||He("COLORTERM")!==null||(He("TERM")||"").includes("color")),Ei=e=>new Uint8Array(e),To=(e,t,n)=>new Uint8Array(e,t,n),Do=e=>new Uint8Array(e),Lo=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Us(e[n]);return btoa(t)},Io=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),xo=e=>{const t=atob(e),n=Ei(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n},Oo=e=>{const t=Buffer.from(e,"base64");return To(t.buffer,t.byteOffset,t.byteLength)},Si=vi?Lo:Io,ki=vi?xo:Oo,Mo=e=>{const t=Ei(e.byteLength);return t.set(e),t};class No{constructor(t,n){this.left=t,this.right=n}}const Bt=(e,t)=>new No(e,t);typeof DOMParser<"u"&&new DOMParser;const Uo=e=>Ds(e,(t,n)=>`${n}:${t};`).join(""),Fo=JSON.stringify,Wt=Symbol,Et=Wt(),ae=Wt(),Ri=Wt(),ar=Wt(),Ai=Wt(),Ti=Wt(),Di=Wt(),En=Wt(),Sn=Wt(),Bo=e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[];let i=0;for(;i<e.length;i++){const s=e[i];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(i>0&&n.push(t.join(""));i<e.length;i++){const s=e[i];s instanceof Symbol||n.push(s)}return n},Vr=[Ai,Di,En,Ri];let Mn=0,qr=qt();const jo=(e,t)=>{const n=Vr[Mn],i=He("log"),o=i!==null&&(i==="*"||i==="true"||new RegExp(i,"gi").test(t));return Mn=(Mn+1)%Vr.length,t+=": ",o?(...s)=>{var a;s.length===1&&((a=s[0])==null?void 0:a.constructor)===Function&&(s=s[0]());const h=qt(),l=h-qr;qr=h,e(n,t,Sn,...s.map(p=>{switch(p!=null&&p.constructor===Uint8Array&&(p=Array.from(p)),typeof p){case"string":case"symbol":return p;default:return Fo(p)}}),n," +"+l+"ms")}:Co},Po={[Et]:Bt("font-weight","bold"),[ae]:Bt("font-weight","normal"),[Ri]:Bt("color","blue"),[Ai]:Bt("color","green"),[ar]:Bt("color","grey"),[Ti]:Bt("color","red"),[Di]:Bt("color","purple"),[En]:Bt("color","orange"),[Sn]:Bt("color","black")},Vo=e=>{var h;e.length===1&&((h=e[0])==null?void 0:h.constructor)===Function&&(e=e[0]());const t=[],n=[],i=mt();let o=[],s=0;for(;s<e.length;s++){const l=e[s],a=Po[l];if(a!==void 0)i.set(a.left,a.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const p=Uo(i);s>0||p.length>0?(t.push("%c"+l),n.push(p)):t.push(l)}else break}}for(s>0&&(o=n,o.unshift(t.join("")));s<e.length;s++){const l=e[s];l instanceof Symbol||o.push(l)}return o},Li=Ao?Vo:Bo,Ii=(...e)=>{console.log(...Li(e)),xi.forEach(t=>t.print(e))},qo=(...e)=>{console.warn(...Li(e)),e.unshift(En),xi.forEach(t=>t.print(e))},xi=Zt(),Wo=e=>jo(Ii,e),Oi=e=>({[Symbol.iterator](){return this},next:e}),Ho=(e,t)=>Oi(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Nn=(e,t)=>Oi(()=>{const{done:n,value:i}=e.next();return{done:n,value:n?void 0:t(i)}});class lr{constructor(t,n){this.clock=t,this.len=n}}class Ke{constructor(){this.clients=new Map}}const Mi=(e,t,n)=>t.clients.forEach((i,o)=>{const s=e.doc.store.clients.get(o);if(s!=null){const h=s[s.length-1],l=h.id.clock+h.length;for(let a=0,p=i[a];a<i.length&&p.clock<l;p=i[++a])$i(e,s,p.clock,p.len,n)}}),Yo=(e,t)=>{let n=0,i=e.length-1;for(;n<=i;){const o=xt((n+i)/2),s=e[o],h=s.clock;if(h<=t){if(t<h+s.len)return o;n=o+1}else i=o-1}return null},Ni=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Yo(n,t.clock)!==null},hr=e=>{e.clients.forEach(t=>{t.sort((o,s)=>o.clock-s.clock);let n,i;for(n=1,i=1;n<t.length;n++){const o=t[i-1],s=t[n];o.clock+o.len>=s.clock?o.len=de(o.len,s.clock+s.len-o.clock):(i<n&&(t[i]=s),i++)}t.length=i})},zo=e=>{const t=new Ke;for(let n=0;n<e.length;n++)e[n].clients.forEach((i,o)=>{if(!t.clients.has(o)){const s=i.slice();for(let h=n+1;h<e.length;h++)Is(s,e[h].clients.get(o)||[]);t.clients.set(o,s)}});return hr(t),t},ln=(e,t,n,i)=>{_t(e.clients,t,()=>[]).push(new lr(n,i))},$o=()=>new Ke,Go=e=>{const t=$o();return e.clients.forEach((n,i)=>{const o=[];for(let s=0;s<n.length;s++){const h=n[s];if(h.deleted){const l=h.id.clock;let a=h.length;if(s+1<n.length)for(let p=n[s+1];s+1<n.length&&p.deleted;p=n[++s+1])a+=p.length;o.push(new lr(l,a))}}o.length>0&&t.clients.set(i,o)}),t},De=(e,t)=>{q(e.restEncoder,t.clients.size),Vt(t.clients.entries()).sort((n,i)=>i[0]-n[0]).forEach(([n,i])=>{e.resetDsCurVal(),q(e.restEncoder,n);const o=i.length;q(e.restEncoder,o);for(let s=0;s<o;s++){const h=i[s];e.writeDsClock(h.clock),e.writeDsLen(h.len)}})},ur=e=>{const t=new Ke,n=Y(e.restDecoder);for(let i=0;i<n;i++){e.resetDsCurVal();const o=Y(e.restDecoder),s=Y(e.restDecoder);if(s>0){const h=_t(t.clients,o,()=>[]);for(let l=0;l<s;l++)h.push(new lr(e.readDsClock(),e.readDsLen()))}}return t},Wr=(e,t,n)=>{const i=new Ke,o=Y(e.restDecoder);for(let s=0;s<o;s++){e.resetDsCurVal();const h=Y(e.restDecoder),l=Y(e.restDecoder),a=n.clients.get(h)||[],p=ut(n,h);for(let b=0;b<l;b++){const u=e.readDsClock(),f=u+e.readDsLen();if(u<p){p<f&&ln(i,h,p,f-p);let y=Nt(a,u),g=a[y];for(!g.deleted&&g.id.clock<u&&(a.splice(y+1,0,yn(t,g,u-g.id.clock)),y++);y<a.length&&(g=a[y++],g.id.clock<f);)g.deleted||(f<g.id.clock+g.length&&a.splice(y,0,yn(t,g,f-g.id.clock)),g.delete(t))}else ln(i,h,u,f-u)}}if(i.clients.size>0){const s=new le;return q(s.restEncoder,0),De(s,i),s.toUint8Array()}return null},Ui=gi;class Le extends ai{constructor({guid:t=pi(),collectionid:n=null,gc:i=!0,gcFilter:o=()=>!0,meta:s=null,autoLoad:h=!1,shouldLoad:l=!0}={}){super(),this.gc=i,this.gcFilter=o,this.clientID=Ui(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Yi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=h,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ur(p=>{this.on("load",()=>{this.isLoaded=!0,p(this)})});const a=()=>Ur(p=>{const b=u=>{(u===void 0||u===!0)&&(this.off("sync",b),p())};this.on("sync",b)});this.on("sync",p=>{p===!1&&this.isSynced&&(this.whenSynced=a()),this.isSynced=p===void 0||p===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=a()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Q(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Vt(this.subdocs).map(t=>t.guid))}transact(t,n=null){return Q(this,t,n)}get(t,n=gt){const i=_t(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),o=i.constructor;if(n!==gt&&o!==n)if(o===gt){const s=new n;s._map=i._map,i._map.forEach(h=>{for(;h!==null;h=h.left)h.parent=s}),s._start=i._start;for(let h=s._start;h!==null;h=h.right)h.parent=s;return s._length=i._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return i}getArray(t=""){return this.get(t,_e)}getText(t=""){return this.get(t,Ae)}getMap(t=""){return this.get(t,Re)}getXmlElement(t=""){return this.get(t,Te)}getXmlFragment(t=""){return this.get(t,he)}toJSON(){const t={};return this.share.forEach((n,i)=>{t[i]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Vt(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Le({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,Q(t.parent.doc,i=>{const o=n.doc;t.deleted||i.subdocsAdded.add(o),i.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Fi{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Y(this.restDecoder)}readDsLen(){return Y(this.restDecoder)}}class Bi extends Fi{readLeftID(){return K(Y(this.restDecoder),Y(this.restDecoder))}readRightID(){return K(Y(this.restDecoder),Y(this.restDecoder))}readClient(){return Y(this.restDecoder)}readInfo(){return ce(this.restDecoder)}readString(){return Pt(this.restDecoder)}readParentInfo(){return Y(this.restDecoder)===1}readTypeRef(){return Y(this.restDecoder)}readLen(){return Y(this.restDecoder)}readAny(){return Ee(this.restDecoder)}readBuf(){return Mo(at(this.restDecoder))}readJSON(){return JSON.parse(Pt(this.restDecoder))}readKey(){return Pt(this.restDecoder)}}class Jo{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Y(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Y(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ke extends Jo{constructor(t){super(t),this.keys=[],Y(t),this.keyClockDecoder=new On(at(t)),this.clientDecoder=new cn(at(t)),this.leftClockDecoder=new On(at(t)),this.rightClockDecoder=new On(at(t)),this.infoDecoder=new Nr(at(t),ce),this.stringDecoder=new co(at(t)),this.parentInfoDecoder=new Nr(at(t),ce),this.typeRefDecoder=new cn(at(t)),this.lenDecoder=new cn(at(t))}readLeftID(){return new be(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new be(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ee(this.restDecoder)}readBuf(){return at(this.restDecoder)}readJSON(){return Ee(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class ji{constructor(){this.restEncoder=lt()}toUint8Array(){return et(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){q(this.restEncoder,t)}writeDsLen(t){q(this.restEncoder,t)}}class Xe extends ji{writeLeftID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeRightID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeClient(t){q(this.restEncoder,t)}writeInfo(t){We(this.restEncoder,t)}writeString(t){Lt(this.restEncoder,t)}writeParentInfo(t){q(this.restEncoder,t?1:0)}writeTypeRef(t){q(this.restEncoder,t)}writeLen(t){q(this.restEncoder,t)}writeAny(t){Ce(this.restEncoder,t)}writeBuf(t){rt(this.restEncoder,t)}writeJSON(t){Lt(this.restEncoder,JSON.stringify(t))}writeKey(t){Lt(this.restEncoder,t)}}class Pi{constructor(){this.restEncoder=lt(),this.dsCurrVal=0}toUint8Array(){return et(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,q(this.restEncoder,n)}writeDsLen(t){t===0&&Mt(),q(this.restEncoder,t-1),this.dsCurrVal+=t}}class le extends Pi{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new xn,this.clientEncoder=new on,this.leftClockEncoder=new xn,this.rightClockEncoder=new xn,this.infoEncoder=new xr(We),this.stringEncoder=new Zs,this.parentInfoEncoder=new xr(We),this.typeRefEncoder=new on,this.lenEncoder=new on}toUint8Array(){const t=lt();return q(t,0),rt(t,this.keyClockEncoder.toUint8Array()),rt(t,this.clientEncoder.toUint8Array()),rt(t,this.leftClockEncoder.toUint8Array()),rt(t,this.rightClockEncoder.toUint8Array()),rt(t,et(this.infoEncoder)),rt(t,this.stringEncoder.toUint8Array()),rt(t,et(this.parentInfoEncoder)),rt(t,this.typeRefEncoder.toUint8Array()),rt(t,this.lenEncoder.toUint8Array()),vn(t,et(this.restEncoder)),et(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ce(this.restEncoder,t)}writeBuf(t){rt(this.restEncoder,t)}writeJSON(t){Ce(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Ko=(e,t,n,i)=>{i=de(i,t[0].id.clock);const o=Nt(t,i);q(e.restEncoder,t.length-o),e.writeClient(n),q(e.restEncoder,i);const s=t[o];s.write(e,i-s.id.clock);for(let h=o+1;h<t.length;h++)t[h].write(e,0)},dr=(e,t,n)=>{const i=new Map;n.forEach((o,s)=>{ut(t,s)>o&&i.set(s,o)}),kn(t).forEach((o,s)=>{n.has(s)||i.set(s,0)}),q(e.restEncoder,i.size),Vt(i.entries()).sort((o,s)=>s[0]-o[0]).forEach(([o,s])=>{Ko(e,t.clients.get(o),o,s)})},Xo=(e,t)=>{const n=mt(),i=Y(e.restDecoder);for(let o=0;o<i;o++){const s=Y(e.restDecoder),h=new Array(s),l=e.readClient();let a=Y(e.restDecoder);n.set(l,{i:0,refs:h});for(let p=0;p<s;p++){const b=e.readInfo();switch(_n&b){case 0:{const u=e.readLen();h[p]=new vt(K(l,a),u),a+=u;break}case 10:{const u=Y(e.restDecoder);h[p]=new Ct(K(l,a),u),a+=u;break}default:{const u=(b&(jt|bt))===0,f=new st(K(l,a),null,(b&bt)===bt?e.readLeftID():null,null,(b&jt)===jt?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(b&Ve)===Ve?e.readString():null,ds(e,b));h[p]=f,a+=f.length}}}}return n},Zo=(e,t,n)=>{const i=[];let o=Vt(n.keys()).sort((y,g)=>y-g);if(o.length===0)return null;const s=()=>{if(o.length===0)return null;let y=n.get(o[o.length-1]);for(;y.refs.length===y.i;)if(o.pop(),o.length>0)y=n.get(o[o.length-1]);else return null;return y};let h=s();if(h===null)return null;const l=new Yi,a=new Map,p=(y,g)=>{const C=a.get(y);(C==null||C>g)&&a.set(y,g)};let b=h.refs[h.i++];const u=new Map,f=()=>{for(const y of i){const g=y.id.client,C=n.get(g);C?(C.i--,l.clients.set(g,C.refs.slice(C.i)),n.delete(g),C.i=0,C.refs=[]):l.clients.set(g,[y]),o=o.filter(M=>M!==g)}i.length=0};for(;;){if(b.constructor!==Ct){const g=_t(u,b.id.client,()=>ut(t,b.id.client))-b.id.clock;if(g<0)i.push(b),p(b.id.client,b.id.clock-1),f();else{const C=b.getMissing(e,t);if(C!==null){i.push(b);const M=n.get(C)||{refs:[],i:0};if(M.refs.length===M.i)p(C,ut(t,C)),f();else{b=M.refs[M.i++];continue}}else(g===0||g<b.length)&&(b.integrate(e,g),u.set(b.id.client,b.id.clock+b.length))}}if(i.length>0)b=i.pop();else if(h!==null&&h.i<h.refs.length)b=h.refs[h.i++];else{if(h=s(),h===null)break;b=h.refs[h.i++]}}if(l.clients.size>0){const y=new le;return dr(y,l,new Map),q(y.restEncoder,0),{missing:a,update:y.toUint8Array()}}return null},Qo=(e,t)=>dr(e,t.doc.store,t.beforeState),tc=(e,t,n,i=new ke(e))=>Q(t,o=>{o.local=!1;let s=!1;const h=o.doc,l=h.store,a=Xo(i,h),p=Zo(o,l,a),b=l.pendingStructs;if(b){for(const[f,y]of b.missing)if(y<ut(l,f)){s=!0;break}if(p){for(const[f,y]of p.missing){const g=b.missing.get(f);(g==null||g>y)&&b.missing.set(f,y)}b.update=hn([b.update,p.update])}}else l.pendingStructs=p;const u=Wr(i,o,l);if(l.pendingDs){const f=new ke(Ft(l.pendingDs));Y(f.restDecoder);const y=Wr(f,o,l);u&&y?l.pendingDs=hn([u,y]):l.pendingDs=u||y}else l.pendingDs=u;if(s){const f=l.pendingStructs.update;l.pendingStructs=null,Vi(o.doc,f)}},n,!1),Vi=(e,t,n,i=ke)=>{const o=Ft(t);tc(o,e,n,new i(o))},ec=(e,t,n)=>Vi(e,t,n,Bi),nc=(e,t,n=new Map)=>{dr(e,t.store,n),De(e,Go(t.store))},rc=(e,t=new Uint8Array([0]),n=new le)=>{const i=qi(t);nc(n,e,i);const o=[n.toUint8Array()];if(e.store.pendingDs&&o.push(e.store.pendingDs),e.store.pendingStructs&&o.push(bc(e.store.pendingStructs.update,t)),o.length>1){if(n.constructor===Xe)return mc(o.map((s,h)=>h===0?s:vc(s)));if(n.constructor===le)return hn(o)}return o[0]},ic=(e,t)=>rc(e,t,new Xe),sc=e=>{const t=new Map,n=Y(e.restDecoder);for(let i=0;i<n;i++){const o=Y(e.restDecoder),s=Y(e.restDecoder);t.set(o,s)}return t},qi=e=>sc(new Fi(Ft(e))),Wi=(e,t)=>(q(e.restEncoder,t.size),Vt(t.entries()).sort((n,i)=>i[0]-n[0]).forEach(([n,i])=>{q(e.restEncoder,n),q(e.restEncoder,i)}),e),oc=(e,t)=>Wi(e,kn(t.store)),cc=(e,t=new Pi)=>(e instanceof Map?Wi(t,e):oc(t,e),t.toUint8Array()),ac=e=>cc(e,new ji);class lc{constructor(){this.l=[]}}const Hr=()=>new lc,Yr=(e,t)=>e.l.push(t),zr=(e,t)=>{const n=e.l,i=n.length;e.l=n.filter(o=>t!==o),i===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Hi=(e,t,n)=>cr(e.l,[t,n]);class be{constructor(t,n){this.client=t,this.clock=n}}const tn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,K=(e,t)=>new be(e,t),hc=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Mt()},we=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ni(t.ds,e.id),$n=(e,t)=>{const n=_t(e.meta,$n,Zt),i=e.doc.store;n.has(t)||(t.sv.forEach((o,s)=>{o<ut(i,s)&&Qt(e,K(s,o))}),Mi(e,t.ds,o=>{}),n.add(t))};class Yi{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const kn=e=>{const t=new Map;return e.clients.forEach((n,i)=>{const o=n[n.length-1];t.set(i,o.id.clock+o.length)}),t},ut=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const i=n[n.length-1];return i.id.clock+i.length},zi=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const i=n[n.length-1];if(i.id.clock+i.length!==t.id.clock)throw Mt()}n.push(t)},Nt=(e,t)=>{let n=0,i=e.length-1,o=e[i],s=o.id.clock;if(s===t)return i;let h=xt(t/(s+o.length-1)*i);for(;n<=i;){if(o=e[h],s=o.id.clock,s<=t){if(t<s+o.length)return h;n=h+1}else i=h-1;h=xt((n+i)/2)}throw Mt()},uc=(e,t)=>{const n=e.clients.get(t.client);return n[Nt(n,t.clock)]},Un=uc,Gn=(e,t,n)=>{const i=Nt(t,n),o=t[i];return o.id.clock<n&&o instanceof st?(t.splice(i+1,0,yn(e,o,n-o.id.clock)),i+1):i},Qt=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Gn(e,n,t.clock)]},$r=(e,t,n)=>{const i=t.clients.get(n.client),o=Nt(i,n.clock),s=i[o];return n.clock!==s.id.clock+s.length-1&&s.constructor!==vt&&i.splice(o+1,0,yn(e,s,n.clock-s.id.clock+1)),s},dc=(e,t,n)=>{const i=e.clients.get(t.id.client);i[Nt(i,t.id.clock)]=n},$i=(e,t,n,i,o)=>{if(i===0)return;const s=n+i;let h=Gn(e,t,n),l;do l=t[h++],s<l.id.clock+l.length&&Gn(e,t,s),o(l);while(h<t.length&&t[h].id.clock<s)};class fc{constructor(t,n,i){this.doc=t,this.deleteSet=new Ke,this.beforeState=kn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=i,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Gr=(e,t)=>t.deleteSet.clients.size===0&&!Ls(t.afterState,(n,i)=>t.beforeState.get(i)!==n)?!1:(hr(t.deleteSet),Qo(e,t),De(e,t.deleteSet),!0),Jr=(e,t,n)=>{const i=t._item;(i===null||i.id.clock<(e.beforeState.get(i.id.client)||0)&&!i.deleted)&&_t(e.changed,t,Zt).add(n)},an=(e,t)=>{let n=e[t],i=e[t-1],o=t;for(;o>0;n=i,i=e[--o-1]){if(i.deleted===n.deleted&&i.constructor===n.constructor&&i.mergeWith(n)){n instanceof st&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,i);continue}break}const s=t-o;return s&&e.splice(t+1-s,s),s},gc=(e,t,n)=>{for(const[i,o]of e.clients.entries()){const s=t.clients.get(i);for(let h=o.length-1;h>=0;h--){const l=o[h],a=l.clock+l.len;for(let p=Nt(s,l.clock),b=s[p];p<s.length&&b.id.clock<a;b=s[++p]){const u=s[p];if(l.clock+l.len<=u.id.clock)break;u instanceof st&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},pc=(e,t)=>{e.clients.forEach((n,i)=>{const o=t.clients.get(i);for(let s=n.length-1;s>=0;s--){const h=n[s],l=tr(o.length-1,1+Nt(o,h.clock+h.len-1));for(let a=l,p=o[a];a>0&&p.id.clock>=h.clock;p=o[a])a-=1+an(o,a)}})},Gi=(e,t)=>{if(t<e.length){const n=e[t],i=n.doc,o=i.store,s=n.deleteSet,h=n._mergeStructs;try{hr(s),n.afterState=kn(n.doc.store),i.emit("beforeObserverCalls",[n,i]);const l=[];n.changed.forEach((a,p)=>l.push(()=>{(p._item===null||!p._item.deleted)&&p._callObserver(n,a)})),l.push(()=>{n.changedParentTypes.forEach((a,p)=>{p._dEH.l.length>0&&(p._item===null||!p._item.deleted)&&(a=a.filter(b=>b.target._item===null||!b.target._item.deleted),a.forEach(b=>{b.currentTarget=p,b._path=null}),a.sort((b,u)=>b.path.length-u.path.length),Hi(p._dEH,a,n))})}),l.push(()=>i.emit("afterTransaction",[n,i])),cr(l,[]),n._needFormattingCleanup&&Nc(n)}finally{i.gc&&gc(s,o,i.gcFilter),pc(s,o),n.afterState.forEach((b,u)=>{const f=n.beforeState.get(u)||0;if(f!==b){const y=o.clients.get(u),g=de(Nt(y,f),1);for(let C=y.length-1;C>=g;)C-=1+an(y,C)}});for(let b=h.length-1;b>=0;b--){const{client:u,clock:f}=h[b].id,y=o.clients.get(u),g=Nt(y,f);g+1<y.length&&an(y,g+1)>1||g>0&&an(y,g)}if(!n.local&&n.afterState.get(i.clientID)!==n.beforeState.get(i.clientID)&&(Ii(En,Et,"[yjs] ",ae,Ti,"Changed the client-id because another client seems to be using it."),i.clientID=Ui()),i.emit("afterTransactionCleanup",[n,i]),i._observers.has("update")){const b=new Xe;Gr(b,n)&&i.emit("update",[b.toUint8Array(),n.origin,i,n])}if(i._observers.has("updateV2")){const b=new le;Gr(b,n)&&i.emit("updateV2",[b.toUint8Array(),n.origin,i,n])}const{subdocsAdded:l,subdocsLoaded:a,subdocsRemoved:p}=n;(l.size>0||p.size>0||a.size>0)&&(l.forEach(b=>{b.clientID=i.clientID,b.collectionid==null&&(b.collectionid=i.collectionid),i.subdocs.add(b)}),p.forEach(b=>i.subdocs.delete(b)),i.emit("subdocs",[{loaded:a,added:l,removed:p},i,n]),p.forEach(b=>b.destroy())),e.length<=t+1?(i._transactionCleanups=[],i.emit("afterAllTransactions",[i,e])):Gi(e,t+1)}}},Q=(e,t,n=null,i=!0)=>{const o=e._transactionCleanups;let s=!1,h=null;e._transaction===null&&(s=!0,e._transaction=new fc(e,n,i),o.push(e._transaction),o.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{h=t(e._transaction)}finally{if(s){const l=e._transaction===o[0];e._transaction=null,l&&Gi(o,0)}}return h};function*yc(e){const t=Y(e.restDecoder);for(let n=0;n<t;n++){const i=Y(e.restDecoder),o=e.readClient();let s=Y(e.restDecoder);for(let h=0;h<i;h++){const l=e.readInfo();if(l===10){const a=Y(e.restDecoder);yield new Ct(K(o,s),a),s+=a}else if(_n&l){const a=(l&(jt|bt))===0,p=new st(K(o,s),null,(l&bt)===bt?e.readLeftID():null,null,(l&jt)===jt?e.readRightID():null,a?e.readParentInfo()?e.readString():e.readLeftID():null,a&&(l&Ve)===Ve?e.readString():null,ds(e,l));yield p,s+=p.length}else{const a=e.readLen();yield new vt(K(o,s),a),s+=a}}}}class fr{constructor(t,n){this.gen=yc(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ct);return this.curr}}class gr{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const mc=e=>hn(e,Bi,Xe),wc=(e,t)=>{if(e.constructor===vt){const{client:n,clock:i}=e.id;return new vt(K(n,i+t),e.length-t)}else if(e.constructor===Ct){const{client:n,clock:i}=e.id;return new Ct(K(n,i+t),e.length-t)}else{const n=e,{client:i,clock:o}=n.id;return new st(K(i,o+t),null,K(i,o+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hn=(e,t=ke,n=le)=>{if(e.length===1)return e[0];const i=e.map(b=>new t(Ft(b)));let o=i.map(b=>new fr(b,!0)),s=null;const h=new n,l=new gr(h);for(;o=o.filter(f=>f.curr!==null),o.sort((f,y)=>{if(f.curr.id.client===y.curr.id.client){const g=f.curr.id.clock-y.curr.id.clock;return g===0?f.curr.constructor===y.curr.constructor?0:f.curr.constructor===Ct?1:-1:g}else return y.curr.id.client-f.curr.id.client}),o.length!==0;){const b=o[0],u=b.curr.id.client;if(s!==null){let f=b.curr,y=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=b.next(),y=!0;if(f===null||f.id.client!==u||y&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)Kt(l,s.struct,s.offset),s={struct:f,offset:0},b.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Ct)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Kt(l,s.struct,s.offset);const g=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Ct(K(u,s.struct.id.clock+s.struct.length),g),offset:0}}else{const g=s.struct.id.clock+s.struct.length-f.id.clock;g>0&&(s.struct.constructor===Ct?s.struct.length-=g:f=wc(f,g)),s.struct.mergeWith(f)||(Kt(l,s.struct,s.offset),s={struct:f,offset:0},b.next())}}else s={struct:b.curr,offset:0},b.next();for(let f=b.curr;f!==null&&f.id.client===u&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Ct;f=b.next())Kt(l,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Kt(l,s.struct,s.offset),s=null),pr(l);const a=i.map(b=>ur(b)),p=zo(a);return De(h,p),h.toUint8Array()},bc=(e,t,n=ke,i=le)=>{const o=qi(t),s=new i,h=new gr(s),l=new n(Ft(e)),a=new fr(l,!1);for(;a.curr;){const b=a.curr,u=b.id.client,f=o.get(u)||0;if(a.curr.constructor===Ct){a.next();continue}if(b.id.clock+b.length>f)for(Kt(h,b,de(f-b.id.clock,0)),a.next();a.curr&&a.curr.id.client===u;)Kt(h,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===u&&a.curr.id.clock+a.curr.length<=f;)a.next()}pr(h);const p=ur(l);return De(s,p),s.toUint8Array()},Ji=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:et(e.encoder.restEncoder)}),e.encoder.restEncoder=lt(),e.written=0)},Kt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ji(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),q(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},pr=e=>{Ji(e);const t=e.encoder.restEncoder;q(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const i=e.clientStructs[n];q(t,i.written),vn(t,i.restEncoder)}},_c=(e,t,n,i)=>{const o=new n(Ft(e)),s=new fr(o,!1),h=new i,l=new gr(h);for(let p=s.curr;p!==null;p=s.next())Kt(l,t(p),0);pr(l);const a=ur(o);return De(h,a),h.toUint8Array()},vc=e=>_c(e,Eo,ke,Xe),Kr="You must not compute changes after the event-handler fired.";class Rn{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Cc(this.currentTarget,this.target))}deletes(t){return Ni(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ot(Kr);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(o=>{if(o!==null){const s=n._map.get(o);let h,l;if(this.adds(s)){let a=s.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(s))if(a!==null&&this.deletes(a))h="delete",l=Dn(a.content.getContent());else return;else a!==null&&this.deletes(a)?(h="update",l=Dn(a.content.getContent())):(h="add",l=void 0)}else if(this.deletes(s))h="delete",l=Dn(s.content.getContent());else return;t.set(o,{action:h,oldValue:l})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ot(Kr);const n=this.target,i=Zt(),o=Zt(),s=[];if(t={added:i,deleted:o,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const a=()=>{l&&s.push(l)};for(let p=n._start;p!==null;p=p.right)p.deleted?this.deletes(p)&&!this.adds(p)&&((l===null||l.delete===void 0)&&(a(),l={delete:0}),l.delete+=p.length,o.add(p)):this.adds(p)?((l===null||l.insert===void 0)&&(a(),l={insert:[]}),l.insert=l.insert.concat(p.content.getContent()),i.add(p)):((l===null||l.retain===void 0)&&(a(),l={retain:0}),l.retain+=p.length);l!==null&&l.retain===void 0&&a()}this._changes=t}return t}}const Cc=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let i=0,o=t._item.parent._start;for(;o!==t._item&&o!==null;)!o.deleted&&o.countable&&(i+=o.length),o=o.right;n.unshift(i)}t=t._item.parent}return n},pt=()=>{qo("Invalid access: Add Yjs type to a document before reading data.")},Ki=80;let yr=0;class Ec{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=yr++}}const Sc=e=>{e.timestamp=yr++},Xi=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=yr++},kc=(e,t,n)=>{if(e.length>=Ki){const i=e.reduce((o,s)=>o.timestamp<s.timestamp?o:s);return Xi(i,t,n),i}else{const i=new Ec(t,n);return e.push(i),i}},An=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,h)=>sn(t-s.index)<sn(t-h.index)?s:h);let i=e._start,o=0;for(n!==null&&(i=n.p,o=n.index,Sc(n));i.right!==null&&o<t;){if(!i.deleted&&i.countable){if(t<o+i.length)break;o+=i.length}i=i.right}for(;i.left!==null&&o>t;)i=i.left,!i.deleted&&i.countable&&(o-=i.length);for(;i.left!==null&&i.left.id.client===i.id.client&&i.left.id.clock+i.left.length===i.id.clock;)i=i.left,!i.deleted&&i.countable&&(o-=i.length);return n!==null&&sn(n.index-o)<i.parent.length/Ki?(Xi(n,i,o),n):kc(e._searchMarker,i,o)},Ye=(e,t,n)=>{for(let i=e.length-1;i>=0;i--){const o=e[i];if(n>0){let s=o.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(o.index-=s.length);if(s===null||s.marker===!0){e.splice(i,1);continue}o.p=s,s.marker=!0}(t<o.index||n>0&&t===o.index)&&(o.index=de(t,o.index+n))}},Tn=(e,t,n)=>{const i=e,o=t.changedParentTypes;for(;_t(o,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Hi(i._eH,n,t)};class gt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Hr(),this._dEH=Hr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw It()}clone(){throw It()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Yr(this._eH,t)}observeDeep(t){Yr(this._dEH,t)}unobserve(t){zr(this._eH,t)}unobserveDeep(t){zr(this._dEH,t)}toJSON(){}}const Zi=(e,t,n)=>{e.doc??pt(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let i=n-t;const o=[];let s=e._start;for(;s!==null&&i>0;){if(s.countable&&!s.deleted){const h=s.content.getContent();if(h.length<=t)t-=h.length;else{for(let l=t;l<h.length&&i>0;l++)o.push(h[l]),i--;t=0}}s=s.right}return o},Qi=e=>{e.doc??pt();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let o=0;o<i.length;o++)t.push(i[o])}n=n.right}return t},ze=(e,t)=>{let n=0,i=e._start;for(e.doc??pt();i!==null;){if(i.countable&&!i.deleted){const o=i.content.getContent();for(let s=0;s<o.length;s++)t(o[s],n++,e)}i=i.right}},ts=(e,t)=>{const n=[];return ze(e,(i,o)=>{n.push(t(i,o,e))}),n},Rc=e=>{let t=e._start,n=null,i=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),i=0,t=t.right}const o=n[i++];return n.length<=i&&(n=null),{done:!1,value:o}}}},es=(e,t)=>{e.doc??pt();const n=An(e,t);let i=e._start;for(n!==null&&(i=n.p,t-=n.index);i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<i.length)return i.content.getContent()[t];t-=i.length}},un=(e,t,n,i)=>{let o=n;const s=e.doc,h=s.clientID,l=s.store,a=n===null?t._start:n.right;let p=[];const b=()=>{p.length>0&&(o=new st(K(h,ut(l,h)),o,o&&o.lastId,a,a&&a.id,t,null,new ue(p)),o.integrate(e,0),p=[])};i.forEach(u=>{if(u===null)p.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:p.push(u);break;default:switch(b(),u.constructor){case Uint8Array:case ArrayBuffer:o=new st(K(h,ut(l,h)),o,o&&o.lastId,a,a&&a.id,t,null,new Ze(new Uint8Array(u))),o.integrate(e,0);break;case Le:o=new st(K(h,ut(l,h)),o,o&&o.lastId,a,a&&a.id,t,null,new Qe(u)),o.integrate(e,0);break;default:if(u instanceof gt)o=new st(K(h,ut(l,h)),o,o&&o.lastId,a,a&&a.id,t,null,new Ht(u)),o.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),b()},ns=()=>Ot("Length exceeded!"),rs=(e,t,n,i)=>{if(n>t._length)throw ns();if(n===0)return t._searchMarker&&Ye(t._searchMarker,n,i.length),un(e,t,null,i);const o=n,s=An(t,n);let h=t._start;for(s!==null&&(h=s.p,n-=s.index,n===0&&(h=h.prev,n+=h&&h.countable&&!h.deleted?h.length:0));h!==null;h=h.right)if(!h.deleted&&h.countable){if(n<=h.length){n<h.length&&Qt(e,K(h.id.client,h.id.clock+n));break}n-=h.length}return t._searchMarker&&Ye(t._searchMarker,o,i.length),un(e,t,h,i)},Ac=(e,t,n)=>{let o=(t._searchMarker||[]).reduce((s,h)=>h.index>s.index?h:s,{index:0,p:t._start}).p;if(o)for(;o.right;)o=o.right;return un(e,t,o,n)},is=(e,t,n,i)=>{if(i===0)return;const o=n,s=i,h=An(t,n);let l=t._start;for(h!==null&&(l=h.p,n-=h.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&Qt(e,K(l.id.client,l.id.clock+n)),n-=l.length);for(;i>0&&l!==null;)l.deleted||(i<l.length&&Qt(e,K(l.id.client,l.id.clock+i)),l.delete(e),i-=l.length),l=l.right;if(i>0)throw ns();t._searchMarker&&Ye(t._searchMarker,o,-s+i)},dn=(e,t,n)=>{const i=t._map.get(n);i!==void 0&&i.delete(e)},mr=(e,t,n,i)=>{const o=t._map.get(n)||null,s=e.doc,h=s.clientID;let l;if(i==null)l=new ue([i]);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new ue([i]);break;case Uint8Array:l=new Ze(i);break;case Le:l=new Qe(i);break;default:if(i instanceof gt)l=new Ht(i);else throw new Error("Unexpected content type")}new st(K(h,ut(s.store,h)),o,o&&o.lastId,null,null,t,n,l).integrate(e,0)},wr=(e,t)=>{e.doc??pt();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},ss=e=>{const t={};return e.doc??pt(),e._map.forEach((n,i)=>{n.deleted||(t[i]=n.content.getContent()[n.length-1])}),t},os=(e,t)=>{e.doc??pt();const n=e._map.get(t);return n!==void 0&&!n.deleted},Tc=(e,t)=>{const n={};return e._map.forEach((i,o)=>{let s=i;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&we(s,t)&&(n[o]=s.content.getContent()[s.length-1])}),n},en=e=>(e.doc??pt(),Ho(e._map.entries(),t=>!t[1].deleted));class Dc extends Rn{}class _e extends gt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new _e;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new _e}clone(){const t=new _e;return t.insert(0,this.toArray().map(n=>n instanceof gt?n.clone():n)),t}get length(){return this.doc??pt(),this._length}_callObserver(t,n){super._callObserver(t,n),Tn(this,t,new Dc(this,t))}insert(t,n){this.doc!==null?Q(this.doc,i=>{rs(i,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?Q(this.doc,n=>{Ac(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?Q(this.doc,i=>{is(i,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return es(this,t)}toArray(){return Qi(this)}slice(t=0,n=this.length){return Zi(this,t,n)}toJSON(){return this.map(t=>t instanceof gt?t.toJSON():t)}map(t){return ts(this,t)}forEach(t){ze(this,t)}[Symbol.iterator](){return Rc(this)}_write(t){t.writeTypeRef(ta)}}const Lc=e=>new _e;class Ic extends Rn{constructor(t,n,i){super(t,n),this.keysChanged=i}}class Re extends gt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((i,o)=>{this.set(o,i)}),this._prelimContent=null}_copy(){return new Re}clone(){const t=new Re;return this.forEach((n,i)=>{t.set(i,n instanceof gt?n.clone():n)}),t}_callObserver(t,n){Tn(this,t,new Ic(this,t,n))}toJSON(){this.doc??pt();const t={};return this._map.forEach((n,i)=>{if(!n.deleted){const o=n.content.getContent()[n.length-1];t[i]=o instanceof gt?o.toJSON():o}}),t}get size(){return[...en(this)].length}keys(){return Nn(en(this),t=>t[0])}values(){return Nn(en(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Nn(en(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??pt(),this._map.forEach((n,i)=>{n.deleted||t(n.content.getContent()[n.length-1],i,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Q(this.doc,n=>{dn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?Q(this.doc,i=>{mr(i,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return wr(this,t)}has(t){return os(this,t)}clear(){this.doc!==null?Q(this.doc,t=>{this.forEach(function(n,i,o){dn(t,o,i)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(ea)}}const xc=e=>new Re,Xt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&_o(e,t);class Jn{constructor(t,n,i,o){this.left=t,this.right=n,this.index=i,this.currentAttributes=o}forward(){switch(this.right===null&&Mt(),this.right.content.constructor){case ot:this.right.deleted||Ie(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Xr=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case ot:t.right.deleted||Ie(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Qt(e,K(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},nn=(e,t,n,i)=>{const o=new Map,s=i?An(t,n):null;if(s){const h=new Jn(s.p.left,s.p,s.index,o);return Xr(e,h,n-s.index)}else{const h=new Jn(null,t._start,0,o);return Xr(e,h,n)}},cs=(e,t,n,i)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ot&&Xt(i.get(n.right.content.key),n.right.content.value));)n.right.deleted||i.delete(n.right.content.key),n.forward();const o=e.doc,s=o.clientID;i.forEach((h,l)=>{const a=n.left,p=n.right,b=new st(K(s,ut(o.store,s)),a,a&&a.lastId,p,p&&p.id,t,null,new ot(l,h));b.integrate(e,0),n.right=b,n.forward()})},Ie=(e,t)=>{const{key:n,value:i}=t;i===null?e.delete(n):e.set(n,i)},as=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===ot&&Xt(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},ls=(e,t,n,i)=>{const o=e.doc,s=o.clientID,h=new Map;for(const l in i){const a=i[l],p=n.currentAttributes.get(l)??null;if(!Xt(p,a)){h.set(l,p);const{left:b,right:u}=n;n.right=new st(K(s,ut(o.store,s)),b,b&&b.lastId,u,u&&u.id,t,null,new ot(l,a)),n.right.integrate(e,0),n.forward()}}return h},Fn=(e,t,n,i,o)=>{n.currentAttributes.forEach((f,y)=>{o[y]===void 0&&(o[y]=null)});const s=e.doc,h=s.clientID;as(n,o);const l=ls(e,t,n,o),a=i.constructor===String?new Ut(i):i instanceof gt?new Ht(i):new fe(i);let{left:p,right:b,index:u}=n;t._searchMarker&&Ye(t._searchMarker,n.index,a.getLength()),b=new st(K(h,ut(s.store,h)),p,p&&p.lastId,b,b&&b.id,t,null,a),b.integrate(e,0),n.right=b,n.index=u,n.forward(),cs(e,t,n,l)},Zr=(e,t,n,i,o)=>{const s=e.doc,h=s.clientID;as(n,o);const l=ls(e,t,n,o);t:for(;n.right!==null&&(i>0||l.size>0&&(n.right.deleted||n.right.content.constructor===ot));){if(!n.right.deleted)switch(n.right.content.constructor){case ot:{const{key:a,value:p}=n.right.content,b=o[a];if(b!==void 0){if(Xt(b,p))l.delete(a);else{if(i===0)break t;l.set(a,p)}n.right.delete(e)}else n.currentAttributes.set(a,p);break}default:i<n.right.length&&Qt(e,K(n.right.id.client,n.right.id.clock+i)),i-=n.right.length;break}n.forward()}if(i>0){let a="";for(;i>0;i--)a+=`
`;n.right=new st(K(h,ut(s.store,h)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ut(a)),n.right.integrate(e,0),n.forward()}cs(e,t,n,l)},hs=(e,t,n,i,o)=>{let s=t;const h=mt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ot){const p=s.content;h.set(p.key,p)}s=s.right}let l=0,a=!1;for(;t!==s;){if(n===t&&(a=!0),!t.deleted){const p=t.content;switch(p.constructor){case ot:{const{key:b,value:u}=p,f=i.get(b)??null;(h.get(b)!==p||f===u)&&(t.delete(e),l++,!a&&(o.get(b)??null)===u&&f!==u&&(f===null?o.delete(b):o.set(b,f))),!a&&!t.deleted&&Ie(o,p);break}}}t=t.right}return l},Oc=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ot){const i=t.content.key;n.has(i)?t.delete(e):n.add(i)}t=t.left}},Mc=e=>{let t=0;return Q(e.doc,n=>{let i=e._start,o=e._start,s=mt();const h=qn(s);for(;o;){if(o.deleted===!1)switch(o.content.constructor){case ot:Ie(h,o.content);break;default:t+=hs(n,i,o,s,h),s=qn(h),i=o;break}o=o.right}}),t},Nc=e=>{const t=new Set,n=e.doc;for(const[i,o]of e.afterState.entries()){const s=e.beforeState.get(i)||0;o!==s&&$i(e,n.store.clients.get(i),s,o,h=>{!h.deleted&&h.content.constructor===ot&&h.constructor!==vt&&t.add(h.parent)})}Q(n,i=>{Mi(e,e.deleteSet,o=>{if(o instanceof vt||!o.parent._hasFormatting||t.has(o.parent))return;const s=o.parent;o.content.constructor===ot?t.add(s):Oc(i,o)});for(const o of t)Mc(o)})},Qr=(e,t,n)=>{const i=n,o=qn(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ht:case fe:case Ut:n<t.right.length&&Qt(e,K(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&hs(e,s,t.right,o,t.currentAttributes);const h=(t.left||t.right).parent;return h._searchMarker&&Ye(h._searchMarker,t.index,-i+n),t};class Uc extends Rn{constructor(t,n,i){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,i.forEach(o=>{o===null?this.childListChanged=!0:this.keysChanged.add(o)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];Q(t,i=>{const o=new Map,s=new Map;let h=this.target._start,l=null;const a={};let p="",b=0,u=0;const f=()=>{if(l!==null){let y=null;switch(l){case"delete":u>0&&(y={delete:u}),u=0;break;case"insert":(typeof p=="object"||p.length>0)&&(y={insert:p},o.size>0&&(y.attributes={},o.forEach((g,C)=>{g!==null&&(y.attributes[C]=g)}))),p="";break;case"retain":b>0&&(y={retain:b},wo(a)||(y.attributes=yo({},a))),b=0;break}y&&n.push(y),l=null}};for(;h!==null;){switch(h.content.constructor){case Ht:case fe:this.adds(h)?this.deletes(h)||(f(),l="insert",p=h.content.getContent()[0],f()):this.deletes(h)?(l!=="delete"&&(f(),l="delete"),u+=1):h.deleted||(l!=="retain"&&(f(),l="retain"),b+=1);break;case Ut:this.adds(h)?this.deletes(h)||(l!=="insert"&&(f(),l="insert"),p+=h.content.str):this.deletes(h)?(l!=="delete"&&(f(),l="delete"),u+=h.length):h.deleted||(l!=="retain"&&(f(),l="retain"),b+=h.length);break;case ot:{const{key:y,value:g}=h.content;if(this.adds(h)){if(!this.deletes(h)){const C=o.get(y)??null;Xt(C,g)?g!==null&&h.delete(i):(l==="retain"&&f(),Xt(g,s.get(y)??null)?delete a[y]:a[y]=g)}}else if(this.deletes(h)){s.set(y,g);const C=o.get(y)??null;Xt(C,g)||(l==="retain"&&f(),a[y]=C)}else if(!h.deleted){s.set(y,g);const C=a[y];C!==void 0&&(Xt(C,g)?C!==null&&h.delete(i):(l==="retain"&&f(),g===null?delete a[y]:a[y]=g))}h.deleted||(l==="insert"&&f(),Ie(o,h.content));break}}h=h.right}for(f();n.length>0;){const y=n[n.length-1];if(y.retain!==void 0&&y.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ae extends gt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??pt(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(i=>i())}catch(i){console.error(i)}this._pending=null}_copy(){return new Ae}clone(){const t=new Ae;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const i=new Uc(this,t,n);Tn(this,t,i),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??pt();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ut&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?Q(this.doc,i=>{const o=new Jn(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const h=t[s];if(h.insert!==void 0){const l=!n&&typeof h.insert=="string"&&s===t.length-1&&o.right===null&&h.insert.slice(-1)===`
`?h.insert.slice(0,-1):h.insert;(typeof l!="string"||l.length>0)&&Fn(i,this,o,l,h.attributes||{})}else h.retain!==void 0?Zr(i,this,o,h.retain,h.attributes||{}):h.delete!==void 0&&Qr(i,o,h.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,i){this.doc??pt();const o=[],s=new Map,h=this.doc;let l="",a=this._start;function p(){if(l.length>0){const u={};let f=!1;s.forEach((g,C)=>{f=!0,u[C]=g});const y={insert:l};f&&(y.attributes=u),o.push(y),l=""}}const b=()=>{for(;a!==null;){if(we(a,t)||n!==void 0&&we(a,n))switch(a.content.constructor){case Ut:{const u=s.get("ychange");t!==void 0&&!we(a,t)?(u===void 0||u.user!==a.id.client||u.type!=="removed")&&(p(),s.set("ychange",i?i("removed",a.id):{type:"removed"})):n!==void 0&&!we(a,n)?(u===void 0||u.user!==a.id.client||u.type!=="added")&&(p(),s.set("ychange",i?i("added",a.id):{type:"added"})):u!==void 0&&(p(),s.delete("ychange")),l+=a.content.str;break}case Ht:case fe:{p();const u={insert:a.content.getContent()[0]};if(s.size>0){const f={};u.attributes=f,s.forEach((y,g)=>{f[g]=y})}o.push(u);break}case ot:we(a,t)&&(p(),Ie(s,a.content));break}a=a.right}p()};return t||n?Q(h,u=>{t&&$n(u,t),n&&$n(u,n),b()},"cleanup"):b(),o}insert(t,n,i){if(n.length<=0)return;const o=this.doc;o!==null?Q(o,s=>{const h=nn(s,this,t,!i);i||(i={},h.currentAttributes.forEach((l,a)=>{i[a]=l})),Fn(s,this,h,n,i)}):this._pending.push(()=>this.insert(t,n,i))}insertEmbed(t,n,i){const o=this.doc;o!==null?Q(o,s=>{const h=nn(s,this,t,!i);Fn(s,this,h,n,i||{})}):this._pending.push(()=>this.insertEmbed(t,n,i||{}))}delete(t,n){if(n===0)return;const i=this.doc;i!==null?Q(i,o=>{Qr(o,nn(o,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,i){if(n===0)return;const o=this.doc;o!==null?Q(o,s=>{const h=nn(s,this,t,!1);h.right!==null&&Zr(s,this,h,n,i)}):this._pending.push(()=>this.format(t,n,i))}removeAttribute(t){this.doc!==null?Q(this.doc,n=>{dn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?Q(this.doc,i=>{mr(i,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return wr(this,t)}getAttributes(){return ss(this)}_write(t){t.writeTypeRef(na)}}const Fc=e=>new Ae;class Bn{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??pt()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Te||n.constructor===he)&&n._start!==null)t=n._start;else for(;t!==null;){const i=t.next;if(i!==null){t=i;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class he extends gt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new he}clone(){const t=new he;return t.insert(0,this.toArray().map(n=>n instanceof gt?n.clone():n)),t}get length(){return this.doc??pt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Bn(this,t)}querySelector(t){t=t.toUpperCase();const i=new Bn(this,o=>o.nodeName&&o.nodeName.toUpperCase()===t).next();return i.done?null:i.value}querySelectorAll(t){return t=t.toUpperCase(),Vt(new Bn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Tn(this,t,new Pc(this,n,t))}toString(){return ts(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},i){const o=t.createDocumentFragment();return i!==void 0&&i._createAssociation(o,this),ze(this,s=>{o.insertBefore(s.toDOM(t,n,i),null)}),o}insert(t,n){this.doc!==null?Q(this.doc,i=>{rs(i,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)Q(this.doc,i=>{const o=t&&t instanceof gt?t._item:t;un(i,this,o,n)});else{const i=this._prelimContent,o=t===null?0:i.findIndex(s=>s===t)+1;if(o===0&&t!==null)throw Ot("Reference item not found");i.splice(o,0,...n)}}delete(t,n=1){this.doc!==null?Q(this.doc,i=>{is(i,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Qi(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return es(this,t)}slice(t=0,n=this.length){return Zi(this,t,n)}forEach(t){ze(this,t)}_write(t){t.writeTypeRef(ia)}}const Bc=e=>new he;class Te extends he{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((i,o)=>{this.setAttribute(o,i)}),this._prelimAttrs=null}_copy(){return new Te(this.nodeName)}clone(){const t=new Te(this.nodeName),n=this.getAttributes();return mo(n,(i,o)=>{typeof i=="string"&&t.setAttribute(o,i)}),t.insert(0,this.toArray().map(i=>i instanceof gt?i.clone():i)),t}toString(){const t=this.getAttributes(),n=[],i=[];for(const l in t)i.push(l);i.sort();const o=i.length;for(let l=0;l<o;l++){const a=i[l];n.push(a+'="'+t[a]+'"')}const s=this.nodeName.toLocaleLowerCase(),h=n.length>0?" "+n.join(" "):"";return`<${s}${h}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?Q(this.doc,n=>{dn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?Q(this.doc,i=>{mr(i,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return wr(this,t)}hasAttribute(t){return os(this,t)}getAttributes(t){return t?Tc(this,t):ss(this)}toDOM(t=document,n={},i){const o=t.createElement(this.nodeName),s=this.getAttributes();for(const h in s){const l=s[h];typeof l=="string"&&o.setAttribute(h,l)}return ze(this,h=>{o.appendChild(h.toDOM(t,n,i))}),i!==void 0&&i._createAssociation(o,this),o}_write(t){t.writeTypeRef(ra),t.writeKey(this.nodeName)}}const jc=e=>new Te(e.readKey());class Pc extends Rn{constructor(t,n,i){super(t,i),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(o=>{o===null?this.childListChanged=!0:this.attributesChanged.add(o)})}}class fn extends Re{constructor(t){super(),this.hookName=t}_copy(){return new fn(this.hookName)}clone(){const t=new fn(this.hookName);return this.forEach((n,i)=>{t.set(i,n)}),t}toDOM(t=document,n={},i){const o=n[this.hookName];let s;return o!==void 0?s=o.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),i!==void 0&&i._createAssociation(s,this),s}_write(t){t.writeTypeRef(sa),t.writeKey(this.hookName)}}const Vc=e=>new fn(e.readKey());class gn extends Ae{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new gn}clone(){const t=new gn;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,i){const o=t.createTextNode(this.toString());return i!==void 0&&i._createAssociation(o,this),o}toString(){return this.toDelta().map(t=>{const n=[];for(const o in t.attributes){const s=[];for(const h in t.attributes[o])s.push({key:h,value:t.attributes[o][h]});s.sort((h,l)=>h.key<l.key?-1:1),n.push({nodeName:o,attrs:s})}n.sort((o,s)=>o.nodeName<s.nodeName?-1:1);let i="";for(let o=0;o<n.length;o++){const s=n[o];i+=`<${s.nodeName}`;for(let h=0;h<s.attrs.length;h++){const l=s.attrs[h];i+=` ${l.key}="${l.value}"`}i+=">"}i+=t.insert;for(let o=n.length-1;o>=0;o--)i+=`</${n[o].nodeName}>`;return i}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(oa)}}const qc=e=>new gn;class br{constructor(t,n){this.id=t,this.length=n}get deleted(){throw It()}mergeWith(t){return!1}write(t,n,i){throw It()}integrate(t,n){throw It()}}const Wc=0;class vt extends br{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),zi(t.doc.store,this)}write(t,n){t.writeInfo(Wc),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ze{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ze(this.content)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Hc=e=>new Ze(e.readBuf());class $e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new $e(this.len)}splice(t){const n=new $e(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){ln(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Yc=e=>new $e(e.readLen()),us=(e,t)=>new Le({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Qe{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Qe(us(this.doc.guid,this.opts))}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const zc=e=>new Qe(us(e.readString(),e.readAny()));class fe{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new fe(this.embed)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const $c=e=>new fe(e.readJSON());class ot{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ot(this.key,this.value)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){const i=n.parent;i._searchMarker=null,i._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Gc=e=>new ot(e.readKey(),e.readJSON());class pn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new pn(this.arr)}splice(t){const n=new pn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let o=n;o<i;o++){const s=this.arr[o];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Jc=e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++){const o=e.readString();o==="undefined"?n.push(void 0):n.push(JSON.parse(o))}return new pn(n)},Kc=He("node_env")==="development";class ue{constructor(t){this.arr=t,Kc&&_i(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ue(this.arr)}splice(t){const n=new ue(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let o=n;o<i;o++){const s=this.arr[o];t.writeAny(s)}}getRef(){return 8}}const Xc=e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++)n.push(e.readAny());return new ue(n)};class Ut{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ut(this.str)}splice(t){const n=new Ut(this.str.slice(t));this.str=this.str.slice(0,t);const i=this.str.charCodeAt(t-1);return i>=55296&&i<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Zc=e=>new Ut(e.readString()),Qc=[Lc,xc,Fc,jc,Bc,Vc,qc],ta=0,ea=1,na=2,ra=3,ia=4,sa=5,oa=6;class Ht{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ht(this.type._copy())}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(i=>{i.deleted?i.id.clock<(t.beforeState.get(i.id.client)||0)&&t._mergeStructs.push(i):i.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(i=>{for(;i!==null;)i.gc(t,!0),i=i.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const ca=e=>new Ht(Qc[e.readTypeRef()](e)),yn=(e,t,n)=>{const{client:i,clock:o}=t.id,s=new st(K(i,o+n),t,K(i,o+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=K(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class st extends br{constructor(t,n,i,o,s,h,l,a){super(t,a.getLength()),this.origin=i,this.left=n,this.right=o,this.rightOrigin=s,this.parent=h,this.parentSub=l,this.redone=null,this.content=a,this.info=this.content.isCountable()?Dr:0}set marker(t){(this.info&In)>0!==t&&(this.info^=In)}get marker(){return(this.info&In)>0}get keep(){return(this.info&Tr)>0}set keep(t){this.keep!==t&&(this.info^=Tr)}get countable(){return(this.info&Dr)>0}get deleted(){return(this.info&Ln)>0}set deleted(t){this.deleted!==t&&(this.info^=Ln)}markDeleted(){this.info|=Ln}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ut(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ut(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===be&&this.id.client!==this.parent.client&&this.parent.clock>=ut(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$r(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Qt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===vt||this.right&&this.right.constructor===vt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===st?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===st&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===be){const i=Un(n,this.parent);i.constructor===vt?this.parent=null:this.parent=i.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=$r(t,t.doc.store,K(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let i=this.left,o;if(i!==null)o=i.right;else if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start;const s=new Set,h=new Set;for(;o!==null&&o!==this.right;){if(h.add(o),s.add(o),tn(this.origin,o.origin)){if(o.id.client<this.id.client)i=o,s.clear();else if(tn(this.rightOrigin,o.rightOrigin))break}else if(o.origin!==null&&h.has(Un(t.doc.store,o.origin)))s.has(Un(t.doc.store,o.origin))||(i=o,s.clear());else break;o=o.right}this.left=i}if(this.left!==null){const i=this.left.right;this.right=i,this.left.right=this}else{let i;if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start,this.parent._start=this;this.right=i}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),zi(t.doc.store,this),this.content.integrate(t,this),Jr(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new vt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:K(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&tn(t.origin,this.lastId)&&this.right===t&&tn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(i=>{i.p===t&&(i.p=this,!this.deleted&&this.countable&&(i.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ln(t.deleteSet,this.id.client,this.id.clock,this.length),Jr(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Mt();this.content.gc(t),n?dc(t,this,new vt(this.id,this.length)):this.content=new $e(this.length)}write(t,n){const i=n>0?K(this.id.client,this.id.clock+n-1):this.origin,o=this.rightOrigin,s=this.parentSub,h=this.content.getRef()&_n|(i===null?0:bt)|(o===null?0:jt)|(s===null?0:Ve);if(t.writeInfo(h),i!==null&&t.writeLeftID(i),o!==null&&t.writeRightID(o),i===null&&o===null){const l=this.parent;if(l._item!==void 0){const a=l._item;if(a===null){const p=hc(l);t.writeParentInfo(!0),t.writeString(p)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else l.constructor===String?(t.writeParentInfo(!0),t.writeString(l)):l.constructor===be?(t.writeParentInfo(!1),t.writeLeftID(l)):Mt();s!==null&&t.writeString(s)}this.content.write(t,n)}}const ds=(e,t)=>aa[t&_n](e),aa=[()=>{Mt()},Yc,Jc,Hc,Zc,$c,Gc,ca,Xc,zc,()=>{Mt()}],la=10;class Ct extends br{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Mt()}write(t,n){t.writeInfo(la),q(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const fs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},gs="__ $YJS$ __";fs[gs]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");fs[gs]=!0;const ha=1200,ua=2500,mn=3e4,Kn=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let i=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=h=>{e.lastMessageReceived=qt();const l=h.data,a=typeof l=="string"?JSON.parse(l):l;a&&a.type==="pong"&&(clearTimeout(i),i=setTimeout(s,mn/2)),e.emit("message",[a,e])};const o=h=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:h},e])):e.unsuccessfulReconnects++,setTimeout(Kn,tr(Os(e.unsuccessfulReconnects+1)*ha,ua),e)),clearTimeout(i)},s=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>o(null),t.onerror=h=>o(h),t.onopen=()=>{e.lastMessageReceived=qt(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),i=setTimeout(s,mn/2)}}};class da extends li{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&mn<qt()-this.lastMessageReceived&&this.ws.close()},mn/2),Kn(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&Kn(this)}}const ps=new Map;class fa{constructor(t){this.room=t,this.onmessage=null,this._onChange=n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:ki(n.newValue||"")}),go(this._onChange)}postMessage(t){mi.setItem(this.room,Si(Do(t)))}close(){po(this._onChange)}}const ga=typeof BroadcastChannel>"u"?fa:BroadcastChannel,_r=e=>_t(ps,e,()=>{const t=Zt(),n=new ga(e);return n.onmessage=i=>t.forEach(o=>o(i.data,"broadcastchannel")),{bc:n,subs:t}}),pa=(e,t)=>(_r(e).subs.add(t),t),ya=(e,t)=>{const n=_r(e),i=n.subs.delete(t);return i&&n.subs.size===0&&(n.bc.close(),ps.delete(e)),i},ma=(e,t,n=null)=>{const i=_r(e);i.bc.postMessage(t),i.subs.forEach(o=>o(t,n))},wa=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var Dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ba(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ys={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,i=Math.abs,o=Math.pow;return function(){function s(h,l,a){function p(f,y){if(!l[f]){if(!h[f]){var g=typeof rn=="function"&&rn;if(!y&&g)return g(f,!0);if(b)return b(f,!0);var C=new Error("Cannot find module '"+f+"'");throw C.code="MODULE_NOT_FOUND",C}var M=l[f]={exports:{}};h[f][0].call(M.exports,function(I){var N=h[f][1][I];return p(N||I)},M,M.exports,s,h,l,a)}return l[f].exports}for(var b=typeof rn=="function"&&rn,u=0;u<a.length;u++)p(a[u]);return p}return s}()({1:[function(s,h,l){function a(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var A=_.indexOf("=");A===-1&&(A=v);var S=A===v?0:4-A%4;return[A,S]}function p(_,v,A){return 3*(v+A)/4-A}function b(_){var v,A,S=a(_),L=S[0],U=S[1],k=new M(p(_,L,U)),T=0,F=0<U?L-4:L;for(A=0;A<F;A+=4)v=C[_.charCodeAt(A)]<<18|C[_.charCodeAt(A+1)]<<12|C[_.charCodeAt(A+2)]<<6|C[_.charCodeAt(A+3)],k[T++]=255&v>>16,k[T++]=255&v>>8,k[T++]=255&v;return U===2&&(v=C[_.charCodeAt(A)]<<2|C[_.charCodeAt(A+1)]>>4,k[T++]=255&v),U===1&&(v=C[_.charCodeAt(A)]<<10|C[_.charCodeAt(A+1)]<<4|C[_.charCodeAt(A+2)]>>2,k[T++]=255&v>>8,k[T++]=255&v),k}function u(_){return g[63&_>>18]+g[63&_>>12]+g[63&_>>6]+g[63&_]}function f(_,v,A){for(var S,L=[],U=v;U<A;U+=3)S=(16711680&_[U]<<16)+(65280&_[U+1]<<8)+(255&_[U+2]),L.push(u(S));return L.join("")}function y(_){for(var v,A=_.length,S=A%3,L=[],U=16383,k=0,T=A-S;k<T;k+=U)L.push(f(_,k,k+U>T?T:k+U));return S===1?(v=_[A-1],L.push(g[v>>2]+g[63&v<<4]+"==")):S===2&&(v=(_[A-2]<<8)+_[A-1],L.push(g[v>>10]+g[63&v>>4]+g[63&v<<2]+"=")),L.join("")}l.byteLength=function(_){var v=a(_),A=v[0],S=v[1];return 3*(A+S)/4-S},l.toByteArray=b,l.fromByteArray=y;for(var g=[],C=[],M=typeof Uint8Array>"u"?Array:Uint8Array,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=0,m=I.length;N<m;++N)g[N]=I[N],C[I.charCodeAt(N)]=N;C[45]=62,C[95]=63},{}],2:[function(){},{}],3:[function(s,h,l){(function(){(function(){var a=String.fromCharCode,p=Math.min;function b(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var c=new Uint8Array(r);return c.__proto__=u.prototype,c}function u(r,c,d){if(typeof r=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(r)}return f(r,c,d)}function f(r,c,d){if(typeof r=="string")return M(r,c);if(ArrayBuffer.isView(r))return I(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(D(r,ArrayBuffer)||r&&D(r.buffer,ArrayBuffer))return N(r,c,d);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var E=r.valueOf&&r.valueOf();if(E!=null&&E!==r)return u.from(E,c,d);var R=m(r);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),c,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function y(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function g(r,c,d){return y(r),0>=r||c===void 0?b(r):typeof d=="string"?b(r).fill(c,d):b(r).fill(c)}function C(r){return y(r),b(0>r?0:0|_(r))}function M(r,c){if((typeof c!="string"||c==="")&&(c="utf8"),!u.isEncoding(c))throw new TypeError("Unknown encoding: "+c);var d=0|v(r,c),E=b(d),R=E.write(r,c);return R!==d&&(E=E.slice(0,R)),E}function I(r){for(var c=0>r.length?0:0|_(r.length),d=b(c),E=0;E<c;E+=1)d[E]=255&r[E];return d}function N(r,c,d){if(0>c||r.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<c+(d||0))throw new RangeError('"length" is outside of buffer bounds');var E;return E=c===void 0&&d===void 0?new Uint8Array(r):d===void 0?new Uint8Array(r,c):new Uint8Array(r,c,d),E.__proto__=u.prototype,E}function m(r){if(u.isBuffer(r)){var c=0|_(r.length),d=b(c);return d.length===0||r.copy(d,0,0,c),d}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?I(r.data):void 0:typeof r.length!="number"||x(r.length)?b(0):I(r)}function _(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|r}function v(r,c){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||D(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var d=r.length,E=2<arguments.length&&arguments[2]===!0;if(!E&&d===0)return 0;for(var R=!1;;)switch(c){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return ee(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Rt(r).length;default:if(R)return E?-1:ee(r).length;c=(""+c).toLowerCase(),R=!0}}function A(r,c,d){var E=!1;if((c===void 0||0>c)&&(c=0),c>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,c>>>=0,d<=c))return"";for(r||(r="utf8");;)switch(r){case"hex":return St(this,c,d);case"utf8":case"utf-8":return it(this,c,d);case"ascii":return W(this,c,d);case"latin1":case"binary":return ge(this,c,d);case"base64":return X(this,c,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yt(this,c,d);default:if(E)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),E=!0}}function S(r,c,d){var E=r[c];r[c]=r[d],r[d]=E}function L(r,c,d,E,R){if(r.length===0)return-1;if(typeof d=="string"?(E=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,x(d)&&(d=R?0:r.length-1),0>d&&(d=r.length+d),d>=r.length){if(R)return-1;d=r.length-1}else if(0>d)if(R)d=0;else return-1;if(typeof c=="string"&&(c=u.from(c,E)),u.isBuffer(c))return c.length===0?-1:U(r,c,d,E,R);if(typeof c=="number")return c&=255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(r,c,d):Uint8Array.prototype.lastIndexOf.call(r,c,d):U(r,[c],d,E,R);throw new TypeError("val must be string, number or Buffer")}function U(r,c,d,E,R){function O(pe,Me){return P===1?pe[Me]:pe.readUInt16BE(Me*P)}var P=1,G=r.length,tt=c.length;if(E!==void 0&&(E=(E+"").toLowerCase(),E==="ucs2"||E==="ucs-2"||E==="utf16le"||E==="utf-16le")){if(2>r.length||2>c.length)return-1;P=2,G/=2,tt/=2,d/=2}var J;if(R){var $=-1;for(J=d;J<G;J++)if(O(r,J)!==O(c,$===-1?0:J-$))$!==-1&&(J-=J-$),$=-1;else if($===-1&&($=J),J-$+1===tt)return $*P}else for(d+tt>G&&(d=G-tt),J=d;0<=J;J--){for(var dt=!0,ne=0;ne<tt;ne++)if(O(r,J+ne)!==O(c,ne)){dt=!1;break}if(dt)return J}return-1}function k(r,c,d,E){d=+d||0;var R=r.length-d;E?(E=+E,E>R&&(E=R)):E=R;var O=c.length;E>O/2&&(E=O/2);for(var P,G=0;G<E;++G){if(P=parseInt(c.substr(2*G,2),16),x(P))return G;r[d+G]=P}return G}function T(r,c,d,E){return At(ee(c,r.length-d),r,d,E)}function F(r,c,d,E){return At(Oe(c),r,d,E)}function j(r,c,d,E){return F(r,c,d,E)}function H(r,c,d,E){return At(Rt(c),r,d,E)}function z(r,c,d,E){return At(Gt(c,r.length-d),r,d,E)}function X(r,c,d){return c===0&&d===r.length?B.fromByteArray(r):B.fromByteArray(r.slice(c,d))}function it(r,c,d){d=p(r.length,d);for(var E=[],R=c;R<d;){var O=r[R],P=null,G=239<O?4:223<O?3:191<O?2:1;if(R+G<=d){var tt,J,$,dt;G===1?128>O&&(P=O):G===2?(tt=r[R+1],(192&tt)==128&&(dt=(31&O)<<6|63&tt,127<dt&&(P=dt))):G===3?(tt=r[R+1],J=r[R+2],(192&tt)==128&&(192&J)==128&&(dt=(15&O)<<12|(63&tt)<<6|63&J,2047<dt&&(55296>dt||57343<dt)&&(P=dt))):G===4&&(tt=r[R+1],J=r[R+2],$=r[R+3],(192&tt)==128&&(192&J)==128&&(192&$)==128&&(dt=(15&O)<<18|(63&tt)<<12|(63&J)<<6|63&$,65535<dt&&1114112>dt&&(P=dt)))}P===null?(P=65533,G=1):65535<P&&(P-=65536,E.push(55296|1023&P>>>10),P=56320|1023&P),E.push(P),R+=G}return yt(E)}function yt(r){var c=r.length;if(c<=4096)return a.apply(String,r);for(var d="",E=0;E<c;)d+=a.apply(String,r.slice(E,E+=4096));return d}function W(r,c,d){var E="";d=p(r.length,d);for(var R=c;R<d;++R)E+=a(127&r[R]);return E}function ge(r,c,d){var E="";d=p(r.length,d);for(var R=c;R<d;++R)E+=a(r[R]);return E}function St(r,c,d){var E=r.length;(!c||0>c)&&(c=0),(!d||0>d||d>E)&&(d=E);for(var R="",O=c;O<d;++O)R+=te(r[O]);return R}function Yt(r,c,d){for(var E=r.slice(c,d),R="",O=0;O<E.length;O+=2)R+=a(E[O]+256*E[O+1]);return R}function nt(r,c,d){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+c>d)throw new RangeError("Trying to access beyond buffer length")}function Z(r,c,d,E,R,O){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>R||c<O)throw new RangeError('"value" argument is out of bounds');if(d+E>r.length)throw new RangeError("Index out of range")}function kt(r,c,d,E){if(d+E>r.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function zt(r,c,d,E,R){return c=+c,d>>>=0,R||kt(r,c,d,4),V.write(r,c,d,E,23,4),d+4}function $t(r,c,d,E,R){return c=+c,d>>>=0,R||kt(r,c,d,8),V.write(r,c,d,E,52,8),d+8}function xe(r){if(r=r.split("=")[0],r=r.trim().replace(w,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function te(r){return 16>r?"0"+r.toString(16):r.toString(16)}function ee(r,c){c=c||1/0;for(var d,E=r.length,R=null,O=[],P=0;P<E;++P){if(d=r.charCodeAt(P),55295<d&&57344>d){if(!R){if(56319<d){-1<(c-=3)&&O.push(239,191,189);continue}else if(P+1===E){-1<(c-=3)&&O.push(239,191,189);continue}R=d;continue}if(56320>d){-1<(c-=3)&&O.push(239,191,189),R=d;continue}d=(R-55296<<10|d-56320)+65536}else R&&-1<(c-=3)&&O.push(239,191,189);if(R=null,128>d){if(0>(c-=1))break;O.push(d)}else if(2048>d){if(0>(c-=2))break;O.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(c-=3))break;O.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(c-=4))break;O.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return O}function Oe(r){for(var c=[],d=0;d<r.length;++d)c.push(255&r.charCodeAt(d));return c}function Gt(r,c){for(var d,E,R,O=[],P=0;P<r.length&&!(0>(c-=2));++P)d=r.charCodeAt(P),E=d>>8,R=d%256,O.push(R),O.push(E);return O}function Rt(r){return B.toByteArray(xe(r))}function At(r,c,d,E){for(var R=0;R<E&&!(R+d>=c.length||R>=r.length);++R)c[R+d]=r[R];return R}function D(r,c){return r instanceof c||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===c.name}function x(r){return r!==r}var B=s("base64-js"),V=s("ieee754");l.Buffer=u,l.SlowBuffer=function(r){return+r!=r&&(r=0),u.alloc(+r)},l.INSPECT_MAX_BYTES=50,l.kMaxLength=2147483647,u.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),u.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){return u.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){return u.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(r,c,d){return f(r,c,d)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(r,c,d){return g(r,c,d)},u.allocUnsafe=function(r){return C(r)},u.allocUnsafeSlow=function(r){return C(r)},u.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==u.prototype},u.compare=function(r,c){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),D(c,Uint8Array)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(r)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===c)return 0;for(var d=r.length,E=c.length,R=0,O=p(d,E);R<O;++R)if(r[R]!==c[R]){d=r[R],E=c[R];break}return d<E?-1:E<d?1:0},u.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(r,c){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return u.alloc(0);var d;if(c===void 0)for(c=0,d=0;d<r.length;++d)c+=r[d].length;var E=u.allocUnsafe(c),R=0;for(d=0;d<r.length;++d){var O=r[d];if(D(O,Uint8Array)&&(O=u.from(O)),!u.isBuffer(O))throw new TypeError('"list" argument must be an Array of Buffers');O.copy(E,R),R+=O.length}return E},u.byteLength=v,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var c=0;c<r;c+=2)S(this,c,c+1);return this},u.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var c=0;c<r;c+=4)S(this,c,c+3),S(this,c+1,c+2);return this},u.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var c=0;c<r;c+=8)S(this,c,c+7),S(this,c+1,c+6),S(this,c+2,c+5),S(this,c+3,c+4);return this},u.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?it(this,0,r):A.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(r){if(!u.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||u.compare(this,r)===0},u.prototype.inspect=function(){var r="",c=l.INSPECT_MAX_BYTES;return r=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(r+=" ... "),"<Buffer "+r+">"},u.prototype.compare=function(r,c,d,E,R){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(c===void 0&&(c=0),d===void 0&&(d=r?r.length:0),E===void 0&&(E=0),R===void 0&&(R=this.length),0>c||d>r.length||0>E||R>this.length)throw new RangeError("out of range index");if(E>=R&&c>=d)return 0;if(E>=R)return-1;if(c>=d)return 1;if(c>>>=0,d>>>=0,E>>>=0,R>>>=0,this===r)return 0;for(var O=R-E,P=d-c,G=p(O,P),tt=this.slice(E,R),J=r.slice(c,d),$=0;$<G;++$)if(tt[$]!==J[$]){O=tt[$],P=J[$];break}return O<P?-1:P<O?1:0},u.prototype.includes=function(r,c,d){return this.indexOf(r,c,d)!==-1},u.prototype.indexOf=function(r,c,d){return L(this,r,c,d,!0)},u.prototype.lastIndexOf=function(r,c,d){return L(this,r,c,d,!1)},u.prototype.write=function(r,c,d,E){if(c===void 0)E="utf8",d=this.length,c=0;else if(d===void 0&&typeof c=="string")E=c,d=this.length,c=0;else if(isFinite(c))c>>>=0,isFinite(d)?(d>>>=0,E===void 0&&(E="utf8")):(E=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-c;if((d===void 0||d>R)&&(d=R),0<r.length&&(0>d||0>c)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");E||(E="utf8");for(var O=!1;;)switch(E){case"hex":return k(this,r,c,d);case"utf8":case"utf-8":return T(this,r,c,d);case"ascii":return F(this,r,c,d);case"latin1":case"binary":return j(this,r,c,d);case"base64":return H(this,r,c,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,r,c,d);default:if(O)throw new TypeError("Unknown encoding: "+E);E=(""+E).toLowerCase(),O=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(r,c){var d=this.length;r=~~r,c=c===void 0?d:~~c,0>r?(r+=d,0>r&&(r=0)):r>d&&(r=d),0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d),c<r&&(c=r);var E=this.subarray(r,c);return E.__proto__=u.prototype,E},u.prototype.readUIntLE=function(r,c,d){r>>>=0,c>>>=0,d||nt(r,c,this.length);for(var E=this[r],R=1,O=0;++O<c&&(R*=256);)E+=this[r+O]*R;return E},u.prototype.readUIntBE=function(r,c,d){r>>>=0,c>>>=0,d||nt(r,c,this.length);for(var E=this[r+--c],R=1;0<c&&(R*=256);)E+=this[r+--c]*R;return E},u.prototype.readUInt8=function(r,c){return r>>>=0,c||nt(r,1,this.length),this[r]},u.prototype.readUInt16LE=function(r,c){return r>>>=0,c||nt(r,2,this.length),this[r]|this[r+1]<<8},u.prototype.readUInt16BE=function(r,c){return r>>>=0,c||nt(r,2,this.length),this[r]<<8|this[r+1]},u.prototype.readUInt32LE=function(r,c){return r>>>=0,c||nt(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},u.prototype.readUInt32BE=function(r,c){return r>>>=0,c||nt(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},u.prototype.readIntLE=function(r,c,d){r>>>=0,c>>>=0,d||nt(r,c,this.length);for(var E=this[r],R=1,O=0;++O<c&&(R*=256);)E+=this[r+O]*R;return R*=128,E>=R&&(E-=o(2,8*c)),E},u.prototype.readIntBE=function(r,c,d){r>>>=0,c>>>=0,d||nt(r,c,this.length);for(var E=c,R=1,O=this[r+--E];0<E&&(R*=256);)O+=this[r+--E]*R;return R*=128,O>=R&&(O-=o(2,8*c)),O},u.prototype.readInt8=function(r,c){return r>>>=0,c||nt(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},u.prototype.readInt16LE=function(r,c){r>>>=0,c||nt(r,2,this.length);var d=this[r]|this[r+1]<<8;return 32768&d?4294901760|d:d},u.prototype.readInt16BE=function(r,c){r>>>=0,c||nt(r,2,this.length);var d=this[r+1]|this[r]<<8;return 32768&d?4294901760|d:d},u.prototype.readInt32LE=function(r,c){return r>>>=0,c||nt(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},u.prototype.readInt32BE=function(r,c){return r>>>=0,c||nt(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},u.prototype.readFloatLE=function(r,c){return r>>>=0,c||nt(r,4,this.length),V.read(this,r,!0,23,4)},u.prototype.readFloatBE=function(r,c){return r>>>=0,c||nt(r,4,this.length),V.read(this,r,!1,23,4)},u.prototype.readDoubleLE=function(r,c){return r>>>=0,c||nt(r,8,this.length),V.read(this,r,!0,52,8)},u.prototype.readDoubleBE=function(r,c){return r>>>=0,c||nt(r,8,this.length),V.read(this,r,!1,52,8)},u.prototype.writeUIntLE=function(r,c,d,E){if(r=+r,c>>>=0,d>>>=0,!E){var R=o(2,8*d)-1;Z(this,r,c,d,R,0)}var O=1,P=0;for(this[c]=255&r;++P<d&&(O*=256);)this[c+P]=255&r/O;return c+d},u.prototype.writeUIntBE=function(r,c,d,E){if(r=+r,c>>>=0,d>>>=0,!E){var R=o(2,8*d)-1;Z(this,r,c,d,R,0)}var O=d-1,P=1;for(this[c+O]=255&r;0<=--O&&(P*=256);)this[c+O]=255&r/P;return c+d},u.prototype.writeUInt8=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,1,255,0),this[c]=255&r,c+1},u.prototype.writeUInt16LE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,2,65535,0),this[c]=255&r,this[c+1]=r>>>8,c+2},u.prototype.writeUInt16BE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,2,65535,0),this[c]=r>>>8,this[c+1]=255&r,c+2},u.prototype.writeUInt32LE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,4,4294967295,0),this[c+3]=r>>>24,this[c+2]=r>>>16,this[c+1]=r>>>8,this[c]=255&r,c+4},u.prototype.writeUInt32BE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,4,4294967295,0),this[c]=r>>>24,this[c+1]=r>>>16,this[c+2]=r>>>8,this[c+3]=255&r,c+4},u.prototype.writeIntLE=function(r,c,d,E){if(r=+r,c>>>=0,!E){var R=o(2,8*d-1);Z(this,r,c,d,R-1,-R)}var O=0,P=1,G=0;for(this[c]=255&r;++O<d&&(P*=256);)0>r&&G===0&&this[c+O-1]!==0&&(G=1),this[c+O]=255&(r/P>>0)-G;return c+d},u.prototype.writeIntBE=function(r,c,d,E){if(r=+r,c>>>=0,!E){var R=o(2,8*d-1);Z(this,r,c,d,R-1,-R)}var O=d-1,P=1,G=0;for(this[c+O]=255&r;0<=--O&&(P*=256);)0>r&&G===0&&this[c+O+1]!==0&&(G=1),this[c+O]=255&(r/P>>0)-G;return c+d},u.prototype.writeInt8=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,1,127,-128),0>r&&(r=255+r+1),this[c]=255&r,c+1},u.prototype.writeInt16LE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,2,32767,-32768),this[c]=255&r,this[c+1]=r>>>8,c+2},u.prototype.writeInt16BE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,2,32767,-32768),this[c]=r>>>8,this[c+1]=255&r,c+2},u.prototype.writeInt32LE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,4,2147483647,-2147483648),this[c]=255&r,this[c+1]=r>>>8,this[c+2]=r>>>16,this[c+3]=r>>>24,c+4},u.prototype.writeInt32BE=function(r,c,d){return r=+r,c>>>=0,d||Z(this,r,c,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[c]=r>>>24,this[c+1]=r>>>16,this[c+2]=r>>>8,this[c+3]=255&r,c+4},u.prototype.writeFloatLE=function(r,c,d){return zt(this,r,c,!0,d)},u.prototype.writeFloatBE=function(r,c,d){return zt(this,r,c,!1,d)},u.prototype.writeDoubleLE=function(r,c,d){return $t(this,r,c,!0,d)},u.prototype.writeDoubleBE=function(r,c,d){return $t(this,r,c,!1,d)},u.prototype.copy=function(r,c,d,E){if(!u.isBuffer(r))throw new TypeError("argument should be a Buffer");if(d||(d=0),E||E===0||(E=this.length),c>=r.length&&(c=r.length),c||(c=0),0<E&&E<d&&(E=d),E===d||r.length===0||this.length===0)return 0;if(0>c)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>E)throw new RangeError("sourceEnd out of bounds");E>this.length&&(E=this.length),r.length-c<E-d&&(E=r.length-c+d);var R=E-d;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(c,d,E);else if(this===r&&d<c&&c<E)for(var O=R-1;0<=O;--O)r[O+c]=this[O+d];else Uint8Array.prototype.set.call(r,this.subarray(d,E),c);return R},u.prototype.fill=function(r,c,d,E){if(typeof r=="string"){if(typeof c=="string"?(E=c,c=0,d=this.length):typeof d=="string"&&(E=d,d=this.length),E!==void 0&&typeof E!="string")throw new TypeError("encoding must be a string");if(typeof E=="string"&&!u.isEncoding(E))throw new TypeError("Unknown encoding: "+E);if(r.length===1){var R=r.charCodeAt(0);(E==="utf8"&&128>R||E==="latin1")&&(r=R)}}else typeof r=="number"&&(r&=255);if(0>c||this.length<c||this.length<d)throw new RangeError("Out of range index");if(d<=c)return this;c>>>=0,d=d===void 0?this.length:d>>>0,r||(r=0);var O;if(typeof r=="number")for(O=c;O<d;++O)this[O]=r;else{var P=u.isBuffer(r)?r:u.from(r,E),G=P.length;if(G===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(O=0;O<d-c;++O)this[O+c]=P[O%G]}return this};var w=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,s("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(s,h,l){(function(a){(function(){function p(){let u;try{u=l.storage.getItem("debug")}catch{}return!u&&typeof a<"u"&&"env"in a&&(u=a.env.DEBUG),u}l.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+h.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;u.splice(1,0,f,"color: inherit");let y=0,g=0;u[0].replace(/%[a-zA-Z%]/g,C=>{C==="%%"||(y++,C==="%c"&&(g=y))}),u.splice(g,0,f)},l.save=function(u){try{u?l.storage.setItem("debug",u):l.storage.removeItem("debug")}catch{}},l.load=p,l.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},l.storage=function(){try{return localStorage}catch{}}(),l.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],l.log=console.debug||console.log||(()=>{}),h.exports=s("./common")(l);const{formatters:b}=h.exports;b.j=function(u){try{return JSON.stringify(u)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}).call(this)}).call(this,s("_process"))},{"./common":5,_process:12}],5:[function(s,h){h.exports=function(l){function a(u){function f(...C){if(!f.enabled)return;const M=f,I=+new Date,N=I-(y||I);M.diff=N,M.prev=y,M.curr=I,y=I,C[0]=a.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let m=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(v,A)=>{if(v==="%%")return"%";m++;const S=a.formatters[A];if(typeof S=="function"){const L=C[m];v=S.call(M,L),C.splice(m,1),m--}return v}),a.formatArgs.call(M,C),(M.log||a.log).apply(M,C)}let y,g=null;return f.namespace=u,f.useColors=a.useColors(),f.color=a.selectColor(u),f.extend=p,f.destroy=a.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?a.enabled(u):g,set:C=>{g=C}}),typeof a.init=="function"&&a.init(f),f}function p(u,f){const y=a(this.namespace+(typeof f>"u"?":":f)+u);return y.log=this.log,y}function b(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(u){return u instanceof Error?u.stack||u.message:u},a.disable=function(){const u=[...a.names.map(b),...a.skips.map(b).map(f=>"-"+f)].join(",");return a.enable(""),u},a.enable=function(u){a.save(u),a.names=[],a.skips=[];let f;const y=(typeof u=="string"?u:"").split(/[\s,]+/),g=y.length;for(f=0;f<g;f++)y[f]&&(u=y[f].replace(/\*/g,".*?"),u[0]==="-"?a.skips.push(new RegExp("^"+u.substr(1)+"$")):a.names.push(new RegExp("^"+u+"$")))},a.enabled=function(u){if(u[u.length-1]==="*")return!0;let f,y;for(f=0,y=a.skips.length;f<y;f++)if(a.skips[f].test(u))return!1;for(f=0,y=a.names.length;f<y;f++)if(a.names[f].test(u))return!0;return!1},a.humanize=s("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(l).forEach(u=>{a[u]=l[u]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(u){let f=0;for(let y=0;y<u.length;y++)f=(f<<5)-f+u.charCodeAt(y),f|=0;return a.colors[i(f)%a.colors.length]},a.enable(a.load()),a}},{ms:11}],6:[function(s,h){function l(a,p){for(const b in p)Object.defineProperty(a,b,{value:p[b],enumerable:!0,configurable:!0});return a}h.exports=function(a,p,b){if(!a||typeof a=="string")throw new TypeError("Please pass an Error to err-code");b||(b={}),typeof p=="object"&&(b=p,p=""),p&&(b.code=p);try{return l(a,b)}catch{b.message=a.message,b.stack=a.stack;const f=function(){};return f.prototype=Object.create(Object.getPrototypeOf(a)),l(new f,b)}}},{}],7:[function(s,h){function l(k){console&&console.warn&&console.warn(k)}function a(){a.init.call(this)}function p(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function b(k){return k._maxListeners===void 0?a.defaultMaxListeners:k._maxListeners}function u(k,T,F,j){var H,z,X;if(p(F),z=k._events,z===void 0?(z=k._events=Object.create(null),k._eventsCount=0):(z.newListener!==void 0&&(k.emit("newListener",T,F.listener?F.listener:F),z=k._events),X=z[T]),X===void 0)X=z[T]=F,++k._eventsCount;else if(typeof X=="function"?X=z[T]=j?[F,X]:[X,F]:j?X.unshift(F):X.push(F),H=b(k),0<H&&X.length>H&&!X.warned){X.warned=!0;var it=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+(T+" listeners added. Use emitter.setMaxListeners() to increase limit"));it.name="MaxListenersExceededWarning",it.emitter=k,it.type=T,it.count=X.length,l(it)}return k}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(k,T,F){var j={fired:!1,wrapFn:void 0,target:k,type:T,listener:F},H=f.bind(j);return H.listener=F,j.wrapFn=H,H}function g(k,T,F){var j=k._events;if(j===void 0)return[];var H=j[T];return H===void 0?[]:typeof H=="function"?F?[H.listener||H]:[H]:F?N(H):M(H,H.length)}function C(k){var T=this._events;if(T!==void 0){var F=T[k];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function M(k,T){for(var F=Array(T),j=0;j<T;++j)F[j]=k[j];return F}function I(k,T){for(;T+1<k.length;T++)k[T]=k[T+1];k.pop()}function N(k){for(var T=Array(k.length),F=0;F<T.length;++F)T[F]=k[F].listener||k[F];return T}function m(k,T,F){typeof k.on=="function"&&_(k,"error",T,F)}function _(k,T,F,j){if(typeof k.on=="function")j.once?k.once(T,F):k.on(T,F);else if(typeof k.addEventListener=="function")k.addEventListener(T,function H(z){j.once&&k.removeEventListener(T,H),F(z)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var v,A=typeof Reflect=="object"?Reflect:null,S=A&&typeof A.apply=="function"?A.apply:function(k,T,F){return Function.prototype.apply.call(k,T,F)};v=A&&typeof A.ownKeys=="function"?A.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var L=Number.isNaN||function(k){return k!==k};h.exports=a,h.exports.once=function(k,T){return new Promise(function(F,j){function H(X){k.removeListener(T,z),j(X)}function z(){typeof k.removeListener=="function"&&k.removeListener("error",H),F([].slice.call(arguments))}_(k,T,z,{once:!0}),T!=="error"&&m(k,H,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var U=10;Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(k){if(typeof k!="number"||0>k||L(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");U=k}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||L(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},a.prototype.getMaxListeners=function(){return b(this)},a.prototype.emit=function(k){for(var T=[],F=1;F<arguments.length;F++)T.push(arguments[F]);var j=k==="error",H=this._events;if(H!==void 0)j=j&&H.error===void 0;else if(!j)return!1;if(j){var z;if(0<T.length&&(z=T[0]),z instanceof Error)throw z;var X=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw X.context=z,X}var it=H[k];if(it===void 0)return!1;if(typeof it=="function")S(it,this,T);else for(var yt=it.length,W=M(it,yt),F=0;F<yt;++F)S(W[F],this,T);return!0},a.prototype.addListener=function(k,T){return u(this,k,T,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(k,T){return u(this,k,T,!0)},a.prototype.once=function(k,T){return p(T),this.on(k,y(this,k,T)),this},a.prototype.prependOnceListener=function(k,T){return p(T),this.prependListener(k,y(this,k,T)),this},a.prototype.removeListener=function(k,T){var F,j,H,z,X;if(p(T),j=this._events,j===void 0)return this;if(F=j[k],F===void 0)return this;if(F===T||F.listener===T)--this._eventsCount==0?this._events=Object.create(null):(delete j[k],j.removeListener&&this.emit("removeListener",k,F.listener||T));else if(typeof F!="function"){for(H=-1,z=F.length-1;0<=z;z--)if(F[z]===T||F[z].listener===T){X=F[z].listener,H=z;break}if(0>H)return this;H===0?F.shift():I(F,H),F.length===1&&(j[k]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",k,X||T)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(k){var T,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[k]),this;if(arguments.length===0){var H,z=Object.keys(F);for(j=0;j<z.length;++j)H=z[j],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=F[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(j=T.length-1;0<=j;j--)this.removeListener(k,T[j]);return this},a.prototype.listeners=function(k){return g(this,k,!0)},a.prototype.rawListeners=function(k){return g(this,k,!1)},a.listenerCount=function(k,T){return typeof k.listenerCount=="function"?k.listenerCount(T):C.call(k,T)},a.prototype.listenerCount=C,a.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(s,h){h.exports=function(){if(typeof globalThis>"u")return null;var l={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return l.RTCPeerConnection?l:null}},{}],9:[function(s,h,l){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */l.read=function(a,p,b,u,f){var y,g,C=8*f-u-1,M=(1<<C)-1,I=M>>1,N=-7,m=b?f-1:0,_=b?-1:1,v=a[p+m];for(m+=_,y=v&(1<<-N)-1,v>>=-N,N+=C;0<N;y=256*y+a[p+m],m+=_,N-=8);for(g=y&(1<<-N)-1,y>>=-N,N+=u;0<N;g=256*g+a[p+m],m+=_,N-=8);if(y===0)y=1-I;else{if(y===M)return g?NaN:(v?-1:1)*(1/0);g+=o(2,u),y-=I}return(v?-1:1)*g*o(2,y-u)},l.write=function(a,p,b,u,f,y){var g,C,M,I=Math.LN2,N=Math.log,m=8*y-f-1,_=(1<<m)-1,v=_>>1,A=f===23?o(2,-24)-o(2,-77):0,S=u?0:y-1,L=u?1:-1,U=0>p||p===0&&0>1/p?1:0;for(p=i(p),isNaN(p)||p===1/0?(C=isNaN(p)?1:0,g=_):(g=n(N(p)/I),1>p*(M=o(2,-g))&&(g--,M*=2),p+=1<=g+v?A/M:A*o(2,1-v),2<=p*M&&(g++,M/=2),g+v>=_?(C=0,g=_):1<=g+v?(C=(p*M-1)*o(2,f),g+=v):(C=p*o(2,v-1)*o(2,f),g=0));8<=f;a[b+S]=255&C,S+=L,C/=256,f-=8);for(g=g<<f|C,m+=f;0<m;a[b+S]=255&g,S+=L,g/=256,m-=8);a[b+S-L]|=128*U}},{}],10:[function(s,h){h.exports=typeof Object.create=="function"?function(l,a){a&&(l.super_=a,l.prototype=Object.create(a.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}))}:function(l,a){if(a){l.super_=a;var p=function(){};p.prototype=a.prototype,l.prototype=new p,l.prototype.constructor=l}}},{}],11:[function(s,h){var l=Math.round;function a(f){if(f+="",!(100<f.length)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(y){var g=parseFloat(y[1]),C=(y[2]||"ms").toLowerCase();return C==="years"||C==="year"||C==="yrs"||C==="yr"||C==="y"?315576e5*g:C==="weeks"||C==="week"||C==="w"?6048e5*g:C==="days"||C==="day"||C==="d"?864e5*g:C==="hours"||C==="hour"||C==="hrs"||C==="hr"||C==="h"?36e5*g:C==="minutes"||C==="minute"||C==="mins"||C==="min"||C==="m"?6e4*g:C==="seconds"||C==="second"||C==="secs"||C==="sec"||C==="s"?1e3*g:C==="milliseconds"||C==="millisecond"||C==="msecs"||C==="msec"||C==="ms"?g:void 0}}}function p(f){var y=i(f);return 864e5<=y?l(f/864e5)+"d":36e5<=y?l(f/36e5)+"h":6e4<=y?l(f/6e4)+"m":1e3<=y?l(f/1e3)+"s":f+"ms"}function b(f){var y=i(f);return 864e5<=y?u(f,y,864e5,"day"):36e5<=y?u(f,y,36e5,"hour"):6e4<=y?u(f,y,6e4,"minute"):1e3<=y?u(f,y,1e3,"second"):f+" ms"}function u(f,y,g,C){return l(f/g)+" "+C+(y>=1.5*g?"s":"")}h.exports=function(f,y){y=y||{};var g=typeof f;if(g=="string"&&0<f.length)return a(f);if(g==="number"&&isFinite(f))return y.long?b(f):p(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],12:[function(s,h){function l(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function p(A){if(C===setTimeout)return setTimeout(A,0);if((C===l||!C)&&setTimeout)return C=setTimeout,setTimeout(A,0);try{return C(A,0)}catch{try{return C.call(null,A,0)}catch{return C.call(this,A,0)}}}function b(A){if(M===clearTimeout)return clearTimeout(A);if((M===a||!M)&&clearTimeout)return M=clearTimeout,clearTimeout(A);try{return M(A)}catch{try{return M.call(null,A)}catch{return M.call(this,A)}}}function u(){_&&N&&(_=!1,N.length?m=N.concat(m):v=-1,m.length&&f())}function f(){if(!_){var A=p(u);_=!0;for(var S=m.length;S;){for(N=m,m=[];++v<S;)N&&N[v].run();v=-1,S=m.length}N=null,_=!1,b(A)}}function y(A,S){this.fun=A,this.array=S}function g(){}var C,M,I=h.exports={};(function(){try{C=typeof setTimeout=="function"?setTimeout:l}catch{C=l}try{M=typeof clearTimeout=="function"?clearTimeout:a}catch{M=a}})();var N,m=[],_=!1,v=-1;I.nextTick=function(A){var S=Array(arguments.length-1);if(1<arguments.length)for(var L=1;L<arguments.length;L++)S[L-1]=arguments[L];m.push(new y(A,S)),m.length!==1||_||p(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=g,I.addListener=g,I.once=g,I.off=g,I.removeListener=g,I.removeAllListeners=g,I.emit=g,I.prependListener=g,I.prependOnceListener=g,I.listeners=function(){return[]},I.binding=function(){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},{}],13:[function(s,h){(function(l){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let a;h.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?l:window):p=>(a||(a=Promise.resolve())).then(p).catch(b=>setTimeout(()=>{throw b},0))}).call(this)}).call(this,typeof Dt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Dt)},{}],14:[function(s,h){(function(l,a){(function(){var p=s("safe-buffer").Buffer,b=a.crypto||a.msCrypto;h.exports=b&&b.getRandomValues?function(u,f){if(u>4294967295)throw new RangeError("requested too many random bytes");var y=p.allocUnsafe(u);if(0<u)if(65536<u)for(var g=0;g<u;g+=65536)b.getRandomValues(y.slice(g,g+65536));else b.getRandomValues(y);return typeof f=="function"?l.nextTick(function(){f(null,y)}):y}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,s("_process"),typeof Dt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Dt)},{_process:12,"safe-buffer":30}],15:[function(s,h){function l(g,C){g.prototype=Object.create(C.prototype),g.prototype.constructor=g,g.__proto__=C}function a(g,C,M){function I(m,_,v){return typeof C=="string"?C:C(m,_,v)}M||(M=Error);var N=function(m){function _(v,A,S){return m.call(this,I(v,A,S))||this}return l(_,m),_}(M);N.prototype.name=M.name,N.prototype.code=g,y[g]=N}function p(g,C){if(Array.isArray(g)){var M=g.length;return g=g.map(function(I){return I+""}),2<M?"one of ".concat(C," ").concat(g.slice(0,M-1).join(", "),", or ")+g[M-1]:M===2?"one of ".concat(C," ").concat(g[0]," or ").concat(g[1]):"of ".concat(C," ").concat(g[0])}return"of ".concat(C," ").concat(g+"")}function b(g,C,M){return g.substr(!M||0>M?0:+M,C.length)===C}function u(g,C,M){return(M===void 0||M>g.length)&&(M=g.length),g.substring(M-C.length,M)===C}function f(g,C,M){return typeof M!="number"&&(M=0),!(M+C.length>g.length)&&g.indexOf(C,M)!==-1}var y={};a("ERR_INVALID_OPT_VALUE",function(g,C){return'The value "'+C+'" is invalid for option "'+g+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(g,C,M){var I;typeof C=="string"&&b(C,"not ")?(I="must not be",C=C.replace(/^not /,"")):I="must be";var N;if(u(g," argument"))N="The ".concat(g," ").concat(I," ").concat(p(C,"type"));else{var m=f(g,".")?"property":"argument";N='The "'.concat(g,'" ').concat(m," ").concat(I," ").concat(p(C,"type"))}return N+=". Received type ".concat(typeof M),N},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),h.exports.codes=y},{}],16:[function(s,h){(function(l){(function(){function a(I){return this instanceof a?(f.call(this,I),y.call(this,I),this.allowHalfOpen=!0,void(I&&(I.readable===!1&&(this.readable=!1),I.writable===!1&&(this.writable=!1),I.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p))))):new a(I)}function p(){this._writableState.ended||l.nextTick(b,this)}function b(I){I.end()}var u=Object.keys||function(I){var N=[];for(var m in I)N.push(m);return N};h.exports=a;var f=s("./_stream_readable"),y=s("./_stream_writable");s("inherits")(a,f);for(var g,C=u(y.prototype),M=0;M<C.length;M++)g=C[M],a.prototype[g]||(a.prototype[g]=y.prototype[g]);Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(I){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=I,this._writableState.destroyed=I)}})}).call(this)}).call(this,s("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(s,h){function l(p){return this instanceof l?void a.call(this,p):new l(p)}h.exports=l;var a=s("./_stream_transform");s("inherits")(l,a),l.prototype._transform=function(p,b,u){u(null,p)}},{"./_stream_transform":19,inherits:10}],18:[function(s,h){(function(l,a){(function(){function p(w){return Yt.from(w)}function b(w){return Yt.isBuffer(w)||w instanceof nt}function u(w,r,c){return typeof w.prependListener=="function"?w.prependListener(r,c):void(w._events&&w._events[r]?Array.isArray(w._events[r])?w._events[r].unshift(c):w._events[r]=[c,w._events[r]]:w.on(r,c))}function f(w,r,c){yt=yt||s("./_stream_duplex"),w=w||{},typeof c!="boolean"&&(c=r instanceof yt),this.objectMode=!!w.objectMode,c&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=Oe(this,w,"readableHighWaterMark",c),this.buffer=new xe,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(!kt&&(kt=s("string_decoder/").StringDecoder),this.decoder=new kt(w.encoding),this.encoding=w.encoding)}function y(w){if(yt=yt||s("./_stream_duplex"),!(this instanceof y))return new y(w);var r=this instanceof yt;this._readableState=new f(w,this,r),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),St.call(this)}function g(w,r,c,d,E){W("readableAddChunk",r);var R=w._readableState;if(r===null)R.reading=!1,m(w,R);else{var O;if(E||(O=M(R,r)),O)B(w,O);else if(!(R.objectMode||r&&0<r.length))d||(R.reading=!1,A(w,R));else if(typeof r=="string"||R.objectMode||Object.getPrototypeOf(r)===Yt.prototype||(r=p(r)),d)R.endEmitted?B(w,new x):C(w,R,r,!0);else if(R.ended)B(w,new At);else{if(R.destroyed)return!1;R.reading=!1,R.decoder&&!c?(r=R.decoder.write(r),R.objectMode||r.length!==0?C(w,R,r,!1):A(w,R)):C(w,R,r,!1)}}return!R.ended&&(R.length<R.highWaterMark||R.length===0)}function C(w,r,c,d){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,w.emit("data",c)):(r.length+=r.objectMode?1:c.length,d?r.buffer.unshift(c):r.buffer.push(c),r.needReadable&&_(w)),A(w,r)}function M(w,r){var c;return b(r)||typeof r=="string"||r===void 0||w.objectMode||(c=new Rt("chunk",["string","Buffer","Uint8Array"],r)),c}function I(w){return 1073741824<=w?w=1073741824:(w--,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,w|=w>>>16,w++),w}function N(w,r){return 0>=w||r.length===0&&r.ended?0:r.objectMode?1:w===w?(w>r.highWaterMark&&(r.highWaterMark=I(w)),w<=r.length?w:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function m(w,r){if(W("onEofChunk"),!r.ended){if(r.decoder){var c=r.decoder.end();c&&c.length&&(r.buffer.push(c),r.length+=r.objectMode?1:c.length)}r.ended=!0,r.sync?_(w):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,v(w)))}}function _(w){var r=w._readableState;W("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(W("emitReadable",r.flowing),r.emittedReadable=!0,l.nextTick(v,w))}function v(w){var r=w._readableState;W("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(w.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,j(w)}function A(w,r){r.readingMore||(r.readingMore=!0,l.nextTick(S,w,r))}function S(w,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var c=r.length;if(W("maybeReadMore read 0"),w.read(0),c===r.length)break}r.readingMore=!1}function L(w){return function(){var r=w._readableState;W("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&ge(w,"data")&&(r.flowing=!0,j(w))}}function U(w){var r=w._readableState;r.readableListening=0<w.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<w.listenerCount("data")&&w.resume()}function k(w){W("readable nexttick read 0"),w.read(0)}function T(w,r){r.resumeScheduled||(r.resumeScheduled=!0,l.nextTick(F,w,r))}function F(w,r){W("resume",r.reading),r.reading||w.read(0),r.resumeScheduled=!1,w.emit("resume"),j(w),r.flowing&&!r.reading&&w.read(0)}function j(w){var r=w._readableState;for(W("flow",r.flowing);r.flowing&&w.read()!==null;);}function H(w,r){if(r.length===0)return null;var c;return r.objectMode?c=r.buffer.shift():!w||w>=r.length?(c=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):c=r.buffer.consume(w,r.decoder),c}function z(w){var r=w._readableState;W("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,l.nextTick(X,r,w))}function X(w,r){if(W("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,r.readable=!1,r.emit("end"),w.autoDestroy)){var c=r._writableState;(!c||c.autoDestroy&&c.finished)&&r.destroy()}}function it(w,r){for(var c=0,d=w.length;c<d;c++)if(w[c]===r)return c;return-1}h.exports=y;var yt;y.ReadableState=f;var W;s("events").EventEmitter;var ge=function(w,r){return w.listeners(r).length},St=s("./internal/streams/stream"),Yt=s("buffer").Buffer,nt=a.Uint8Array||function(){},Z=s("util");W=Z&&Z.debuglog?Z.debuglog("stream"):function(){};var kt,zt,$t,xe=s("./internal/streams/buffer_list"),te=s("./internal/streams/destroy"),ee=s("./internal/streams/state"),Oe=ee.getHighWaterMark,Gt=s("../errors").codes,Rt=Gt.ERR_INVALID_ARG_TYPE,At=Gt.ERR_STREAM_PUSH_AFTER_EOF,D=Gt.ERR_METHOD_NOT_IMPLEMENTED,x=Gt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;s("inherits")(y,St);var B=te.errorOrDestroy,V=["error","close","destroy","pause","resume"];Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),y.prototype.destroy=te.destroy,y.prototype._undestroy=te.undestroy,y.prototype._destroy=function(w,r){r(w)},y.prototype.push=function(w,r){var c,d=this._readableState;return d.objectMode?c=!0:typeof w=="string"&&(r=r||d.defaultEncoding,r!==d.encoding&&(w=Yt.from(w,r),r=""),c=!0),g(this,w,r,!1,c)},y.prototype.unshift=function(w){return g(this,w,null,!0,!1)},y.prototype.isPaused=function(){return this._readableState.flowing===!1},y.prototype.setEncoding=function(w){kt||(kt=s("string_decoder/").StringDecoder);var r=new kt(w);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var c=this._readableState.buffer.head,d="";c!==null;)d+=r.write(c.data),c=c.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},y.prototype.read=function(w){W("read",w),w=parseInt(w,10);var r=this._readableState,c=w;if(w!==0&&(r.emittedReadable=!1),w===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return W("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?z(this):_(this),null;if(w=N(w,r),w===0&&r.ended)return r.length===0&&z(this),null;var d=r.needReadable;W("need readable",d),(r.length===0||r.length-w<r.highWaterMark)&&(d=!0,W("length less than watermark",d)),r.ended||r.reading?(d=!1,W("reading or ended",d)):d&&(W("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(w=N(c,r)));var E;return E=0<w?H(w,r):null,E===null?(r.needReadable=r.length<=r.highWaterMark,w=0):(r.length-=w,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),c!==w&&r.ended&&z(this)),E!==null&&this.emit("data",E),E},y.prototype._read=function(){B(this,new D("_read()"))},y.prototype.pipe=function(w,r){function c(ye,me){W("onunpipe"),ye===J&&me&&me.hasUnpiped===!1&&(me.hasUnpiped=!0,E())}function d(){W("onend"),w.end()}function E(){W("cleanup"),w.removeListener("close",P),w.removeListener("finish",G),w.removeListener("drain",pe),w.removeListener("error",O),w.removeListener("unpipe",c),J.removeListener("end",d),J.removeListener("end",tt),J.removeListener("data",R),Me=!0,$.awaitDrain&&(!w._writableState||w._writableState.needDrain)&&pe()}function R(ye){W("ondata");var me=w.write(ye);W("dest.write",me),me===!1&&(($.pipesCount===1&&$.pipes===w||1<$.pipesCount&&it($.pipes,w)!==-1)&&!Me&&(W("false write response, pause",$.awaitDrain),$.awaitDrain++),J.pause())}function O(ye){W("onerror",ye),tt(),w.removeListener("error",O),ge(w,"error")===0&&B(w,ye)}function P(){w.removeListener("finish",G),tt()}function G(){W("onfinish"),w.removeListener("close",P),tt()}function tt(){W("unpipe"),J.unpipe(w)}var J=this,$=this._readableState;switch($.pipesCount){case 0:$.pipes=w;break;case 1:$.pipes=[$.pipes,w];break;default:$.pipes.push(w)}$.pipesCount+=1,W("pipe count=%d opts=%j",$.pipesCount,r);var dt=(!r||r.end!==!1)&&w!==l.stdout&&w!==l.stderr,ne=dt?d:tt;$.endEmitted?l.nextTick(ne):J.once("end",ne),w.on("unpipe",c);var pe=L(J);w.on("drain",pe);var Me=!1;return J.on("data",R),u(w,"error",O),w.once("close",P),w.once("finish",G),w.emit("pipe",J),$.flowing||(W("pipe resume"),J.resume()),w},y.prototype.unpipe=function(w){var r=this._readableState,c={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return w&&w!==r.pipes?this:(w||(w=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,w&&w.emit("unpipe",this,c),this);if(!w){var d=r.pipes,E=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var R=0;R<E;R++)d[R].emit("unpipe",this,{hasUnpiped:!1});return this}var O=it(r.pipes,w);return O===-1?this:(r.pipes.splice(O,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),w.emit("unpipe",this,c),this)},y.prototype.on=function(w,r){var c=St.prototype.on.call(this,w,r),d=this._readableState;return w==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):w=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,W("on readable",d.length,d.reading),d.length?_(this):!d.reading&&l.nextTick(k,this)),c},y.prototype.addListener=y.prototype.on,y.prototype.removeListener=function(w,r){var c=St.prototype.removeListener.call(this,w,r);return w==="readable"&&l.nextTick(U,this),c},y.prototype.removeAllListeners=function(w){var r=St.prototype.removeAllListeners.apply(this,arguments);return(w==="readable"||w===void 0)&&l.nextTick(U,this),r},y.prototype.resume=function(){var w=this._readableState;return w.flowing||(W("resume"),w.flowing=!w.readableListening,T(this,w)),w.paused=!1,this},y.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},y.prototype.wrap=function(w){var r=this,c=this._readableState,d=!1;for(var E in w.on("end",function(){if(W("wrapped end"),c.decoder&&!c.ended){var O=c.decoder.end();O&&O.length&&r.push(O)}r.push(null)}),w.on("data",function(O){if(W("wrapped data"),c.decoder&&(O=c.decoder.write(O)),!(c.objectMode&&O==null)&&(c.objectMode||O&&O.length)){var P=r.push(O);P||(d=!0,w.pause())}}),w)this[E]===void 0&&typeof w[E]=="function"&&(this[E]=function(O){return function(){return w[O].apply(w,arguments)}}(E));for(var R=0;R<V.length;R++)w.on(V[R],this.emit.bind(this,V[R]));return this._read=function(O){W("wrapped _read",O),d&&(d=!1,w.resume())},this},typeof Symbol=="function"&&(y.prototype[Symbol.asyncIterator]=function(){return zt===void 0&&(zt=s("./internal/streams/async_iterator")),zt(this)}),Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(y.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(y.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),y._fromList=H,Object.defineProperty(y.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(y.from=function(w,r){return $t===void 0&&($t=s("./internal/streams/from")),$t(y,w,r)})}).call(this)}).call(this,s("_process"),typeof Dt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Dt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(s,h){function l(I,N){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new y);m.writechunk=null,m.writecb=null,N!=null&&this.push(N),_(I);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function a(I){return this instanceof a?(M.call(this,I),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,I&&(typeof I.transform=="function"&&(this._transform=I.transform),typeof I.flush=="function"&&(this._flush=I.flush)),void this.on("prefinish",p)):new a(I)}function p(){var I=this;typeof this._flush!="function"||this._readableState.destroyed?b(this,null,null):this._flush(function(N,m){b(I,N,m)})}function b(I,N,m){if(N)return I.emit("error",N);if(m!=null&&I.push(m),I._writableState.length)throw new C;if(I._transformState.transforming)throw new g;return I.push(null)}h.exports=a;var u=s("../errors").codes,f=u.ERR_METHOD_NOT_IMPLEMENTED,y=u.ERR_MULTIPLE_CALLBACK,g=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,C=u.ERR_TRANSFORM_WITH_LENGTH_0,M=s("./_stream_duplex");s("inherits")(a,M),a.prototype.push=function(I,N){return this._transformState.needTransform=!1,M.prototype.push.call(this,I,N)},a.prototype._transform=function(I,N,m){m(new f("_transform()"))},a.prototype._write=function(I,N,m){var _=this._transformState;if(_.writecb=m,_.writechunk=I,_.writeencoding=N,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},a.prototype._read=function(){var I=this._transformState;I.writechunk===null||I.transforming?I.needTransform=!0:(I.transforming=!0,this._transform(I.writechunk,I.writeencoding,I.afterTransform))},a.prototype._destroy=function(I,N){M.prototype._destroy.call(this,I,function(m){N(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(s,h){(function(l,a){(function(){function p(D){var x=this;this.next=null,this.entry=null,this.finish=function(){z(x,D)}}function b(D){return W.from(D)}function u(D){return W.isBuffer(D)||D instanceof ge}function f(){}function y(D,x,B){X=X||s("./_stream_duplex"),D=D||{},typeof B!="boolean"&&(B=x instanceof X),this.objectMode=!!D.objectMode,B&&(this.objectMode=this.objectMode||!!D.writableObjectMode),this.highWaterMark=nt(this,D,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=D.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(w){A(x,w)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function g(D){X=X||s("./_stream_duplex");var x=this instanceof X;return x||At.call(g,this)?(this._writableState=new y(D,this,x),this.writable=!0,D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final)),void yt.call(this)):new g(D)}function C(D,x){var B=new Oe;Rt(D,B),l.nextTick(x,B)}function M(D,x,B,V){var w;return B===null?w=new ee:typeof B!="string"&&!x.objectMode&&(w=new kt("chunk",["string","Buffer"],B)),!w||(Rt(D,w),l.nextTick(V,w),!1)}function I(D,x,B){return D.objectMode||D.decodeStrings===!1||typeof x!="string"||(x=W.from(x,B)),x}function N(D,x,B,V,w,r){if(!B){var c=I(x,V,w);V!==c&&(B=!0,w="buffer",V=c)}var d=x.objectMode?1:V.length;x.length+=d;var E=x.length<x.highWaterMark;if(E||(x.needDrain=!0),x.writing||x.corked){var R=x.lastBufferedRequest;x.lastBufferedRequest={chunk:V,encoding:w,isBuf:B,callback:r,next:null},R?R.next=x.lastBufferedRequest:x.bufferedRequest=x.lastBufferedRequest,x.bufferedRequestCount+=1}else m(D,x,!1,d,V,w,r);return E}function m(D,x,B,V,w,r,c){x.writelen=V,x.writecb=c,x.writing=!0,x.sync=!0,x.destroyed?x.onwrite(new te("write")):B?D._writev(w,x.onwrite):D._write(w,r,x.onwrite),x.sync=!1}function _(D,x,B,V,w){--x.pendingcb,B?(l.nextTick(w,V),l.nextTick(j,D,x),D._writableState.errorEmitted=!0,Rt(D,V)):(w(V),D._writableState.errorEmitted=!0,Rt(D,V),j(D,x))}function v(D){D.writing=!1,D.writecb=null,D.length-=D.writelen,D.writelen=0}function A(D,x){var B=D._writableState,V=B.sync,w=B.writecb;if(typeof w!="function")throw new $t;if(v(B),x)_(D,B,V,x,w);else{var r=k(B)||D.destroyed;r||B.corked||B.bufferProcessing||!B.bufferedRequest||U(D,B),V?l.nextTick(S,D,B,r,w):S(D,B,r,w)}}function S(D,x,B,V){B||L(D,x),x.pendingcb--,V(),j(D,x)}function L(D,x){x.length===0&&x.needDrain&&(x.needDrain=!1,D.emit("drain"))}function U(D,x){x.bufferProcessing=!0;var B=x.bufferedRequest;if(D._writev&&B&&B.next){var V=x.bufferedRequestCount,w=Array(V),r=x.corkedRequestsFree;r.entry=B;for(var c=0,d=!0;B;)w[c]=B,B.isBuf||(d=!1),B=B.next,c+=1;w.allBuffers=d,m(D,x,!0,x.length,w,"",r.finish),x.pendingcb++,x.lastBufferedRequest=null,r.next?(x.corkedRequestsFree=r.next,r.next=null):x.corkedRequestsFree=new p(x),x.bufferedRequestCount=0}else{for(;B;){var E=B.chunk,R=B.encoding,O=B.callback,P=x.objectMode?1:E.length;if(m(D,x,!1,P,E,R,O),B=B.next,x.bufferedRequestCount--,x.writing)break}B===null&&(x.lastBufferedRequest=null)}x.bufferedRequest=B,x.bufferProcessing=!1}function k(D){return D.ending&&D.length===0&&D.bufferedRequest===null&&!D.finished&&!D.writing}function T(D,x){D._final(function(B){x.pendingcb--,B&&Rt(D,B),x.prefinished=!0,D.emit("prefinish"),j(D,x)})}function F(D,x){x.prefinished||x.finalCalled||(typeof D._final!="function"||x.destroyed?(x.prefinished=!0,D.emit("prefinish")):(x.pendingcb++,x.finalCalled=!0,l.nextTick(T,D,x)))}function j(D,x){var B=k(x);if(B&&(F(D,x),x.pendingcb===0&&(x.finished=!0,D.emit("finish"),x.autoDestroy))){var V=D._readableState;(!V||V.autoDestroy&&V.endEmitted)&&D.destroy()}return B}function H(D,x,B){x.ending=!0,j(D,x),B&&(x.finished?l.nextTick(B):D.once("finish",B)),x.ended=!0,D.writable=!1}function z(D,x,B){var V=D.entry;for(D.entry=null;V;){var w=V.callback;x.pendingcb--,w(B),V=V.next}x.corkedRequestsFree.next=D}h.exports=g;var X;g.WritableState=y;var it={deprecate:s("util-deprecate")},yt=s("./internal/streams/stream"),W=s("buffer").Buffer,ge=a.Uint8Array||function(){},St=s("./internal/streams/destroy"),Yt=s("./internal/streams/state"),nt=Yt.getHighWaterMark,Z=s("../errors").codes,kt=Z.ERR_INVALID_ARG_TYPE,zt=Z.ERR_METHOD_NOT_IMPLEMENTED,$t=Z.ERR_MULTIPLE_CALLBACK,xe=Z.ERR_STREAM_CANNOT_PIPE,te=Z.ERR_STREAM_DESTROYED,ee=Z.ERR_STREAM_NULL_VALUES,Oe=Z.ERR_STREAM_WRITE_AFTER_END,Gt=Z.ERR_UNKNOWN_ENCODING,Rt=St.errorOrDestroy;s("inherits")(g,yt),y.prototype.getBuffer=function(){for(var D=this.bufferedRequest,x=[];D;)x.push(D),D=D.next;return x},function(){try{Object.defineProperty(y.prototype,"buffer",{get:it.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var At;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(At=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(D){return!!At.call(this,D)||this===g&&D&&D._writableState instanceof y}})):At=function(D){return D instanceof this},g.prototype.pipe=function(){Rt(this,new xe)},g.prototype.write=function(D,x,B){var V=this._writableState,w=!1,r=!V.objectMode&&u(D);return r&&!W.isBuffer(D)&&(D=b(D)),typeof x=="function"&&(B=x,x=null),r?x="buffer":!x&&(x=V.defaultEncoding),typeof B!="function"&&(B=f),V.ending?C(this,B):(r||M(this,V,D,B))&&(V.pendingcb++,w=N(this,V,r,D,x,B)),w},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var D=this._writableState;D.corked&&(D.corked--,!D.writing&&!D.corked&&!D.bufferProcessing&&D.bufferedRequest&&U(this,D))},g.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())))throw new Gt(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(D,x,B){B(new zt("_write()"))},g.prototype._writev=null,g.prototype.end=function(D,x,B){var V=this._writableState;return typeof D=="function"?(B=D,D=null,x=null):typeof x=="function"&&(B=x,x=null),D!=null&&this.write(D,x),V.corked&&(V.corked=1,this.uncork()),V.ending||H(this,V,B),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),g.prototype.destroy=St.destroy,g.prototype._undestroy=St.undestroy,g.prototype._destroy=function(D,x){x(D)}}).call(this)}).call(this,s("_process"),typeof Dt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Dt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(s,h){(function(l){(function(){function a(L,U,k){return U in L?Object.defineProperty(L,U,{value:k,enumerable:!0,configurable:!0,writable:!0}):L[U]=k,L}function p(L,U){return{value:L,done:U}}function b(L){var U=L[C];if(U!==null){var k=L[v].read();k!==null&&(L[m]=null,L[C]=null,L[M]=null,U(p(k,!1)))}}function u(L){l.nextTick(b,L)}function f(L,U){return function(k,T){L.then(function(){return U[N]?void k(p(void 0,!0)):void U[_](k,T)},T)}}var y,g=s("./end-of-stream"),C=Symbol("lastResolve"),M=Symbol("lastReject"),I=Symbol("error"),N=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),A=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((y={get stream(){return this[v]},next:function(){var L=this,U=this[I];if(U!==null)return Promise.reject(U);if(this[N])return Promise.resolve(p(void 0,!0));if(this[v].destroyed)return new Promise(function(j,H){l.nextTick(function(){L[I]?H(L[I]):j(p(void 0,!0))})});var k,T=this[m];if(T)k=new Promise(f(T,this));else{var F=this[v].read();if(F!==null)return Promise.resolve(p(F,!1));k=new Promise(this[_])}return this[m]=k,k}},a(y,Symbol.asyncIterator,function(){return this}),a(y,"return",function(){var L=this;return new Promise(function(U,k){L[v].destroy(null,function(T){return T?void k(T):void U(p(void 0,!0))})})}),y),A);h.exports=function(L){var U,k=Object.create(S,(U={},a(U,v,{value:L,writable:!0}),a(U,C,{value:null,writable:!0}),a(U,M,{value:null,writable:!0}),a(U,I,{value:null,writable:!0}),a(U,N,{value:L._readableState.endEmitted,writable:!0}),a(U,_,{value:function(T,F){var j=k[v].read();j?(k[m]=null,k[C]=null,k[M]=null,T(p(j,!1))):(k[C]=T,k[M]=F)},writable:!0}),U));return k[m]=null,g(L,function(T){if(T&&T.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=k[M];return F!==null&&(k[m]=null,k[C]=null,k[M]=null,F(T)),void(k[I]=T)}var j=k[C];j!==null&&(k[m]=null,k[C]=null,k[M]=null,j(p(void 0,!0))),k[N]=!0}),L.on("readable",u.bind(null,k)),k}}).call(this)}).call(this,s("_process"))},{"./end-of-stream":24,_process:12}],22:[function(s,h){function l(m,_){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(m);_&&(A=A.filter(function(S){return Object.getOwnPropertyDescriptor(m,S).enumerable})),v.push.apply(v,A)}return v}function a(m){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?l(Object(_),!0).forEach(function(A){p(m,A,_[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):l(Object(_)).forEach(function(A){Object.defineProperty(m,A,Object.getOwnPropertyDescriptor(_,A))});return m}function p(m,_,v){return _ in m?Object.defineProperty(m,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):m[_]=v,m}function b(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function u(m,_){for(var v,A=0;A<_.length;A++)v=_[A],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(m,v.key,v)}function f(m,_,v){return _&&u(m.prototype,_),v&&u(m,v),m}function y(m,_,v){C.prototype.copy.call(m,_,v)}var g=s("buffer"),C=g.Buffer,M=s("util"),I=M.inspect,N=I&&I.custom||"inspect";h.exports=function(){function m(){b(this,m),this.head=null,this.tail=null,this.length=0}return f(m,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,A=""+v.data;v=v.next;)A+=_+v.data;return A}},{key:"concat",value:function(_){if(this.length===0)return C.alloc(0);for(var v=C.allocUnsafe(_>>>0),A=this.head,S=0;A;)y(A.data,v,S),S+=A.data.length,A=A.next;return v}},{key:"consume",value:function(_,v){var A;return _<this.head.data.length?(A=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?A=this.shift():A=v?this._getString(_):this._getBuffer(_),A}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,A=1,S=v.data;for(_-=S.length;v=v.next;){var L=v.data,U=_>L.length?L.length:_;if(S+=U===L.length?L:L.slice(0,_),_-=U,_===0){U===L.length?(++A,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=L.slice(U));break}++A}return this.length-=A,S}},{key:"_getBuffer",value:function(_){var v=C.allocUnsafe(_),A=this.head,S=1;for(A.data.copy(v),_-=A.data.length;A=A.next;){var L=A.data,U=_>L.length?L.length:_;if(L.copy(v,v.length-_,0,U),_-=U,_===0){U===L.length?(++S,this.head=A.next?A.next:this.tail=null):(this.head=A,A.data=L.slice(U));break}++S}return this.length-=S,v}},{key:N,value:function(_,v){return I(this,a({},v,{depth:0,customInspect:!1}))}}]),m}()},{buffer:3,util:2}],23:[function(s,h){(function(l){(function(){function a(u,f){b(u,f),p(u)}function p(u){u._writableState&&!u._writableState.emitClose||u._readableState&&!u._readableState.emitClose||u.emit("close")}function b(u,f){u.emit("error",f)}h.exports={destroy:function(u,f){var y=this,g=this._readableState&&this._readableState.destroyed,C=this._writableState&&this._writableState.destroyed;return g||C?(f?f(u):u&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,l.nextTick(b,this,u)):l.nextTick(b,this,u)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(u||null,function(M){!f&&M?y._writableState?y._writableState.errorEmitted?l.nextTick(p,y):(y._writableState.errorEmitted=!0,l.nextTick(a,y,M)):l.nextTick(a,y,M):f?(l.nextTick(p,y),f(M)):l.nextTick(p,y)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(u,f){var y=u._readableState,g=u._writableState;y&&y.autoDestroy||g&&g.autoDestroy?u.destroy(f):u.emit("error",f)}}}).call(this)}).call(this,s("_process"))},{_process:12}],24:[function(s,h){function l(f){var y=!1;return function(){if(!y){y=!0;for(var g=arguments.length,C=Array(g),M=0;M<g;M++)C[M]=arguments[M];f.apply(this,C)}}}function a(){}function p(f){return f.setHeader&&typeof f.abort=="function"}function b(f,y,g){if(typeof y=="function")return b(f,null,y);y||(y={}),g=l(g||a);var C=y.readable||y.readable!==!1&&f.readable,M=y.writable||y.writable!==!1&&f.writable,I=function(){f.writable||m()},N=f._writableState&&f._writableState.finished,m=function(){M=!1,N=!0,C||g.call(f)},_=f._readableState&&f._readableState.endEmitted,v=function(){C=!1,_=!0,M||g.call(f)},A=function(U){g.call(f,U)},S=function(){var U;return C&&!_?(f._readableState&&f._readableState.ended||(U=new u),g.call(f,U)):M&&!N?(f._writableState&&f._writableState.ended||(U=new u),g.call(f,U)):void 0},L=function(){f.req.on("finish",m)};return p(f)?(f.on("complete",m),f.on("abort",S),f.req?L():f.on("request",L)):M&&!f._writableState&&(f.on("end",I),f.on("close",I)),f.on("end",v),f.on("finish",m),y.error!==!1&&f.on("error",A),f.on("close",S),function(){f.removeListener("complete",m),f.removeListener("abort",S),f.removeListener("request",L),f.req&&f.req.removeListener("finish",m),f.removeListener("end",I),f.removeListener("close",I),f.removeListener("finish",m),f.removeListener("end",v),f.removeListener("error",A),f.removeListener("close",S)}}var u=s("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;h.exports=b},{"../../../errors":15}],25:[function(s,h){h.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(s,h){function l(N){var m=!1;return function(){m||(m=!0,N.apply(void 0,arguments))}}function a(N){if(N)throw N}function p(N){return N.setHeader&&typeof N.abort=="function"}function b(N,m,_,v){v=l(v);var A=!1;N.on("close",function(){A=!0}),g===void 0&&(g=s("./end-of-stream")),g(N,{readable:m,writable:_},function(L){return L?v(L):(A=!0,void v())});var S=!1;return function(L){if(!A)return S?void 0:(S=!0,p(N)?N.abort():typeof N.destroy=="function"?N.destroy():void v(L||new I("pipe")))}}function u(N){N()}function f(N,m){return N.pipe(m)}function y(N){return N.length&&typeof N[N.length-1]=="function"?N.pop():a}var g,C=s("../../../errors").codes,M=C.ERR_MISSING_ARGS,I=C.ERR_STREAM_DESTROYED;h.exports=function(){for(var N=arguments.length,m=Array(N),_=0;_<N;_++)m[_]=arguments[_];var v=y(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new M("streams");var A,S=m.map(function(L,U){var k=U<m.length-1;return b(L,k,0<U,function(T){A||(A=T),T&&S.forEach(u),k||(S.forEach(u),v(A))})});return m.reduce(f)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(s,h){function l(p,b,u){return p.highWaterMark==null?b?p[u]:null:p.highWaterMark}var a=s("../../../errors").codes.ERR_INVALID_OPT_VALUE;h.exports={getHighWaterMark:function(p,b,u,f){var y=l(b,f,u);if(y!=null){if(!(isFinite(y)&&n(y)===y)||0>y){var g=f?u:"highWaterMark";throw new a(g,y)}return n(y)}return p.objectMode?16:16384}}},{"../../../errors":15}],28:[function(s,h){h.exports=s("events").EventEmitter},{events:7}],29:[function(s,h,l){l=h.exports=s("./lib/_stream_readable.js"),l.Stream=l,l.Readable=l,l.Writable=s("./lib/_stream_writable.js"),l.Duplex=s("./lib/_stream_duplex.js"),l.Transform=s("./lib/_stream_transform.js"),l.PassThrough=s("./lib/_stream_passthrough.js"),l.finished=s("./lib/internal/streams/end-of-stream.js"),l.pipeline=s("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(s,h,l){function a(f,y){for(var g in f)y[g]=f[g]}function p(f,y,g){return u(f,y,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var b=s("buffer"),u=b.Buffer;u.from&&u.alloc&&u.allocUnsafe&&u.allocUnsafeSlow?h.exports=b:(a(b,l),l.Buffer=p),p.prototype=Object.create(u.prototype),a(u,p),p.from=function(f,y,g){if(typeof f=="number")throw new TypeError("Argument must not be a number");return u(f,y,g)},p.alloc=function(f,y,g){if(typeof f!="number")throw new TypeError("Argument must be a number");var C=u(f);return y===void 0?C.fill(0):typeof g=="string"?C.fill(y,g):C.fill(y),C},p.allocUnsafe=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return u(f)},p.allocUnsafeSlow=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return b.SlowBuffer(f)}},{buffer:3}],31:[function(s,h,l){function a(S){if(!S)return"utf8";for(var L;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(L)return;S=(""+S).toLowerCase(),L=!0}}function p(S){var L=a(S);if(typeof L!="string"&&(v.isEncoding===A||!A(S)))throw new Error("Unknown encoding: "+S);return L||S}function b(S){this.encoding=p(S);var L;switch(this.encoding){case"utf16le":this.text=C,this.end=M,L=4;break;case"utf8":this.fillLast=g,L=4;break;case"base64":this.text=I,this.end=N,L=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(L)}function u(S){return 127>=S?0:S>>5==6?2:S>>4==14?3:S>>3==30?4:S>>6==2?-1:-2}function f(S,L,U){var k=L.length-1;if(k<U)return 0;var T=u(L[k]);return 0<=T?(0<T&&(S.lastNeed=T-1),T):--k<U||T===-2?0:(T=u(L[k]),0<=T?(0<T&&(S.lastNeed=T-2),T):--k<U||T===-2?0:(T=u(L[k]),0<=T?(0<T&&(T===2?T=0:S.lastNeed=T-3),T):0))}function y(S,L){if((192&L[0])!=128)return S.lastNeed=0,"";if(1<S.lastNeed&&1<L.length){if((192&L[1])!=128)return S.lastNeed=1,"";if(2<S.lastNeed&&2<L.length&&(192&L[2])!=128)return S.lastNeed=2,""}}function g(S){var L=this.lastTotal-this.lastNeed,U=y(this,S);return U===void 0?this.lastNeed<=S.length?(S.copy(this.lastChar,L,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(S.copy(this.lastChar,L,0,S.length),void(this.lastNeed-=S.length)):U}function C(S,L){if((S.length-L)%2==0){var U=S.toString("utf16le",L);if(U){var k=U.charCodeAt(U.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",L,S.length-1)}function M(S){var L=S&&S.length?this.write(S):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return L+this.lastChar.toString("utf16le",0,U)}return L}function I(S,L){var U=(S.length-L)%3;return U==0?S.toString("base64",L):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",L,S.length-U))}function N(S){var L=S&&S.length?this.write(S):"";return this.lastNeed?L+this.lastChar.toString("base64",0,3-this.lastNeed):L}function m(S){return S.toString(this.encoding)}function _(S){return S&&S.length?this.write(S):""}var v=s("safe-buffer").Buffer,A=v.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};l.StringDecoder=b,b.prototype.write=function(S){if(S.length===0)return"";var L,U;if(this.lastNeed){if(L=this.fillLast(S),L===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<S.length?L?L+this.text(S,U):this.text(S,U):L||""},b.prototype.end=function(S){var L=S&&S.length?this.write(S):"";return this.lastNeed?L+"":L},b.prototype.text=function(S,L){var U=f(this,S,L);if(!this.lastNeed)return S.toString("utf8",L);this.lastTotal=U;var k=S.length-(U-this.lastNeed);return S.copy(this.lastChar,0,k),S.toString("utf8",L,k)},b.prototype.fillLast=function(S){return this.lastNeed<=S.length?(S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),void(this.lastNeed-=S.length))}},{"safe-buffer":30}],32:[function(s,h){(function(l){(function(){function a(p){try{if(!l.localStorage)return!1}catch{return!1}var b=l.localStorage[p];return b!=null&&(b+"").toLowerCase()==="true"}h.exports=function(p,b){function u(){if(!f){if(a("throwDeprecation"))throw new Error(b);a("traceDeprecation")?console.trace(b):console.warn(b),f=!0}return p.apply(this,arguments)}if(a("noDeprecation"))return p;var f=!1;return u}}).call(this)}).call(this,typeof Dt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Dt)},{}],"/":[function(s,h){function l(N){return N.replace(/a=ice-options:trickle\s\n/g,"")}function a(N){console.warn(N)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const p=s("debug")("simple-peer"),b=s("get-browser-rtc"),u=s("randombytes"),f=s("readable-stream"),y=s("queue-microtask"),g=s("err-code"),{Buffer:C}=s("buffer"),M=65536;class I extends f.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=u(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||u(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||I.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},I.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:b(),!this._wrtc)throw g(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(g(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(g(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(g(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){const _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?a("Ignoring unsupported ICE candidate."):this.destroy(g(v,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(v){this.destroy(g(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const v=this._senderMap.get(m)||new Map;let A=v.get(_);if(!A)A=this._pc.addTrack(m,_),v.set(_,A),this._senderMap.set(m,v),this._needsNegotiation();else throw A.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,v){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const A=this._senderMap.get(m),S=A?A.get(v):null;if(!S)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,A),S.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):S.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const v=this._senderMap.get(m),A=v?v.get(_):null;if(!A)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{A.removed=!0,this._pc.removeTrack(A)}catch(S){S.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(A):this.destroy(g(S,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,y(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),y(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=M),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{const A=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(g(A,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,v){if(this.destroyed)return v(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(A){return this.destroy(g(A,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>M?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=m,this._cb=v}_onFinish(){if(!this.destroyed){const m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=l(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(g(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(g(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=l(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(g(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(g(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){const _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(A=>{Object.assign(v,A)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{const A=[];v.forEach(S=>{A.push(_(S))}),m(null,A)},v=>m(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;const A=[];v.result().forEach(S=>{const L={};S.names().forEach(U=>{L[U]=S.stat(U)}),L.id=S.id,L.type=S.type,L.timestamp=S.timestamp,A.push(_(L))}),m(null,A)},v=>m(v)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const m=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);const A={},S={},L={};let U=!1;v.forEach(T=>{(T.type==="remotecandidate"||T.type==="remote-candidate")&&(A[T.id]=T),(T.type==="localcandidate"||T.type==="local-candidate")&&(S[T.id]=T),(T.type==="candidatepair"||T.type==="candidate-pair")&&(L[T.id]=T)});const k=T=>{U=!0;let F=S[T.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof T.googLocalAddress=="string"&&(F=T.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=A[T.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof T.googRemoteAddress=="string"&&(j=T.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(T=>{T.type==="transport"&&T.selectedCandidatePairId&&k(L[T.selectedCandidatePairId]),(T.type==="googCandidatePair"&&T.googActiveConnection==="true"||(T.type==="candidatepair"||T.type==="candidate-pair")&&T.selected)&&k(T)}),!U&&(!Object.keys(L).length||Object.keys(S).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(g(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const T=this._cb;this._cb=null,T(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>M)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=C.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),y(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],p.apply(null,m)}}I.WEBRTC_SUPPORT=!!b(),I.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},I.channelConfig={},h.exports=I},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(ys);var _a=ys.exports;const va=ba(_a),vr=0,Cr=1,ms=2,ws=(e,t)=>{q(e,vr);const n=ac(t);rt(e,n)},bs=(e,t,n)=>{q(e,Cr),rt(e,ic(t,n))},Ca=(e,t,n)=>bs(t,n,at(e)),_s=(e,t,n)=>{try{ec(t,at(e),n)}catch(i){console.error("Caught error while handling a Yjs update",i)}},Ea=(e,t)=>{q(e,ms),rt(e,t)},Sa=_s,ka=(e,t,n,i)=>{const o=Y(e);switch(o){case vr:Ca(e,t,n);break;case Cr:_s(e,n,i);break;case ms:Sa(e,n,i);break;default:throw new Error("Unknown message type")}return o},jn=3e4;class Ra extends li{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=qt();this.getLocalState()!==null&&jn/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const i=[];this.meta.forEach((o,s)=>{s!==this.clientID&&jn<=n-o.lastUpdated&&this.states.has(s)&&i.push(s)}),i.length>0&&Xn(this,i,"timeout")},xt(jn/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,i=this.meta.get(n),o=i===void 0?0:i.clock+1,s=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:o,lastUpdated:qt()});const h=[],l=[],a=[],p=[];t===null?p.push(n):s==null?t!=null&&h.push(n):(l.push(n),Be(s,t)||a.push(n)),(h.length>0||a.length>0||p.length>0)&&this.emit("change",[{added:h,updated:a,removed:p},"local"]),this.emit("update",[{added:h,updated:l,removed:p},"local"])}setLocalStateField(t,n){const i=this.getLocalState();i!==null&&this.setLocalState({...i,[t]:n})}getStates(){return this.states}}const Xn=(e,t,n)=>{const i=[];for(let o=0;o<t.length;o++){const s=t[o];if(e.states.has(s)){if(e.states.delete(s),s===e.clientID){const h=e.meta.get(s);e.meta.set(s,{clock:h.clock+1,lastUpdated:qt()})}i.push(s)}}i.length>0&&(e.emit("change",[{added:[],updated:[],removed:i},n]),e.emit("update",[{added:[],updated:[],removed:i},n]))},wn=(e,t,n=e.states)=>{const i=t.length,o=lt();q(o,i);for(let s=0;s<i;s++){const h=t[s],l=n.get(h)||null,a=e.meta.get(h).clock;q(o,h),q(o,a),Lt(o,JSON.stringify(l))}return et(o)},Aa=(e,t,n)=>{const i=Ft(t),o=qt(),s=[],h=[],l=[],a=[],p=Y(i);for(let b=0;b<p;b++){const u=Y(i);let f=Y(i);const y=JSON.parse(Pt(i)),g=e.meta.get(u),C=e.states.get(u),M=g===void 0?0:g.clock;(M<f||M===f&&y===null&&e.states.has(u))&&(y===null?u===e.clientID&&e.getLocalState()!=null?f++:e.states.delete(u):e.states.set(u,y),e.meta.set(u,{clock:f,lastUpdated:o}),g===void 0&&y!==null?s.push(u):g!==void 0&&y===null?a.push(u):y!==null&&(Be(y,C)||l.push(u),h.push(u)))}(s.length>0||l.length>0||a.length>0)&&e.emit("change",[{added:s,updated:l,removed:a},n]),(s.length>0||h.length>0||a.length>0)&&e.emit("update",[{added:s,updated:h,removed:a},n])},Ta=(e,t)=>{const n=Hn(e).buffer,i=Hn(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(o=>crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},vs=(e,t)=>{if(!t)return sr(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(i=>{const o=lt();return Lt(o,"AES-GCM"),rt(o,n),rt(o,new Uint8Array(i)),et(o)})},Da=(e,t)=>{const n=lt();return Ce(n,e),vs(et(n),t)},Cs=(e,t)=>{if(!t)return sr(e);const n=Ft(e);Pt(n)!=="AES-GCM"&&uo(Ot("Unknown encryption algorithm"));const o=at(n),s=at(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,s).then(h=>new Uint8Array(h))},La=(e,t)=>Cs(e,t).then(n=>Ee(Ft(new Uint8Array(n)))),wt=Wo("y-webrtc"),ve=0,Es=3,Ge=1,Er=4,bn=new Map,oe=new Map,Ss=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),wt("synced ",Et,e.name,ae," with all peers"))},ks=(e,t,n)=>{const i=Ft(t),o=lt(),s=Y(i);if(e===void 0)return null;const h=e.awareness,l=e.doc;let a=!1;switch(s){case ve:{q(o,ve);const p=ka(i,o,l,e);p===Cr&&!e.synced&&n(),p===vr&&(a=!0);break}case Es:q(o,Ge),rt(o,wn(h,Array.from(h.getStates().keys()))),a=!0;break;case Ge:Aa(h,at(i),e);break;case Er:{const p=ce(i)===1,b=Pt(i);if(b!==e.peerId&&(e.bcConns.has(b)&&!p||!e.bcConns.has(b)&&p)){const u=[],f=[];p?(e.bcConns.add(b),f.push(b)):(e.bcConns.delete(b),u.push(b)),e.provider.emit("peers",[{added:f,removed:u,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),Rs(e)}break}default:return console.error("Unable to compute message"),o}return a?o:null},Ia=(e,t)=>{const n=e.room;return wt("received message from ",Et,e.remotePeerId,ar," (",n.name,")",ae,Sn),ks(n,t,()=>{e.synced=!0,wt("synced ",Et,n.name,ae," with ",Et,e.remotePeerId),Ss(n)})},Pn=(e,t)=>{wt("send message to ",Et,e.remotePeerId,ae,ar," (",e.room.name,")",Sn);try{e.peer.send(et(t))}catch{}},xa=(e,t)=>{wt("broadcast message in ",Et,e.name,ae),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class ti{constructor(t,n,i,o){wt("establishing connection to ",Et,i),this.room=o,this.remotePeerId=i,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new va({initiator:n,...o.provider.peerOpts}),this.peer.on("signal",s=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),Sr(t,o,{to:i,from:o.peerId,type:"signal",token:this.glareToken,signal:s})}),this.peer.on("connect",()=>{wt("connected to ",Et,i),this.connected=!0;const h=o.provider.doc,l=o.awareness,a=lt();q(a,ve),ws(a,h),Pn(this,a);const p=l.getStates();if(p.size>0){const b=lt();q(b,Ge),rt(b,wn(l,Array.from(p.keys()))),Pn(this,b)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,o.webrtcConns.has(this.remotePeerId)&&(o.webrtcConns.delete(this.remotePeerId),o.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}])),Ss(o),this.peer.destroy(),wt("closed connection to ",Et,i),Zn(o)}),this.peer.on("error",s=>{wt("Error in connection to ",Et,i,": ",s),Zn(o)}),this.peer.on("data",s=>{const h=Ia(this,s);h!==null&&Pn(this,h)})}destroy(){this.peer.destroy()}}const Jt=(e,t)=>vs(t,e.key).then(n=>e.mux(()=>ma(e.name,n))),ei=(e,t)=>{e.bcconnected&&Jt(e,t),xa(e,t)},Zn=e=>{bn.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&Sr(t,e,{type:"announce",from:e.peerId}))})},Rs=e=>{if(e.provider.filterBcConns){const t=lt();q(t,Er),We(t,1),Lt(t,e.peerId),Jt(e,et(t))}};class Oa{constructor(t,n,i,o){this.peerId=pi(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=i,this.key=o,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=wa(),this.bcconnected=!1,this._bcSubscriber=s=>Cs(new Uint8Array(s),o).then(h=>this.mux(()=>{const l=ks(this,h,()=>{});l&&Jt(this,et(l))})),this._docUpdateHandler=(s,h)=>{const l=lt();q(l,ve),Ea(l,s),ei(this,et(l))},this._awarenessUpdateHandler=({added:s,updated:h,removed:l},a)=>{const p=s.concat(h).concat(l),b=lt();q(b,Ge),rt(b,wn(this.awareness,p)),ei(this,et(b))},this._beforeUnloadHandler=()=>{Xn(this.awareness,[t.clientID],"window unload"),oe.forEach(s=>{s.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Zn(this);const t=this.name;pa(t,this._bcSubscriber),this.bcconnected=!0,Rs(this);const n=lt();q(n,ve),ws(n,this.doc),Jt(this,et(n));const i=lt();q(i,ve),bs(i,this.doc),Jt(this,et(i));const o=lt();q(o,Es),Jt(this,et(o));const s=lt();q(s,Ge),rt(s,wn(this.awareness,[this.doc.clientID])),Jt(this,et(s))}disconnect(){bn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),Xn(this.awareness,[this.doc.clientID],"disconnect");const t=lt();q(t,Er),We(t,0),Lt(t,this.peerId),Jt(this,et(t)),ya(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const Ma=(e,t,n,i)=>{if(oe.has(n))throw Ot(`A Yjs Doc connected to room "${n}" already exists!`);const o=new Oa(e,t,n,i);return oe.set(n,o),o},Sr=(e,t,n)=>{t.key?Da(n,t.key).then(i=>{e.send({type:"publish",topic:t.name,data:Si(i)})}):e.send({type:"publish",topic:t.name,data:n})};class Na extends da{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{wt(`connected (${t})`);const n=Array.from(oe.keys());this.send({type:"subscribe",topics:n}),oe.forEach(i=>Sr(this,i,{type:"announce",from:i.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const i=n.topic,o=oe.get(i);if(o==null||typeof i!="string")return;const s=h=>{const l=o.webrtcConns,a=o.peerId;if(h==null||h.from===a||h.to!==void 0&&h.to!==a||o.bcConns.has(h.from))return;const p=l.has(h.from)?()=>{}:()=>o.provider.emit("peers",[{removed:[],added:[h.from],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}]);switch(h.type){case"announce":l.size<o.provider.maxConns&&(_t(l,h.from,()=>new ti(this,!0,h.from,o)),p());break;case"signal":if(h.signal.type==="offer"){const b=l.get(h.from);if(b){const u=h.token,f=b.glareToken;if(f&&f>u){wt("offer rejected: ",h.from);return}b.glareToken=void 0}}if(h.signal.type==="answer"){wt("offer answered by: ",h.from);const b=l.get(h.from);b.glareToken=void 0}h.to===a&&(_t(l,h.from,()=>new ti(this,!1,h.from,o)).peer.signal(h.signal),p());break}};o.key?typeof n.data=="string"&&La(ki(n.data),o.key).then(s):s(n.data)}}}),this.on("disconnect",()=>wt(`disconnect (${t})`))}}const Vn=e=>{e.emit("status",[{connected:e.connected}])};class Ua extends ai{constructor(t,n,{signaling:i=["wss://y-webrtc-eu.fly.dev"],password:o=null,awareness:s=new Ra(n),maxConns:h=20+xt(lo()*15),filterBcConns:l=!0,peerOpts:a={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=l,this.awareness=s,this.shouldConnect=!1,this.signalingUrls=i,this.signalingConns=[],this.maxConns=h,this.peerOpts=a,this.key=o?Ta(o,t):sr(null),this.room=null,this.key.then(p=>{this.room=Ma(n,this,t,p),this.shouldConnect?this.room.connect():this.room.disconnect(),Vn(this)}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=_t(bn,t,()=>new Na(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&(this.room.connect(),Vn(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),bn.delete(t.url))}),this.room&&(this.room.disconnect(),Vn(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),oe.delete(this.roomName)}),super.destroy()}}const ni=["#FF5733","#33A8FF","#33FF57","#FF33A8","#A833FF","#FFBD33","#33FFC1","#FF5733"],ft=document.getElementById("editor"),je=document.getElementById("status"),kr=document.getElementById("username"),ri=document.getElementById("session-id"),Fa=document.getElementById("join-btn"),Ba=document.getElementById("session-display"),ja=document.getElementById("current-session"),ii=document.getElementById("copy-notification"),Pa=document.getElementById("theme-toggle"),si=document.getElementById("moon-icon"),oi=document.getElementById("sun-icon");kr.value="User"+Math.floor(Math.random()*1e3);function Va(){const e=localStorage.getItem("theme");if(e)Qn(e);else{const t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;Qn(t?"dark":"light")}}function Qn(e){e==="dark"?(document.documentElement.setAttribute("data-theme","dark"),si.style.display="none",oi.style.display="block"):(document.documentElement.removeAttribute("data-theme"),si.style.display="block",oi.style.display="none")}function qa(){const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";Qn(t),localStorage.setItem("theme",t)}Va();Pa.addEventListener("click",qa);function As(){return crypto===void 0||!crypto.randomUUID?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}):crypto.randomUUID()}function Wa(){return new URLSearchParams(window.location.search).get("session")||As()}function Ha(e){const t=new URL(window.location);t.searchParams.set("session",e),window.history.pushState({},"",t)}function Ya(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}let ie,ht,re,Rr=Wa(),Pe={},Ue={};function Ts(e){ht&&ht.destroy(),ie&&ie.destroy(),ie=new Le,re=ie.getText("content"),ht=new Ua(`minimal-p2p-notes-${e}`,ie,{signaling:["wss://signaling.yjs.dev"]}),Ba.textContent=e,Rr=e,Ha(e);const t=kr.value.trim()||"User"+Math.floor(Math.random()*1e3);ht.awareness.setLocalStateField("user",{name:t,cursor:null}),ht.awareness.on("change",()=>{ci(),$a()}),ht.on("status",n=>{n.status==="connected"?je.style.backgroundColor="rgba(0,255,0,0.2)":je.style.backgroundColor="rgba(255,0,0,0.2)"}),ci(),za()}function za(){let e=!1;ft.textContent=re.toString(),re.observe(t=>{if(t.transaction.origin!==ht.awareness.clientID&&!e){const n=window.getSelection(),i=n.rangeCount>0;let o=null;if(i){const s=n.getRangeAt(0);o={startContainer:s.startContainer,startOffset:s.startOffset,endContainer:s.endContainer,endOffset:s.endOffset}}if(ft.innerHTML=re.toString(),i&&o)try{setTimeout(()=>{const s=document.createRange(),h=Array.from(ft.childNodes).findIndex(l=>l.textContent===o.startContainer.textContent);if(h>=0){const l=ft.childNodes[h];s.setStart(l,Math.min(o.startOffset,l.textContent.length)),s.setEnd(l,Math.min(o.endOffset,l.textContent.length)),n.removeAllRanges(),n.addRange(s)}},0)}catch{}}}),ft.addEventListener("input",()=>{e=!0;const t=Ya(ft.innerText);re.delete(0,re.length),re.insert(0,t),e=!1,Ne()}),ft.addEventListener("mouseup",Ne),ft.addEventListener("keyup",Ne),ft.addEventListener("click",Ne),setTimeout(()=>{ft.focus(),Ne()},100)}function ci(){if(!ht)return;const e=ht.awareness.getStates().size;je.textContent=`Connected with ${e-1} peer${e!==2?"s":""}`,e>1?je.style.backgroundColor="rgba(0,255,0,0.2)":je.style.backgroundColor="rgba(255,165,0,0.2)"}Fa.addEventListener("click",()=>{const e=ri.value.trim()||As();Ar(),Ue={},Ts(e),ri.value=""});Ts(Rr);ja.addEventListener("click",()=>{const e=new URL(window.location);e.searchParams.set("session",Rr);const t=e.toString();navigator.clipboard.writeText(t).then(()=>{ii.classList.add("show"),setTimeout(()=>{ii.classList.remove("show")},2e3)}).catch(n=>{console.error("Failed to copy URL: ",n)})});window.addEventListener("beforeunload",()=>{ht&&ht.destroy(),ie&&ie.destroy(),Ar()});function Ne(){if(!ht||!ht.awareness)return;const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0);if(!ft.contains(t.startContainer))return;let n;const i=document.createElement("span");if(i.innerHTML="&#8203;",t.cloneRange().insertNode(i),n=i.getBoundingClientRect(),n.height===0){const a=(i.parentNode||ft).getBoundingClientRect(),p=window.getComputedStyle(ft),b=parseInt(p.lineHeight)||20;n={left:a.left+20,top:a.top,width:0,height:b}}if(i.parentNode&&i.parentNode.removeChild(i),e.removeAllRanges(),e.addRange(t),t.startContainer===ft&&t.startOffset===0){const l=ft.getBoundingClientRect();n={left:l.left+20,top:l.top+20,width:0,height:20}}const s=ft.getBoundingClientRect(),h={left:n.left-s.left,top:n.top-s.top};ht.awareness.setLocalStateField("user",{name:kr.value.trim()||"User"+Math.floor(Math.random()*1e3),cursor:h})}function $a(){if(!ht||!ht.awareness)return;Ar();const e=ht.awareness.getStates(),t=ht.awareness.clientID;e.forEach((n,i)=>{i===t||!n.user||!n.user.cursor||Ga(i,n.user)})}function Ga(e,t){if(!Ue[e]){const a=Object.keys(Ue).length%ni.length;Ue[e]=ni[a]}const n=Ue[e],i=t.cursor;if(!i||typeof i.left!="number"||typeof i.top!="number")return;if(!Pe[e]){const a=document.createElement("div");a.className="remote-cursor",a.style.backgroundColor=n;const p=document.createElement("div");p.className="cursor-label",p.style.backgroundColor=n,p.textContent=t.name||"Anonymous",a.appendChild(p),document.body.appendChild(a),Pe[e]=a}const o=Pe[e],s=ft.getBoundingClientRect(),h=s.left+i.left,l=s.top+i.top;o.style.left=`${h}px`,o.style.top=`${l}px`,o.style.display="block"}function Ar(){Object.values(Pe).forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),Pe={}}
