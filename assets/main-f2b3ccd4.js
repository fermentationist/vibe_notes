(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const we=()=>new Map,Kn=t=>{const e=we();return t.forEach((n,s)=>{e.set(s,n)}),e},Se=(t,e,n)=>{let s=t.get(e);return s===void 0&&t.set(e,s=n()),s},Vi=(t,e)=>{const n=[];for(const[s,o]of t)n.push(e(o,s));return n},qi=(t,e)=>{for(const[n,s]of t)if(e(s,n))return!0;return!1},et=()=>new Set,Mn=t=>t[t.length-1],Hi=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ve=Array.from,zi=Array.isArray;class ws{constructor(){this._observers=we()}on(e,n){return Se(this._observers,e,et).add(n),n}once(e,n){const s=(...o)=>{this.off(e,s),n(...o)};this.on(e,s)}off(e,n){const s=this._observers.get(e);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(e))}emit(e,n){return Ve((this._observers.get(e)||we()).values()).forEach(s=>s(...n))}destroy(){this._observers=we()}}class bs{constructor(){this._observers=we()}on(e,n){Se(this._observers,e,et).add(n)}once(e,n){const s=(...o)=>{this.off(e,s),n(...o)};this.on(e,s)}off(e,n){const s=this._observers.get(e);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(e))}emit(e,n){return Ve((this._observers.get(e)||we()).values()).forEach(s=>s(...n))}destroy(){this._observers=we()}}const Ne=Math.floor,un=Math.abs,Yi=Math.log10,cr=(t,e)=>t<e?t:e,ft=(t,e)=>t>e?t:e,_s=t=>t!==0?t<0:1/t<0,Mr=1,Ur=2,Un=4,Fn=8,Ht=32,Pe=64,_e=128,Tn=31,Xn=63,ot=127,Gi=2147483647,Ss=Number.MAX_SAFE_INTEGER,Ji=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Ne(t)===t),Ki=String.fromCharCode,Xi=t=>t.toLowerCase(),Zi=/^\s*/g,Qi=t=>t.replace(Zi,""),eo=/([A-Z])/g,Fr=(t,e)=>Qi(t.replace(eo,n=>`${e}${Xi(n)}`)),to=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=e.codePointAt(o);return s},zt=typeof TextEncoder<"u"?new TextEncoder:null,no=t=>zt.encode(t),Zn=zt?no:to;let Pt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Pt&&Pt.decode(new Uint8Array).length===1&&(Pt=null);class Qt{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const he=()=>new Qt,ro=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},re=t=>{const e=new Uint8Array(ro(t));let n=0;for(let s=0;s<t.bufs.length;s++){const o=t.bufs[s];e.set(o,n),n+=o.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},so=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ft(n,e)*2),t.cpos=0)},ce=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Yt=ce,V=(t,e)=>{for(;e>ot;)ce(t,_e|ot&e),e=Ne(e/128);ce(t,ot&e)},ur=(t,e)=>{const n=_s(e);for(n&&(e=-e),ce(t,(e>Xn?_e:0)|(n?Pe:0)|Xn&e),e=Ne(e/64);e>0;)ce(t,(e>ot?_e:0)|ot&e),e=Ne(e/128)},Qn=new Uint8Array(3e4),io=Qn.length/3,oo=(t,e)=>{if(e.length<io){const n=zt.encodeInto(e,Qn).written||0;V(t,n);for(let s=0;s<n;s++)ce(t,Qn[s])}else ie(t,Zn(e))},ao=(t,e)=>{const n=unescape(encodeURIComponent(e)),s=n.length;V(t,s);for(let o=0;o<s;o++)ce(t,n.codePointAt(o))},Le=zt&&zt.encodeInto?oo:ao,Rn=(t,e)=>{const n=t.cbuf.length,s=t.cpos,o=cr(n-s,e.length),i=e.length-o;t.cbuf.set(e.subarray(0,o),s),t.cpos+=o,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ft(n*2,i)),t.cbuf.set(e.subarray(o)),t.cpos=i)},ie=(t,e)=>{V(t,e.byteLength),Rn(t,e)},hr=(t,e)=>{so(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},lo=(t,e)=>hr(t,4).setFloat32(0,e,!1),co=(t,e)=>hr(t,8).setFloat64(0,e,!1),uo=(t,e)=>hr(t,8).setBigInt64(0,e,!1),Br=new DataView(new ArrayBuffer(4)),ho=t=>(Br.setFloat32(0,t),Br.getFloat32(0)===t),Et=(t,e)=>{switch(typeof e){case"string":ce(t,119),Le(t,e);break;case"number":Ji(e)&&un(e)<=Gi?(ce(t,125),ur(t,e)):ho(e)?(ce(t,124),lo(t,e)):(ce(t,123),co(t,e));break;case"bigint":ce(t,122),uo(t,e);break;case"object":if(e===null)ce(t,126);else if(zi(e)){ce(t,117),V(t,e.length);for(let n=0;n<e.length;n++)Et(t,e[n])}else if(e instanceof Uint8Array)ce(t,116),ie(t,e);else{ce(t,118);const n=Object.keys(e);V(t,n.length);for(let s=0;s<n.length;s++){const o=n[s];Le(t,o),Et(t,e[o])}}break;case"boolean":ce(t,e?120:121);break;default:ce(t,127)}};class $r extends Qt{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&V(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const jr=t=>{t.count>0&&(ur(t.encoder,t.count===1?t.s:-t.s),t.count>1&&V(t.encoder,t.count-2))};class hn{constructor(){this.encoder=new Qt,this.s=0,this.count=0}write(e){this.s===e?this.count++:(jr(this),this.count=1,this.s=e)}toUint8Array(){return jr(this),re(this.encoder)}}const Pr=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);ur(t.encoder,e),t.count>1&&V(t.encoder,t.count-2)}};class Bn{constructor(){this.encoder=new Qt,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Pr(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Pr(this),re(this.encoder)}}class fo{constructor(){this.sarr=[],this.s="",this.lensE=new hn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Qt;return this.sarr.push(this.s),this.s="",Le(e,this.sarr.join("")),Rn(e,this.lensE.toUint8Array()),re(e)}}const Me=t=>new Error(t),Oe=()=>{throw Me("Method unimplemented")},Ue=()=>{throw Me("Unexpected case")},vs=Me("Unexpected end of array"),Cs=Me("Integer out of Range");class Dn{constructor(e){this.arr=e,this.pos=0}}const $e=t=>new Dn(t),go=t=>t.pos!==t.arr.length,po=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},ue=t=>po(t,z(t)),lt=t=>t.arr[t.pos++],z=t=>{let e=0,n=1;const s=t.arr.length;for(;t.pos<s;){const o=t.arr[t.pos++];if(e=e+(o&ot)*n,n*=128,o<_e)return e;if(e>Ss)throw Cs}throw vs},dr=t=>{let e=t.arr[t.pos++],n=e&Xn,s=64;const o=(e&Pe)>0?-1:1;if(!(e&_e))return o*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n=n+(e&ot)*s,s*=128,e<_e)return o*n;if(n>Ss)throw Cs}throw vs},yo=t=>{let e=z(t);if(e===0)return"";{let n=String.fromCodePoint(lt(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(lt(t));else for(;e>0;){const s=e<1e4?e:1e4,o=t.arr.subarray(t.pos,t.pos+s);t.pos+=s,n+=String.fromCodePoint.apply(null,o),e-=s}return decodeURIComponent(escape(n))}},mo=t=>Pt.decode(ue(t)),We=Pt?mo:yo,fr=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},wo=t=>fr(t,4).getFloat32(0,!1),bo=t=>fr(t,8).getFloat64(0,!1),_o=t=>fr(t,8).getBigInt64(0,!1),So=[t=>{},t=>null,dr,wo,bo,_o,t=>!1,t=>!0,We,t=>{const e=z(t),n={};for(let s=0;s<e;s++){const o=We(t);n[o]=kt(t)}return n},t=>{const e=z(t),n=[];for(let s=0;s<e;s++)n.push(kt(t));return n},ue],kt=t=>So[127-lt(t)](t);class Wr extends Dn{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),go(this)?this.count=z(this)+1:this.count=-1),this.count--,this.s}}class dn extends Dn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=dr(this);const e=_s(this.s);this.count=1,e&&(this.s=-this.s,this.count=z(this)+2)}return this.count--,this.s}}class $n extends Dn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=dr(this),n=e&1;this.diff=Ne(e/2),this.count=1,n&&(this.count=z(this)+2)}return this.s+=this.diff,this.count--,this.s}}class vo{constructor(e){this.decoder=new dn(e),this.str=We(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const Co=crypto.getRandomValues.bind(crypto),Eo=Math.random,Es=()=>Co(new Uint32Array(1))[0],ko=[1e7]+-1e3+-4e3+-8e3+-1e11,ks=()=>ko.replace(/[018]/g,t=>(t^Es()&15>>t/4).toString(16)),qe=Date.now,Vr=t=>new Promise(t);Promise.all.bind(Promise);const To=t=>Promise.reject(t),gr=t=>Promise.resolve(t),qr=t=>t===void 0?null:t;class Ro{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Ts=new Ro,pr=!0;try{typeof localStorage<"u"&&localStorage&&(Ts=localStorage,pr=!1)}catch{}const Rs=Ts,Do=t=>pr||addEventListener("storage",t),Ao=t=>pr||removeEventListener("storage",t),xo=Object.assign,Ds=Object.keys,Io=(t,e)=>{for(const n in t)e(t[n],n)},Hr=t=>Ds(t).length,zr=t=>Ds(t).length,Lo=t=>{for(const e in t)return!1;return!0},Oo=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},As=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),No=(t,e)=>t===e||zr(t)===zr(e)&&Oo(t,(n,s)=>(n!==void 0||As(e,s))&&e[s]===n),Mo=Object.freeze,xs=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&xs(t[e])}return Mo(t)},Yr=Symbol("Equality"),yr=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&yr(t,e,n+1)}},Uo=()=>{},Fo=t=>t,Wt=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[Yr]!=null)return t[Yr](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Wt(t.get(n),e.get(n)))return!1;break}case Object:if(Hr(t)!==Hr(e))return!1;for(const n in t)if(!As(t,n)||!Wt(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Wt(t[n],e[n]))return!1;break;default:return!1}return!0},Bo=(t,e)=>e.includes(t),Tt=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Is=typeof window<"u"&&typeof document<"u"&&!Tt;let xe;const $o=()=>{if(xe===void 0)if(Tt){xe=we();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const s=t[n];s[0]==="-"?(e!==null&&xe.set(e,""),e=s):e!==null&&(xe.set(e,s),e=null)}e!==null&&xe.set(e,"")}else typeof location=="object"?(xe=we(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");xe.set(`--${Fr(e,"-")}`,n),xe.set(`-${Fr(e,"-")}`,n)}})):xe=we();return xe},er=t=>$o().has(t),Gt=t=>qr(Tt?process.env[t.toUpperCase().replaceAll("-","_")]:Rs.getItem(t)),Ls=t=>er("--"+t)||Gt(t)!==null;Ls("production");const jo=Tt&&Bo({}.FORCE_COLOR,["true","1","2"]),Po=jo||!er("--no-colors")&&!Ls("no-color")&&(!Tt||process.stdout.isTTY)&&(!Tt||er("--color")||Gt("COLORTERM")!==null||(Gt("TERM")||"").includes("color")),Os=t=>new Uint8Array(t),Wo=(t,e,n)=>new Uint8Array(t,e,n),Vo=t=>new Uint8Array(t),qo=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=Ki(t[n]);return btoa(e)},Ho=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),zo=t=>{const e=atob(t),n=Os(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n},Yo=t=>{const e=Buffer.from(t,"base64");return Wo(e.buffer,e.byteOffset,e.byteLength)},Ns=Is?qo:Ho,Ms=Is?zo:Yo,Go=t=>{const e=Os(t.byteLength);return e.set(t),e};class Jo{constructor(e,n){this.left=e,this.right=n}}const je=(t,e)=>new Jo(t,e);typeof DOMParser<"u"&&new DOMParser;const Ko=t=>Vi(t,(e,n)=>`${n}:${e};`).join(""),Xo=JSON.stringify,He=Symbol,Ee=He(),ct=He(),Us=He(),mr=He(),Fs=He(),Bs=He(),$s=He(),An=He(),xn=He(),Zo=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[];let s=0;for(;s<t.length;s++){const i=t[s];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(s>0&&n.push(e.join(""));s<t.length;s++){const i=t[s];i instanceof Symbol||n.push(i)}return n},Gr=[Fs,$s,An,Us];let jn=0,Jr=qe();const Qo=(t,e)=>{const n=Gr[jn],s=Gt("log"),o=s!==null&&(s==="*"||s==="true"||new RegExp(s,"gi").test(e));return jn=(jn+1)%Gr.length,e+=": ",o?(...i)=>{var l;i.length===1&&((l=i[0])==null?void 0:l.constructor)===Function&&(i=i[0]());const u=qe(),c=u-Jr;Jr=u,t(n,e,xn,...i.map(p=>{switch(p!=null&&p.constructor===Uint8Array&&(p=Array.from(p)),typeof p){case"string":case"symbol":return p;default:return Xo(p)}}),n," +"+c+"ms")}:Uo},ea={[Ee]:je("font-weight","bold"),[ct]:je("font-weight","normal"),[Us]:je("color","blue"),[Fs]:je("color","green"),[mr]:je("color","grey"),[Bs]:je("color","red"),[$s]:je("color","purple"),[An]:je("color","orange"),[xn]:je("color","black")},ta=t=>{var u;t.length===1&&((u=t[0])==null?void 0:u.constructor)===Function&&(t=t[0]());const e=[],n=[],s=we();let o=[],i=0;for(;i<t.length;i++){const c=t[i],l=ea[c];if(l!==void 0)s.set(l.left,l.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){const p=Ko(s);i>0||p.length>0?(e.push("%c"+c),n.push(p)):e.push(c)}else break}}for(i>0&&(o=n,o.unshift(e.join("")));i<t.length;i++){const c=t[i];c instanceof Symbol||o.push(c)}return o},js=Po?ta:Zo,Ps=(...t)=>{console.log(...js(t)),Ws.forEach(e=>e.print(t))},na=(...t)=>{console.warn(...js(t)),t.unshift(An),Ws.forEach(e=>e.print(t))},Ws=et(),ra=t=>Qo(Ps,t),Vs=t=>({[Symbol.iterator](){return this},next:t}),sa=(t,e)=>Vs(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Pn=(t,e)=>Vs(()=>{const{done:n,value:s}=t.next();return{done:n,value:n?void 0:e(s)}});class wr{constructor(e,n){this.clock=e,this.len=n}}class en{constructor(){this.clients=new Map}}const qs=(t,e,n)=>e.clients.forEach((s,o)=>{const i=t.doc.store.clients.get(o);if(i!=null){const u=i[i.length-1],c=u.id.clock+u.length;for(let l=0,p=s[l];l<s.length&&p.clock<c;p=s[++l])ri(t,i,p.clock,p.len,n)}}),ia=(t,e)=>{let n=0,s=t.length-1;for(;n<=s;){const o=Ne((n+s)/2),i=t[o],u=i.clock;if(u<=e){if(e<u+i.len)return o;n=o+1}else s=o-1}return null},Hs=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&ia(n,e.clock)!==null},br=t=>{t.clients.forEach(e=>{e.sort((o,i)=>o.clock-i.clock);let n,s;for(n=1,s=1;n<e.length;n++){const o=e[s-1],i=e[n];o.clock+o.len>=i.clock?o.len=ft(o.len,i.clock+i.len-o.clock):(s<n&&(e[s]=i),s++)}e.length=s})},oa=t=>{const e=new en;for(let n=0;n<t.length;n++)t[n].clients.forEach((s,o)=>{if(!e.clients.has(o)){const i=s.slice();for(let u=n+1;u<t.length;u++)Hi(i,t[u].clients.get(o)||[]);e.clients.set(o,i)}});return br(e),e},gn=(t,e,n,s)=>{Se(t.clients,e,()=>[]).push(new wr(n,s))},aa=()=>new en,la=t=>{const e=aa();return t.clients.forEach((n,s)=>{const o=[];for(let i=0;i<n.length;i++){const u=n[i];if(u.deleted){const c=u.id.clock;let l=u.length;if(i+1<n.length)for(let p=n[i+1];i+1<n.length&&p.deleted;p=n[++i+1])l+=p.length;o.push(new wr(c,l))}}o.length>0&&e.clients.set(s,o)}),e},It=(t,e)=>{V(t.restEncoder,e.clients.size),Ve(e.clients.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{t.resetDsCurVal(),V(t.restEncoder,n);const o=s.length;V(t.restEncoder,o);for(let i=0;i<o;i++){const u=s[i];t.writeDsClock(u.clock),t.writeDsLen(u.len)}})},_r=t=>{const e=new en,n=z(t.restDecoder);for(let s=0;s<n;s++){t.resetDsCurVal();const o=z(t.restDecoder),i=z(t.restDecoder);if(i>0){const u=Se(e.clients,o,()=>[]);for(let c=0;c<i;c++)u.push(new wr(t.readDsClock(),t.readDsLen()))}}return e},Kr=(t,e,n)=>{const s=new en,o=z(t.restDecoder);for(let i=0;i<o;i++){t.resetDsCurVal();const u=z(t.restDecoder),c=z(t.restDecoder),l=n.clients.get(u)||[],p=de(n,u);for(let w=0;w<c;w++){const h=t.readDsClock(),g=h+t.readDsLen();if(h<p){p<g&&gn(s,u,p,g-p);let m=Fe(l,h),y=l[m];for(!y.deleted&&y.id.clock<h&&(l.splice(m+1,0,Sn(e,y,h-y.id.clock)),m++);m<l.length&&(y=l[m++],y.id.clock<g);)y.deleted||(g<y.id.clock+y.length&&l.splice(m,0,Sn(e,y,g-y.id.clock)),y.delete(e))}else gn(s,u,h,g-h)}}if(s.clients.size>0){const i=new ut;return V(i.restEncoder,0),It(i,s),i.toUint8Array()}return null},zs=Es;class Lt extends ws{constructor({guid:e=ks(),collectionid:n=null,gc:s=!0,gcFilter:o=()=>!0,meta:i=null,autoLoad:u=!1,shouldLoad:c=!0}={}){super(),this.gc=s,this.gcFilter=o,this.clientID=zs(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new ti,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=u,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Vr(p=>{this.on("load",()=>{this.isLoaded=!0,p(this)})});const l=()=>Vr(p=>{const w=h=>{(h===void 0||h===!0)&&(this.off("sync",w),p())};this.on("sync",w)});this.on("sync",p=>{p===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=p===void 0||p===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ee(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ve(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ee(this,e,n)}get(e,n=pe){const s=Se(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),o=s.constructor;if(n!==pe&&o!==n)if(o===pe){const i=new n;i._map=s._map,s._map.forEach(u=>{for(;u!==null;u=u.left)u.parent=i}),i._start=s._start;for(let u=i._start;u!==null;u=u.right)u.parent=i;return i._length=s._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return s}getArray(e=""){return this.get(e,St)}getText(e=""){return this.get(e,At)}getMap(e=""){return this.get(e,Dt)}getXmlElement(e=""){return this.get(e,xt)}getXmlFragment(e=""){return this.get(e,ht)}toJSON(){const e={};return this.share.forEach((n,s)=>{e[s]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ve(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Lt({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ee(e.parent.doc,s=>{const o=n.doc;e.deleted||s.subdocsAdded.add(o),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ys{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return z(this.restDecoder)}readDsLen(){return z(this.restDecoder)}}class Gs extends Ys{readLeftID(){return X(z(this.restDecoder),z(this.restDecoder))}readRightID(){return X(z(this.restDecoder),z(this.restDecoder))}readClient(){return z(this.restDecoder)}readInfo(){return lt(this.restDecoder)}readString(){return We(this.restDecoder)}readParentInfo(){return z(this.restDecoder)===1}readTypeRef(){return z(this.restDecoder)}readLen(){return z(this.restDecoder)}readAny(){return kt(this.restDecoder)}readBuf(){return Go(ue(this.restDecoder))}readJSON(){return JSON.parse(We(this.restDecoder))}readKey(){return We(this.restDecoder)}}class ca{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=z(this.restDecoder),this.dsCurrVal}readDsLen(){const e=z(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Rt extends ca{constructor(e){super(e),this.keys=[],z(e),this.keyClockDecoder=new $n(ue(e)),this.clientDecoder=new dn(ue(e)),this.leftClockDecoder=new $n(ue(e)),this.rightClockDecoder=new $n(ue(e)),this.infoDecoder=new Wr(ue(e),lt),this.stringDecoder=new vo(ue(e)),this.parentInfoDecoder=new Wr(ue(e),lt),this.typeRefDecoder=new dn(ue(e)),this.lenDecoder=new dn(ue(e))}readLeftID(){return new _t(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new _t(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return kt(this.restDecoder)}readBuf(){return ue(this.restDecoder)}readJSON(){return kt(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Js{constructor(){this.restEncoder=he()}toUint8Array(){return re(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){V(this.restEncoder,e)}writeDsLen(e){V(this.restEncoder,e)}}class tn extends Js{writeLeftID(e){V(this.restEncoder,e.client),V(this.restEncoder,e.clock)}writeRightID(e){V(this.restEncoder,e.client),V(this.restEncoder,e.clock)}writeClient(e){V(this.restEncoder,e)}writeInfo(e){Yt(this.restEncoder,e)}writeString(e){Le(this.restEncoder,e)}writeParentInfo(e){V(this.restEncoder,e?1:0)}writeTypeRef(e){V(this.restEncoder,e)}writeLen(e){V(this.restEncoder,e)}writeAny(e){Et(this.restEncoder,e)}writeBuf(e){ie(this.restEncoder,e)}writeJSON(e){Le(this.restEncoder,JSON.stringify(e))}writeKey(e){Le(this.restEncoder,e)}}class Ks{constructor(){this.restEncoder=he(),this.dsCurrVal=0}toUint8Array(){return re(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,V(this.restEncoder,n)}writeDsLen(e){e===0&&Ue(),V(this.restEncoder,e-1),this.dsCurrVal+=e}}class ut extends Ks{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Bn,this.clientEncoder=new hn,this.leftClockEncoder=new Bn,this.rightClockEncoder=new Bn,this.infoEncoder=new $r(Yt),this.stringEncoder=new fo,this.parentInfoEncoder=new $r(Yt),this.typeRefEncoder=new hn,this.lenEncoder=new hn}toUint8Array(){const e=he();return V(e,0),ie(e,this.keyClockEncoder.toUint8Array()),ie(e,this.clientEncoder.toUint8Array()),ie(e,this.leftClockEncoder.toUint8Array()),ie(e,this.rightClockEncoder.toUint8Array()),ie(e,re(this.infoEncoder)),ie(e,this.stringEncoder.toUint8Array()),ie(e,re(this.parentInfoEncoder)),ie(e,this.typeRefEncoder.toUint8Array()),ie(e,this.lenEncoder.toUint8Array()),Rn(e,re(this.restEncoder)),re(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Et(this.restEncoder,e)}writeBuf(e){ie(this.restEncoder,e)}writeJSON(e){Et(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const ua=(t,e,n,s)=>{s=ft(s,e[0].id.clock);const o=Fe(e,s);V(t.restEncoder,e.length-o),t.writeClient(n),V(t.restEncoder,s);const i=e[o];i.write(t,s-i.id.clock);for(let u=o+1;u<e.length;u++)e[u].write(t,0)},Sr=(t,e,n)=>{const s=new Map;n.forEach((o,i)=>{de(e,i)>o&&s.set(i,o)}),In(e).forEach((o,i)=>{n.has(i)||s.set(i,0)}),V(t.restEncoder,s.size),Ve(s.entries()).sort((o,i)=>i[0]-o[0]).forEach(([o,i])=>{ua(t,e.clients.get(o),o,i)})},ha=(t,e)=>{const n=we(),s=z(t.restDecoder);for(let o=0;o<s;o++){const i=z(t.restDecoder),u=new Array(i),c=t.readClient();let l=z(t.restDecoder);n.set(c,{i:0,refs:u});for(let p=0;p<i;p++){const w=t.readInfo();switch(Tn&w){case 0:{const h=t.readLen();u[p]=new ve(X(c,l),h),l+=h;break}case 10:{const h=z(t.restDecoder);u[p]=new Ce(X(c,l),h),l+=h;break}default:{const h=(w&(Pe|_e))===0,g=new ae(X(c,l),null,(w&_e)===_e?t.readLeftID():null,null,(w&Pe)===Pe?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(w&Ht)===Ht?t.readString():null,vi(t,w));u[p]=g,l+=g.length}}}}return n},da=(t,e,n)=>{const s=[];let o=Ve(n.keys()).sort((m,y)=>m-y);if(o.length===0)return null;const i=()=>{if(o.length===0)return null;let m=n.get(o[o.length-1]);for(;m.refs.length===m.i;)if(o.pop(),o.length>0)m=n.get(o[o.length-1]);else return null;return m};let u=i();if(u===null)return null;const c=new ti,l=new Map,p=(m,y)=>{const C=l.get(m);(C==null||C>y)&&l.set(m,y)};let w=u.refs[u.i++];const h=new Map,g=()=>{for(const m of s){const y=m.id.client,C=n.get(y);C?(C.i--,c.clients.set(y,C.refs.slice(C.i)),n.delete(y),C.i=0,C.refs=[]):c.clients.set(y,[m]),o=o.filter(M=>M!==y)}s.length=0};for(;;){if(w.constructor!==Ce){const y=Se(h,w.id.client,()=>de(e,w.id.client))-w.id.clock;if(y<0)s.push(w),p(w.id.client,w.id.clock-1),g();else{const C=w.getMissing(t,e);if(C!==null){s.push(w);const M=n.get(C)||{refs:[],i:0};if(M.refs.length===M.i)p(C,de(e,C)),g();else{w=M.refs[M.i++];continue}}else(y===0||y<w.length)&&(w.integrate(t,y),h.set(w.id.client,w.id.clock+w.length))}}if(s.length>0)w=s.pop();else if(u!==null&&u.i<u.refs.length)w=u.refs[u.i++];else{if(u=i(),u===null)break;w=u.refs[u.i++]}}if(c.clients.size>0){const m=new ut;return Sr(m,c,new Map),V(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},fa=(t,e)=>Sr(t,e.doc.store,e.beforeState),ga=(t,e,n,s=new Rt(t))=>ee(e,o=>{o.local=!1;let i=!1;const u=o.doc,c=u.store,l=ha(s,u),p=da(o,c,l),w=c.pendingStructs;if(w){for(const[g,m]of w.missing)if(m<de(c,g)){i=!0;break}if(p){for(const[g,m]of p.missing){const y=w.missing.get(g);(y==null||y>m)&&w.missing.set(g,m)}w.update=pn([w.update,p.update])}}else c.pendingStructs=p;const h=Kr(s,o,c);if(c.pendingDs){const g=new Rt($e(c.pendingDs));z(g.restDecoder);const m=Kr(g,o,c);h&&m?c.pendingDs=pn([h,m]):c.pendingDs=h||m}else c.pendingDs=h;if(i){const g=c.pendingStructs.update;c.pendingStructs=null,Xs(o.doc,g)}},n,!1),Xs=(t,e,n,s=Rt)=>{const o=$e(e);ga(o,t,n,new s(o))},pa=(t,e,n)=>Xs(t,e,n,Gs),ya=(t,e,n=new Map)=>{Sr(t,e.store,n),It(t,la(e.store))},ma=(t,e=new Uint8Array([0]),n=new ut)=>{const s=Zs(e);ya(n,t,s);const o=[n.toUint8Array()];if(t.store.pendingDs&&o.push(t.store.pendingDs),t.store.pendingStructs&&o.push(Oa(t.store.pendingStructs.update,e)),o.length>1){if(n.constructor===tn)return Ia(o.map((i,u)=>u===0?i:Ma(i)));if(n.constructor===ut)return pn(o)}return o[0]},wa=(t,e)=>ma(t,e,new tn),ba=t=>{const e=new Map,n=z(t.restDecoder);for(let s=0;s<n;s++){const o=z(t.restDecoder),i=z(t.restDecoder);e.set(o,i)}return e},Zs=t=>ba(new Ys($e(t))),Qs=(t,e)=>(V(t.restEncoder,e.size),Ve(e.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{V(t.restEncoder,n),V(t.restEncoder,s)}),t),_a=(t,e)=>Qs(t,In(e.store)),Sa=(t,e=new Ks)=>(t instanceof Map?Qs(e,t):_a(e,t),e.toUint8Array()),va=t=>Sa(t,new Js);class Ca{constructor(){this.l=[]}}const Xr=()=>new Ca,Zr=(t,e)=>t.l.push(e),Qr=(t,e)=>{const n=t.l,s=n.length;t.l=n.filter(o=>e!==o),s===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ei=(t,e,n)=>yr(t.l,[e,n]);class _t{constructor(e,n){this.client=e,this.clock=n}}const on=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,X=(t,e)=>new _t(t,e),Ea=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ue()},bt=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Hs(e.ds,t.id),tr=(t,e)=>{const n=Se(t.meta,tr,et),s=t.doc.store;n.has(e)||(e.sv.forEach((o,i)=>{o<de(s,i)&&tt(t,X(i,o))}),qs(t,e.ds,o=>{}),n.add(e))};class ti{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const In=t=>{const e=new Map;return t.clients.forEach((n,s)=>{const o=n[n.length-1];e.set(s,o.id.clock+o.length)}),e},de=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const s=n[n.length-1];return s.id.clock+s.length},ni=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const s=n[n.length-1];if(s.id.clock+s.length!==e.id.clock)throw Ue()}n.push(e)},Fe=(t,e)=>{let n=0,s=t.length-1,o=t[s],i=o.id.clock;if(i===e)return s;let u=Ne(e/(i+o.length-1)*s);for(;n<=s;){if(o=t[u],i=o.id.clock,i<=e){if(e<i+o.length)return u;n=u+1}else s=u-1;u=Ne((n+s)/2)}throw Ue()},ka=(t,e)=>{const n=t.clients.get(e.client);return n[Fe(n,e.clock)]},Wn=ka,nr=(t,e,n)=>{const s=Fe(e,n),o=e[s];return o.id.clock<n&&o instanceof ae?(e.splice(s+1,0,Sn(t,o,n-o.id.clock)),s+1):s},tt=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[nr(t,n,e.clock)]},es=(t,e,n)=>{const s=e.clients.get(n.client),o=Fe(s,n.clock),i=s[o];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ve&&s.splice(o+1,0,Sn(t,i,n.clock-i.id.clock+1)),i},Ta=(t,e,n)=>{const s=t.clients.get(e.id.client);s[Fe(s,e.id.clock)]=n},ri=(t,e,n,s,o)=>{if(s===0)return;const i=n+s;let u=nr(t,e,n),c;do c=e[u++],i<c.id.clock+c.length&&nr(t,e,i),o(c);while(u<e.length&&e[u].id.clock<i)};class Ra{constructor(e,n,s){this.doc=e,this.deleteSet=new en,this.beforeState=In(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ts=(t,e)=>e.deleteSet.clients.size===0&&!qi(e.afterState,(n,s)=>e.beforeState.get(s)!==n)?!1:(br(e.deleteSet),fa(t,e),It(t,e.deleteSet),!0),ns=(t,e,n)=>{const s=e._item;(s===null||s.id.clock<(t.beforeState.get(s.id.client)||0)&&!s.deleted)&&Se(t.changed,e,et).add(n)},fn=(t,e)=>{let n=t[e],s=t[e-1],o=e;for(;o>0;n=s,s=t[--o-1]){if(s.deleted===n.deleted&&s.constructor===n.constructor&&s.mergeWith(n)){n instanceof ae&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,s);continue}break}const i=e-o;return i&&t.splice(e+1-i,i),i},Da=(t,e,n)=>{for(const[s,o]of t.clients.entries()){const i=e.clients.get(s);for(let u=o.length-1;u>=0;u--){const c=o[u],l=c.clock+c.len;for(let p=Fe(i,c.clock),w=i[p];p<i.length&&w.id.clock<l;w=i[++p]){const h=i[p];if(c.clock+c.len<=h.id.clock)break;h instanceof ae&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},Aa=(t,e)=>{t.clients.forEach((n,s)=>{const o=e.clients.get(s);for(let i=n.length-1;i>=0;i--){const u=n[i],c=cr(o.length-1,1+Fe(o,u.clock+u.len-1));for(let l=c,p=o[l];l>0&&p.id.clock>=u.clock;p=o[l])l-=1+fn(o,l)}})},si=(t,e)=>{if(e<t.length){const n=t[e],s=n.doc,o=s.store,i=n.deleteSet,u=n._mergeStructs;try{br(i),n.afterState=In(n.doc.store),s.emit("beforeObserverCalls",[n,s]);const c=[];n.changed.forEach((l,p)=>c.push(()=>{(p._item===null||!p._item.deleted)&&p._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,p)=>{p._dEH.l.length>0&&(p._item===null||!p._item.deleted)&&(l=l.filter(w=>w.target._item===null||!w.target._item.deleted),l.forEach(w=>{w.currentTarget=p,w._path=null}),l.sort((w,h)=>w.path.length-h.path.length),ei(p._dEH,l,n))})}),c.push(()=>s.emit("afterTransaction",[n,s])),yr(c,[]),n._needFormattingCleanup&&Ja(n)}finally{s.gc&&Da(i,o,s.gcFilter),Aa(i,o),n.afterState.forEach((w,h)=>{const g=n.beforeState.get(h)||0;if(g!==w){const m=o.clients.get(h),y=ft(Fe(m,g),1);for(let C=m.length-1;C>=y;)C-=1+fn(m,C)}});for(let w=u.length-1;w>=0;w--){const{client:h,clock:g}=u[w].id,m=o.clients.get(h),y=Fe(m,g);y+1<m.length&&fn(m,y+1)>1||y>0&&fn(m,y)}if(!n.local&&n.afterState.get(s.clientID)!==n.beforeState.get(s.clientID)&&(Ps(An,Ee,"[yjs] ",ct,Bs,"Changed the client-id because another client seems to be using it."),s.clientID=zs()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const w=new tn;ts(w,n)&&s.emit("update",[w.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const w=new ut;ts(w,n)&&s.emit("updateV2",[w.toUint8Array(),n.origin,s,n])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:p}=n;(c.size>0||p.size>0||l.size>0)&&(c.forEach(w=>{w.clientID=s.clientID,w.collectionid==null&&(w.collectionid=s.collectionid),s.subdocs.add(w)}),p.forEach(w=>s.subdocs.delete(w)),s.emit("subdocs",[{loaded:l,added:c,removed:p},s,n]),p.forEach(w=>w.destroy())),t.length<=e+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,t])):si(t,e+1)}}},ee=(t,e,n=null,s=!0)=>{const o=t._transactionCleanups;let i=!1,u=null;t._transaction===null&&(i=!0,t._transaction=new Ra(t,n,s),o.push(t._transaction),o.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{u=e(t._transaction)}finally{if(i){const c=t._transaction===o[0];t._transaction=null,c&&si(o,0)}}return u};function*xa(t){const e=z(t.restDecoder);for(let n=0;n<e;n++){const s=z(t.restDecoder),o=t.readClient();let i=z(t.restDecoder);for(let u=0;u<s;u++){const c=t.readInfo();if(c===10){const l=z(t.restDecoder);yield new Ce(X(o,i),l),i+=l}else if(Tn&c){const l=(c&(Pe|_e))===0,p=new ae(X(o,i),null,(c&_e)===_e?t.readLeftID():null,null,(c&Pe)===Pe?t.readRightID():null,l?t.readParentInfo()?t.readString():t.readLeftID():null,l&&(c&Ht)===Ht?t.readString():null,vi(t,c));yield p,i+=p.length}else{const l=t.readLen();yield new ve(X(o,i),l),i+=l}}}}class vr{constructor(e,n){this.gen=xa(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ce);return this.curr}}class Cr{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Ia=t=>pn(t,Gs,tn),La=(t,e)=>{if(t.constructor===ve){const{client:n,clock:s}=t.id;return new ve(X(n,s+e),t.length-e)}else if(t.constructor===Ce){const{client:n,clock:s}=t.id;return new Ce(X(n,s+e),t.length-e)}else{const n=t,{client:s,clock:o}=n.id;return new ae(X(s,o+e),null,X(s,o+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},pn=(t,e=Rt,n=ut)=>{if(t.length===1)return t[0];const s=t.map(w=>new e($e(w)));let o=s.map(w=>new vr(w,!0)),i=null;const u=new n,c=new Cr(u);for(;o=o.filter(g=>g.curr!==null),o.sort((g,m)=>{if(g.curr.id.client===m.curr.id.client){const y=g.curr.id.clock-m.curr.id.clock;return y===0?g.curr.constructor===m.curr.constructor?0:g.curr.constructor===Ce?1:-1:y}else return m.curr.id.client-g.curr.id.client}),o.length!==0;){const w=o[0],h=w.curr.id.client;if(i!==null){let g=w.curr,m=!1;for(;g!==null&&g.id.clock+g.length<=i.struct.id.clock+i.struct.length&&g.id.client>=i.struct.id.client;)g=w.next(),m=!0;if(g===null||g.id.client!==h||m&&g.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Ze(c,i.struct,i.offset),i={struct:g,offset:0},w.next();else if(i.struct.id.clock+i.struct.length<g.id.clock)if(i.struct.constructor===Ce)i.struct.length=g.id.clock+g.length-i.struct.id.clock;else{Ze(c,i.struct,i.offset);const y=g.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Ce(X(h,i.struct.id.clock+i.struct.length),y),offset:0}}else{const y=i.struct.id.clock+i.struct.length-g.id.clock;y>0&&(i.struct.constructor===Ce?i.struct.length-=y:g=La(g,y)),i.struct.mergeWith(g)||(Ze(c,i.struct,i.offset),i={struct:g,offset:0},w.next())}}else i={struct:w.curr,offset:0},w.next();for(let g=w.curr;g!==null&&g.id.client===h&&g.id.clock===i.struct.id.clock+i.struct.length&&g.constructor!==Ce;g=w.next())Ze(c,i.struct,i.offset),i={struct:g,offset:0}}i!==null&&(Ze(c,i.struct,i.offset),i=null),Er(c);const l=s.map(w=>_r(w)),p=oa(l);return It(u,p),u.toUint8Array()},Oa=(t,e,n=Rt,s=ut)=>{const o=Zs(e),i=new s,u=new Cr(i),c=new n($e(t)),l=new vr(c,!1);for(;l.curr;){const w=l.curr,h=w.id.client,g=o.get(h)||0;if(l.curr.constructor===Ce){l.next();continue}if(w.id.clock+w.length>g)for(Ze(u,w,ft(g-w.id.clock,0)),l.next();l.curr&&l.curr.id.client===h;)Ze(u,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===h&&l.curr.id.clock+l.curr.length<=g;)l.next()}Er(u);const p=_r(c);return It(i,p),i.toUint8Array()},ii=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:re(t.encoder.restEncoder)}),t.encoder.restEncoder=he(),t.written=0)},Ze=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&ii(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),V(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Er=t=>{ii(t);const e=t.encoder.restEncoder;V(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const s=t.clientStructs[n];V(e,s.written),Rn(e,s.restEncoder)}},Na=(t,e,n,s)=>{const o=new n($e(t)),i=new vr(o,!1),u=new s,c=new Cr(u);for(let p=i.curr;p!==null;p=i.next())Ze(c,e(p),0);Er(c);const l=_r(o);return It(u,l),u.toUint8Array()},Ma=t=>Na(t,Fo,Rt,tn),rs="You must not compute changes after the event-handler fired.";class Ln{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ua(this.currentTarget,this.target))}deletes(e){return Hs(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(rs);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(o=>{if(o!==null){const i=n._map.get(o);let u,c;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))u="delete",c=Mn(l.content.getContent());else return;else l!==null&&this.deletes(l)?(u="update",c=Mn(l.content.getContent())):(u="add",c=void 0)}else if(this.deletes(i))u="delete",c=Mn(i.content.getContent());else return;e.set(o,{action:u,oldValue:c})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(rs);const n=this.target,s=et(),o=et(),i=[];if(e={added:s,deleted:o,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const l=()=>{c&&i.push(c)};for(let p=n._start;p!==null;p=p.right)p.deleted?this.deletes(p)&&!this.adds(p)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=p.length,o.add(p)):this.adds(p)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(p.content.getContent()),s.add(p)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=p.length);c!==null&&c.retain===void 0&&l()}this._changes=e}return e}}const Ua=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let s=0,o=e._item.parent._start;for(;o!==e._item&&o!==null;)!o.deleted&&o.countable&&(s+=o.length),o=o.right;n.unshift(s)}e=e._item.parent}return n},ye=()=>{na("Invalid access: Add Yjs type to a document before reading data.")},oi=80;let kr=0;class Fa{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=kr++}}const Ba=t=>{t.timestamp=kr++},ai=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=kr++},$a=(t,e,n)=>{if(t.length>=oi){const s=t.reduce((o,i)=>o.timestamp<i.timestamp?o:i);return ai(s,e,n),s}else{const s=new Fa(e,n);return t.push(s),s}},On=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,u)=>un(e-i.index)<un(e-u.index)?i:u);let s=t._start,o=0;for(n!==null&&(s=n.p,o=n.index,Ba(n));s.right!==null&&o<e;){if(!s.deleted&&s.countable){if(e<o+s.length)break;o+=s.length}s=s.right}for(;s.left!==null&&o>e;)s=s.left,!s.deleted&&s.countable&&(o-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(o-=s.length);return n!==null&&un(n.index-o)<s.parent.length/oi?(ai(n,s,o),n):$a(t._searchMarker,s,o)},Jt=(t,e,n)=>{for(let s=t.length-1;s>=0;s--){const o=t[s];if(n>0){let i=o.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(o.index-=i.length);if(i===null||i.marker===!0){t.splice(s,1);continue}o.p=i,i.marker=!0}(e<o.index||n>0&&e===o.index)&&(o.index=ft(e,o.index+n))}},Nn=(t,e,n)=>{const s=t,o=e.changedParentTypes;for(;Se(o,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;ei(s._eH,n,e)};class pe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xr(),this._dEH=Xr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Oe()}clone(){throw Oe()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Zr(this._eH,e)}observeDeep(e){Zr(this._dEH,e)}unobserve(e){Qr(this._eH,e)}unobserveDeep(e){Qr(this._dEH,e)}toJSON(){}}const li=(t,e,n)=>{t.doc??ye(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let s=n-e;const o=[];let i=t._start;for(;i!==null&&s>0;){if(i.countable&&!i.deleted){const u=i.content.getContent();if(u.length<=e)e-=u.length;else{for(let c=e;c<u.length&&s>0;c++)o.push(u[c]),s--;e=0}}i=i.right}return o},ci=t=>{t.doc??ye();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let o=0;o<s.length;o++)e.push(s[o])}n=n.right}return e},Kt=(t,e)=>{let n=0,s=t._start;for(t.doc??ye();s!==null;){if(s.countable&&!s.deleted){const o=s.content.getContent();for(let i=0;i<o.length;i++)e(o[i],n++,t)}s=s.right}},ui=(t,e)=>{const n=[];return Kt(t,(s,o)=>{n.push(e(s,o,t))}),n},ja=t=>{let e=t._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),s=0,e=e.right}const o=n[s++];return n.length<=s&&(n=null),{done:!1,value:o}}}},hi=(t,e)=>{t.doc??ye();const n=On(t,e);let s=t._start;for(n!==null&&(s=n.p,e-=n.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(e<s.length)return s.content.getContent()[e];e-=s.length}},yn=(t,e,n,s)=>{let o=n;const i=t.doc,u=i.clientID,c=i.store,l=n===null?e._start:n.right;let p=[];const w=()=>{p.length>0&&(o=new ae(X(u,de(c,u)),o,o&&o.lastId,l,l&&l.id,e,null,new dt(p)),o.integrate(t,0),p=[])};s.forEach(h=>{if(h===null)p.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:p.push(h);break;default:switch(w(),h.constructor){case Uint8Array:case ArrayBuffer:o=new ae(X(u,de(c,u)),o,o&&o.lastId,l,l&&l.id,e,null,new nn(new Uint8Array(h))),o.integrate(t,0);break;case Lt:o=new ae(X(u,de(c,u)),o,o&&o.lastId,l,l&&l.id,e,null,new rn(h)),o.integrate(t,0);break;default:if(h instanceof pe)o=new ae(X(u,de(c,u)),o,o&&o.lastId,l,l&&l.id,e,null,new ze(h)),o.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),w()},di=()=>Me("Length exceeded!"),fi=(t,e,n,s)=>{if(n>e._length)throw di();if(n===0)return e._searchMarker&&Jt(e._searchMarker,n,s.length),yn(t,e,null,s);const o=n,i=On(e,n);let u=e._start;for(i!==null&&(u=i.p,n-=i.index,n===0&&(u=u.prev,n+=u&&u.countable&&!u.deleted?u.length:0));u!==null;u=u.right)if(!u.deleted&&u.countable){if(n<=u.length){n<u.length&&tt(t,X(u.id.client,u.id.clock+n));break}n-=u.length}return e._searchMarker&&Jt(e._searchMarker,o,s.length),yn(t,e,u,s)},Pa=(t,e,n)=>{let o=(e._searchMarker||[]).reduce((i,u)=>u.index>i.index?u:i,{index:0,p:e._start}).p;if(o)for(;o.right;)o=o.right;return yn(t,e,o,n)},gi=(t,e,n,s)=>{if(s===0)return;const o=n,i=s,u=On(e,n);let c=e._start;for(u!==null&&(c=u.p,n-=u.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&tt(t,X(c.id.client,c.id.clock+n)),n-=c.length);for(;s>0&&c!==null;)c.deleted||(s<c.length&&tt(t,X(c.id.client,c.id.clock+s)),c.delete(t),s-=c.length),c=c.right;if(s>0)throw di();e._searchMarker&&Jt(e._searchMarker,o,-i+s)},mn=(t,e,n)=>{const s=e._map.get(n);s!==void 0&&s.delete(t)},Tr=(t,e,n,s)=>{const o=e._map.get(n)||null,i=t.doc,u=i.clientID;let c;if(s==null)c=new dt([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new dt([s]);break;case Uint8Array:c=new nn(s);break;case Lt:c=new rn(s);break;default:if(s instanceof pe)c=new ze(s);else throw new Error("Unexpected content type")}new ae(X(u,de(i.store,u)),o,o&&o.lastId,null,null,e,n,c).integrate(t,0)},Rr=(t,e)=>{t.doc??ye();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},pi=t=>{const e={};return t.doc??ye(),t._map.forEach((n,s)=>{n.deleted||(e[s]=n.content.getContent()[n.length-1])}),e},yi=(t,e)=>{t.doc??ye();const n=t._map.get(e);return n!==void 0&&!n.deleted},Wa=(t,e)=>{const n={};return t._map.forEach((s,o)=>{let i=s;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&bt(i,e)&&(n[o]=i.content.getContent()[i.length-1])}),n},an=t=>(t.doc??ye(),sa(t._map.entries(),e=>!e[1].deleted));class Va extends Ln{}class St extends pe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new St;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new St}clone(){const e=new St;return e.insert(0,this.toArray().map(n=>n instanceof pe?n.clone():n)),e}get length(){return this.doc??ye(),this._length}_callObserver(e,n){super._callObserver(e,n),Nn(this,e,new Va(this,e))}insert(e,n){this.doc!==null?ee(this.doc,s=>{fi(s,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ee(this.doc,n=>{Pa(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ee(this.doc,s=>{gi(s,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return hi(this,e)}toArray(){return ci(this)}slice(e=0,n=this.length){return li(this,e,n)}toJSON(){return this.map(e=>e instanceof pe?e.toJSON():e)}map(e){return ui(this,e)}forEach(e){Kt(this,e)}[Symbol.iterator](){return ja(this)}_write(e){e.writeTypeRef(gl)}}const qa=t=>new St;class Ha extends Ln{constructor(e,n,s){super(e,n),this.keysChanged=s}}class Dt extends pe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((s,o)=>{this.set(o,s)}),this._prelimContent=null}_copy(){return new Dt}clone(){const e=new Dt;return this.forEach((n,s)=>{e.set(s,n instanceof pe?n.clone():n)}),e}_callObserver(e,n){Nn(this,e,new Ha(this,e,n))}toJSON(){this.doc??ye();const e={};return this._map.forEach((n,s)=>{if(!n.deleted){const o=n.content.getContent()[n.length-1];e[s]=o instanceof pe?o.toJSON():o}}),e}get size(){return[...an(this)].length}keys(){return Pn(an(this),e=>e[0])}values(){return Pn(an(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Pn(an(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ye(),this._map.forEach((n,s)=>{n.deleted||e(n.content.getContent()[n.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ee(this.doc,n=>{mn(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ee(this.doc,s=>{Tr(s,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Rr(this,e)}has(e){return yi(this,e)}clear(){this.doc!==null?ee(this.doc,e=>{this.forEach(function(n,s,o){mn(e,o,s)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(pl)}}const za=t=>new Dt,Qe=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&No(t,e);class rr{constructor(e,n,s,o){this.left=e,this.right=n,this.index=s,this.currentAttributes=o}forward(){switch(this.right===null&&Ue(),this.right.content.constructor){case le:this.right.deleted||Ot(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ss=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case le:e.right.deleted||Ot(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&tt(t,X(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ln=(t,e,n,s)=>{const o=new Map,i=s?On(e,n):null;if(i){const u=new rr(i.p.left,i.p,i.index,o);return ss(t,u,n-i.index)}else{const u=new rr(null,e._start,0,o);return ss(t,u,n)}},mi=(t,e,n,s)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===le&&Qe(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const o=t.doc,i=o.clientID;s.forEach((u,c)=>{const l=n.left,p=n.right,w=new ae(X(i,de(o.store,i)),l,l&&l.lastId,p,p&&p.id,e,null,new le(c,u));w.integrate(t,0),n.right=w,n.forward()})},Ot=(t,e)=>{const{key:n,value:s}=e;s===null?t.delete(n):t.set(n,s)},wi=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===le&&Qe(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},bi=(t,e,n,s)=>{const o=t.doc,i=o.clientID,u=new Map;for(const c in s){const l=s[c],p=n.currentAttributes.get(c)??null;if(!Qe(p,l)){u.set(c,p);const{left:w,right:h}=n;n.right=new ae(X(i,de(o.store,i)),w,w&&w.lastId,h,h&&h.id,e,null,new le(c,l)),n.right.integrate(t,0),n.forward()}}return u},Vn=(t,e,n,s,o)=>{n.currentAttributes.forEach((g,m)=>{o[m]===void 0&&(o[m]=null)});const i=t.doc,u=i.clientID;wi(n,o);const c=bi(t,e,n,o),l=s.constructor===String?new Be(s):s instanceof pe?new ze(s):new gt(s);let{left:p,right:w,index:h}=n;e._searchMarker&&Jt(e._searchMarker,n.index,l.getLength()),w=new ae(X(u,de(i.store,u)),p,p&&p.lastId,w,w&&w.id,e,null,l),w.integrate(t,0),n.right=w,n.index=h,n.forward(),mi(t,e,n,c)},is=(t,e,n,s,o)=>{const i=t.doc,u=i.clientID;wi(n,o);const c=bi(t,e,n,o);e:for(;n.right!==null&&(s>0||c.size>0&&(n.right.deleted||n.right.content.constructor===le));){if(!n.right.deleted)switch(n.right.content.constructor){case le:{const{key:l,value:p}=n.right.content,w=o[l];if(w!==void 0){if(Qe(w,p))c.delete(l);else{if(s===0)break e;c.set(l,p)}n.right.delete(t)}else n.currentAttributes.set(l,p);break}default:s<n.right.length&&tt(t,X(n.right.id.client,n.right.id.clock+s)),s-=n.right.length;break}n.forward()}if(s>0){let l="";for(;s>0;s--)l+=`
`;n.right=new ae(X(u,de(i.store,u)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Be(l)),n.right.integrate(t,0),n.forward()}mi(t,e,n,c)},_i=(t,e,n,s,o)=>{let i=e;const u=we();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===le){const p=i.content;u.set(p.key,p)}i=i.right}let c=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const p=e.content;switch(p.constructor){case le:{const{key:w,value:h}=p,g=s.get(w)??null;(u.get(w)!==p||g===h)&&(e.delete(t),c++,!l&&(o.get(w)??null)===h&&g!==h&&(g===null?o.delete(w):o.set(w,g))),!l&&!e.deleted&&Ot(o,p);break}}}e=e.right}return c},Ya=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===le){const s=e.content.key;n.has(s)?e.delete(t):n.add(s)}e=e.left}},Ga=t=>{let e=0;return ee(t.doc,n=>{let s=t._start,o=t._start,i=we();const u=Kn(i);for(;o;){if(o.deleted===!1)switch(o.content.constructor){case le:Ot(u,o.content);break;default:e+=_i(n,s,o,i,u),i=Kn(u),s=o;break}o=o.right}}),e},Ja=t=>{const e=new Set,n=t.doc;for(const[s,o]of t.afterState.entries()){const i=t.beforeState.get(s)||0;o!==i&&ri(t,n.store.clients.get(s),i,o,u=>{!u.deleted&&u.content.constructor===le&&u.constructor!==ve&&e.add(u.parent)})}ee(n,s=>{qs(t,t.deleteSet,o=>{if(o instanceof ve||!o.parent._hasFormatting||e.has(o.parent))return;const i=o.parent;o.content.constructor===le?e.add(i):Ya(s,o)});for(const o of e)Ga(o)})},os=(t,e,n)=>{const s=n,o=Kn(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ze:case gt:case Be:n<e.right.length&&tt(t,X(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&_i(t,i,e.right,o,e.currentAttributes);const u=(e.left||e.right).parent;return u._searchMarker&&Jt(u._searchMarker,e.index,-s+n),e};class Ka extends Ln{constructor(e,n,s){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(o=>{o===null?this.childListChanged=!0:this.keysChanged.add(o)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ee(e,s=>{const o=new Map,i=new Map;let u=this.target._start,c=null;const l={};let p="",w=0,h=0;const g=()=>{if(c!==null){let m=null;switch(c){case"delete":h>0&&(m={delete:h}),h=0;break;case"insert":(typeof p=="object"||p.length>0)&&(m={insert:p},o.size>0&&(m.attributes={},o.forEach((y,C)=>{y!==null&&(m.attributes[C]=y)}))),p="";break;case"retain":w>0&&(m={retain:w},Lo(l)||(m.attributes=xo({},l))),w=0;break}m&&n.push(m),c=null}};for(;u!==null;){switch(u.content.constructor){case ze:case gt:this.adds(u)?this.deletes(u)||(g(),c="insert",p=u.content.getContent()[0],g()):this.deletes(u)?(c!=="delete"&&(g(),c="delete"),h+=1):u.deleted||(c!=="retain"&&(g(),c="retain"),w+=1);break;case Be:this.adds(u)?this.deletes(u)||(c!=="insert"&&(g(),c="insert"),p+=u.content.str):this.deletes(u)?(c!=="delete"&&(g(),c="delete"),h+=u.length):u.deleted||(c!=="retain"&&(g(),c="retain"),w+=u.length);break;case le:{const{key:m,value:y}=u.content;if(this.adds(u)){if(!this.deletes(u)){const C=o.get(m)??null;Qe(C,y)?y!==null&&u.delete(s):(c==="retain"&&g(),Qe(y,i.get(m)??null)?delete l[m]:l[m]=y)}}else if(this.deletes(u)){i.set(m,y);const C=o.get(m)??null;Qe(C,y)||(c==="retain"&&g(),l[m]=C)}else if(!u.deleted){i.set(m,y);const C=l[m];C!==void 0&&(Qe(C,y)?C!==null&&u.delete(s):(c==="retain"&&g(),y===null?delete l[m]:l[m]=y))}u.deleted||(c==="insert"&&g(),Ot(o,u.content));break}}u=u.right}for(g();n.length>0;){const m=n[n.length-1];if(m.retain!==void 0&&m.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class At extends pe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ye(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new At}clone(){const e=new At;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const s=new Ka(this,e,n);Nn(this,e,s),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ye();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Be&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ee(this.doc,s=>{const o=new rr(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const u=e[i];if(u.insert!==void 0){const c=!n&&typeof u.insert=="string"&&i===e.length-1&&o.right===null&&u.insert.slice(-1)===`
`?u.insert.slice(0,-1):u.insert;(typeof c!="string"||c.length>0)&&Vn(s,this,o,c,u.attributes||{})}else u.retain!==void 0?is(s,this,o,u.retain,u.attributes||{}):u.delete!==void 0&&os(s,o,u.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,s){this.doc??ye();const o=[],i=new Map,u=this.doc;let c="",l=this._start;function p(){if(c.length>0){const h={};let g=!1;i.forEach((y,C)=>{g=!0,h[C]=y});const m={insert:c};g&&(m.attributes=h),o.push(m),c=""}}const w=()=>{for(;l!==null;){if(bt(l,e)||n!==void 0&&bt(l,n))switch(l.content.constructor){case Be:{const h=i.get("ychange");e!==void 0&&!bt(l,e)?(h===void 0||h.user!==l.id.client||h.type!=="removed")&&(p(),i.set("ychange",s?s("removed",l.id):{type:"removed"})):n!==void 0&&!bt(l,n)?(h===void 0||h.user!==l.id.client||h.type!=="added")&&(p(),i.set("ychange",s?s("added",l.id):{type:"added"})):h!==void 0&&(p(),i.delete("ychange")),c+=l.content.str;break}case ze:case gt:{p();const h={insert:l.content.getContent()[0]};if(i.size>0){const g={};h.attributes=g,i.forEach((m,y)=>{g[y]=m})}o.push(h);break}case le:bt(l,e)&&(p(),Ot(i,l.content));break}l=l.right}p()};return e||n?ee(u,h=>{e&&tr(h,e),n&&tr(h,n),w()},"cleanup"):w(),o}insert(e,n,s){if(n.length<=0)return;const o=this.doc;o!==null?ee(o,i=>{const u=ln(i,this,e,!s);s||(s={},u.currentAttributes.forEach((c,l)=>{s[l]=c})),Vn(i,this,u,n,s)}):this._pending.push(()=>this.insert(e,n,s))}insertEmbed(e,n,s){const o=this.doc;o!==null?ee(o,i=>{const u=ln(i,this,e,!s);Vn(i,this,u,n,s||{})}):this._pending.push(()=>this.insertEmbed(e,n,s||{}))}delete(e,n){if(n===0)return;const s=this.doc;s!==null?ee(s,o=>{os(o,ln(o,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,s){if(n===0)return;const o=this.doc;o!==null?ee(o,i=>{const u=ln(i,this,e,!1);u.right!==null&&is(i,this,u,n,s)}):this._pending.push(()=>this.format(e,n,s))}removeAttribute(e){this.doc!==null?ee(this.doc,n=>{mn(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ee(this.doc,s=>{Tr(s,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Rr(this,e)}getAttributes(){return pi(this)}_write(e){e.writeTypeRef(yl)}}const Xa=t=>new At;class qn{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ye()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===xt||n.constructor===ht)&&n._start!==null)e=n._start;else for(;e!==null;){const s=e.next;if(s!==null){e=s;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ht extends pe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ht}clone(){const e=new ht;return e.insert(0,this.toArray().map(n=>n instanceof pe?n.clone():n)),e}get length(){return this.doc??ye(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new qn(this,e)}querySelector(e){e=e.toUpperCase();const s=new qn(this,o=>o.nodeName&&o.nodeName.toUpperCase()===e).next();return s.done?null:s.value}querySelectorAll(e){return e=e.toUpperCase(),Ve(new qn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Nn(this,e,new el(this,n,e))}toString(){return ui(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},s){const o=e.createDocumentFragment();return s!==void 0&&s._createAssociation(o,this),Kt(this,i=>{o.insertBefore(i.toDOM(e,n,s),null)}),o}insert(e,n){this.doc!==null?ee(this.doc,s=>{fi(s,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ee(this.doc,s=>{const o=e&&e instanceof pe?e._item:e;yn(s,this,o,n)});else{const s=this._prelimContent,o=e===null?0:s.findIndex(i=>i===e)+1;if(o===0&&e!==null)throw Me("Reference item not found");s.splice(o,0,...n)}}delete(e,n=1){this.doc!==null?ee(this.doc,s=>{gi(s,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return ci(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return hi(this,e)}slice(e=0,n=this.length){return li(this,e,n)}forEach(e){Kt(this,e)}_write(e){e.writeTypeRef(wl)}}const Za=t=>new ht;class xt extends ht{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((s,o)=>{this.setAttribute(o,s)}),this._prelimAttrs=null}_copy(){return new xt(this.nodeName)}clone(){const e=new xt(this.nodeName),n=this.getAttributes();return Io(n,(s,o)=>{typeof s=="string"&&e.setAttribute(o,s)}),e.insert(0,this.toArray().map(s=>s instanceof pe?s.clone():s)),e}toString(){const e=this.getAttributes(),n=[],s=[];for(const c in e)s.push(c);s.sort();const o=s.length;for(let c=0;c<o;c++){const l=s[c];n.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),u=n.length>0?" "+n.join(" "):"";return`<${i}${u}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?ee(this.doc,n=>{mn(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ee(this.doc,s=>{Tr(s,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Rr(this,e)}hasAttribute(e){return yi(this,e)}getAttributes(e){return e?Wa(this,e):pi(this)}toDOM(e=document,n={},s){const o=e.createElement(this.nodeName),i=this.getAttributes();for(const u in i){const c=i[u];typeof c=="string"&&o.setAttribute(u,c)}return Kt(this,u=>{o.appendChild(u.toDOM(e,n,s))}),s!==void 0&&s._createAssociation(o,this),o}_write(e){e.writeTypeRef(ml),e.writeKey(this.nodeName)}}const Qa=t=>new xt(t.readKey());class el extends Ln{constructor(e,n,s){super(e,s),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(o=>{o===null?this.childListChanged=!0:this.attributesChanged.add(o)})}}class wn extends Dt{constructor(e){super(),this.hookName=e}_copy(){return new wn(this.hookName)}clone(){const e=new wn(this.hookName);return this.forEach((n,s)=>{e.set(s,n)}),e}toDOM(e=document,n={},s){const o=n[this.hookName];let i;return o!==void 0?i=o.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(i,this),i}_write(e){e.writeTypeRef(bl),e.writeKey(this.hookName)}}const tl=t=>new wn(t.readKey());class bn extends At{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new bn}clone(){const e=new bn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,s){const o=e.createTextNode(this.toString());return s!==void 0&&s._createAssociation(o,this),o}toString(){return this.toDelta().map(e=>{const n=[];for(const o in e.attributes){const i=[];for(const u in e.attributes[o])i.push({key:u,value:e.attributes[o][u]});i.sort((u,c)=>u.key<c.key?-1:1),n.push({nodeName:o,attrs:i})}n.sort((o,i)=>o.nodeName<i.nodeName?-1:1);let s="";for(let o=0;o<n.length;o++){const i=n[o];s+=`<${i.nodeName}`;for(let u=0;u<i.attrs.length;u++){const c=i.attrs[u];s+=` ${c.key}="${c.value}"`}s+=">"}s+=e.insert;for(let o=n.length-1;o>=0;o--)s+=`</${n[o].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(_l)}}const nl=t=>new bn;class Dr{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Oe()}mergeWith(e){return!1}write(e,n,s){throw Oe()}integrate(e,n){throw Oe()}}const rl=0;class ve extends Dr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ni(e.doc.store,this)}write(e,n){e.writeInfo(rl),e.writeLen(this.length-n)}getMissing(e,n){return null}}class nn{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new nn(this.content)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const sl=t=>new nn(t.readBuf());class Xt{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Xt(this.len)}splice(e){const n=new Xt(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){gn(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const il=t=>new Xt(t.readLen()),Si=(t,e)=>new Lt({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class rn{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new rn(Si(this.doc.guid,this.opts))}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ol=t=>new rn(Si(t.readString(),t.readAny()));class gt{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new gt(this.embed)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const al=t=>new gt(t.readJSON());class le{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new le(this.key,this.value)}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){const s=n.parent;s._searchMarker=null,s._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const ll=t=>new le(t.readKey(),t.readJSON());class _n{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _n(this.arr)}splice(e){const n=new _n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const s=this.arr.length;e.writeLen(s-n);for(let o=n;o<s;o++){const i=this.arr[o];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const cl=t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++){const o=t.readString();o==="undefined"?n.push(void 0):n.push(JSON.parse(o))}return new _n(n)},ul=Gt("node_env")==="development";class dt{constructor(e){this.arr=e,ul&&xs(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new dt(this.arr)}splice(e){const n=new dt(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const s=this.arr.length;e.writeLen(s-n);for(let o=n;o<s;o++){const i=this.arr[o];e.writeAny(i)}}getRef(){return 8}}const hl=t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++)n.push(t.readAny());return new dt(n)};class Be{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Be(this.str)}splice(e){const n=new Be(this.str.slice(e));this.str=this.str.slice(0,e);const s=this.str.charCodeAt(e-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const dl=t=>new Be(t.readString()),fl=[qa,za,Xa,Qa,Za,tl,nl],gl=0,pl=1,yl=2,ml=3,wl=4,bl=5,_l=6;class ze{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ze(this.type._copy())}splice(e){throw Oe()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(s=>{s.deleted?s.id.clock<(e.beforeState.get(s.id.client)||0)&&e._mergeStructs.push(s):s.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(e,!0),s=s.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Sl=t=>new ze(fl[t.readTypeRef()](t)),Sn=(t,e,n)=>{const{client:s,clock:o}=e.id,i=new ae(X(s,o+n),e,X(s,o+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=X(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class ae extends Dr{constructor(e,n,s,o,i,u,c,l){super(e,l.getLength()),this.origin=s,this.left=n,this.right=o,this.rightOrigin=i,this.parent=u,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?Ur:0}set marker(e){(this.info&Fn)>0!==e&&(this.info^=Fn)}get marker(){return(this.info&Fn)>0}get keep(){return(this.info&Mr)>0}set keep(e){this.keep!==e&&(this.info^=Mr)}get countable(){return(this.info&Ur)>0}get deleted(){return(this.info&Un)>0}set deleted(e){this.deleted!==e&&(this.info^=Un)}markDeleted(){this.info|=Un}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=de(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=de(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===_t&&this.id.client!==this.parent.client&&this.parent.clock>=de(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=es(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=tt(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ve||this.right&&this.right.constructor===ve)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ae?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ae&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===_t){const s=Wn(n,this.parent);s.constructor===ve?this.parent=null:this.parent=s.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=es(e,e.doc.store,X(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,o;if(s!==null)o=s.right;else if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start;const i=new Set,u=new Set;for(;o!==null&&o!==this.right;){if(u.add(o),i.add(o),on(this.origin,o.origin)){if(o.id.client<this.id.client)s=o,i.clear();else if(on(this.rightOrigin,o.rightOrigin))break}else if(o.origin!==null&&u.has(Wn(e.doc.store,o.origin)))i.has(Wn(e.doc.store,o.origin))||(s=o,i.clear());else break;o=o.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ni(e.doc.store,this),this.content.integrate(e,this),ns(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ve(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:X(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&on(e.origin,this.lastId)&&this.right===e&&on(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(s=>{s.p===e&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),gn(e.deleteSet,this.id.client,this.id.clock,this.length),ns(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ue();this.content.gc(e),n?Ta(e,this,new ve(this.id,this.length)):this.content=new Xt(this.length)}write(e,n){const s=n>0?X(this.id.client,this.id.clock+n-1):this.origin,o=this.rightOrigin,i=this.parentSub,u=this.content.getRef()&Tn|(s===null?0:_e)|(o===null?0:Pe)|(i===null?0:Ht);if(e.writeInfo(u),s!==null&&e.writeLeftID(s),o!==null&&e.writeRightID(o),s===null&&o===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const p=Ea(c);e.writeParentInfo(!0),e.writeString(p)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else c.constructor===String?(e.writeParentInfo(!0),e.writeString(c)):c.constructor===_t?(e.writeParentInfo(!1),e.writeLeftID(c)):Ue();i!==null&&e.writeString(i)}this.content.write(e,n)}}const vi=(t,e)=>vl[e&Tn](t),vl=[()=>{Ue()},il,cl,sl,dl,al,ll,Sl,hl,ol,()=>{Ue()}],Cl=10;class Ce extends Dr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Ue()}write(e,n){e.writeInfo(Cl),V(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Ei="__ $YJS$ __";Ci[Ei]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ci[Ei]=!0;const El=1200,kl=2500,vn=3e4,sr=t=>{if(t.shouldConnect&&t.ws===null){const e=new WebSocket(t.url),n=t.binaryType;let s=null;n&&(e.binaryType=n),t.ws=e,t.connecting=!0,t.connected=!1,e.onmessage=u=>{t.lastMessageReceived=qe();const c=u.data,l=typeof c=="string"?JSON.parse(c):c;l&&l.type==="pong"&&(clearTimeout(s),s=setTimeout(i,vn/2)),t.emit("message",[l,t])};const o=u=>{t.ws!==null&&(t.ws=null,t.connecting=!1,t.connected?(t.connected=!1,t.emit("disconnect",[{type:"disconnect",error:u},t])):t.unsuccessfulReconnects++,setTimeout(sr,cr(Yi(t.unsuccessfulReconnects+1)*El,kl),t)),clearTimeout(s)},i=()=>{t.ws===e&&t.send({type:"ping"})};e.onclose=()=>o(null),e.onerror=u=>o(u),e.onopen=()=>{t.lastMessageReceived=qe(),t.connecting=!1,t.connected=!0,t.unsuccessfulReconnects=0,t.emit("connect",[{type:"connect"},t]),s=setTimeout(i,vn/2)}}};class Tl extends bs{constructor(e,{binaryType:n}={}){super(),this.url=e,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&vn<qe()-this.lastMessageReceived&&this.ws.close()},vn/2),sr(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&sr(this)}}const ki=new Map;class Rl{constructor(e){this.room=e,this.onmessage=null,this._onChange=n=>n.key===e&&this.onmessage!==null&&this.onmessage({data:Ms(n.newValue||"")}),Do(this._onChange)}postMessage(e){Rs.setItem(this.room,Ns(Vo(e)))}close(){Ao(this._onChange)}}const Dl=typeof BroadcastChannel>"u"?Rl:BroadcastChannel,Ar=t=>Se(ki,t,()=>{const e=et(),n=new Dl(t);return n.onmessage=s=>e.forEach(o=>o(s.data,"broadcastchannel")),{bc:n,subs:e}}),Al=(t,e)=>(Ar(t).subs.add(e),e),xl=(t,e)=>{const n=Ar(t),s=n.subs.delete(e);return s&&n.subs.size===0&&(n.bc.close(),ki.delete(t)),s},Il=(t,e,n=null)=>{const s=Ar(t);s.bc.postMessage(e),s.subs.forEach(o=>o(e,n))},Ll=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else n!==void 0&&n()}};var Ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ol(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function cn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ti={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){var n=Math.floor,s=Math.abs,o=Math.pow;return function(){function i(u,c,l){function p(g,m){if(!c[g]){if(!u[g]){var y=typeof cn=="function"&&cn;if(!m&&y)return y(g,!0);if(w)return w(g,!0);var C=new Error("Cannot find module '"+g+"'");throw C.code="MODULE_NOT_FOUND",C}var M=c[g]={exports:{}};u[g][0].call(M.exports,function(L){var T=u[g][1][L];return p(T||L)},M,M.exports,i,u,c,l)}return c[g].exports}for(var w=typeof cn=="function"&&cn,h=0;h<l.length;h++)p(l[h]);return p}return i}()({1:[function(i,u,c){function l(_){var S=_.length;if(0<S%4)throw new Error("Invalid string. Length must be a multiple of 4");var R=_.indexOf("=");R===-1&&(R=S);var v=R===S?0:4-R%4;return[R,v]}function p(_,S,R){return 3*(S+R)/4-R}function w(_){var S,R,v=l(_),D=v[0],U=v[1],E=new M(p(_,D,U)),x=0,F=0<U?D-4:D;for(R=0;R<F;R+=4)S=C[_.charCodeAt(R)]<<18|C[_.charCodeAt(R+1)]<<12|C[_.charCodeAt(R+2)]<<6|C[_.charCodeAt(R+3)],E[x++]=255&S>>16,E[x++]=255&S>>8,E[x++]=255&S;return U===2&&(S=C[_.charCodeAt(R)]<<2|C[_.charCodeAt(R+1)]>>4,E[x++]=255&S),U===1&&(S=C[_.charCodeAt(R)]<<10|C[_.charCodeAt(R+1)]<<4|C[_.charCodeAt(R+2)]>>2,E[x++]=255&S>>8,E[x++]=255&S),E}function h(_){return y[63&_>>18]+y[63&_>>12]+y[63&_>>6]+y[63&_]}function g(_,S,R){for(var v,D=[],U=S;U<R;U+=3)v=(16711680&_[U]<<16)+(65280&_[U+1]<<8)+(255&_[U+2]),D.push(h(v));return D.join("")}function m(_){for(var S,R=_.length,v=R%3,D=[],U=16383,E=0,x=R-v;E<x;E+=U)D.push(g(_,E,E+U>x?x:E+U));return v===1?(S=_[R-1],D.push(y[S>>2]+y[63&S<<4]+"==")):v===2&&(S=(_[R-2]<<8)+_[R-1],D.push(y[S>>10]+y[63&S>>4]+y[63&S<<2]+"=")),D.join("")}c.byteLength=function(_){var S=l(_),R=S[0],v=S[1];return 3*(R+v)/4-v},c.toByteArray=w,c.fromByteArray=m;for(var y=[],C=[],M=typeof Uint8Array>"u"?Array:Uint8Array,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=0,f=L.length;T<f;++T)y[T]=L[T],C[L.charCodeAt(T)]=T;C[45]=62,C[95]=63},{}],2:[function(){},{}],3:[function(i,u,c){(function(){(function(){var l=String.fromCharCode,p=Math.min;function w(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var a=new Uint8Array(r);return a.__proto__=h.prototype,a}function h(r,a,d){if(typeof r=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(r)}return g(r,a,d)}function g(r,a,d){if(typeof r=="string")return M(r,a);if(ArrayBuffer.isView(r))return L(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(I(r,ArrayBuffer)||r&&I(r.buffer,ArrayBuffer))return T(r,a,d);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var k=r.valueOf&&r.valueOf();if(k!=null&&k!==r)return h.from(k,a,d);var A=f(r);if(A)return A;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return h.from(r[Symbol.toPrimitive]("string"),a,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function m(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function y(r,a,d){return m(r),0>=r||a===void 0?w(r):typeof d=="string"?w(r).fill(a,d):w(r).fill(a)}function C(r){return m(r),w(0>r?0:0|_(r))}function M(r,a){if((typeof a!="string"||a==="")&&(a="utf8"),!h.isEncoding(a))throw new TypeError("Unknown encoding: "+a);var d=0|S(r,a),k=w(d),A=k.write(r,a);return A!==d&&(k=k.slice(0,A)),k}function L(r){for(var a=0>r.length?0:0|_(r.length),d=w(a),k=0;k<a;k+=1)d[k]=255&r[k];return d}function T(r,a,d){if(0>a||r.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<a+(d||0))throw new RangeError('"length" is outside of buffer bounds');var k;return k=a===void 0&&d===void 0?new Uint8Array(r):d===void 0?new Uint8Array(r,a):new Uint8Array(r,a,d),k.__proto__=h.prototype,k}function f(r){if(h.isBuffer(r)){var a=0|_(r.length),d=w(a);return d.length===0||r.copy(d,0,0,a),d}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?L(r.data):void 0:typeof r.length!="number"||O(r.length)?w(0):L(r)}function _(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|r}function S(r,a){if(h.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||I(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var d=r.length,k=2<arguments.length&&arguments[2]===!0;if(!k&&d===0)return 0;for(var A=!1;;)switch(a){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return rt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Re(r).length;default:if(A)return k?-1:rt(r).length;a=(""+a).toLowerCase(),A=!0}}function R(r,a,d){var k=!1;if((a===void 0||0>a)&&(a=0),a>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,a>>>=0,d<=a))return"";for(r||(r="utf8");;)switch(r){case"hex":return ke(this,a,d);case"utf8":case"utf-8":return oe(this,a,d);case"ascii":return q(this,a,d);case"latin1":case"binary":return pt(this,a,d);case"base64":return Z(this,a,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ye(this,a,d);default:if(k)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),k=!0}}function v(r,a,d){var k=r[a];r[a]=r[d],r[d]=k}function D(r,a,d,k,A){if(r.length===0)return-1;if(typeof d=="string"?(k=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,O(d)&&(d=A?0:r.length-1),0>d&&(d=r.length+d),d>=r.length){if(A)return-1;d=r.length-1}else if(0>d)if(A)d=0;else return-1;if(typeof a=="string"&&(a=h.from(a,k)),h.isBuffer(a))return a.length===0?-1:U(r,a,d,k,A);if(typeof a=="number")return a&=255,typeof Uint8Array.prototype.indexOf=="function"?A?Uint8Array.prototype.indexOf.call(r,a,d):Uint8Array.prototype.lastIndexOf.call(r,a,d):U(r,[a],d,k,A);throw new TypeError("val must be string, number or Buffer")}function U(r,a,d,k,A){function N(yt,Ut){return P===1?yt[Ut]:yt.readUInt16BE(Ut*P)}var P=1,J=r.length,te=a.length;if(k!==void 0&&(k=(k+"").toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(2>r.length||2>a.length)return-1;P=2,J/=2,te/=2,d/=2}var K;if(A){var G=-1;for(K=d;K<J;K++)if(N(r,K)!==N(a,G===-1?0:K-G))G!==-1&&(K-=K-G),G=-1;else if(G===-1&&(G=K),K-G+1===te)return G*P}else for(d+te>J&&(d=J-te),K=d;0<=K;K--){for(var fe=!0,st=0;st<te;st++)if(N(r,K+st)!==N(a,st)){fe=!1;break}if(fe)return K}return-1}function E(r,a,d,k){d=+d||0;var A=r.length-d;k?(k=+k,k>A&&(k=A)):k=A;var N=a.length;k>N/2&&(k=N/2);for(var P,J=0;J<k;++J){if(P=parseInt(a.substr(2*J,2),16),O(P))return J;r[d+J]=P}return J}function x(r,a,d,k){return De(rt(a,r.length-d),r,d,k)}function F(r,a,d,k){return De(Mt(a),r,d,k)}function j(r,a,d,k){return F(r,a,d,k)}function H(r,a,d,k){return De(Re(a),r,d,k)}function Y(r,a,d,k){return De(Ke(a,r.length-d),r,d,k)}function Z(r,a,d){return a===0&&d===r.length?$.fromByteArray(r):$.fromByteArray(r.slice(a,d))}function oe(r,a,d){d=p(r.length,d);for(var k=[],A=a;A<d;){var N=r[A],P=null,J=239<N?4:223<N?3:191<N?2:1;if(A+J<=d){var te,K,G,fe;J===1?128>N&&(P=N):J===2?(te=r[A+1],(192&te)==128&&(fe=(31&N)<<6|63&te,127<fe&&(P=fe))):J===3?(te=r[A+1],K=r[A+2],(192&te)==128&&(192&K)==128&&(fe=(15&N)<<12|(63&te)<<6|63&K,2047<fe&&(55296>fe||57343<fe)&&(P=fe))):J===4&&(te=r[A+1],K=r[A+2],G=r[A+3],(192&te)==128&&(192&K)==128&&(192&G)==128&&(fe=(15&N)<<18|(63&te)<<12|(63&K)<<6|63&G,65535<fe&&1114112>fe&&(P=fe)))}P===null?(P=65533,J=1):65535<P&&(P-=65536,k.push(55296|1023&P>>>10),P=56320|1023&P),k.push(P),A+=J}return me(k)}function me(r){var a=r.length;if(a<=4096)return l.apply(String,r);for(var d="",k=0;k<a;)d+=l.apply(String,r.slice(k,k+=4096));return d}function q(r,a,d){var k="";d=p(r.length,d);for(var A=a;A<d;++A)k+=l(127&r[A]);return k}function pt(r,a,d){var k="";d=p(r.length,d);for(var A=a;A<d;++A)k+=l(r[A]);return k}function ke(r,a,d){var k=r.length;(!a||0>a)&&(a=0),(!d||0>d||d>k)&&(d=k);for(var A="",N=a;N<d;++N)A+=nt(r[N]);return A}function Ye(r,a,d){for(var k=r.slice(a,d),A="",N=0;N<k.length;N+=2)A+=l(k[N]+256*k[N+1]);return A}function se(r,a,d){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+a>d)throw new RangeError("Trying to access beyond buffer length")}function Q(r,a,d,k,A,N){if(!h.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>A||a<N)throw new RangeError('"value" argument is out of bounds');if(d+k>r.length)throw new RangeError("Index out of range")}function Te(r,a,d,k){if(d+k>r.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function Ge(r,a,d,k,A){return a=+a,d>>>=0,A||Te(r,a,d,4),W.write(r,a,d,k,23,4),d+4}function Je(r,a,d,k,A){return a=+a,d>>>=0,A||Te(r,a,d,8),W.write(r,a,d,k,52,8),d+8}function Nt(r){if(r=r.split("=")[0],r=r.trim().replace(b,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function nt(r){return 16>r?"0"+r.toString(16):r.toString(16)}function rt(r,a){a=a||1/0;for(var d,k=r.length,A=null,N=[],P=0;P<k;++P){if(d=r.charCodeAt(P),55295<d&&57344>d){if(!A){if(56319<d){-1<(a-=3)&&N.push(239,191,189);continue}else if(P+1===k){-1<(a-=3)&&N.push(239,191,189);continue}A=d;continue}if(56320>d){-1<(a-=3)&&N.push(239,191,189),A=d;continue}d=(A-55296<<10|d-56320)+65536}else A&&-1<(a-=3)&&N.push(239,191,189);if(A=null,128>d){if(0>(a-=1))break;N.push(d)}else if(2048>d){if(0>(a-=2))break;N.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(a-=3))break;N.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(a-=4))break;N.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return N}function Mt(r){for(var a=[],d=0;d<r.length;++d)a.push(255&r.charCodeAt(d));return a}function Ke(r,a){for(var d,k,A,N=[],P=0;P<r.length&&!(0>(a-=2));++P)d=r.charCodeAt(P),k=d>>8,A=d%256,N.push(A),N.push(k);return N}function Re(r){return $.toByteArray(Nt(r))}function De(r,a,d,k){for(var A=0;A<k&&!(A+d>=a.length||A>=r.length);++A)a[A+d]=r[A];return A}function I(r,a){return r instanceof a||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===a.name}function O(r){return r!==r}var $=i("base64-js"),W=i("ieee754");c.Buffer=h,c.SlowBuffer=function(r){return+r!=r&&(r=0),h.alloc(+r)},c.INSPECT_MAX_BYTES=50,c.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),h.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(r,a,d){return g(r,a,d)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(r,a,d){return y(r,a,d)},h.allocUnsafe=function(r){return C(r)},h.allocUnsafeSlow=function(r){return C(r)},h.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==h.prototype},h.compare=function(r,a){if(I(r,Uint8Array)&&(r=h.from(r,r.offset,r.byteLength)),I(a,Uint8Array)&&(a=h.from(a,a.offset,a.byteLength)),!h.isBuffer(r)||!h.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===a)return 0;for(var d=r.length,k=a.length,A=0,N=p(d,k);A<N;++A)if(r[A]!==a[A]){d=r[A],k=a[A];break}return d<k?-1:k<d?1:0},h.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(r,a){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return h.alloc(0);var d;if(a===void 0)for(a=0,d=0;d<r.length;++d)a+=r[d].length;var k=h.allocUnsafe(a),A=0;for(d=0;d<r.length;++d){var N=r[d];if(I(N,Uint8Array)&&(N=h.from(N)),!h.isBuffer(N))throw new TypeError('"list" argument must be an Array of Buffers');N.copy(k,A),A+=N.length}return k},h.byteLength=S,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var a=0;a<r;a+=2)v(this,a,a+1);return this},h.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var a=0;a<r;a+=4)v(this,a,a+3),v(this,a+1,a+2);return this},h.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var a=0;a<r;a+=8)v(this,a,a+7),v(this,a+1,a+6),v(this,a+2,a+5),v(this,a+3,a+4);return this},h.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?oe(this,0,r):R.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(r){if(!h.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||h.compare(this,r)===0},h.prototype.inspect=function(){var r="",a=c.INSPECT_MAX_BYTES;return r=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(r+=" ... "),"<Buffer "+r+">"},h.prototype.compare=function(r,a,d,k,A){if(I(r,Uint8Array)&&(r=h.from(r,r.offset,r.byteLength)),!h.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(a===void 0&&(a=0),d===void 0&&(d=r?r.length:0),k===void 0&&(k=0),A===void 0&&(A=this.length),0>a||d>r.length||0>k||A>this.length)throw new RangeError("out of range index");if(k>=A&&a>=d)return 0;if(k>=A)return-1;if(a>=d)return 1;if(a>>>=0,d>>>=0,k>>>=0,A>>>=0,this===r)return 0;for(var N=A-k,P=d-a,J=p(N,P),te=this.slice(k,A),K=r.slice(a,d),G=0;G<J;++G)if(te[G]!==K[G]){N=te[G],P=K[G];break}return N<P?-1:P<N?1:0},h.prototype.includes=function(r,a,d){return this.indexOf(r,a,d)!==-1},h.prototype.indexOf=function(r,a,d){return D(this,r,a,d,!0)},h.prototype.lastIndexOf=function(r,a,d){return D(this,r,a,d,!1)},h.prototype.write=function(r,a,d,k){if(a===void 0)k="utf8",d=this.length,a=0;else if(d===void 0&&typeof a=="string")k=a,d=this.length,a=0;else if(isFinite(a))a>>>=0,isFinite(d)?(d>>>=0,k===void 0&&(k="utf8")):(k=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var A=this.length-a;if((d===void 0||d>A)&&(d=A),0<r.length&&(0>d||0>a)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");for(var N=!1;;)switch(k){case"hex":return E(this,r,a,d);case"utf8":case"utf-8":return x(this,r,a,d);case"ascii":return F(this,r,a,d);case"latin1":case"binary":return j(this,r,a,d);case"base64":return H(this,r,a,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,r,a,d);default:if(N)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),N=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(r,a){var d=this.length;r=~~r,a=a===void 0?d:~~a,0>r?(r+=d,0>r&&(r=0)):r>d&&(r=d),0>a?(a+=d,0>a&&(a=0)):a>d&&(a=d),a<r&&(a=r);var k=this.subarray(r,a);return k.__proto__=h.prototype,k},h.prototype.readUIntLE=function(r,a,d){r>>>=0,a>>>=0,d||se(r,a,this.length);for(var k=this[r],A=1,N=0;++N<a&&(A*=256);)k+=this[r+N]*A;return k},h.prototype.readUIntBE=function(r,a,d){r>>>=0,a>>>=0,d||se(r,a,this.length);for(var k=this[r+--a],A=1;0<a&&(A*=256);)k+=this[r+--a]*A;return k},h.prototype.readUInt8=function(r,a){return r>>>=0,a||se(r,1,this.length),this[r]},h.prototype.readUInt16LE=function(r,a){return r>>>=0,a||se(r,2,this.length),this[r]|this[r+1]<<8},h.prototype.readUInt16BE=function(r,a){return r>>>=0,a||se(r,2,this.length),this[r]<<8|this[r+1]},h.prototype.readUInt32LE=function(r,a){return r>>>=0,a||se(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},h.prototype.readUInt32BE=function(r,a){return r>>>=0,a||se(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},h.prototype.readIntLE=function(r,a,d){r>>>=0,a>>>=0,d||se(r,a,this.length);for(var k=this[r],A=1,N=0;++N<a&&(A*=256);)k+=this[r+N]*A;return A*=128,k>=A&&(k-=o(2,8*a)),k},h.prototype.readIntBE=function(r,a,d){r>>>=0,a>>>=0,d||se(r,a,this.length);for(var k=a,A=1,N=this[r+--k];0<k&&(A*=256);)N+=this[r+--k]*A;return A*=128,N>=A&&(N-=o(2,8*a)),N},h.prototype.readInt8=function(r,a){return r>>>=0,a||se(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},h.prototype.readInt16LE=function(r,a){r>>>=0,a||se(r,2,this.length);var d=this[r]|this[r+1]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt16BE=function(r,a){r>>>=0,a||se(r,2,this.length);var d=this[r+1]|this[r]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt32LE=function(r,a){return r>>>=0,a||se(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},h.prototype.readInt32BE=function(r,a){return r>>>=0,a||se(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},h.prototype.readFloatLE=function(r,a){return r>>>=0,a||se(r,4,this.length),W.read(this,r,!0,23,4)},h.prototype.readFloatBE=function(r,a){return r>>>=0,a||se(r,4,this.length),W.read(this,r,!1,23,4)},h.prototype.readDoubleLE=function(r,a){return r>>>=0,a||se(r,8,this.length),W.read(this,r,!0,52,8)},h.prototype.readDoubleBE=function(r,a){return r>>>=0,a||se(r,8,this.length),W.read(this,r,!1,52,8)},h.prototype.writeUIntLE=function(r,a,d,k){if(r=+r,a>>>=0,d>>>=0,!k){var A=o(2,8*d)-1;Q(this,r,a,d,A,0)}var N=1,P=0;for(this[a]=255&r;++P<d&&(N*=256);)this[a+P]=255&r/N;return a+d},h.prototype.writeUIntBE=function(r,a,d,k){if(r=+r,a>>>=0,d>>>=0,!k){var A=o(2,8*d)-1;Q(this,r,a,d,A,0)}var N=d-1,P=1;for(this[a+N]=255&r;0<=--N&&(P*=256);)this[a+N]=255&r/P;return a+d},h.prototype.writeUInt8=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,1,255,0),this[a]=255&r,a+1},h.prototype.writeUInt16LE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,2,65535,0),this[a]=255&r,this[a+1]=r>>>8,a+2},h.prototype.writeUInt16BE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,2,65535,0),this[a]=r>>>8,this[a+1]=255&r,a+2},h.prototype.writeUInt32LE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,4,4294967295,0),this[a+3]=r>>>24,this[a+2]=r>>>16,this[a+1]=r>>>8,this[a]=255&r,a+4},h.prototype.writeUInt32BE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,4,4294967295,0),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},h.prototype.writeIntLE=function(r,a,d,k){if(r=+r,a>>>=0,!k){var A=o(2,8*d-1);Q(this,r,a,d,A-1,-A)}var N=0,P=1,J=0;for(this[a]=255&r;++N<d&&(P*=256);)0>r&&J===0&&this[a+N-1]!==0&&(J=1),this[a+N]=255&(r/P>>0)-J;return a+d},h.prototype.writeIntBE=function(r,a,d,k){if(r=+r,a>>>=0,!k){var A=o(2,8*d-1);Q(this,r,a,d,A-1,-A)}var N=d-1,P=1,J=0;for(this[a+N]=255&r;0<=--N&&(P*=256);)0>r&&J===0&&this[a+N+1]!==0&&(J=1),this[a+N]=255&(r/P>>0)-J;return a+d},h.prototype.writeInt8=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,1,127,-128),0>r&&(r=255+r+1),this[a]=255&r,a+1},h.prototype.writeInt16LE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,2,32767,-32768),this[a]=255&r,this[a+1]=r>>>8,a+2},h.prototype.writeInt16BE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,2,32767,-32768),this[a]=r>>>8,this[a+1]=255&r,a+2},h.prototype.writeInt32LE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,4,2147483647,-2147483648),this[a]=255&r,this[a+1]=r>>>8,this[a+2]=r>>>16,this[a+3]=r>>>24,a+4},h.prototype.writeInt32BE=function(r,a,d){return r=+r,a>>>=0,d||Q(this,r,a,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},h.prototype.writeFloatLE=function(r,a,d){return Ge(this,r,a,!0,d)},h.prototype.writeFloatBE=function(r,a,d){return Ge(this,r,a,!1,d)},h.prototype.writeDoubleLE=function(r,a,d){return Je(this,r,a,!0,d)},h.prototype.writeDoubleBE=function(r,a,d){return Je(this,r,a,!1,d)},h.prototype.copy=function(r,a,d,k){if(!h.isBuffer(r))throw new TypeError("argument should be a Buffer");if(d||(d=0),k||k===0||(k=this.length),a>=r.length&&(a=r.length),a||(a=0),0<k&&k<d&&(k=d),k===d||r.length===0||this.length===0)return 0;if(0>a)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>k)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),r.length-a<k-d&&(k=r.length-a+d);var A=k-d;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(a,d,k);else if(this===r&&d<a&&a<k)for(var N=A-1;0<=N;--N)r[N+a]=this[N+d];else Uint8Array.prototype.set.call(r,this.subarray(d,k),a);return A},h.prototype.fill=function(r,a,d,k){if(typeof r=="string"){if(typeof a=="string"?(k=a,a=0,d=this.length):typeof d=="string"&&(k=d,d=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!h.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(r.length===1){var A=r.charCodeAt(0);(k==="utf8"&&128>A||k==="latin1")&&(r=A)}}else typeof r=="number"&&(r&=255);if(0>a||this.length<a||this.length<d)throw new RangeError("Out of range index");if(d<=a)return this;a>>>=0,d=d===void 0?this.length:d>>>0,r||(r=0);var N;if(typeof r=="number")for(N=a;N<d;++N)this[N]=r;else{var P=h.isBuffer(r)?r:h.from(r,k),J=P.length;if(J===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(N=0;N<d-a;++N)this[N+a]=P[N%J]}return this};var b=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,i("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(i,u,c){(function(l){(function(){function p(){let h;try{h=c.storage.getItem("debug")}catch{}return!h&&typeof l<"u"&&"env"in l&&(h=l.env.DEBUG),h}c.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+u.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;h.splice(1,0,g,"color: inherit");let m=0,y=0;h[0].replace(/%[a-zA-Z%]/g,C=>{C==="%%"||(m++,C==="%c"&&(y=m))}),h.splice(y,0,g)},c.save=function(h){try{h?c.storage.setItem("debug",h):c.storage.removeItem("debug")}catch{}},c.load=p,c.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),u.exports=i("./common")(c);const{formatters:w}=u.exports;w.j=function(h){try{return JSON.stringify(h)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}}).call(this)}).call(this,i("_process"))},{"./common":5,_process:12}],5:[function(i,u){u.exports=function(c){function l(h){function g(...C){if(!g.enabled)return;const M=g,L=+new Date,T=L-(m||L);M.diff=T,M.prev=m,M.curr=L,m=L,C[0]=l.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let f=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(S,R)=>{if(S==="%%")return"%";f++;const v=l.formatters[R];if(typeof v=="function"){const D=C[f];S=v.call(M,D),C.splice(f,1),f--}return S}),l.formatArgs.call(M,C),(M.log||l.log).apply(M,C)}let m,y=null;return g.namespace=h,g.useColors=l.useColors(),g.color=l.selectColor(h),g.extend=p,g.destroy=l.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?l.enabled(h):y,set:C=>{y=C}}),typeof l.init=="function"&&l.init(g),g}function p(h,g){const m=l(this.namespace+(typeof g>"u"?":":g)+h);return m.log=this.log,m}function w(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function(h){return h instanceof Error?h.stack||h.message:h},l.disable=function(){const h=[...l.names.map(w),...l.skips.map(w).map(g=>"-"+g)].join(",");return l.enable(""),h},l.enable=function(h){l.save(h),l.names=[],l.skips=[];let g;const m=(typeof h=="string"?h:"").split(/[\s,]+/),y=m.length;for(g=0;g<y;g++)m[g]&&(h=m[g].replace(/\*/g,".*?"),h[0]==="-"?l.skips.push(new RegExp("^"+h.substr(1)+"$")):l.names.push(new RegExp("^"+h+"$")))},l.enabled=function(h){if(h[h.length-1]==="*")return!0;let g,m;for(g=0,m=l.skips.length;g<m;g++)if(l.skips[g].test(h))return!1;for(g=0,m=l.names.length;g<m;g++)if(l.names[g].test(h))return!0;return!1},l.humanize=i("ms"),l.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(c).forEach(h=>{l[h]=c[h]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function(h){let g=0;for(let m=0;m<h.length;m++)g=(g<<5)-g+h.charCodeAt(m),g|=0;return l.colors[s(g)%l.colors.length]},l.enable(l.load()),l}},{ms:11}],6:[function(i,u){function c(l,p){for(const w in p)Object.defineProperty(l,w,{value:p[w],enumerable:!0,configurable:!0});return l}u.exports=function(l,p,w){if(!l||typeof l=="string")throw new TypeError("Please pass an Error to err-code");w||(w={}),typeof p=="object"&&(w=p,p=""),p&&(w.code=p);try{return c(l,w)}catch{w.message=l.message,w.stack=l.stack;const g=function(){};return g.prototype=Object.create(Object.getPrototypeOf(l)),c(new g,w)}}},{}],7:[function(i,u){function c(E){console&&console.warn&&console.warn(E)}function l(){l.init.call(this)}function p(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}function w(E){return E._maxListeners===void 0?l.defaultMaxListeners:E._maxListeners}function h(E,x,F,j){var H,Y,Z;if(p(F),Y=E._events,Y===void 0?(Y=E._events=Object.create(null),E._eventsCount=0):(Y.newListener!==void 0&&(E.emit("newListener",x,F.listener?F.listener:F),Y=E._events),Z=Y[x]),Z===void 0)Z=Y[x]=F,++E._eventsCount;else if(typeof Z=="function"?Z=Y[x]=j?[F,Z]:[Z,F]:j?Z.unshift(F):Z.push(F),H=w(E),0<H&&Z.length>H&&!Z.warned){Z.warned=!0;var oe=new Error("Possible EventEmitter memory leak detected. "+Z.length+" "+(x+" listeners added. Use emitter.setMaxListeners() to increase limit"));oe.name="MaxListenersExceededWarning",oe.emitter=E,oe.type=x,oe.count=Z.length,c(oe)}return E}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(E,x,F){var j={fired:!1,wrapFn:void 0,target:E,type:x,listener:F},H=g.bind(j);return H.listener=F,j.wrapFn=H,H}function y(E,x,F){var j=E._events;if(j===void 0)return[];var H=j[x];return H===void 0?[]:typeof H=="function"?F?[H.listener||H]:[H]:F?T(H):M(H,H.length)}function C(E){var x=this._events;if(x!==void 0){var F=x[E];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function M(E,x){for(var F=Array(x),j=0;j<x;++j)F[j]=E[j];return F}function L(E,x){for(;x+1<E.length;x++)E[x]=E[x+1];E.pop()}function T(E){for(var x=Array(E.length),F=0;F<x.length;++F)x[F]=E[F].listener||E[F];return x}function f(E,x,F){typeof E.on=="function"&&_(E,"error",x,F)}function _(E,x,F,j){if(typeof E.on=="function")j.once?E.once(x,F):E.on(x,F);else if(typeof E.addEventListener=="function")E.addEventListener(x,function H(Y){j.once&&E.removeEventListener(x,H),F(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}var S,R=typeof Reflect=="object"?Reflect:null,v=R&&typeof R.apply=="function"?R.apply:function(E,x,F){return Function.prototype.apply.call(E,x,F)};S=R&&typeof R.ownKeys=="function"?R.ownKeys:Object.getOwnPropertySymbols?function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:function(E){return Object.getOwnPropertyNames(E)};var D=Number.isNaN||function(E){return E!==E};u.exports=l,u.exports.once=function(E,x){return new Promise(function(F,j){function H(Z){E.removeListener(x,Y),j(Z)}function Y(){typeof E.removeListener=="function"&&E.removeListener("error",H),F([].slice.call(arguments))}_(E,x,Y,{once:!0}),x!=="error"&&f(E,H,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var U=10;Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(E){if(typeof E!="number"||0>E||D(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");U=E}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(E){if(typeof E!="number"||0>E||D(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this},l.prototype.getMaxListeners=function(){return w(this)},l.prototype.emit=function(E){for(var x=[],F=1;F<arguments.length;F++)x.push(arguments[F]);var j=E==="error",H=this._events;if(H!==void 0)j=j&&H.error===void 0;else if(!j)return!1;if(j){var Y;if(0<x.length&&(Y=x[0]),Y instanceof Error)throw Y;var Z=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw Z.context=Y,Z}var oe=H[E];if(oe===void 0)return!1;if(typeof oe=="function")v(oe,this,x);else for(var me=oe.length,q=M(oe,me),F=0;F<me;++F)v(q[F],this,x);return!0},l.prototype.addListener=function(E,x){return h(this,E,x,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(E,x){return h(this,E,x,!0)},l.prototype.once=function(E,x){return p(x),this.on(E,m(this,E,x)),this},l.prototype.prependOnceListener=function(E,x){return p(x),this.prependListener(E,m(this,E,x)),this},l.prototype.removeListener=function(E,x){var F,j,H,Y,Z;if(p(x),j=this._events,j===void 0)return this;if(F=j[E],F===void 0)return this;if(F===x||F.listener===x)--this._eventsCount==0?this._events=Object.create(null):(delete j[E],j.removeListener&&this.emit("removeListener",E,F.listener||x));else if(typeof F!="function"){for(H=-1,Y=F.length-1;0<=Y;Y--)if(F[Y]===x||F[Y].listener===x){Z=F[Y].listener,H=Y;break}if(0>H)return this;H===0?F.shift():L(F,H),F.length===1&&(j[E]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",E,Z||x)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(E){var x,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[E]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[E]),this;if(arguments.length===0){var H,Y=Object.keys(F);for(j=0;j<Y.length;++j)H=Y[j],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=F[E],typeof x=="function")this.removeListener(E,x);else if(x!==void 0)for(j=x.length-1;0<=j;j--)this.removeListener(E,x[j]);return this},l.prototype.listeners=function(E){return y(this,E,!0)},l.prototype.rawListeners=function(E){return y(this,E,!1)},l.listenerCount=function(E,x){return typeof E.listenerCount=="function"?E.listenerCount(x):C.call(E,x)},l.prototype.listenerCount=C,l.prototype.eventNames=function(){return 0<this._eventsCount?S(this._events):[]}},{}],8:[function(i,u){u.exports=function(){if(typeof globalThis>"u")return null;var c={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return c.RTCPeerConnection?c:null}},{}],9:[function(i,u,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(l,p,w,h,g){var m,y,C=8*g-h-1,M=(1<<C)-1,L=M>>1,T=-7,f=w?g-1:0,_=w?-1:1,S=l[p+f];for(f+=_,m=S&(1<<-T)-1,S>>=-T,T+=C;0<T;m=256*m+l[p+f],f+=_,T-=8);for(y=m&(1<<-T)-1,m>>=-T,T+=h;0<T;y=256*y+l[p+f],f+=_,T-=8);if(m===0)m=1-L;else{if(m===M)return y?NaN:(S?-1:1)*(1/0);y+=o(2,h),m-=L}return(S?-1:1)*y*o(2,m-h)},c.write=function(l,p,w,h,g,m){var y,C,M,L=Math.LN2,T=Math.log,f=8*m-g-1,_=(1<<f)-1,S=_>>1,R=g===23?o(2,-24)-o(2,-77):0,v=h?0:m-1,D=h?1:-1,U=0>p||p===0&&0>1/p?1:0;for(p=s(p),isNaN(p)||p===1/0?(C=isNaN(p)?1:0,y=_):(y=n(T(p)/L),1>p*(M=o(2,-y))&&(y--,M*=2),p+=1<=y+S?R/M:R*o(2,1-S),2<=p*M&&(y++,M/=2),y+S>=_?(C=0,y=_):1<=y+S?(C=(p*M-1)*o(2,g),y+=S):(C=p*o(2,S-1)*o(2,g),y=0));8<=g;l[w+v]=255&C,v+=D,C/=256,g-=8);for(y=y<<g|C,f+=g;0<f;l[w+v]=255&y,v+=D,y/=256,f-=8);l[w+v-D]|=128*U}},{}],10:[function(i,u){u.exports=typeof Object.create=="function"?function(c,l){l&&(c.super_=l,c.prototype=Object.create(l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,l){if(l){c.super_=l;var p=function(){};p.prototype=l.prototype,c.prototype=new p,c.prototype.constructor=c}}},{}],11:[function(i,u){var c=Math.round;function l(g){if(g+="",!(100<g.length)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(g);if(m){var y=parseFloat(m[1]),C=(m[2]||"ms").toLowerCase();return C==="years"||C==="year"||C==="yrs"||C==="yr"||C==="y"?315576e5*y:C==="weeks"||C==="week"||C==="w"?6048e5*y:C==="days"||C==="day"||C==="d"?864e5*y:C==="hours"||C==="hour"||C==="hrs"||C==="hr"||C==="h"?36e5*y:C==="minutes"||C==="minute"||C==="mins"||C==="min"||C==="m"?6e4*y:C==="seconds"||C==="second"||C==="secs"||C==="sec"||C==="s"?1e3*y:C==="milliseconds"||C==="millisecond"||C==="msecs"||C==="msec"||C==="ms"?y:void 0}}}function p(g){var m=s(g);return 864e5<=m?c(g/864e5)+"d":36e5<=m?c(g/36e5)+"h":6e4<=m?c(g/6e4)+"m":1e3<=m?c(g/1e3)+"s":g+"ms"}function w(g){var m=s(g);return 864e5<=m?h(g,m,864e5,"day"):36e5<=m?h(g,m,36e5,"hour"):6e4<=m?h(g,m,6e4,"minute"):1e3<=m?h(g,m,1e3,"second"):g+" ms"}function h(g,m,y,C){return c(g/y)+" "+C+(m>=1.5*y?"s":"")}u.exports=function(g,m){m=m||{};var y=typeof g;if(y=="string"&&0<g.length)return l(g);if(y==="number"&&isFinite(g))return m.long?w(g):p(g);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(g))}},{}],12:[function(i,u){function c(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function p(R){if(C===setTimeout)return setTimeout(R,0);if((C===c||!C)&&setTimeout)return C=setTimeout,setTimeout(R,0);try{return C(R,0)}catch{try{return C.call(null,R,0)}catch{return C.call(this,R,0)}}}function w(R){if(M===clearTimeout)return clearTimeout(R);if((M===l||!M)&&clearTimeout)return M=clearTimeout,clearTimeout(R);try{return M(R)}catch{try{return M.call(null,R)}catch{return M.call(this,R)}}}function h(){_&&T&&(_=!1,T.length?f=T.concat(f):S=-1,f.length&&g())}function g(){if(!_){var R=p(h);_=!0;for(var v=f.length;v;){for(T=f,f=[];++S<v;)T&&T[S].run();S=-1,v=f.length}T=null,_=!1,w(R)}}function m(R,v){this.fun=R,this.array=v}function y(){}var C,M,L=u.exports={};(function(){try{C=typeof setTimeout=="function"?setTimeout:c}catch{C=c}try{M=typeof clearTimeout=="function"?clearTimeout:l}catch{M=l}})();var T,f=[],_=!1,S=-1;L.nextTick=function(R){var v=Array(arguments.length-1);if(1<arguments.length)for(var D=1;D<arguments.length;D++)v[D-1]=arguments[D];f.push(new m(R,v)),f.length!==1||_||p(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=y,L.addListener=y,L.once=y,L.off=y,L.removeListener=y,L.removeAllListeners=y,L.emit=y,L.prependListener=y,L.prependOnceListener=y,L.listeners=function(){return[]},L.binding=function(){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],13:[function(i,u){(function(c){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let l;u.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?c:window):p=>(l||(l=Promise.resolve())).then(p).catch(w=>setTimeout(()=>{throw w},0))}).call(this)}).call(this,typeof Ie>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ie)},{}],14:[function(i,u){(function(c,l){(function(){var p=i("safe-buffer").Buffer,w=l.crypto||l.msCrypto;u.exports=w&&w.getRandomValues?function(h,g){if(h>4294967295)throw new RangeError("requested too many random bytes");var m=p.allocUnsafe(h);if(0<h)if(65536<h)for(var y=0;y<h;y+=65536)w.getRandomValues(m.slice(y,y+65536));else w.getRandomValues(m);return typeof g=="function"?c.nextTick(function(){g(null,m)}):m}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,i("_process"),typeof Ie>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ie)},{_process:12,"safe-buffer":30}],15:[function(i,u){function c(y,C){y.prototype=Object.create(C.prototype),y.prototype.constructor=y,y.__proto__=C}function l(y,C,M){function L(f,_,S){return typeof C=="string"?C:C(f,_,S)}M||(M=Error);var T=function(f){function _(S,R,v){return f.call(this,L(S,R,v))||this}return c(_,f),_}(M);T.prototype.name=M.name,T.prototype.code=y,m[y]=T}function p(y,C){if(Array.isArray(y)){var M=y.length;return y=y.map(function(L){return L+""}),2<M?"one of ".concat(C," ").concat(y.slice(0,M-1).join(", "),", or ")+y[M-1]:M===2?"one of ".concat(C," ").concat(y[0]," or ").concat(y[1]):"of ".concat(C," ").concat(y[0])}return"of ".concat(C," ").concat(y+"")}function w(y,C,M){return y.substr(!M||0>M?0:+M,C.length)===C}function h(y,C,M){return(M===void 0||M>y.length)&&(M=y.length),y.substring(M-C.length,M)===C}function g(y,C,M){return typeof M!="number"&&(M=0),!(M+C.length>y.length)&&y.indexOf(C,M)!==-1}var m={};l("ERR_INVALID_OPT_VALUE",function(y,C){return'The value "'+C+'" is invalid for option "'+y+'"'},TypeError),l("ERR_INVALID_ARG_TYPE",function(y,C,M){var L;typeof C=="string"&&w(C,"not ")?(L="must not be",C=C.replace(/^not /,"")):L="must be";var T;if(h(y," argument"))T="The ".concat(y," ").concat(L," ").concat(p(C,"type"));else{var f=g(y,".")?"property":"argument";T='The "'.concat(y,'" ').concat(f," ").concat(L," ").concat(p(C,"type"))}return T+=". Received type ".concat(typeof M),T},TypeError),l("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),l("ERR_METHOD_NOT_IMPLEMENTED",function(y){return"The "+y+" method is not implemented"}),l("ERR_STREAM_PREMATURE_CLOSE","Premature close"),l("ERR_STREAM_DESTROYED",function(y){return"Cannot call "+y+" after a stream was destroyed"}),l("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),l("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),l("ERR_STREAM_WRITE_AFTER_END","write after end"),l("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),l("ERR_UNKNOWN_ENCODING",function(y){return"Unknown encoding: "+y},TypeError),l("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),u.exports.codes=m},{}],16:[function(i,u){(function(c){(function(){function l(L){return this instanceof l?(g.call(this,L),m.call(this,L),this.allowHalfOpen=!0,void(L&&(L.readable===!1&&(this.readable=!1),L.writable===!1&&(this.writable=!1),L.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p))))):new l(L)}function p(){this._writableState.ended||c.nextTick(w,this)}function w(L){L.end()}var h=Object.keys||function(L){var T=[];for(var f in L)T.push(f);return T};u.exports=l;var g=i("./_stream_readable"),m=i("./_stream_writable");i("inherits")(l,g);for(var y,C=h(m.prototype),M=0;M<C.length;M++)y=C[M],l.prototype[y]||(l.prototype[y]=m.prototype[y]);Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(L){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=L,this._writableState.destroyed=L)}})}).call(this)}).call(this,i("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(i,u){function c(p){return this instanceof c?void l.call(this,p):new c(p)}u.exports=c;var l=i("./_stream_transform");i("inherits")(c,l),c.prototype._transform=function(p,w,h){h(null,p)}},{"./_stream_transform":19,inherits:10}],18:[function(i,u){(function(c,l){(function(){function p(b){return Ye.from(b)}function w(b){return Ye.isBuffer(b)||b instanceof se}function h(b,r,a){return typeof b.prependListener=="function"?b.prependListener(r,a):void(b._events&&b._events[r]?Array.isArray(b._events[r])?b._events[r].unshift(a):b._events[r]=[a,b._events[r]]:b.on(r,a))}function g(b,r,a){me=me||i("./_stream_duplex"),b=b||{},typeof a!="boolean"&&(a=r instanceof me),this.objectMode=!!b.objectMode,a&&(this.objectMode=this.objectMode||!!b.readableObjectMode),this.highWaterMark=Mt(this,b,"readableHighWaterMark",a),this.buffer=new Nt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=b.emitClose!==!1,this.autoDestroy=!!b.autoDestroy,this.destroyed=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(!Te&&(Te=i("string_decoder/").StringDecoder),this.decoder=new Te(b.encoding),this.encoding=b.encoding)}function m(b){if(me=me||i("./_stream_duplex"),!(this instanceof m))return new m(b);var r=this instanceof me;this._readableState=new g(b,this,r),this.readable=!0,b&&(typeof b.read=="function"&&(this._read=b.read),typeof b.destroy=="function"&&(this._destroy=b.destroy)),ke.call(this)}function y(b,r,a,d,k){q("readableAddChunk",r);var A=b._readableState;if(r===null)A.reading=!1,f(b,A);else{var N;if(k||(N=M(A,r)),N)$(b,N);else if(!(A.objectMode||r&&0<r.length))d||(A.reading=!1,R(b,A));else if(typeof r=="string"||A.objectMode||Object.getPrototypeOf(r)===Ye.prototype||(r=p(r)),d)A.endEmitted?$(b,new O):C(b,A,r,!0);else if(A.ended)$(b,new De);else{if(A.destroyed)return!1;A.reading=!1,A.decoder&&!a?(r=A.decoder.write(r),A.objectMode||r.length!==0?C(b,A,r,!1):R(b,A)):C(b,A,r,!1)}}return!A.ended&&(A.length<A.highWaterMark||A.length===0)}function C(b,r,a,d){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,b.emit("data",a)):(r.length+=r.objectMode?1:a.length,d?r.buffer.unshift(a):r.buffer.push(a),r.needReadable&&_(b)),R(b,r)}function M(b,r){var a;return w(r)||typeof r=="string"||r===void 0||b.objectMode||(a=new Re("chunk",["string","Buffer","Uint8Array"],r)),a}function L(b){return 1073741824<=b?b=1073741824:(b--,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,b|=b>>>16,b++),b}function T(b,r){return 0>=b||r.length===0&&r.ended?0:r.objectMode?1:b===b?(b>r.highWaterMark&&(r.highWaterMark=L(b)),b<=r.length?b:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function f(b,r){if(q("onEofChunk"),!r.ended){if(r.decoder){var a=r.decoder.end();a&&a.length&&(r.buffer.push(a),r.length+=r.objectMode?1:a.length)}r.ended=!0,r.sync?_(b):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,S(b)))}}function _(b){var r=b._readableState;q("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(q("emitReadable",r.flowing),r.emittedReadable=!0,c.nextTick(S,b))}function S(b){var r=b._readableState;q("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(b.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,j(b)}function R(b,r){r.readingMore||(r.readingMore=!0,c.nextTick(v,b,r))}function v(b,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var a=r.length;if(q("maybeReadMore read 0"),b.read(0),a===r.length)break}r.readingMore=!1}function D(b){return function(){var r=b._readableState;q("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&pt(b,"data")&&(r.flowing=!0,j(b))}}function U(b){var r=b._readableState;r.readableListening=0<b.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<b.listenerCount("data")&&b.resume()}function E(b){q("readable nexttick read 0"),b.read(0)}function x(b,r){r.resumeScheduled||(r.resumeScheduled=!0,c.nextTick(F,b,r))}function F(b,r){q("resume",r.reading),r.reading||b.read(0),r.resumeScheduled=!1,b.emit("resume"),j(b),r.flowing&&!r.reading&&b.read(0)}function j(b){var r=b._readableState;for(q("flow",r.flowing);r.flowing&&b.read()!==null;);}function H(b,r){if(r.length===0)return null;var a;return r.objectMode?a=r.buffer.shift():!b||b>=r.length?(a=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):a=r.buffer.consume(b,r.decoder),a}function Y(b){var r=b._readableState;q("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,c.nextTick(Z,r,b))}function Z(b,r){if(q("endReadableNT",b.endEmitted,b.length),!b.endEmitted&&b.length===0&&(b.endEmitted=!0,r.readable=!1,r.emit("end"),b.autoDestroy)){var a=r._writableState;(!a||a.autoDestroy&&a.finished)&&r.destroy()}}function oe(b,r){for(var a=0,d=b.length;a<d;a++)if(b[a]===r)return a;return-1}u.exports=m;var me;m.ReadableState=g;var q;i("events").EventEmitter;var pt=function(b,r){return b.listeners(r).length},ke=i("./internal/streams/stream"),Ye=i("buffer").Buffer,se=l.Uint8Array||function(){},Q=i("util");q=Q&&Q.debuglog?Q.debuglog("stream"):function(){};var Te,Ge,Je,Nt=i("./internal/streams/buffer_list"),nt=i("./internal/streams/destroy"),rt=i("./internal/streams/state"),Mt=rt.getHighWaterMark,Ke=i("../errors").codes,Re=Ke.ERR_INVALID_ARG_TYPE,De=Ke.ERR_STREAM_PUSH_AFTER_EOF,I=Ke.ERR_METHOD_NOT_IMPLEMENTED,O=Ke.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("inherits")(m,ke);var $=nt.errorOrDestroy,W=["error","close","destroy","pause","resume"];Object.defineProperty(m.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(b){this._readableState&&(this._readableState.destroyed=b)}}),m.prototype.destroy=nt.destroy,m.prototype._undestroy=nt.undestroy,m.prototype._destroy=function(b,r){r(b)},m.prototype.push=function(b,r){var a,d=this._readableState;return d.objectMode?a=!0:typeof b=="string"&&(r=r||d.defaultEncoding,r!==d.encoding&&(b=Ye.from(b,r),r=""),a=!0),y(this,b,r,!1,a)},m.prototype.unshift=function(b){return y(this,b,null,!0,!1)},m.prototype.isPaused=function(){return this._readableState.flowing===!1},m.prototype.setEncoding=function(b){Te||(Te=i("string_decoder/").StringDecoder);var r=new Te(b);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var a=this._readableState.buffer.head,d="";a!==null;)d+=r.write(a.data),a=a.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},m.prototype.read=function(b){q("read",b),b=parseInt(b,10);var r=this._readableState,a=b;if(b!==0&&(r.emittedReadable=!1),b===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return q("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?Y(this):_(this),null;if(b=T(b,r),b===0&&r.ended)return r.length===0&&Y(this),null;var d=r.needReadable;q("need readable",d),(r.length===0||r.length-b<r.highWaterMark)&&(d=!0,q("length less than watermark",d)),r.ended||r.reading?(d=!1,q("reading or ended",d)):d&&(q("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(b=T(a,r)));var k;return k=0<b?H(b,r):null,k===null?(r.needReadable=r.length<=r.highWaterMark,b=0):(r.length-=b,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),a!==b&&r.ended&&Y(this)),k!==null&&this.emit("data",k),k},m.prototype._read=function(){$(this,new I("_read()"))},m.prototype.pipe=function(b,r){function a(mt,wt){q("onunpipe"),mt===K&&wt&&wt.hasUnpiped===!1&&(wt.hasUnpiped=!0,k())}function d(){q("onend"),b.end()}function k(){q("cleanup"),b.removeListener("close",P),b.removeListener("finish",J),b.removeListener("drain",yt),b.removeListener("error",N),b.removeListener("unpipe",a),K.removeListener("end",d),K.removeListener("end",te),K.removeListener("data",A),Ut=!0,G.awaitDrain&&(!b._writableState||b._writableState.needDrain)&&yt()}function A(mt){q("ondata");var wt=b.write(mt);q("dest.write",wt),wt===!1&&((G.pipesCount===1&&G.pipes===b||1<G.pipesCount&&oe(G.pipes,b)!==-1)&&!Ut&&(q("false write response, pause",G.awaitDrain),G.awaitDrain++),K.pause())}function N(mt){q("onerror",mt),te(),b.removeListener("error",N),pt(b,"error")===0&&$(b,mt)}function P(){b.removeListener("finish",J),te()}function J(){q("onfinish"),b.removeListener("close",P),te()}function te(){q("unpipe"),K.unpipe(b)}var K=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=b;break;case 1:G.pipes=[G.pipes,b];break;default:G.pipes.push(b)}G.pipesCount+=1,q("pipe count=%d opts=%j",G.pipesCount,r);var fe=(!r||r.end!==!1)&&b!==c.stdout&&b!==c.stderr,st=fe?d:te;G.endEmitted?c.nextTick(st):K.once("end",st),b.on("unpipe",a);var yt=D(K);b.on("drain",yt);var Ut=!1;return K.on("data",A),h(b,"error",N),b.once("close",P),b.once("finish",J),b.emit("pipe",K),G.flowing||(q("pipe resume"),K.resume()),b},m.prototype.unpipe=function(b){var r=this._readableState,a={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return b&&b!==r.pipes?this:(b||(b=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,b&&b.emit("unpipe",this,a),this);if(!b){var d=r.pipes,k=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var A=0;A<k;A++)d[A].emit("unpipe",this,{hasUnpiped:!1});return this}var N=oe(r.pipes,b);return N===-1?this:(r.pipes.splice(N,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),b.emit("unpipe",this,a),this)},m.prototype.on=function(b,r){var a=ke.prototype.on.call(this,b,r),d=this._readableState;return b==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):b=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,q("on readable",d.length,d.reading),d.length?_(this):!d.reading&&c.nextTick(E,this)),a},m.prototype.addListener=m.prototype.on,m.prototype.removeListener=function(b,r){var a=ke.prototype.removeListener.call(this,b,r);return b==="readable"&&c.nextTick(U,this),a},m.prototype.removeAllListeners=function(b){var r=ke.prototype.removeAllListeners.apply(this,arguments);return(b==="readable"||b===void 0)&&c.nextTick(U,this),r},m.prototype.resume=function(){var b=this._readableState;return b.flowing||(q("resume"),b.flowing=!b.readableListening,x(this,b)),b.paused=!1,this},m.prototype.pause=function(){return q("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(q("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},m.prototype.wrap=function(b){var r=this,a=this._readableState,d=!1;for(var k in b.on("end",function(){if(q("wrapped end"),a.decoder&&!a.ended){var N=a.decoder.end();N&&N.length&&r.push(N)}r.push(null)}),b.on("data",function(N){if(q("wrapped data"),a.decoder&&(N=a.decoder.write(N)),!(a.objectMode&&N==null)&&(a.objectMode||N&&N.length)){var P=r.push(N);P||(d=!0,b.pause())}}),b)this[k]===void 0&&typeof b[k]=="function"&&(this[k]=function(N){return function(){return b[N].apply(b,arguments)}}(k));for(var A=0;A<W.length;A++)b.on(W[A],this.emit.bind(this,W[A]));return this._read=function(N){q("wrapped _read",N),d&&(d=!1,b.resume())},this},typeof Symbol=="function"&&(m.prototype[Symbol.asyncIterator]=function(){return Ge===void 0&&(Ge=i("./internal/streams/async_iterator")),Ge(this)}),Object.defineProperty(m.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(m.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(m.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(b){this._readableState&&(this._readableState.flowing=b)}}),m._fromList=H,Object.defineProperty(m.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(m.from=function(b,r){return Je===void 0&&(Je=i("./internal/streams/from")),Je(m,b,r)})}).call(this)}).call(this,i("_process"),typeof Ie>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ie)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(i,u){function c(L,T){var f=this._transformState;f.transforming=!1;var _=f.writecb;if(_===null)return this.emit("error",new m);f.writechunk=null,f.writecb=null,T!=null&&this.push(T),_(L);var S=this._readableState;S.reading=!1,(S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}function l(L){return this instanceof l?(M.call(this,L),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,L&&(typeof L.transform=="function"&&(this._transform=L.transform),typeof L.flush=="function"&&(this._flush=L.flush)),void this.on("prefinish",p)):new l(L)}function p(){var L=this;typeof this._flush!="function"||this._readableState.destroyed?w(this,null,null):this._flush(function(T,f){w(L,T,f)})}function w(L,T,f){if(T)return L.emit("error",T);if(f!=null&&L.push(f),L._writableState.length)throw new C;if(L._transformState.transforming)throw new y;return L.push(null)}u.exports=l;var h=i("../errors").codes,g=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,y=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,C=h.ERR_TRANSFORM_WITH_LENGTH_0,M=i("./_stream_duplex");i("inherits")(l,M),l.prototype.push=function(L,T){return this._transformState.needTransform=!1,M.prototype.push.call(this,L,T)},l.prototype._transform=function(L,T,f){f(new g("_transform()"))},l.prototype._write=function(L,T,f){var _=this._transformState;if(_.writecb=f,_.writechunk=L,_.writeencoding=T,!_.transforming){var S=this._readableState;(_.needTransform||S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}},l.prototype._read=function(){var L=this._transformState;L.writechunk===null||L.transforming?L.needTransform=!0:(L.transforming=!0,this._transform(L.writechunk,L.writeencoding,L.afterTransform))},l.prototype._destroy=function(L,T){M.prototype._destroy.call(this,L,function(f){T(f)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(i,u){(function(c,l){(function(){function p(I){var O=this;this.next=null,this.entry=null,this.finish=function(){Y(O,I)}}function w(I){return q.from(I)}function h(I){return q.isBuffer(I)||I instanceof pt}function g(){}function m(I,O,$){Z=Z||i("./_stream_duplex"),I=I||{},typeof $!="boolean"&&($=O instanceof Z),this.objectMode=!!I.objectMode,$&&(this.objectMode=this.objectMode||!!I.writableObjectMode),this.highWaterMark=se(this,I,"writableHighWaterMark",$),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var W=I.decodeStrings===!1;this.decodeStrings=!W,this.defaultEncoding=I.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(b){R(O,b)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=I.emitClose!==!1,this.autoDestroy=!!I.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function y(I){Z=Z||i("./_stream_duplex");var O=this instanceof Z;return O||De.call(y,this)?(this._writableState=new m(I,this,O),this.writable=!0,I&&(typeof I.write=="function"&&(this._write=I.write),typeof I.writev=="function"&&(this._writev=I.writev),typeof I.destroy=="function"&&(this._destroy=I.destroy),typeof I.final=="function"&&(this._final=I.final)),void me.call(this)):new y(I)}function C(I,O){var $=new Mt;Re(I,$),c.nextTick(O,$)}function M(I,O,$,W){var b;return $===null?b=new rt:typeof $!="string"&&!O.objectMode&&(b=new Te("chunk",["string","Buffer"],$)),!b||(Re(I,b),c.nextTick(W,b),!1)}function L(I,O,$){return I.objectMode||I.decodeStrings===!1||typeof O!="string"||(O=q.from(O,$)),O}function T(I,O,$,W,b,r){if(!$){var a=L(O,W,b);W!==a&&($=!0,b="buffer",W=a)}var d=O.objectMode?1:W.length;O.length+=d;var k=O.length<O.highWaterMark;if(k||(O.needDrain=!0),O.writing||O.corked){var A=O.lastBufferedRequest;O.lastBufferedRequest={chunk:W,encoding:b,isBuf:$,callback:r,next:null},A?A.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else f(I,O,!1,d,W,b,r);return k}function f(I,O,$,W,b,r,a){O.writelen=W,O.writecb=a,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new nt("write")):$?I._writev(b,O.onwrite):I._write(b,r,O.onwrite),O.sync=!1}function _(I,O,$,W,b){--O.pendingcb,$?(c.nextTick(b,W),c.nextTick(j,I,O),I._writableState.errorEmitted=!0,Re(I,W)):(b(W),I._writableState.errorEmitted=!0,Re(I,W),j(I,O))}function S(I){I.writing=!1,I.writecb=null,I.length-=I.writelen,I.writelen=0}function R(I,O){var $=I._writableState,W=$.sync,b=$.writecb;if(typeof b!="function")throw new Je;if(S($),O)_(I,$,W,O,b);else{var r=E($)||I.destroyed;r||$.corked||$.bufferProcessing||!$.bufferedRequest||U(I,$),W?c.nextTick(v,I,$,r,b):v(I,$,r,b)}}function v(I,O,$,W){$||D(I,O),O.pendingcb--,W(),j(I,O)}function D(I,O){O.length===0&&O.needDrain&&(O.needDrain=!1,I.emit("drain"))}function U(I,O){O.bufferProcessing=!0;var $=O.bufferedRequest;if(I._writev&&$&&$.next){var W=O.bufferedRequestCount,b=Array(W),r=O.corkedRequestsFree;r.entry=$;for(var a=0,d=!0;$;)b[a]=$,$.isBuf||(d=!1),$=$.next,a+=1;b.allBuffers=d,f(I,O,!0,O.length,b,"",r.finish),O.pendingcb++,O.lastBufferedRequest=null,r.next?(O.corkedRequestsFree=r.next,r.next=null):O.corkedRequestsFree=new p(O),O.bufferedRequestCount=0}else{for(;$;){var k=$.chunk,A=$.encoding,N=$.callback,P=O.objectMode?1:k.length;if(f(I,O,!1,P,k,A,N),$=$.next,O.bufferedRequestCount--,O.writing)break}$===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=$,O.bufferProcessing=!1}function E(I){return I.ending&&I.length===0&&I.bufferedRequest===null&&!I.finished&&!I.writing}function x(I,O){I._final(function($){O.pendingcb--,$&&Re(I,$),O.prefinished=!0,I.emit("prefinish"),j(I,O)})}function F(I,O){O.prefinished||O.finalCalled||(typeof I._final!="function"||O.destroyed?(O.prefinished=!0,I.emit("prefinish")):(O.pendingcb++,O.finalCalled=!0,c.nextTick(x,I,O)))}function j(I,O){var $=E(O);if($&&(F(I,O),O.pendingcb===0&&(O.finished=!0,I.emit("finish"),O.autoDestroy))){var W=I._readableState;(!W||W.autoDestroy&&W.endEmitted)&&I.destroy()}return $}function H(I,O,$){O.ending=!0,j(I,O),$&&(O.finished?c.nextTick($):I.once("finish",$)),O.ended=!0,I.writable=!1}function Y(I,O,$){var W=I.entry;for(I.entry=null;W;){var b=W.callback;O.pendingcb--,b($),W=W.next}O.corkedRequestsFree.next=I}u.exports=y;var Z;y.WritableState=m;var oe={deprecate:i("util-deprecate")},me=i("./internal/streams/stream"),q=i("buffer").Buffer,pt=l.Uint8Array||function(){},ke=i("./internal/streams/destroy"),Ye=i("./internal/streams/state"),se=Ye.getHighWaterMark,Q=i("../errors").codes,Te=Q.ERR_INVALID_ARG_TYPE,Ge=Q.ERR_METHOD_NOT_IMPLEMENTED,Je=Q.ERR_MULTIPLE_CALLBACK,Nt=Q.ERR_STREAM_CANNOT_PIPE,nt=Q.ERR_STREAM_DESTROYED,rt=Q.ERR_STREAM_NULL_VALUES,Mt=Q.ERR_STREAM_WRITE_AFTER_END,Ke=Q.ERR_UNKNOWN_ENCODING,Re=ke.errorOrDestroy;i("inherits")(y,me),m.prototype.getBuffer=function(){for(var I=this.bufferedRequest,O=[];I;)O.push(I),I=I.next;return O},function(){try{Object.defineProperty(m.prototype,"buffer",{get:oe.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var De;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(De=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(I){return!!De.call(this,I)||this===y&&I&&I._writableState instanceof m}})):De=function(I){return I instanceof this},y.prototype.pipe=function(){Re(this,new Nt)},y.prototype.write=function(I,O,$){var W=this._writableState,b=!1,r=!W.objectMode&&h(I);return r&&!q.isBuffer(I)&&(I=w(I)),typeof O=="function"&&($=O,O=null),r?O="buffer":!O&&(O=W.defaultEncoding),typeof $!="function"&&($=g),W.ending?C(this,$):(r||M(this,W,I,$))&&(W.pendingcb++,b=T(this,W,r,I,O,$)),b},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var I=this._writableState;I.corked&&(I.corked--,!I.writing&&!I.corked&&!I.bufferProcessing&&I.bufferedRequest&&U(this,I))},y.prototype.setDefaultEncoding=function(I){if(typeof I=="string"&&(I=I.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((I+"").toLowerCase())))throw new Ke(I);return this._writableState.defaultEncoding=I,this},Object.defineProperty(y.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(I,O,$){$(new Ge("_write()"))},y.prototype._writev=null,y.prototype.end=function(I,O,$){var W=this._writableState;return typeof I=="function"?($=I,I=null,O=null):typeof O=="function"&&($=O,O=null),I!=null&&this.write(I,O),W.corked&&(W.corked=1,this.uncork()),W.ending||H(this,W,$),this},Object.defineProperty(y.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(I){this._writableState&&(this._writableState.destroyed=I)}}),y.prototype.destroy=ke.destroy,y.prototype._undestroy=ke.undestroy,y.prototype._destroy=function(I,O){O(I)}}).call(this)}).call(this,i("_process"),typeof Ie>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ie)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(i,u){(function(c){(function(){function l(D,U,E){return U in D?Object.defineProperty(D,U,{value:E,enumerable:!0,configurable:!0,writable:!0}):D[U]=E,D}function p(D,U){return{value:D,done:U}}function w(D){var U=D[C];if(U!==null){var E=D[S].read();E!==null&&(D[f]=null,D[C]=null,D[M]=null,U(p(E,!1)))}}function h(D){c.nextTick(w,D)}function g(D,U){return function(E,x){D.then(function(){return U[T]?void E(p(void 0,!0)):void U[_](E,x)},x)}}var m,y=i("./end-of-stream"),C=Symbol("lastResolve"),M=Symbol("lastReject"),L=Symbol("error"),T=Symbol("ended"),f=Symbol("lastPromise"),_=Symbol("handlePromise"),S=Symbol("stream"),R=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((m={get stream(){return this[S]},next:function(){var D=this,U=this[L];if(U!==null)return Promise.reject(U);if(this[T])return Promise.resolve(p(void 0,!0));if(this[S].destroyed)return new Promise(function(j,H){c.nextTick(function(){D[L]?H(D[L]):j(p(void 0,!0))})});var E,x=this[f];if(x)E=new Promise(g(x,this));else{var F=this[S].read();if(F!==null)return Promise.resolve(p(F,!1));E=new Promise(this[_])}return this[f]=E,E}},l(m,Symbol.asyncIterator,function(){return this}),l(m,"return",function(){var D=this;return new Promise(function(U,E){D[S].destroy(null,function(x){return x?void E(x):void U(p(void 0,!0))})})}),m),R);u.exports=function(D){var U,E=Object.create(v,(U={},l(U,S,{value:D,writable:!0}),l(U,C,{value:null,writable:!0}),l(U,M,{value:null,writable:!0}),l(U,L,{value:null,writable:!0}),l(U,T,{value:D._readableState.endEmitted,writable:!0}),l(U,_,{value:function(x,F){var j=E[S].read();j?(E[f]=null,E[C]=null,E[M]=null,x(p(j,!1))):(E[C]=x,E[M]=F)},writable:!0}),U));return E[f]=null,y(D,function(x){if(x&&x.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=E[M];return F!==null&&(E[f]=null,E[C]=null,E[M]=null,F(x)),void(E[L]=x)}var j=E[C];j!==null&&(E[f]=null,E[C]=null,E[M]=null,j(p(void 0,!0))),E[T]=!0}),D.on("readable",h.bind(null,E)),E}}).call(this)}).call(this,i("_process"))},{"./end-of-stream":24,_process:12}],22:[function(i,u){function c(f,_){var S=Object.keys(f);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(f);_&&(R=R.filter(function(v){return Object.getOwnPropertyDescriptor(f,v).enumerable})),S.push.apply(S,R)}return S}function l(f){for(var _,S=1;S<arguments.length;S++)_=arguments[S]==null?{}:arguments[S],S%2?c(Object(_),!0).forEach(function(R){p(f,R,_[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(_)):c(Object(_)).forEach(function(R){Object.defineProperty(f,R,Object.getOwnPropertyDescriptor(_,R))});return f}function p(f,_,S){return _ in f?Object.defineProperty(f,_,{value:S,enumerable:!0,configurable:!0,writable:!0}):f[_]=S,f}function w(f,_){if(!(f instanceof _))throw new TypeError("Cannot call a class as a function")}function h(f,_){for(var S,R=0;R<_.length;R++)S=_[R],S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(f,S.key,S)}function g(f,_,S){return _&&h(f.prototype,_),S&&h(f,S),f}function m(f,_,S){C.prototype.copy.call(f,_,S)}var y=i("buffer"),C=y.Buffer,M=i("util"),L=M.inspect,T=L&&L.custom||"inspect";u.exports=function(){function f(){w(this,f),this.head=null,this.tail=null,this.length=0}return g(f,[{key:"push",value:function(_){var S={data:_,next:null};0<this.length?this.tail.next=S:this.head=S,this.tail=S,++this.length}},{key:"unshift",value:function(_){var S={data:_,next:this.head};this.length===0&&(this.tail=S),this.head=S,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var S=this.head,R=""+S.data;S=S.next;)R+=_+S.data;return R}},{key:"concat",value:function(_){if(this.length===0)return C.alloc(0);for(var S=C.allocUnsafe(_>>>0),R=this.head,v=0;R;)m(R.data,S,v),v+=R.data.length,R=R.next;return S}},{key:"consume",value:function(_,S){var R;return _<this.head.data.length?(R=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?R=this.shift():R=S?this._getString(_):this._getBuffer(_),R}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var S=this.head,R=1,v=S.data;for(_-=v.length;S=S.next;){var D=S.data,U=_>D.length?D.length:_;if(v+=U===D.length?D:D.slice(0,_),_-=U,_===0){U===D.length?(++R,this.head=S.next?S.next:this.tail=null):(this.head=S,S.data=D.slice(U));break}++R}return this.length-=R,v}},{key:"_getBuffer",value:function(_){var S=C.allocUnsafe(_),R=this.head,v=1;for(R.data.copy(S),_-=R.data.length;R=R.next;){var D=R.data,U=_>D.length?D.length:_;if(D.copy(S,S.length-_,0,U),_-=U,_===0){U===D.length?(++v,this.head=R.next?R.next:this.tail=null):(this.head=R,R.data=D.slice(U));break}++v}return this.length-=v,S}},{key:T,value:function(_,S){return L(this,l({},S,{depth:0,customInspect:!1}))}}]),f}()},{buffer:3,util:2}],23:[function(i,u){(function(c){(function(){function l(h,g){w(h,g),p(h)}function p(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function w(h,g){h.emit("error",g)}u.exports={destroy:function(h,g){var m=this,y=this._readableState&&this._readableState.destroyed,C=this._writableState&&this._writableState.destroyed;return y||C?(g?g(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,c.nextTick(w,this,h)):c.nextTick(w,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(M){!g&&M?m._writableState?m._writableState.errorEmitted?c.nextTick(p,m):(m._writableState.errorEmitted=!0,c.nextTick(l,m,M)):c.nextTick(l,m,M):g?(c.nextTick(p,m),g(M)):c.nextTick(p,m)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,g){var m=h._readableState,y=h._writableState;m&&m.autoDestroy||y&&y.autoDestroy?h.destroy(g):h.emit("error",g)}}}).call(this)}).call(this,i("_process"))},{_process:12}],24:[function(i,u){function c(g){var m=!1;return function(){if(!m){m=!0;for(var y=arguments.length,C=Array(y),M=0;M<y;M++)C[M]=arguments[M];g.apply(this,C)}}}function l(){}function p(g){return g.setHeader&&typeof g.abort=="function"}function w(g,m,y){if(typeof m=="function")return w(g,null,m);m||(m={}),y=c(y||l);var C=m.readable||m.readable!==!1&&g.readable,M=m.writable||m.writable!==!1&&g.writable,L=function(){g.writable||f()},T=g._writableState&&g._writableState.finished,f=function(){M=!1,T=!0,C||y.call(g)},_=g._readableState&&g._readableState.endEmitted,S=function(){C=!1,_=!0,M||y.call(g)},R=function(U){y.call(g,U)},v=function(){var U;return C&&!_?(g._readableState&&g._readableState.ended||(U=new h),y.call(g,U)):M&&!T?(g._writableState&&g._writableState.ended||(U=new h),y.call(g,U)):void 0},D=function(){g.req.on("finish",f)};return p(g)?(g.on("complete",f),g.on("abort",v),g.req?D():g.on("request",D)):M&&!g._writableState&&(g.on("end",L),g.on("close",L)),g.on("end",S),g.on("finish",f),m.error!==!1&&g.on("error",R),g.on("close",v),function(){g.removeListener("complete",f),g.removeListener("abort",v),g.removeListener("request",D),g.req&&g.req.removeListener("finish",f),g.removeListener("end",L),g.removeListener("close",L),g.removeListener("finish",f),g.removeListener("end",S),g.removeListener("error",R),g.removeListener("close",v)}}var h=i("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;u.exports=w},{"../../../errors":15}],25:[function(i,u){u.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(i,u){function c(T){var f=!1;return function(){f||(f=!0,T.apply(void 0,arguments))}}function l(T){if(T)throw T}function p(T){return T.setHeader&&typeof T.abort=="function"}function w(T,f,_,S){S=c(S);var R=!1;T.on("close",function(){R=!0}),y===void 0&&(y=i("./end-of-stream")),y(T,{readable:f,writable:_},function(D){return D?S(D):(R=!0,void S())});var v=!1;return function(D){if(!R)return v?void 0:(v=!0,p(T)?T.abort():typeof T.destroy=="function"?T.destroy():void S(D||new L("pipe")))}}function h(T){T()}function g(T,f){return T.pipe(f)}function m(T){return T.length&&typeof T[T.length-1]=="function"?T.pop():l}var y,C=i("../../../errors").codes,M=C.ERR_MISSING_ARGS,L=C.ERR_STREAM_DESTROYED;u.exports=function(){for(var T=arguments.length,f=Array(T),_=0;_<T;_++)f[_]=arguments[_];var S=m(f);if(Array.isArray(f[0])&&(f=f[0]),2>f.length)throw new M("streams");var R,v=f.map(function(D,U){var E=U<f.length-1;return w(D,E,0<U,function(x){R||(R=x),x&&v.forEach(h),E||(v.forEach(h),S(R))})});return f.reduce(g)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(i,u){function c(p,w,h){return p.highWaterMark==null?w?p[h]:null:p.highWaterMark}var l=i("../../../errors").codes.ERR_INVALID_OPT_VALUE;u.exports={getHighWaterMark:function(p,w,h,g){var m=c(w,g,h);if(m!=null){if(!(isFinite(m)&&n(m)===m)||0>m){var y=g?h:"highWaterMark";throw new l(y,m)}return n(m)}return p.objectMode?16:16384}}},{"../../../errors":15}],28:[function(i,u){u.exports=i("events").EventEmitter},{events:7}],29:[function(i,u,c){c=u.exports=i("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=i("./lib/_stream_writable.js"),c.Duplex=i("./lib/_stream_duplex.js"),c.Transform=i("./lib/_stream_transform.js"),c.PassThrough=i("./lib/_stream_passthrough.js"),c.finished=i("./lib/internal/streams/end-of-stream.js"),c.pipeline=i("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(i,u,c){function l(g,m){for(var y in g)m[y]=g[y]}function p(g,m,y){return h(g,m,y)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=i("buffer"),h=w.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?u.exports=w:(l(w,c),c.Buffer=p),p.prototype=Object.create(h.prototype),l(h,p),p.from=function(g,m,y){if(typeof g=="number")throw new TypeError("Argument must not be a number");return h(g,m,y)},p.alloc=function(g,m,y){if(typeof g!="number")throw new TypeError("Argument must be a number");var C=h(g);return m===void 0?C.fill(0):typeof y=="string"?C.fill(m,y):C.fill(m),C},p.allocUnsafe=function(g){if(typeof g!="number")throw new TypeError("Argument must be a number");return h(g)},p.allocUnsafeSlow=function(g){if(typeof g!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(g)}},{buffer:3}],31:[function(i,u,c){function l(v){if(!v)return"utf8";for(var D;;)switch(v){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return v;default:if(D)return;v=(""+v).toLowerCase(),D=!0}}function p(v){var D=l(v);if(typeof D!="string"&&(S.isEncoding===R||!R(v)))throw new Error("Unknown encoding: "+v);return D||v}function w(v){this.encoding=p(v);var D;switch(this.encoding){case"utf16le":this.text=C,this.end=M,D=4;break;case"utf8":this.fillLast=y,D=4;break;case"base64":this.text=L,this.end=T,D=3;break;default:return this.write=f,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=S.allocUnsafe(D)}function h(v){return 127>=v?0:v>>5==6?2:v>>4==14?3:v>>3==30?4:v>>6==2?-1:-2}function g(v,D,U){var E=D.length-1;if(E<U)return 0;var x=h(D[E]);return 0<=x?(0<x&&(v.lastNeed=x-1),x):--E<U||x===-2?0:(x=h(D[E]),0<=x?(0<x&&(v.lastNeed=x-2),x):--E<U||x===-2?0:(x=h(D[E]),0<=x?(0<x&&(x===2?x=0:v.lastNeed=x-3),x):0))}function m(v,D){if((192&D[0])!=128)return v.lastNeed=0,"";if(1<v.lastNeed&&1<D.length){if((192&D[1])!=128)return v.lastNeed=1,"";if(2<v.lastNeed&&2<D.length&&(192&D[2])!=128)return v.lastNeed=2,""}}function y(v){var D=this.lastTotal-this.lastNeed,U=m(this,v);return U===void 0?this.lastNeed<=v.length?(v.copy(this.lastChar,D,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(v.copy(this.lastChar,D,0,v.length),void(this.lastNeed-=v.length)):U}function C(v,D){if((v.length-D)%2==0){var U=v.toString("utf16le",D);if(U){var E=U.charCodeAt(U.length-1);if(55296<=E&&56319>=E)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=v[v.length-1],v.toString("utf16le",D,v.length-1)}function M(v){var D=v&&v.length?this.write(v):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return D+this.lastChar.toString("utf16le",0,U)}return D}function L(v,D){var U=(v.length-D)%3;return U==0?v.toString("base64",D):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=v[v.length-1]:(this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1]),v.toString("base64",D,v.length-U))}function T(v){var D=v&&v.length?this.write(v):"";return this.lastNeed?D+this.lastChar.toString("base64",0,3-this.lastNeed):D}function f(v){return v.toString(this.encoding)}function _(v){return v&&v.length?this.write(v):""}var S=i("safe-buffer").Buffer,R=S.isEncoding||function(v){switch(v=""+v,v&&v.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=w,w.prototype.write=function(v){if(v.length===0)return"";var D,U;if(this.lastNeed){if(D=this.fillLast(v),D===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<v.length?D?D+this.text(v,U):this.text(v,U):D||""},w.prototype.end=function(v){var D=v&&v.length?this.write(v):"";return this.lastNeed?D+"":D},w.prototype.text=function(v,D){var U=g(this,v,D);if(!this.lastNeed)return v.toString("utf8",D);this.lastTotal=U;var E=v.length-(U-this.lastNeed);return v.copy(this.lastChar,0,E),v.toString("utf8",D,E)},w.prototype.fillLast=function(v){return this.lastNeed<=v.length?(v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,v.length),void(this.lastNeed-=v.length))}},{"safe-buffer":30}],32:[function(i,u){(function(c){(function(){function l(p){try{if(!c.localStorage)return!1}catch{return!1}var w=c.localStorage[p];return w!=null&&(w+"").toLowerCase()==="true"}u.exports=function(p,w){function h(){if(!g){if(l("throwDeprecation"))throw new Error(w);l("traceDeprecation")?console.trace(w):console.warn(w),g=!0}return p.apply(this,arguments)}if(l("noDeprecation"))return p;var g=!1;return h}}).call(this)}).call(this,typeof Ie>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ie)},{}],"/":[function(i,u){function c(T){return T.replace(/a=ice-options:trickle\s\n/g,"")}function l(T){console.warn(T)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const p=i("debug")("simple-peer"),w=i("get-browser-rtc"),h=i("randombytes"),g=i("readable-stream"),m=i("queue-microtask"),y=i("err-code"),{Buffer:C}=i("buffer"),M=65536;class L extends g.Duplex{constructor(f){if(f=Object.assign({allowHalfOpen:!1},f),super(f),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",f),this.channelName=f.initiator?f.channelName||h(20).toString("hex"):null,this.initiator=f.initiator||!1,this.channelConfig=f.channelConfig||L.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},L.config,f.config),this.offerOptions=f.offerOptions||{},this.answerOptions=f.answerOptions||{},this.sdpTransform=f.sdpTransform||(_=>_),this.streams=f.streams||(f.stream?[f.stream]:[]),this.trickle=f.trickle===void 0||f.trickle,this.allowHalfTrickle=f.allowHalfTrickle!==void 0&&f.allowHalfTrickle,this.iceCompleteTimeout=f.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=f.wrtc&&typeof f.wrtc=="object"?f.wrtc:w(),!this._wrtc)throw y(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(y(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(y(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(f){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof f=="string")try{f=JSON.parse(f)}catch{f={}}this._debug("signal()"),f.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),f.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(f.transceiverRequest.kind,f.transceiverRequest.init)),f.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(f.candidate):this._pendingCandidates.push(f.candidate)),f.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(f)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(y(_,"ERR_SET_REMOTE_DESCRIPTION"))}),f.sdp||f.candidate||f.renegotiate||f.transceiverRequest||this.destroy(y(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(f){const _=new this._wrtc.RTCIceCandidate(f);this._pc.addIceCandidate(_).catch(S=>{!_.address||_.address.endsWith(".local")?l("Ignoring unsupported ICE candidate."):this.destroy(y(S,"ERR_ADD_ICE_CANDIDATE"))})}send(f){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(f)}}addTransceiver(f,_){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(f,_),this._needsNegotiation()}catch(S){this.destroy(y(S,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:f,init:_}})}}addStream(f){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),f.getTracks().forEach(_=>{this.addTrack(_,f)})}}addTrack(f,_){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const S=this._senderMap.get(f)||new Map;let R=S.get(_);if(!R)R=this._pc.addTrack(f,_),S.set(_,R),this._senderMap.set(f,S),this._needsNegotiation();else throw R.removed?y(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):y(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(f,_,S){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const R=this._senderMap.get(f),v=R?R.get(S):null;if(!v)throw y(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,R),v.replaceTrack==null?this.destroy(y(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):v.replaceTrack(_)}removeTrack(f,_){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const S=this._senderMap.get(f),R=S?S.get(_):null;if(!R)throw y(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{R.removed=!0,this._pc.removeTrack(R)}catch(v){v.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(R):this.destroy(y(v,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(f){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),f.getTracks().forEach(_=>{this.removeTrack(_,f)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,m(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(f){this._destroy(f,()=>{})}_destroy(f,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",f&&(f.message||f)),m(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",f&&(f.message||f)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,f&&this.emit("error",f),this.emit("close"),_()}))}_setupData(f){if(!f.channel)return this.destroy(y(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=f.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=M),this.channelName=this._channel.label,this._channel.onmessage=S=>{this._onChannelMessage(S)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=S=>{const R=S.error instanceof Error?S.error:new Error(`Datachannel error: ${S.message} ${S.filename}:${S.lineno}:${S.colno}`);this.destroy(y(R,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(f,_,S){if(this.destroyed)return S(y(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(f)}catch(R){return this.destroy(y(R,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>M?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=S):S(null)}else this._debug("write before connect"),this._chunk=f,this._cb=S}_onFinish(){if(!this.destroyed){const f=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?f():this.once("connect",f)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(f=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(f.sdp=c(f.sdp)),f.sdp=this.sdpTransform(f.sdp);const _=()=>{if(!this.destroyed){const S=this._pc.localDescription||f;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp})}};this._pc.setLocalDescription(f).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(S=>{this.destroy(y(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(f=>{this.destroy(y(f,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(f=>{f.mid||!f.sender.track||f.requested||(f.requested=!0,this.addTransceiver(f.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(f=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(f.sdp=c(f.sdp)),f.sdp=this.sdpTransform(f.sdp);const _=()=>{if(!this.destroyed){const S=this._pc.localDescription||f;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(f).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(S=>{this.destroy(y(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(f=>{this.destroy(y(f,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(y(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const f=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",f,_),this.emit("iceStateChange",f,_),(f==="connected"||f==="completed")&&(this._pcReady=!0,this._maybeReady()),f==="failed"&&this.destroy(y(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),f==="closed"&&this.destroy(y(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(f){const _=S=>(Object.prototype.toString.call(S.values)==="[object Array]"&&S.values.forEach(R=>{Object.assign(S,R)}),S);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(S=>{const R=[];S.forEach(v=>{R.push(_(v))}),f(null,R)},S=>f(S)):0<this._pc.getStats.length?this._pc.getStats(S=>{if(this.destroyed)return;const R=[];S.result().forEach(v=>{const D={};v.names().forEach(U=>{D[U]=v.stat(U)}),D.id=v.id,D.type=v.type,D.timestamp=v.timestamp,R.push(_(D))}),f(null,R)},S=>f(S)):f(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const f=()=>{this.destroyed||this.getStats((_,S)=>{if(this.destroyed)return;_&&(S=[]);const R={},v={},D={};let U=!1;S.forEach(x=>{(x.type==="remotecandidate"||x.type==="remote-candidate")&&(R[x.id]=x),(x.type==="localcandidate"||x.type==="local-candidate")&&(v[x.id]=x),(x.type==="candidatepair"||x.type==="candidate-pair")&&(D[x.id]=x)});const E=x=>{U=!0;let F=v[x.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof x.googLocalAddress=="string"&&(F=x.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=R[x.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof x.googRemoteAddress=="string"&&(j=x.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(S.forEach(x=>{x.type==="transport"&&x.selectedCandidatePairId&&E(D[x.selectedCandidatePairId]),(x.type==="googCandidatePair"&&x.googActiveConnection==="true"||(x.type==="candidatepair"||x.type==="candidate-pair")&&x.selected)&&E(x)}),!U&&(!Object.keys(D).length||Object.keys(v).length))return void setTimeout(f,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(y(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const x=this._cb;this._cb=null,x(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};f()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>M)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(f=>{this._pc.removeTrack(f),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(f){this.destroyed||(f.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:f.candidate.candidate,sdpMLineIndex:f.candidate.sdpMLineIndex,sdpMid:f.candidate.sdpMid}}):!f.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),f.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(f){if(this.destroyed)return;let _=f.data;_ instanceof ArrayBuffer&&(_=C.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const f=this._cb;this._cb=null,f(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(f){this.destroyed||f.streams.forEach(_=>{this._debug("on track"),this.emit("track",f.track,_),this._remoteTracks.push({track:f.track,stream:_}),this._remoteStreams.some(S=>S.id===_.id)||(this._remoteStreams.push(_),m(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const f=[].slice.call(arguments);f[0]="["+this._id+"] "+f[0],p.apply(null,f)}}L.WEBRTC_SUPPORT=!!w(),L.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},L.channelConfig={},u.exports=L},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(Ti);var Nl=Ti.exports;const Ml=Ol(Nl),xr=0,Ir=1,Ri=2,Di=(t,e)=>{V(t,xr);const n=va(e);ie(t,n)},Ai=(t,e,n)=>{V(t,Ir),ie(t,wa(e,n))},Ul=(t,e,n)=>Ai(e,n,ue(t)),xi=(t,e,n)=>{try{pa(e,ue(t),n)}catch(s){console.error("Caught error while handling a Yjs update",s)}},Fl=(t,e)=>{V(t,Ri),ie(t,e)},Bl=xi,$l=(t,e,n,s)=>{const o=z(t);switch(o){case xr:Ul(t,e,n);break;case Ir:xi(t,n,s);break;case Ri:Bl(t,n,s);break;default:throw new Error("Unknown message type")}return o},Hn=3e4;class jl extends bs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=qe();this.getLocalState()!==null&&Hn/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const s=[];this.meta.forEach((o,i)=>{i!==this.clientID&&Hn<=n-o.lastUpdated&&this.states.has(i)&&s.push(i)}),s.length>0&&ir(this,s,"timeout")},Ne(Hn/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,s=this.meta.get(n),o=s===void 0?0:s.clock+1,i=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:o,lastUpdated:qe()});const u=[],c=[],l=[],p=[];e===null?p.push(n):i==null?e!=null&&u.push(n):(c.push(n),Wt(i,e)||l.push(n)),(u.length>0||l.length>0||p.length>0)&&this.emit("change",[{added:u,updated:l,removed:p},"local"]),this.emit("update",[{added:u,updated:c,removed:p},"local"])}setLocalStateField(e,n){const s=this.getLocalState();s!==null&&this.setLocalState({...s,[e]:n})}getStates(){return this.states}}const ir=(t,e,n)=>{const s=[];for(let o=0;o<e.length;o++){const i=e[o];if(t.states.has(i)){if(t.states.delete(i),i===t.clientID){const u=t.meta.get(i);t.meta.set(i,{clock:u.clock+1,lastUpdated:qe()})}s.push(i)}}s.length>0&&(t.emit("change",[{added:[],updated:[],removed:s},n]),t.emit("update",[{added:[],updated:[],removed:s},n]))},Cn=(t,e,n=t.states)=>{const s=e.length,o=he();V(o,s);for(let i=0;i<s;i++){const u=e[i],c=n.get(u)||null,l=t.meta.get(u).clock;V(o,u),V(o,l),Le(o,JSON.stringify(c))}return re(o)},Pl=(t,e,n)=>{const s=$e(e),o=qe(),i=[],u=[],c=[],l=[],p=z(s);for(let w=0;w<p;w++){const h=z(s);let g=z(s);const m=JSON.parse(We(s)),y=t.meta.get(h),C=t.states.get(h),M=y===void 0?0:y.clock;(M<g||M===g&&m===null&&t.states.has(h))&&(m===null?h===t.clientID&&t.getLocalState()!=null?g++:t.states.delete(h):t.states.set(h,m),t.meta.set(h,{clock:g,lastUpdated:o}),y===void 0&&m!==null?i.push(h):y!==void 0&&m===null?l.push(h):m!==null&&(Wt(m,C)||c.push(h),u.push(h)))}(i.length>0||c.length>0||l.length>0)&&t.emit("change",[{added:i,updated:c,removed:l},n]),(i.length>0||u.length>0||l.length>0)&&t.emit("update",[{added:i,updated:u,removed:l},n])},Wl=(t,e)=>{const n=Zn(t).buffer,s=Zn(e).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(o=>crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},Ii=(t,e)=>{if(!e)return gr(t);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,t).then(s=>{const o=he();return Le(o,"AES-GCM"),ie(o,n),ie(o,new Uint8Array(s)),re(o)})},Vl=(t,e)=>{const n=he();return Et(n,t),Ii(re(n),e)},Li=(t,e)=>{if(!e)return gr(t);const n=$e(t);We(n)!=="AES-GCM"&&To(Me("Unknown encryption algorithm"));const o=ue(n),i=ue(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:o},e,i).then(u=>new Uint8Array(u))},ql=(t,e)=>Li(t,e).then(n=>kt($e(new Uint8Array(n)))),be=ra("y-webrtc"),vt=0,Oi=3,Zt=1,Lr=4,En=new Map,at=new Map,Ni=t=>{let e=!0;t.webrtcConns.forEach(n=>{n.synced||(e=!1)}),(!e&&t.synced||e&&!t.synced)&&(t.synced=e,t.provider.emit("synced",[{synced:e}]),be("synced ",Ee,t.name,ct," with all peers"))},Mi=(t,e,n)=>{const s=$e(e),o=he(),i=z(s);if(t===void 0)return null;const u=t.awareness,c=t.doc;let l=!1;switch(i){case vt:{V(o,vt);const p=$l(s,o,c,t);p===Ir&&!t.synced&&n(),p===xr&&(l=!0);break}case Oi:V(o,Zt),ie(o,Cn(u,Array.from(u.getStates().keys()))),l=!0;break;case Zt:Pl(u,ue(s),t);break;case Lr:{const p=lt(s)===1,w=We(s);if(w!==t.peerId&&(t.bcConns.has(w)&&!p||!t.bcConns.has(w)&&p)){const h=[],g=[];p?(t.bcConns.add(w),g.push(w)):(t.bcConns.delete(w),h.push(w)),t.provider.emit("peers",[{added:g,removed:h,webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]),Ui(t)}break}default:return console.error("Unable to compute message"),o}return l?o:null},Hl=(t,e)=>{const n=t.room;return be("received message from ",Ee,t.remotePeerId,mr," (",n.name,")",ct,xn),Mi(n,e,()=>{t.synced=!0,be("synced ",Ee,n.name,ct," with ",Ee,t.remotePeerId),Ni(n)})},zn=(t,e)=>{be("send message to ",Ee,t.remotePeerId,ct,mr," (",t.room.name,")",xn);try{t.peer.send(re(e))}catch{}},zl=(t,e)=>{be("broadcast message in ",Ee,t.name,ct),t.webrtcConns.forEach(n=>{try{n.peer.send(e)}catch{}})};class as{constructor(e,n,s,o){be("establishing connection to ",Ee,s),this.room=o,this.remotePeerId=s,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new Ml({initiator:n,...o.provider.peerOpts}),this.peer.on("signal",i=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),Or(e,o,{to:s,from:o.peerId,type:"signal",token:this.glareToken,signal:i})}),this.peer.on("connect",()=>{be("connected to ",Ee,s),this.connected=!0;const u=o.provider.doc,c=o.awareness,l=he();V(l,vt),Di(l,u),zn(this,l);const p=c.getStates();if(p.size>0){const w=he();V(w,Zt),ie(w,Cn(c,Array.from(p.keys()))),zn(this,w)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,o.webrtcConns.has(this.remotePeerId)&&(o.webrtcConns.delete(this.remotePeerId),o.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}])),Ni(o),this.peer.destroy(),be("closed connection to ",Ee,s),or(o)}),this.peer.on("error",i=>{be("Error in connection to ",Ee,s,": ",i),or(o)}),this.peer.on("data",i=>{const u=Hl(this,i);u!==null&&zn(this,u)})}destroy(){this.peer.destroy()}}const Xe=(t,e)=>Ii(e,t.key).then(n=>t.mux(()=>Il(t.name,n))),ls=(t,e)=>{t.bcconnected&&Xe(t,e),zl(t,e)},or=t=>{En.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[t.name]}),t.webrtcConns.size<t.provider.maxConns&&Or(e,t,{type:"announce",from:t.peerId}))})},Ui=t=>{if(t.provider.filterBcConns){const e=he();V(e,Lr),Yt(e,1),Le(e,t.peerId),Xe(t,re(e))}};class Yl{constructor(e,n,s,o){this.peerId=ks(),this.doc=e,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=s,this.key=o,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Ll(),this.bcconnected=!1,this._bcSubscriber=i=>Li(new Uint8Array(i),o).then(u=>this.mux(()=>{const c=Mi(this,u,()=>{});c&&Xe(this,re(c))})),this._docUpdateHandler=(i,u)=>{const c=he();V(c,vt),Fl(c,i),ls(this,re(c))},this._awarenessUpdateHandler=({added:i,updated:u,removed:c},l)=>{const p=i.concat(u).concat(c),w=he();V(w,Zt),ie(w,Cn(this.awareness,p)),ls(this,re(w))},this._beforeUnloadHandler=()=>{ir(this.awareness,[e.clientID],"window unload"),at.forEach(i=>{i.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),or(this);const e=this.name;Al(e,this._bcSubscriber),this.bcconnected=!0,Ui(this);const n=he();V(n,vt),Di(n,this.doc),Xe(this,re(n));const s=he();V(s,vt),Ai(s,this.doc),Xe(this,re(s));const o=he();V(o,Oi),Xe(this,re(o));const i=he();V(i,Zt),ie(i,Cn(this.awareness,[this.doc.clientID])),Xe(this,re(i))}disconnect(){En.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),ir(this.awareness,[this.doc.clientID],"disconnect");const e=he();V(e,Lr),Yt(e,0),Le(e,this.peerId),Xe(this,re(e)),xl(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const Gl=(t,e,n,s)=>{if(at.has(n))throw Me(`A Yjs Doc connected to room "${n}" already exists!`);const o=new Yl(t,e,n,s);return at.set(n,o),o},Or=(t,e,n)=>{e.key?Vl(n,e.key).then(s=>{t.send({type:"publish",topic:e.name,data:Ns(s)})}):t.send({type:"publish",topic:e.name,data:n})};class Jl extends Tl{constructor(e){super(e),this.providers=new Set,this.on("connect",()=>{be(`connected (${e})`);const n=Array.from(at.keys());this.send({type:"subscribe",topics:n}),at.forEach(s=>Or(this,s,{type:"announce",from:s.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const s=n.topic,o=at.get(s);if(o==null||typeof s!="string")return;const i=u=>{const c=o.webrtcConns,l=o.peerId;if(u==null||u.from===l||u.to!==void 0&&u.to!==l||o.bcConns.has(u.from))return;const p=c.has(u.from)?()=>{}:()=>o.provider.emit("peers",[{removed:[],added:[u.from],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}]);switch(u.type){case"announce":c.size<o.provider.maxConns&&(Se(c,u.from,()=>new as(this,!0,u.from,o)),p());break;case"signal":if(u.signal.type==="offer"){const w=c.get(u.from);if(w){const h=u.token,g=w.glareToken;if(g&&g>h){be("offer rejected: ",u.from);return}w.glareToken=void 0}}if(u.signal.type==="answer"){be("offer answered by: ",u.from);const w=c.get(u.from);w.glareToken=void 0}u.to===l&&(Se(c,u.from,()=>new as(this,!1,u.from,o)).peer.signal(u.signal),p());break}};o.key?typeof n.data=="string"&&ql(Ms(n.data),o.key).then(i):i(n.data)}}}),this.on("disconnect",()=>be(`disconnect (${e})`))}}const Yn=t=>{t.emit("status",[{connected:t.connected}])};class Kl extends ws{constructor(e,n,{signaling:s=["wss://y-webrtc-eu.fly.dev"],password:o=null,awareness:i=new jl(n),maxConns:u=20+Ne(Eo()*15),filterBcConns:c=!0,peerOpts:l={}}={}){super(),this.roomName=e,this.doc=n,this.filterBcConns=c,this.awareness=i,this.shouldConnect=!1,this.signalingUrls=s,this.signalingConns=[],this.maxConns=u,this.peerOpts=l,this.key=o?Wl(o,e):gr(null),this.room=null,this.key.then(p=>{this.room=Gl(n,this,e,p),this.shouldConnect?this.room.connect():this.room.disconnect(),Yn(this)}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{const n=Se(En,e,()=>new Jl(e));this.signalingConns.push(n),n.providers.add(this)}),this.room&&(this.room.connect(),Yn(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),e.providers.size===0&&(e.destroy(),En.delete(e.url))}),this.room&&(this.room.disconnect(),Yn(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),at.delete(this.roomName)}),super.destroy()}}const cs=["#FF5733","#33A8FF","#33FF57","#FF33A8","#A833FF","#FFBD33","#33FFC1","#FF5733"],ne=document.getElementById("editor"),Vt=document.getElementById("status"),qt=document.getElementById("username"),us=document.getElementById("session-id"),Xl=document.getElementById("join-btn"),Zl=document.getElementById("save-btn"),Ql=document.getElementById("session-display"),ec=document.getElementById("current-session"),hs=document.getElementById("copy-notification"),tc=document.getElementById("theme-toggle"),ds=document.getElementById("moon-icon"),fs=document.getElementById("sun-icon");qt.value="User"+Math.floor(Math.random()*1e3);let Ae=null,Bt=[];function nc(){if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.location.search.includes("debug=true")){Ae=document.createElement("div"),Ae.id="mobile-debug-console",Ae.style.cssText=`
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      font-family: monospace;
      font-size: 10px;
      padding: 10px;
      padding-top: 40px;
      overflow-y: auto;
      z-index: 10000;
      border-top: 2px solid #333;
      display: none;
    `;const e=document.createElement("button");e.textContent=" Copy",e.style.cssText=`
      position: fixed;
      top: auto;
      bottom: 160px;
      right: 10px;
      background: #444;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      z-index: 10002;
      min-height: 32px;
      min-width: 70px;
      touch-action: manipulation;
    `,e.onclick=async()=>{try{const l=Bt.map(w=>`[${w.timestamp}] ${w.type}: ${w.message}`).join(`
`);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else{const w=document.createElement("textarea");w.value=l,w.style.position="fixed",w.style.left="-999999px",w.style.top="-999999px",document.body.appendChild(w),w.focus(),w.select(),document.execCommand("copy"),document.body.removeChild(w)}const p=e.textContent;e.textContent=" Copied!",e.style.background="#28a745",setTimeout(()=>{e.textContent=p,e.style.background="#444"},2e3)}catch(l){console.error("Failed to copy debug console:",l),e.textContent=" Failed",e.style.background="#dc3545",setTimeout(()=>{e.textContent=" Copy",e.style.background="#444"},2e3)}};const n=()=>{e.style.display=Ae.style.display==="block"?"block":"none"};document.body.appendChild(e),document.body.appendChild(Ae);const s=document.createElement("button");s.textContent=" Debug",s.style.cssText=`
      position: fixed;
      bottom: 63px;
      right: 16px;
      z-index: 10001;
      background: #333;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      touch-action: manipulation;
    `,s.onclick=()=>{const l=Ae.style.display==="block";Ae.style.display=l?"none":"block",s.textContent=l?" Debug":" Close",n()};const o=document.createElement("button");o.textContent=" Diagnostics",o.style.cssText=`
      position: fixed;
      bottom: 105px;
      right: 16px;
      z-index: 10001;
      background: #007acc;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      touch-action: manipulation;
    `,o.onclick=async()=>{var p,w,h,g;console.log(" Mobile diagnostics triggered...");const l=o.textContent;o.textContent=" Running...",o.style.background="#ffa500";try{await Fi(),B?(console.log("Provider exists:",!!B),console.log("Provider room:",B.room),console.log("Signaling connections:",((p=B.signalingConns)==null?void 0:p.length)||0),console.log("WebRTC connections:",((h=(w=B.room)==null?void 0:w.webrtcConns)==null?void 0:h.size)||0),console.log("Awareness states:",B.awareness.getStates().size),console.log("Document synced:",B.synced),(g=B.room)!=null&&g.webrtcConns&&B.room.webrtcConns.forEach((m,y)=>{m.peer&&console.log(`Peer ${y} details:`,{connectionState:m.peer.connectionState,iceConnectionState:m.peer.iceConnectionState,iceGatheringState:m.peer.iceGatheringState,signalingState:m.peer.signalingState})})):console.log(" No provider found"),o.textContent=" Complete",o.style.background="#28a745"}catch(m){console.error("Diagnostic error:",m),o.textContent=" Error",o.style.background="#dc3545"}setTimeout(()=>{o.textContent=l,o.style.background="#007acc"},3e3)},document.body.appendChild(s),document.body.appendChild(o),n();const i=console.log,u=console.error,c=console.warn;console.log=function(...l){i.apply(console,l),Gn("LOG",l.join(" "))},console.error=function(...l){u.apply(console,l),Gn("ERROR",l.join(" "))},console.warn=function(...l){c.apply(console,l),Gn("WARN",l.join(" "))}}}function Gn(t,e){if(!Ae)return;const n=new Date().toLocaleTimeString();Bt.push({type:t,message:e,timestamp:n}),Bt.length>100&&Bt.shift(),Ae.innerHTML=Bt.map(s=>`<div style="color: ${s.type==="ERROR"?"#ff4444":s.type==="WARN"?"#ffaa00":"#00ff00"}; margin-bottom: 2px; word-wrap: break-word;">[${s.timestamp}] ${s.type}: ${s.message}</div>`).join(""),Ae.scrollTop=Ae.scrollHeight}async function Fi(){console.log(" Testing network connectivity...");const t=[{name:"Google DNS",url:"https://dns.google/resolve?name=example.com&type=A"},{name:"Cloudflare DNS",url:"https://cloudflare-dns.com/dns-query?name=example.com&type=A",headers:{Accept:"application/dns-json"}},{name:"YJS Signaling",url:"https://demos.yjs.dev"}],e={};for(const n of t)try{const s=Date.now(),o=await fetch(n.url,{method:"GET",headers:n.headers||{},mode:"cors",cache:"no-cache"}),i=Date.now();e[n.name]={success:o.ok,status:o.status,latency:i-s,error:null},console.log(` ${n.name}: ${o.status} (${i-s}ms)`)}catch(s){e[n.name]={success:!1,status:null,latency:null,error:s.message},console.error(` ${n.name}: ${s.message}`)}try{console.log(" Testing WebSocket connectivity...");const n=new WebSocket("wss://demos.yjs.dev/ws");await new Promise((s,o)=>{const i=setTimeout(()=>{n.close(),o(new Error("WebSocket connection timeout"))},5e3);n.onopen=()=>{clearTimeout(i),console.log(" WebSocket connection successful"),e.WebSocket={success:!0,error:null},n.close(),s()},n.onerror=u=>{clearTimeout(i),console.error(" WebSocket connection failed:",u),e.WebSocket={success:!1,error:"Connection failed"},o(u)}})}catch(n){e.WebSocket={success:!1,error:n.message}}return console.log(" Network connectivity test results:",e),e}nc();function rc(){const t=localStorage.getItem("theme");if(t)ar(t);else{const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;ar(e?"dark":"light")}}function ar(t){t==="dark"?(document.documentElement.setAttribute("data-theme","dark"),ds.style.display="none",fs.style.display="block"):(document.documentElement.removeAttribute("data-theme"),ds.style.display="block",fs.style.display="none")}function sc(){const e=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";ar(e),localStorage.setItem("theme",e)}rc();tc.addEventListener("click",sc);const kn=document.getElementById("header-toggle"),lr=document.querySelector(".header");let $t=!1;function Bi(){$t=!$t,$t?(lr.classList.add("header--hidden"),kn.classList.add("header-toggle--hidden")):(lr.classList.remove("header--hidden"),kn.classList.remove("header-toggle--hidden")),localStorage.setItem("headerHidden",$t)}function ic(){localStorage.getItem("headerHidden")==="true"&&($t=!0,lr.classList.add("header--hidden"),kn.classList.add("header-toggle--hidden"))}kn.addEventListener("click",Bi);ic();function $i(){return crypto===void 0||!crypto.randomUUID?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}):crypto.randomUUID()}function oc(){return new URLSearchParams(window.location.search).get("session")||$i()}function ac(t){const e=new URL(window.location);e.searchParams.set("session",t),window.history.pushState({},"",e)}function lc(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}let it,B,ge,sn=oc(),Ct={},jt={};function ji(t){var m,y,C,M,L;B&&B.destroy(),it&&it.destroy(),it=new Lt,ge=it.getText("content");const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=n?n.effectiveType:"unknown";console.log(`Network detection - Mobile: ${e}, Type: ${s}`);const o=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"}],i=[{urls:["turn:openrelay.metered.ca:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:["turn:global.turn.twilio.com:443?transport=tcp"],username:"dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",credential:"tE2DajzSJwnsSbc123"},{urls:["turn:turn.anyfirewall.com:443?transport=tcp"],username:"webrtc",credential:"webrtc"},{urls:["turn:openrelay.metered.ca:80?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"}],u=[{urls:["turn:openrelay.metered.ca:80","turn:openrelay.metered.ca:443","turn:openrelay.metered.ca:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:["turn:relay1.expressturn.com:3478","turn:relay1.expressturn.com:80"],username:"efSLANXM7179I8RTB5",credential:"T0C0Ej5r6eWBjNppC"},{urls:["turn:global.turn.twilio.com:3478?transport=udp","turn:global.turn.twilio.com:3478?transport=tcp"],username:"dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",credential:"tE2DajzSJwnsSbc123"}],c=e||navigator.connection&&navigator.connection.type==="cellular"||window.location.protocol==="https:"&&window.location.hostname!=="localhost";let l;c?(l=[...o,...i],console.log(" Firewall detected - using TCP-only TURN servers on ports 443/80")):(l=[...o,...i,...u],console.log(" Normal network - using all TURN servers")),console.log(` ICE Servers configured: ${l.length} servers (${l.filter(T=>Array.isArray(T.urls)?T.urls.some(f=>f.includes("turn:")):T.urls.includes("turn:")).length} TURN)`),i.forEach((T,f)=>{console.log(` Firewall bypass TURN ${f}: ${Array.isArray(T.urls)?T.urls[0]:T.urls}`)});const p={iceServers:l,iceCandidatePoolSize:c?20:15,iceTransportPolicy:c?"relay":"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceConnectionReceivingTimeout:c?2e4:15e3,iceInactiveTimeout:c?6e4:45e3,iceCandidateTimeout:c?15e3:1e4};console.log(" RTC Configuration:",{iceServers:p.iceServers.length,iceCandidatePoolSize:p.iceCandidatePoolSize,iceTransportPolicy:p.iceTransportPolicy,firewallMode:c,crossNetwork:!0}),c&&console.log(" Firewall mode enabled - forcing TURN relay connections");const w=["wss://demos.yjs.dev/ws","wss://signaling.yjs.dev/ws","wss://y-webrtc-signaling.herokuapp.com","wss://yjs-websocket-server.glitch.me"];let h;e?(h=[w[0]],console.log(" Mobile: Using single signaling server (Safari WebSocket limit workaround)")):(h=w.slice(0,2),console.log(` Desktop: Using ${h.length} signaling servers`)),console.log(" Signaling servers:",h),B=new Kl(`vibe_notes_${t}`,it,{signaling:h,maxConns:e?15:25,filterBcConns:!1,peerOpts:{config:p}}),console.log("=== WebRTC Debug Info ==="),console.log(`Session ID: ${t}`),console.log(`Room: ${B.roomName}`),console.log(`URL: ${window.location.href}`),console.log(`User Agent: ${navigator.userAgent}`),console.log(`Is Secure Context: ${window.isSecureContext}`),console.log(`Mobile Device: ${e}`),console.log(`Network Type: ${s}`),console.log(`ICE Servers Count: ${l.length} (${l.filter(T=>Array.isArray(T.urls)?T.urls.some(f=>f.includes("turn:")):T.urls.includes("turn:")).length} TURN servers)`),console.log("RTCConfiguration:",p),console.log(`[${new Date().toISOString()}]  Setting up signaling monitoring...`),B.on("status",T=>{console.log(`[${new Date().toISOString()}]  Provider Status Event:`,{status:T.status,type:typeof T.status,event:T}),T.status==="connected"||T.status===!0||T.connected===!0?(console.log(`[${new Date().toISOString()}]  Provider connected to signaling`),setTimeout(()=>{var _;console.log(`[${new Date().toISOString()}]  Broadcasting peer presence...`);const f=((_=B.awareness.getLocalState())==null?void 0:_.user)||{};B.awareness.setLocalStateField("user",{...f,name:f.name||qt.value.trim()||`User${Math.floor(Math.random()*1e3)}`,joinedAt:Date.now(),sessionId:t,announced:!0}),console.log(`[${new Date().toISOString()}]  Peer announcement sent via awareness`)},1e3)):(T.status==="disconnected"||T.status===!1)&&console.log(`[${new Date().toISOString()}]  Disconnected from signaling server`)}),setTimeout(()=>{var f;console.log(`[${new Date().toISOString()}]  Force broadcasting peer presence (fallback)...`);const T=((f=B.awareness.getLocalState())==null?void 0:f.user)||{};B.awareness.setLocalStateField("user",{...T,name:T.name||qt.value.trim()||`User${Math.floor(Math.random()*1e3)}`,joinedAt:Date.now(),sessionId:t,forcedAnnounce:!0}),console.log(`[${new Date().toISOString()}]  Fallback peer announcement sent`)},3e3),e&&(setTimeout(()=>{var S,R,v;const T=((S=B.signalingConns)==null?void 0:S.filter(D=>D.connected).length)||0;if(console.log(`[${new Date().toISOString()}]  Mobile: Requesting awareness sync (${T}/${((R=B.signalingConns)==null?void 0:R.length)||0} servers connected)...`),T===0){console.error(`[${new Date().toISOString()}]  No signaling servers connected - cannot sync`);return}const f=B.awareness.getStates();console.log(`[${new Date().toISOString()}]  Current awareness states:`,Array.from(f.keys()));const _=((v=B.awareness.getLocalState())==null?void 0:v.user)||{};B.awareness.setLocalStateField("user",{..._,syncRequest:Date.now(),requestSync:!0,signalingServers:T}),console.log(`[${new Date().toISOString()}]  Mobile sync request sent`)},5e3),setTimeout(()=>{var f;if(B.awareness.getStates().size-1===0){console.log(`[${new Date().toISOString()}]  Mobile: Still no peers after 10s, trying signaling server rotation...`),B.signalingConns&&B.signalingConns.length>0&&B.signalingConns.forEach((S,R)=>{if(S&&S.send&&S.readyState===WebSocket.OPEN)try{[{type:"sync-request",room:`vibe_notes_${t}`,clientId:B.awareness.clientID,timestamp:Date.now()},{type:"peer-discovery",room:`vibe_notes_${t}`,clientId:B.awareness.clientID,mobile:!0,timestamp:Date.now()}].forEach(D=>{S.send(JSON.stringify(D))}),console.log(`[${new Date().toISOString()}]  Sent enhanced sync requests via signaling ${R} (${S.url})`)}catch(v){console.log(`[${new Date().toISOString()}]  Failed to send sync request to server ${R}:`,v)}else console.log(`[${new Date().toISOString()}]  Signaling ${R} not ready:`,{exists:!!S,canSend:!!(S&&S.send),readyState:S==null?void 0:S.readyState})});const _=((f=B.awareness.getLocalState())==null?void 0:f.user)||{};B.awareness.setLocalStateField("user",{..._,forceSync:Date.now(),mobile:!0,crossNetwork:!0}),console.log(`[${new Date().toISOString()}]  Forced awareness broadcast for cross-network discovery`)}},1e4),setTimeout(()=>{B.awareness.getStates().size-1===0&&(console.log(`[${new Date().toISOString()}]  Mobile: No peers after 20s - signaling isolation detected`),console.log(`[${new Date().toISOString()}]  Signaling servers may be load-balanced or partitioned`),B.signalingConns&&B.signalingConns.forEach((f,_)=>{console.log(`[${new Date().toISOString()}]  Signaling ${_} status:`,{url:f.url,connected:f.connected,readyState:f.readyState,bufferedAmount:f.bufferedAmount})}))},2e4)),setTimeout(()=>{B.signalingConns&&B.signalingConns.length>0?(console.log(`[${new Date().toISOString()}]  Monitoring ${B.signalingConns.length} signaling connections:`),B.signalingConns.forEach((T,f)=>{console.log(`[${new Date().toISOString()}]  Signaling ${f}:`,{url:T.url||"unknown",connected:T.connected||!1,readyState:T.readyState||"unknown",type:typeof T}),T&&typeof T.addEventListener=="function"&&(T.addEventListener("open",()=>{console.log(`[${new Date().toISOString()}]  Signaling ${f} (${T.url}) opened`)}),T.addEventListener("close",()=>{console.log(`[${new Date().toISOString()}]  Signaling ${f} (${T.url}) closed`)}),T.addEventListener("error",_=>{console.log(`[${new Date().toISOString()}]  Signaling ${f} (${T.url}) error:`,_)}))})):console.log(`[${new Date().toISOString()}]  No signaling connections found`)},500),B.on("peers",T=>{console.log(`[${new Date().toISOString()}] Peers Event:`,T);const f=B.awareness.getStates().size-1;console.log(`Current peer count: ${f}`)}),B.awareness.on("change",T=>{var _,S,R;console.log(`[${new Date().toISOString()}]  Awareness Change:`,T),console.log(`Awareness Change: added=${((_=T.added)==null?void 0:_.length)||0}, updated=${((S=T.updated)==null?void 0:S.length)||0}, removed=${((R=T.removed)==null?void 0:R.length)||0}`);const f=B.awareness.getStates();console.log("All connected clients:",Array.from(f.keys()).join(", ")),f.forEach((v,D)=>{console.log(`Client ${D} state:`,v)}),T.added&&T.added.length>0&&T.added.forEach(v=>{const D=f.get(v);console.log(`[${new Date().toISOString()}]  New client joined: ${v}`,D)}),T.removed&&T.removed.length>0&&T.removed.forEach(v=>{console.log(`[${new Date().toISOString()}]  Client left: ${v}`)}),ps()}),setInterval(()=>{if(B&&B.awareness){const T=B.awareness.getLocalState();if(T&&T.user){const f=B.awareness.getStates().size-1;B.awareness.setLocalStateField("user",{...T.user,lastSeen:Date.now(),heartbeat:Date.now(),peerCount:f}),console.log(`[${new Date().toISOString()}]  Heartbeat sent - peers: ${f}`),e&&f===0&&(console.log(`[${new Date().toISOString()}]  Mobile heartbeat: No peers, requesting sync`),B.awareness.setLocalStateField("user",{...T.user,syncRequest:Date.now(),needsSync:!0}))}}},1e4),B.on("connection-error",T=>{console.error(`[${new Date().toISOString()}] WebRTC Connection Error:`,T)}),B.room&&B.room.webrtcConns&&setTimeout(()=>{B.room.webrtcConns.forEach((T,f)=>{T.peer&&T.peer.connectionState&&(console.log(`Peer ${f} connection state: ${T.peer.connectionState}`),T.peer.addEventListener("connectionstatechange",()=>{console.log(` Peer ${f} connection state changed: ${T.peer.connectionState}`),T.peer.connectionState==="failed"?(console.error(` Connection to peer ${f} failed`),T.peer.iceConnectionState&&console.error(`ICE connection state: ${T.peer.iceConnectionState}`)):T.peer.connectionState==="connected"&&console.log(` Successfully connected to peer ${f}`)}),T.peer.addEventListener("icegatheringstatechange",()=>{console.log(` Peer ${f} ICE gathering state: ${T.peer.iceGatheringState}`)}),T.peer.addEventListener("icecandidate",_=>{_.candidate?console.log(` ICE candidate for peer ${f}:`,{type:_.candidate.type,protocol:_.candidate.protocol,address:_.candidate.address,port:_.candidate.port,priority:_.candidate.priority}):console.log(` ICE candidate gathering complete for peer ${f}`)}))})},1e3),B.on("sync",T=>{console.log(`[${new Date().toISOString()}] Document Sync:`,T?" Synced":" Syncing...")}),setTimeout(()=>{var f,_,S,R,v;console.log(`Provider Client ID: ${B.awareness.clientID}`),console.log(`Connected Peers: ${B.awareness.getStates().size-1}`),console.log(`Provider roomName property: ${B.roomName}`),console.log(`Provider connected: ${B.connected}`),console.log(`Signaling connections: ${((f=B.signalingConns)==null?void 0:f.length)||0}`),console.log("Provider properties:",Object.getOwnPropertyNames(B)),console.log(" Signaling server status:"),(_=B.signalingConns)==null||_.forEach((D,U)=>{console.log(`Signaling ${U}: ${D.url||"no url"} - connected: ${D.connected||"false"}, readyState: ${D.readyState||"unknown"}`)});const T=((S=B.signalingConns)==null?void 0:S.filter(D=>D.connected).length)||0;console.log(` Connected to ${T}/${((R=B.signalingConns)==null?void 0:R.length)||0} signaling servers`),T===0?console.warn(" No signaling servers connected - peer discovery will fail"):T<(((v=B.signalingConns)==null?void 0:v.length)||0)&&console.warn(` Only ${T} signaling servers connected - reduced peer discovery`)},2e3),B.on("peers",T=>{console.log("Peer connection event:",T)}),Ql.textContent=t,sn=t,ac(t);const g=qt.value.trim()||"User"+Math.floor(Math.random()*1e3);if(B.awareness.setLocalStateField("user",{name:g,cursor:null}),B.awareness.on("change",()=>{gs(),ps()}),B.on("status",T=>{T.status==="connected"?Vt.style.backgroundColor="rgba(0,255,0,0.2)":Vt.style.backgroundColor="rgba(255,0,0,0.2)"}),gs(),hc(),B.room){const T=(C=(y=(m=B.room.webrtcConns)==null?void 0:m.constructor)==null?void 0:y.prototype)==null?void 0:C.createPeer;T&&(B.room.webrtcConns.constructor.prototype.createPeer=function(f,_){const S=T.call(this,f,_);console.log(`[${new Date().toISOString()}]  Creating peer connection to ${f}, initiator: ${_}`);let R=0,v=0,D=0;return S.addEventListener("icecandidate",U=>{if(U.candidate){const E=U.candidate;E.type==="host"?R++:E.type==="srflx"?v++:E.type==="relay"&&D++,console.log(`[${new Date().toISOString()}]  ICE candidate for peer ${f}:`,{type:E.type,protocol:E.protocol,address:E.address,port:E.port,priority:E.priority,foundation:E.foundation,component:E.component,relatedAddress:E.relatedAddress,relatedPort:E.relatedPort}),E.type==="relay"?(console.log(`[${new Date().toISOString()}]  TURN relay candidate found for peer ${f}!`),(E.port===443||E.port===80)&&console.log(`[${new Date().toISOString()}]  Firewall-friendly port ${E.port} detected`)):E.type==="host"&&c?console.warn(`[${new Date().toISOString()}]  Host candidate in firewall mode - may be blocked`):E.type==="srflx"&&c&&console.warn(`[${new Date().toISOString()}]  STUN candidate in firewall mode - may be blocked`)}else console.log(`[${new Date().toISOString()}]  ICE gathering complete for peer ${f} - Host: ${R}, STUN: ${v}, TURN: ${D}`),D===0?(console.error(`[${new Date().toISOString()}]  No TURN relay candidates found for peer ${f} - connection will likely fail`),c&&console.error(`[${new Date().toISOString()}]  Firewall detected but no TURN relays - network may be blocking TURN servers`)):console.log(`[${new Date().toISOString()}]  ${D} TURN relay candidates found - firewall bypass possible`)}),S.addEventListener("iceconnectionstatechange",()=>{console.log(`[${new Date().toISOString()}]  ICE connection state for peer ${f}: ${S.iceConnectionState}`),S.iceConnectionState==="failed"?(console.error(`[${new Date().toISOString()}]  ICE connection failed for peer ${f}`),console.error(c?`[${new Date().toISOString()}]  Firewall likely blocking WebRTC - try different network or VPN`:`[${new Date().toISOString()}]  NAT traversal issue - TURN servers may be unreachable`)):S.iceConnectionState==="connected"&&(console.log(`[${new Date().toISOString()}]  ICE connection established for peer ${f}`),c&&console.log(`[${new Date().toISOString()}]  Firewall bypass successful!`))}),S.addEventListener("connectionstatechange",()=>{console.log(`[${new Date().toISOString()}]  Connection state for peer ${f}: ${S.connectionState}`),S.connectionState==="failed"?console.error(`[${new Date().toISOString()}]  WebRTC connection failed for peer ${f}`):S.connectionState==="connected"&&console.log(`[${new Date().toISOString()}]  WebRTC connection established for peer ${f}`)}),S.addEventListener("datachannel",U=>{console.log(`[${new Date().toISOString()}]  Data channel opened for peer ${f}:`,U.channel.label)}),S}),B.room.on&&B.room.on("peer",(f,_)=>{console.log(`[${new Date().toISOString()}]  Room peer event: ${_}`)}),console.log(`[${new Date().toISOString()}]  Room initialized:`,{name:B.room.name,peersCount:((M=B.room.webrtcConns)==null?void 0:M.size)||0,bcConns:((L=B.room.bcConns)==null?void 0:L.size)||0,crossNetworkMode:!0,turnServersConfigured:l.filter(f=>Array.isArray(f.urls)?f.urls.some(_=>_.includes("turn:")):f.urls.includes("turn:")).length}),setTimeout(()=>{var _;const f=((_=B.room.webrtcConns)==null?void 0:_.size)||0;f===0?c?(console.error(`[${new Date().toISOString()}]  Firewall blocking WebRTC connections after 15 seconds`),console.log(`[${new Date().toISOString()}]  Try: Different network, VPN, or disable firewall`)):(console.warn(`[${new Date().toISOString()}]  No WebRTC connections after 15 seconds - possible NAT/network issue`),console.log(`[${new Date().toISOString()}]  Check TURN server accessibility and network configuration`)):(console.log(`[${new Date().toISOString()}]  ${f} WebRTC connections established`),c&&console.log(`[${new Date().toISOString()}]  Firewall bypass successful with ${f} connections`))},15e3)}}function cc(t,e,n){let s=0;const o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let i;for(;i=o.nextNode();){if(i===e)return s+n;s+=i.textContent.length}return t.textContent.length}function uc(t,e){const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let s=0,o;for(;o=n.nextNode();){const i=o.textContent.length;if(s+i>=e){const u=document.createRange();return u.setStart(o,Math.min(e-s,i)),u.setEnd(o,Math.min(e-s,i)),u}s+=i}if(t.lastChild&&t.lastChild.nodeType===Node.TEXT_NODE){const i=document.createRange();return i.setStart(t.lastChild,t.lastChild.textContent.length),i.setEnd(t.lastChild,t.lastChild.textContent.length),i}return null}function hc(){let t=!1;ne.textContent=ge.toString(),ge.observe(e=>{if(e.transaction.origin!==B.awareness.clientID&&!t){const n=window.getSelection(),s=n.rangeCount>0;let o=null;if(s&&ne.contains(n.anchorNode)){const i=n.getRangeAt(0);o=cc(ne,i.startContainer,i.startOffset)}if(ne.textContent=ge.toString(),s&&o!==null)try{const i=uc(ne,o);i&&(n.removeAllRanges(),n.addRange(i))}catch(i){console.warn("Failed to restore cursor position:",i)}}}),ne.addEventListener("input",()=>{t=!0;const e=lc(ne.innerText);ge.delete(0,ge.length),ge.insert(0,e),t=!1,Ft()}),ne.addEventListener("mouseup",Ft),ne.addEventListener("keyup",Ft),ne.addEventListener("click",Ft),setTimeout(()=>{ne.focus(),Ft()},100)}function gs(){if(!B)return;const t=B.awareness.getStates().size;Vt.textContent=`Connected with ${t-1} peer${t!==2?"s":""}`,t>1?Vt.style.backgroundColor="rgba(0,255,0,0.2)":Vt.style.backgroundColor="rgba(255,165,0,0.2)"}Xl.addEventListener("click",()=>{const t=us.value.trim()||$i();Nr(),jt={},ji(t),us.value=""});ji(sn);ec.addEventListener("click",()=>{const t=new URL(window.location);t.searchParams.set("session",sn);const e=t.toString();navigator.clipboard.writeText(e).then(()=>{hs.classList.add("show"),setTimeout(()=>{hs.classList.remove("show")},2e3)}).catch(n=>{console.error("Failed to copy URL: ",n)})});window.addEventListener("beforeunload",()=>{B&&B.destroy(),it&&it.destroy(),Nr()});function Ft(){if(!B||!B.awareness)return;const t=window.getSelection();if(!t.rangeCount)return;const e=t.getRangeAt(0);if(!ne.contains(e.startContainer))return;let n;const s=document.createElement("span");if(s.innerHTML="&#8203;",e.cloneRange().insertNode(s),n=s.getBoundingClientRect(),n.height===0){const l=(s.parentNode||ne).getBoundingClientRect(),p=window.getComputedStyle(ne),w=parseInt(p.lineHeight)||27;n={left:l.left+24,top:l.top,width:0,height:w}}if(s.parentNode&&s.parentNode.removeChild(s),t.removeAllRanges(),t.addRange(e),e.startContainer===ne&&e.startOffset===0){const c=ne.getBoundingClientRect();n={left:c.left+24,top:c.top+24,width:0,height:27}}const i=ne.getBoundingClientRect(),u={left:n.left-i.left,top:n.top-i.top};B.awareness.setLocalStateField("user",{name:qt.value.trim()||"User"+Math.floor(Math.random()*1e3),cursor:u})}function ps(){if(!B||!B.awareness)return;Nr();const t=B.awareness.getStates(),e=B.awareness.clientID;t.forEach((n,s)=>{s===e||!n.user||!n.user.cursor||fc(s,n.user)})}function dc(){if(!B||!B.awareness)return;const t=B.awareness.getStates(),e=B.awareness.clientID;t.forEach((n,s)=>{if(s===e||!n.user||!n.user.cursor)return;const o=Ct[s];if(o){const i=n.user.cursor,u=ne.getBoundingClientRect(),c=u.left+i.left,l=u.top+i.top;o.style.left=`${c}px`,o.style.top=`${l}px`}})}function fc(t,e){if(!jt[t]){const l=Object.keys(jt).length%cs.length;jt[t]=cs[l]}const n=jt[t],s=e.cursor;if(!s||typeof s.left!="number"||typeof s.top!="number")return;if(!Ct[t]){const l=document.createElement("div");l.className="remote-cursor",l.style.backgroundColor=n;const p=document.createElement("div");p.className="cursor-label",p.style.backgroundColor=n,p.textContent=e.name||"Anonymous",l.appendChild(p),document.body.appendChild(l),Ct[t]=l}const o=Ct[t],i=ne.getBoundingClientRect(),u=i.left+s.left,c=i.top+s.top;o.style.left=`${u}px`,o.style.top=`${c}px`,o.style.display="block"}function Nr(){Object.values(Ct).forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),Ct={}}async function Pi(){var o;const t=ne.innerText||ne.textContent||"";if(!t.trim()){alert("No content to save!");return}const e=new Date,n=e.toISOString().slice(0,19).replace(/[T:]/g,"-"),s=`${roomName??"vibe_notes"}_${n}`;if("showSaveFilePicker"in window&&window.isSecureContext)try{const i=await window.showSaveFilePicker({suggestedName:s,excludeAcceptAllOption:!1,types:[{description:"All files",accept:{"*/*":[]}}]}),u=i.name,c=((o=u.split(".").pop())==null?void 0:o.toLowerCase())||"txt";let l=t;switch(c){case"html":case"htm":l=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${u.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":l=JSON.stringify({title:u.replace(/\.[^/.]+$/,""),content:t,timestamp:e.toISOString(),sessionId:sn},null,2);break;default:l=t}const p=await i.createWritable();await p.write(l),await p.close(),console.log(` Notes saved as: ${u}`);return}catch(i){if(i.name==="AbortError"){console.log("User cancelled save dialog");return}console.error("Native save dialog failed:",i.message)}gc(t,s)}function gc(t,e){var p;const n=prompt("Enter filename with extension:",e);if(n===null||!n.trim())return;const s=((p=n.split(".").pop())==null?void 0:p.toLowerCase())||"txt";let o=t,i="text/plain;charset=utf-8";switch(s){case"md":case"markdown":i="text/markdown;charset=utf-8";break;case"html":case"htm":i="text/html;charset=utf-8",o=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${n.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":i="application/json;charset=utf-8",o=JSON.stringify({title:n.replace(/\.[^/.]+$/,""),content:t,timestamp:new Date().toISOString(),sessionId:sn},null,2);break;default:i="text/plain;charset=utf-8"}const u=new Blob([o],{type:i}),c=URL.createObjectURL(u),l=document.createElement("a");l.href=c,l.download=n,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),console.log(` Notes downloaded as: ${n}`)}let Jn=!1;async function Wi(){if(Jn){console.log(" Load already in progress, ignoring duplicate call");return}Jn=!0;try{if("showOpenFilePicker"in window&&window.isSecureContext){const[t]=await window.showOpenFilePicker({multiple:!1,excludeAcceptAllOption:!1,types:[{description:"Text files",accept:{"text/plain":[".txt",".md",".markdown"],"text/javascript":[".js",".mjs"],"text/typescript":[".ts"],"text/html":[".html",".htm"],"application/json":[".json"],"text/css":[".css"],"text/xml":[".xml"],"application/xml":[".xml"],"text/*":[".log",".conf",".ini",".cfg"]}}]}),e=await t.getFile(),n=await e.text();ne&&ge&&ge.doc.transact(()=>{ge.delete(0,ge.length),ge.insert(0,n)}),console.log(` Loaded file: ${e.name} (${e.size} bytes)`)}else ys()}catch(t){t.name==="AbortError"?console.log("User cancelled file selection"):(console.error("Error loading file:",t),ys())}finally{Jn=!1}}function ys(){const t=document.createElement("input");t.type="file",t.accept=".txt,.md,.markdown,.js,.mjs,.ts,.html,.htm,.json,.css,.xml,.log,.conf,.ini,.cfg,text/*",t.style.display="none",t.addEventListener("change",async e=>{const n=e.target.files[0];if(n)try{const s=await n.text();ne&&ge&&ge.doc.transact(()=>{ge.delete(0,ge.length),ge.insert(0,s)}),console.log(` Loaded file: ${n.name} (${n.size} bytes)`)}catch(s){console.error("Error reading file:",s),alert("Error reading file: "+s.message)}finally{document.body.removeChild(t)}}),document.body.appendChild(t),t.click()}Zl.addEventListener("click",Pi);const pc=document.getElementById("load-btn");pc.addEventListener("click",Wi);let ms;window.addEventListener("resize",()=>{clearTimeout(ms),ms=setTimeout(()=>{dc()},100)});document.addEventListener("keydown",t=>{var e,n,s,o;(t.ctrlKey||t.metaKey)&&t.key==="o"&&(t.preventDefault(),Wi()),(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),Pi()),t.key==="F11"&&(t.preventDefault(),Bi()),t.ctrlKey&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),console.log(" Manual diagnostics triggered..."),Fi(),B?(console.log("Provider exists:",!!B),console.log("Provider room:",B.room),console.log("Signaling connections:",((e=B.signalingConns)==null?void 0:e.length)||0),console.log("WebRTC connections:",((s=(n=B.room)==null?void 0:n.webrtcConns)==null?void 0:s.size)||0),console.log("Awareness states:",B.awareness.getStates().size),console.log("Document synced:",B.synced),(o=B.room)!=null&&o.webrtcConns&&B.room.webrtcConns.forEach((i,u)=>{i.peer&&console.log(`Peer ${u} details:`,{connectionState:i.peer.connectionState,iceConnectionState:i.peer.iceConnectionState,iceGatheringState:i.peer.iceGatheringState,signalingState:i.peer.signalingState})})):console.log(" No provider found"))});
