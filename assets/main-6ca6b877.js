(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const me=()=>new Map,Ar=t=>{const e=me();return t.forEach((n,r)=>{e.set(r,n)}),e},Ee=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},sl=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},ol=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},tt=()=>new Set,Zn=t=>t[t.length-1],ll=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ve=Array.from,cl=Array.isArray;class Cs{constructor(){this._observers=me()}on(e,n){return Ee(this._observers,e,tt).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ve((this._observers.get(e)||me()).values()).forEach(r=>r(...n))}destroy(){this._observers=me()}}class Ss{constructor(){this._observers=me()}on(e,n){Ee(this._observers,e,tt).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ve((this._observers.get(e)||me()).values()).forEach(r=>r(...n))}destroy(){this._observers=me()}}const Oe=Math.floor,En=Math.abs,al=Math.log10,Yr=(t,e)=>t<e?t:e,yt=(t,e)=>t>e?t:e,Rs=t=>t!==0?t<0:1/t<0,Ei=1,Ci=2,Qn=4,er=8,tn=32,He=64,_e=128,jn=31,Tr=63,ct=127,ul=2147483647,ks=Number.MAX_SAFE_INTEGER,hl=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Oe(t)===t),dl=String.fromCharCode,fl=t=>t.toLowerCase(),gl=/^\s*/g,pl=t=>t.replace(gl,""),yl=/([A-Z])/g,Si=(t,e)=>pl(t.replace(yl,n=>`${e}${fl(n)}`)),wl=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},nn=typeof TextEncoder<"u"?new TextEncoder:null,ml=t=>nn.encode(t),xr=nn?ml:wl;let Zt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Zt&&Zt.decode(new Uint8Array).length===1&&(Zt=null);class hn{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fe=()=>new hn,bl=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},ne=t=>{const e=new Uint8Array(bl(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},_l=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(yt(n,e)*2),t.cpos=0)},he=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},rn=he,N=(t,e)=>{for(;e>ct;)he(t,_e|ct&e),e=Oe(e/128);he(t,ct&e)},Gr=(t,e)=>{const n=Rs(e);for(n&&(e=-e),he(t,(e>Tr?_e:0)|(n?He:0)|Tr&e),e=Oe(e/64);e>0;)he(t,(e>ct?_e:0)|ct&e),e=Oe(e/128)},Ir=new Uint8Array(3e4),El=Ir.length/3,Cl=(t,e)=>{if(e.length<El){const n=nn.encodeInto(e,Ir).written||0;N(t,n);for(let r=0;r<n;r++)he(t,Ir[r])}else oe(t,xr(e))},Sl=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;N(t,r);for(let i=0;i<r;i++)he(t,n.codePointAt(i))},Le=nn&&nn.encodeInto?Cl:Sl,$n=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Yr(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(yt(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},oe=(t,e)=>{N(t,e.byteLength),$n(t,e)},zr=(t,e)=>{_l(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Rl=(t,e)=>zr(t,4).setFloat32(0,e,!1),kl=(t,e)=>zr(t,8).setFloat64(0,e,!1),vl=(t,e)=>zr(t,8).setBigInt64(0,e,!1),Ri=new DataView(new ArrayBuffer(4)),Al=t=>(Ri.setFloat32(0,t),Ri.getFloat32(0)===t),Lt=(t,e)=>{switch(typeof e){case"string":he(t,119),Le(t,e);break;case"number":hl(e)&&En(e)<=ul?(he(t,125),Gr(t,e)):Al(e)?(he(t,124),Rl(t,e)):(he(t,123),kl(t,e));break;case"bigint":he(t,122),vl(t,e);break;case"object":if(e===null)he(t,126);else if(cl(e)){he(t,117),N(t,e.length);for(let n=0;n<e.length;n++)Lt(t,e[n])}else if(e instanceof Uint8Array)he(t,116),oe(t,e);else{he(t,118);const n=Object.keys(e);N(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Le(t,i),Lt(t,e[i])}}break;case"boolean":he(t,e?120:121);break;default:he(t,127)}};class ki extends hn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&N(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const vi=t=>{t.count>0&&(Gr(t.encoder,t.count===1?t.s:-t.s),t.count>1&&N(t.encoder,t.count-2))};class Cn{constructor(){this.encoder=new hn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(vi(this),this.count=1,this.s=e)}toUint8Array(){return vi(this),ne(this.encoder)}}const Ai=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Gr(t.encoder,e),t.count>1&&N(t.encoder,t.count-2)}};class tr{constructor(){this.encoder=new hn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Ai(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Ai(this),ne(this.encoder)}}class Tl{constructor(){this.sarr=[],this.s="",this.lensE=new Cn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new hn;return this.sarr.push(this.s),this.s="",Le(e,this.sarr.join("")),$n(e,this.lensE.toUint8Array()),ne(e)}}const Me=t=>new Error(t),Be=()=>{throw Me("Method unimplemented")},Ne=()=>{throw Me("Unexpected case")},vs=Me("Unexpected end of array"),As=Me("Integer out of Range");class Hn{constructor(e){this.arr=e,this.pos=0}}const Pe=t=>new Hn(t),xl=t=>t.pos!==t.arr.length,Il=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},de=t=>Il(t,$(t)),ut=t=>t.arr[t.pos++],$=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ct)*n,n*=128,i<_e)return e;if(e>ks)throw As}throw vs},Jr=t=>{let e=t.arr[t.pos++],n=e&Tr,r=64;const i=(e&He)>0?-1:1;if(!(e&_e))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ct)*r,r*=128,e<_e)return i*n;if(n>ks)throw As}throw vs},Dl=t=>{let e=$(t);if(e===0)return"";{let n=String.fromCodePoint(ut(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ut(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Ll=t=>Zt.decode(de(t)),We=Zt?Ll:Dl,Kr=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},Bl=t=>Kr(t,4).getFloat32(0,!1),Ol=t=>Kr(t,8).getFloat64(0,!1),Ml=t=>Kr(t,8).getBigInt64(0,!1),Nl=[t=>{},t=>null,Jr,Bl,Ol,Ml,t=>!1,t=>!0,We,t=>{const e=$(t),n={};for(let r=0;r<e;r++){const i=We(t);n[i]=Bt(t)}return n},t=>{const e=$(t),n=[];for(let r=0;r<e;r++)n.push(Bt(t));return n},de],Bt=t=>Nl[127-ut(t)](t);class Ti extends Hn{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),xl(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class Sn extends Hn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Jr(this);const e=Rs(this.s);this.count=1,e&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class nr extends Hn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Jr(this),n=e&1;this.diff=Oe(e/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Fl{constructor(e){this.decoder=new Sn(e),this.str=We(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const Ul=crypto.getRandomValues.bind(crypto),Pl=Math.random,Ts=()=>Ul(new Uint32Array(1))[0],jl=[1e7]+-1e3+-4e3+-8e3+-1e11,xs=()=>jl.replace(/[018]/g,t=>(t^Ts()&15>>t/4).toString(16)),qe=Date.now,xi=t=>new Promise(t);Promise.all.bind(Promise);const $l=t=>Promise.reject(t),Xr=t=>Promise.resolve(t),Ii=t=>t===void 0?null:t;class Hl{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Is=new Hl,Zr=!0;try{typeof localStorage<"u"&&localStorage&&(Is=localStorage,Zr=!1)}catch{}const Ds=Is,Wl=t=>Zr||addEventListener("storage",t),Vl=t=>Zr||removeEventListener("storage",t),ql=Object.assign,Ls=Object.keys,Yl=(t,e)=>{for(const n in t)e(t[n],n)},Di=t=>Ls(t).length,Li=t=>Ls(t).length,Gl=t=>{for(const e in t)return!1;return!0},zl=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Bs=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Jl=(t,e)=>t===e||Li(t)===Li(e)&&zl(t,(n,r)=>(n!==void 0||Bs(e,r))&&e[r]===n),Kl=Object.freeze,Os=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Os(t[e])}return Kl(t)},Bi=Symbol("Equality"),Qr=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Qr(t,e,n+1)}},Xl=()=>{},Zl=t=>t,Qt=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[Bi]!=null)return t[Bi](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Qt(t.get(n),e.get(n)))return!1;break}case Object:if(Di(t)!==Di(e))return!1;for(const n in t)if(!Bs(t,n)||!Qt(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Qt(t[n],e[n]))return!1;break;default:return!1}return!0},Ql=(t,e)=>e.includes(t),Ot=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Ms=typeof window<"u"&&typeof document<"u"&&!Ot;let Ie;const ec=()=>{if(Ie===void 0)if(Ot){Ie=me();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Ie.set(e,""),e=r):e!==null&&(Ie.set(e,r),e=null)}e!==null&&Ie.set(e,"")}else typeof location=="object"?(Ie=me(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Ie.set(`--${Si(e,"-")}`,n),Ie.set(`-${Si(e,"-")}`,n)}})):Ie=me();return Ie},Dr=t=>ec().has(t),sn=t=>Ii(Ot?process.env[t.toUpperCase().replaceAll("-","_")]:Ds.getItem(t)),Ns=t=>Dr("--"+t)||sn(t)!==null;Ns("production");const tc=Ot&&Ql({}.FORCE_COLOR,["true","1","2"]),nc=tc||!Dr("--no-colors")&&!Ns("no-color")&&(!Ot||process.stdout.isTTY)&&(!Ot||Dr("--color")||sn("COLORTERM")!==null||(sn("TERM")||"").includes("color")),Fs=t=>new Uint8Array(t),rc=(t,e,n)=>new Uint8Array(t,e,n),ic=t=>new Uint8Array(t),sc=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=dl(t[n]);return btoa(e)},oc=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),lc=t=>{const e=atob(t),n=Fs(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},cc=t=>{const e=Buffer.from(t,"base64");return rc(e.buffer,e.byteOffset,e.byteLength)},Us=Ms?sc:oc,Ps=Ms?lc:cc,ac=t=>{const e=Fs(t.byteLength);return e.set(t),e};class uc{constructor(e,n){this.left=e,this.right=n}}const $e=(t,e)=>new uc(t,e);typeof DOMParser<"u"&&new DOMParser;const hc=t=>sl(t,(e,n)=>`${n}:${e};`).join(""),dc=JSON.stringify,Ge=Symbol,le=Ge(),ht=Ge(),js=Ge(),ei=Ge(),$s=Ge(),Hs=Ge(),Ws=Ge(),Wn=Ge(),Vn=Ge(),fc=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Oi=[$s,Ws,Wn,js];let rr=0,Mi=qe();const gc=(t,e)=>{const n=Oi[rr],r=sn("log"),i=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(e));return rr=(rr+1)%Oi.length,e+=": ",i?(...s)=>{var u;s.length===1&&((u=s[0])==null?void 0:u.constructor)===Function&&(s=s[0]());const a=qe(),l=a-Mi;Mi=a,t(n,e,Vn,...s.map(d=>{switch(d!=null&&d.constructor===Uint8Array&&(d=Array.from(d)),typeof d){case"string":case"symbol":return d;default:return dc(d)}}),n," +"+l+"ms")}:Xl},pc={[le]:$e("font-weight","bold"),[ht]:$e("font-weight","normal"),[js]:$e("color","blue"),[$s]:$e("color","green"),[ei]:$e("color","grey"),[Hs]:$e("color","red"),[Ws]:$e("color","purple"),[Wn]:$e("color","orange"),[Vn]:$e("color","black")},yc=t=>{var a;t.length===1&&((a=t[0])==null?void 0:a.constructor)===Function&&(t=t[0]());const e=[],n=[],r=me();let i=[],s=0;for(;s<t.length;s++){const l=t[s],u=pc[l];if(u!==void 0)r.set(u.left,u.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const d=hc(r);s>0||d.length>0?(e.push("%c"+l),n.push(d)):e.push(l)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const l=t[s];l instanceof Symbol||i.push(l)}return i},Vs=nc?yc:fc,qs=(...t)=>{console.log(...Vs(t)),Ys.forEach(e=>e.print(t))},wc=(...t)=>{console.warn(...Vs(t)),t.unshift(Wn),Ys.forEach(e=>e.print(t))},Ys=tt(),mc=t=>gc(qs,t),Gs=t=>({[Symbol.iterator](){return this},next:t}),bc=(t,e)=>Gs(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),ir=(t,e)=>Gs(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ti{constructor(e,n){this.clock=e,this.len=n}}class dn{constructor(){this.clients=new Map}}const zs=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const a=s[s.length-1],l=a.id.clock+a.length;for(let u=0,d=r[u];u<r.length&&d.clock<l;d=r[++u])lo(t,s,d.clock,d.len,n)}}),_c=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Oe((n+r)/2),s=t[i],a=s.clock;if(a<=e){if(e<a+s.len)return i;n=i+1}else r=i-1}return null},Js=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&_c(n,e.clock)!==null},ni=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=yt(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},Ec=t=>{const e=new dn;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let a=n+1;a<t.length;a++)ll(s,t[a].clients.get(i)||[]);e.clients.set(i,s)}});return ni(e),e},vn=(t,e,n,r)=>{Ee(t.clients,e,()=>[]).push(new ti(n,r))},Cc=()=>new dn,Sc=t=>{const e=Cc();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const a=n[s];if(a.deleted){const l=a.id.clock;let u=a.length;if(s+1<n.length)for(let d=n[s+1];s+1<n.length&&d.deleted;d=n[++s+1])u+=d.length;i.push(new ti(l,u))}}i.length>0&&e.clients.set(r,i)}),e},jt=(t,e)=>{N(t.restEncoder,e.clients.size),Ve(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),N(t.restEncoder,n);const i=r.length;N(t.restEncoder,i);for(let s=0;s<i;s++){const a=r[s];t.writeDsClock(a.clock),t.writeDsLen(a.len)}})},ri=t=>{const e=new dn,n=$(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=$(t.restDecoder),s=$(t.restDecoder);if(s>0){const a=Ee(e.clients,i,()=>[]);for(let l=0;l<s;l++)a.push(new ti(t.readDsClock(),t.readDsLen()))}}return e},Ni=(t,e,n)=>{const r=new dn,i=$(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const a=$(t.restDecoder),l=$(t.restDecoder),u=n.clients.get(a)||[],d=ge(n,a);for(let f=0;f<l;f++){const w=t.readDsClock(),b=w+t.readDsLen();if(w<d){d<b&&vn(r,a,d,b-d);let E=Fe(u,w),k=u[E];for(!k.deleted&&k.id.clock<w&&(u.splice(E+1,0,Bn(e,k,w-k.id.clock)),E++);E<u.length&&(k=u[E++],k.id.clock<b);)k.deleted||(b<k.id.clock+k.length&&u.splice(E,0,Bn(e,k,b-k.id.clock)),k.delete(e))}else vn(r,a,w,b-w)}}if(r.clients.size>0){const s=new dt;return N(s.restEncoder,0),jt(s,r),s.toUint8Array()}return null},Ks=Ts;class $t extends Cs{constructor({guid:e=xs(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:a=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Ks(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new so,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=a,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=xi(d=>{this.on("load",()=>{this.isLoaded=!0,d(this)})});const u=()=>xi(d=>{const f=w=>{(w===void 0||w===!0)&&(this.off("sync",f),d())};this.on("sync",f)});this.on("sync",d=>{d===!1&&this.isSynced&&(this.whenSynced=u()),this.isSynced=d===void 0||d===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=u()}load(){const e=this._item;e!==null&&!this.shouldLoad&&X(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ve(this.subdocs).map(e=>e.guid))}transact(e,n=null){return X(this,e,n)}get(e,n=ye){const r=Ee(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ye&&i!==n)if(i===ye){const s=new n;s._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=s}),s._start=r._start;for(let a=s._start;a!==null;a=a.right)a.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,xt)}getText(e=""){return this.get(e,Ft)}getMap(e=""){return this.get(e,Nt)}getXmlElement(e=""){return this.get(e,Ut)}getXmlFragment(e=""){return this.get(e,ft)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ve(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new $t({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,X(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Xs{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class Zs extends Xs{readLeftID(){return z($(this.restDecoder),$(this.restDecoder))}readRightID(){return z($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return ut(this.restDecoder)}readString(){return We(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return Bt(this.restDecoder)}readBuf(){return ac(de(this.restDecoder))}readJSON(){return JSON.parse(We(this.restDecoder))}readKey(){return We(this.restDecoder)}}class Rc{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const e=$(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Mt extends Rc{constructor(e){super(e),this.keys=[],$(e),this.keyClockDecoder=new nr(de(e)),this.clientDecoder=new Sn(de(e)),this.leftClockDecoder=new nr(de(e)),this.rightClockDecoder=new nr(de(e)),this.infoDecoder=new Ti(de(e),ut),this.stringDecoder=new Fl(de(e)),this.parentInfoDecoder=new Ti(de(e),ut),this.typeRefDecoder=new Sn(de(e)),this.lenDecoder=new Sn(de(e))}readLeftID(){return new Tt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Tt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Bt(this.restDecoder)}readBuf(){return de(this.restDecoder)}readJSON(){return Bt(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Qs{constructor(){this.restEncoder=fe()}toUint8Array(){return ne(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){N(this.restEncoder,e)}writeDsLen(e){N(this.restEncoder,e)}}class fn extends Qs{writeLeftID(e){N(this.restEncoder,e.client),N(this.restEncoder,e.clock)}writeRightID(e){N(this.restEncoder,e.client),N(this.restEncoder,e.clock)}writeClient(e){N(this.restEncoder,e)}writeInfo(e){rn(this.restEncoder,e)}writeString(e){Le(this.restEncoder,e)}writeParentInfo(e){N(this.restEncoder,e?1:0)}writeTypeRef(e){N(this.restEncoder,e)}writeLen(e){N(this.restEncoder,e)}writeAny(e){Lt(this.restEncoder,e)}writeBuf(e){oe(this.restEncoder,e)}writeJSON(e){Le(this.restEncoder,JSON.stringify(e))}writeKey(e){Le(this.restEncoder,e)}}class eo{constructor(){this.restEncoder=fe(),this.dsCurrVal=0}toUint8Array(){return ne(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,N(this.restEncoder,n)}writeDsLen(e){e===0&&Ne(),N(this.restEncoder,e-1),this.dsCurrVal+=e}}class dt extends eo{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new tr,this.clientEncoder=new Cn,this.leftClockEncoder=new tr,this.rightClockEncoder=new tr,this.infoEncoder=new ki(rn),this.stringEncoder=new Tl,this.parentInfoEncoder=new ki(rn),this.typeRefEncoder=new Cn,this.lenEncoder=new Cn}toUint8Array(){const e=fe();return N(e,0),oe(e,this.keyClockEncoder.toUint8Array()),oe(e,this.clientEncoder.toUint8Array()),oe(e,this.leftClockEncoder.toUint8Array()),oe(e,this.rightClockEncoder.toUint8Array()),oe(e,ne(this.infoEncoder)),oe(e,this.stringEncoder.toUint8Array()),oe(e,ne(this.parentInfoEncoder)),oe(e,this.typeRefEncoder.toUint8Array()),oe(e,this.lenEncoder.toUint8Array()),$n(e,ne(this.restEncoder)),ne(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Lt(this.restEncoder,e)}writeBuf(e){oe(this.restEncoder,e)}writeJSON(e){Lt(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const kc=(t,e,n,r)=>{r=yt(r,e[0].id.clock);const i=Fe(e,r);N(t.restEncoder,e.length-i),t.writeClient(n),N(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let a=i+1;a<e.length;a++)e[a].write(t,0)},ii=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{ge(e,s)>i&&r.set(s,i)}),qn(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),N(t.restEncoder,r.size),Ve(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{kc(t,e.clients.get(i),i,s)})},vc=(t,e)=>{const n=me(),r=$(t.restDecoder);for(let i=0;i<r;i++){const s=$(t.restDecoder),a=new Array(s),l=t.readClient();let u=$(t.restDecoder);n.set(l,{i:0,refs:a});for(let d=0;d<s;d++){const f=t.readInfo();switch(jn&f){case 0:{const w=t.readLen();a[d]=new Re(z(l,u),w),u+=w;break}case 10:{const w=$(t.restDecoder);a[d]=new ke(z(l,u),w),u+=w;break}default:{const w=(f&(He|_e))===0,b=new ae(z(l,u),null,(f&_e)===_e?t.readLeftID():null,null,(f&He)===He?t.readRightID():null,w?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,w&&(f&tn)===tn?t.readString():null,Ao(t,f));a[d]=b,u+=b.length}}}}return n},Ac=(t,e,n)=>{const r=[];let i=Ve(n.keys()).sort((E,k)=>E-k);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let E=n.get(i[i.length-1]);for(;E.refs.length===E.i;)if(i.pop(),i.length>0)E=n.get(i[i.length-1]);else return null;return E};let a=s();if(a===null)return null;const l=new so,u=new Map,d=(E,k)=>{const A=u.get(E);(A==null||A>k)&&u.set(E,k)};let f=a.refs[a.i++];const w=new Map,b=()=>{for(const E of r){const k=E.id.client,A=n.get(k);A?(A.i--,l.clients.set(k,A.refs.slice(A.i)),n.delete(k),A.i=0,A.refs=[]):l.clients.set(k,[E]),i=i.filter(D=>D!==k)}r.length=0};for(;;){if(f.constructor!==ke){const k=Ee(w,f.id.client,()=>ge(e,f.id.client))-f.id.clock;if(k<0)r.push(f),d(f.id.client,f.id.clock-1),b();else{const A=f.getMissing(t,e);if(A!==null){r.push(f);const D=n.get(A)||{refs:[],i:0};if(D.refs.length===D.i)d(A,ge(e,A)),b();else{f=D.refs[D.i++];continue}}else(k===0||k<f.length)&&(f.integrate(t,k),w.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(a!==null&&a.i<a.refs.length)f=a.refs[a.i++];else{if(a=s(),a===null)break;f=a.refs[a.i++]}}if(l.clients.size>0){const E=new dt;return ii(E,l,new Map),N(E.restEncoder,0),{missing:u,update:E.toUint8Array()}}return null},Tc=(t,e)=>ii(t,e.doc.store,e.beforeState),xc=(t,e,n,r=new Mt(t))=>X(e,i=>{i.local=!1;let s=!1;const a=i.doc,l=a.store,u=vc(r,a),d=Ac(i,l,u),f=l.pendingStructs;if(f){for(const[b,E]of f.missing)if(E<ge(l,b)){s=!0;break}if(d){for(const[b,E]of d.missing){const k=f.missing.get(b);(k==null||k>E)&&f.missing.set(b,E)}f.update=An([f.update,d.update])}}else l.pendingStructs=d;const w=Ni(r,i,l);if(l.pendingDs){const b=new Mt(Pe(l.pendingDs));$(b.restDecoder);const E=Ni(b,i,l);w&&E?l.pendingDs=An([w,E]):l.pendingDs=w||E}else l.pendingDs=w;if(s){const b=l.pendingStructs.update;l.pendingStructs=null,to(i.doc,b)}},n,!1),to=(t,e,n,r=Mt)=>{const i=Pe(e);xc(i,t,n,new r(i))},Ic=(t,e,n)=>to(t,e,n,Zs),Dc=(t,e,n=new Map)=>{ii(t,e.store,n),jt(t,Sc(e.store))},Lc=(t,e=new Uint8Array([0]),n=new dt)=>{const r=no(e);Dc(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(zc(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===fn)return Yc(i.map((s,a)=>a===0?s:Kc(s)));if(n.constructor===dt)return An(i)}return i[0]},Bc=(t,e)=>Lc(t,e,new fn),Oc=t=>{const e=new Map,n=$(t.restDecoder);for(let r=0;r<n;r++){const i=$(t.restDecoder),s=$(t.restDecoder);e.set(i,s)}return e},no=t=>Oc(new Xs(Pe(t))),ro=(t,e)=>(N(t.restEncoder,e.size),Ve(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{N(t.restEncoder,n),N(t.restEncoder,r)}),t),Mc=(t,e)=>ro(t,qn(e.store)),Nc=(t,e=new eo)=>(t instanceof Map?ro(e,t):Mc(e,t),e.toUint8Array()),Fc=t=>Nc(t,new Qs);class Uc{constructor(){this.l=[]}}const Fi=()=>new Uc,Ui=(t,e)=>t.l.push(e),Pi=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},io=(t,e,n)=>Qr(t.l,[e,n]);class Tt{constructor(e,n){this.client=e,this.clock=n}}const mn=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,z=(t,e)=>new Tt(t,e),Pc=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ne()},At=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Js(e.ds,t.id),Lr=(t,e)=>{const n=Ee(t.meta,Lr,tt),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<ge(r,s)&&nt(t,z(s,i))}),zs(t,e.ds,i=>{}),n.add(e))};class so{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const qn=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},ge=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},oo=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Ne()}n.push(e)},Fe=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let a=Oe(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[a],s=i.id.clock,s<=e){if(e<s+i.length)return a;n=a+1}else r=a-1;a=Oe((n+r)/2)}throw Ne()},jc=(t,e)=>{const n=t.clients.get(e.client);return n[Fe(n,e.clock)]},sr=jc,Br=(t,e,n)=>{const r=Fe(e,n),i=e[r];return i.id.clock<n&&i instanceof ae?(e.splice(r+1,0,Bn(t,i,n-i.id.clock)),r+1):r},nt=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Br(t,n,e.clock)]},ji=(t,e,n)=>{const r=e.clients.get(n.client),i=Fe(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Re&&r.splice(i+1,0,Bn(t,s,n.clock-s.id.clock+1)),s},$c=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Fe(r,e.id.clock)]=n},lo=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let a=Br(t,e,n),l;do l=e[a++],s<l.id.clock+l.length&&Br(t,e,s),i(l);while(a<e.length&&e[a].id.clock<s)};class Hc{constructor(e,n,r){this.doc=e,this.deleteSet=new dn,this.beforeState=qn(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const $i=(t,e)=>e.deleteSet.clients.size===0&&!ol(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ni(e.deleteSet),Tc(t,e),jt(t,e.deleteSet),!0),Hi=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ee(t.changed,e,tt).add(n)},Rn=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ae&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},Wc=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let a=i.length-1;a>=0;a--){const l=i[a],u=l.clock+l.len;for(let d=Fe(s,l.clock),f=s[d];d<s.length&&f.id.clock<u;f=s[++d]){const w=s[d];if(l.clock+l.len<=w.id.clock)break;w instanceof ae&&w.deleted&&!w.keep&&n(w)&&w.gc(e,!1)}}}},Vc=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const a=n[s],l=Yr(i.length-1,1+Fe(i,a.clock+a.len-1));for(let u=l,d=i[u];u>0&&d.id.clock>=a.clock;d=i[u])u-=1+Rn(i,u)}})},co=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,a=n._mergeStructs;try{ni(s),n.afterState=qn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const l=[];n.changed.forEach((u,d)=>l.push(()=>{(d._item===null||!d._item.deleted)&&d._callObserver(n,u)})),l.push(()=>{n.changedParentTypes.forEach((u,d)=>{d._dEH.l.length>0&&(d._item===null||!d._item.deleted)&&(u=u.filter(f=>f.target._item===null||!f.target._item.deleted),u.forEach(f=>{f.currentTarget=d,f._path=null}),u.sort((f,w)=>f.path.length-w.path.length),io(d._dEH,u,n))})}),l.push(()=>r.emit("afterTransaction",[n,r])),Qr(l,[]),n._needFormattingCleanup&&ua(n)}finally{r.gc&&Wc(s,i,r.gcFilter),Vc(s,i),n.afterState.forEach((f,w)=>{const b=n.beforeState.get(w)||0;if(b!==f){const E=i.clients.get(w),k=yt(Fe(E,b),1);for(let A=E.length-1;A>=k;)A-=1+Rn(E,A)}});for(let f=a.length-1;f>=0;f--){const{client:w,clock:b}=a[f].id,E=i.clients.get(w),k=Fe(E,b);k+1<E.length&&Rn(E,k+1)>1||k>0&&Rn(E,k)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(qs(Wn,le,"[yjs] ",ht,Hs,"Changed the client-id because another client seems to be using it."),r.clientID=Ks()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const f=new fn;$i(f,n)&&r.emit("update",[f.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const f=new dt;$i(f,n)&&r.emit("updateV2",[f.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:u,subdocsRemoved:d}=n;(l.size>0||d.size>0||u.size>0)&&(l.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),d.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:u,added:l,removed:d},r,n]),d.forEach(f=>f.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):co(t,e+1)}}},X=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,a=null;t._transaction===null&&(s=!0,t._transaction=new Hc(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{a=e(t._transaction)}finally{if(s){const l=t._transaction===i[0];t._transaction=null,l&&co(i,0)}}return a};function*qc(t){const e=$(t.restDecoder);for(let n=0;n<e;n++){const r=$(t.restDecoder),i=t.readClient();let s=$(t.restDecoder);for(let a=0;a<r;a++){const l=t.readInfo();if(l===10){const u=$(t.restDecoder);yield new ke(z(i,s),u),s+=u}else if(jn&l){const u=(l&(He|_e))===0,d=new ae(z(i,s),null,(l&_e)===_e?t.readLeftID():null,null,(l&He)===He?t.readRightID():null,u?t.readParentInfo()?t.readString():t.readLeftID():null,u&&(l&tn)===tn?t.readString():null,Ao(t,l));yield d,s+=d.length}else{const u=t.readLen();yield new Re(z(i,s),u),s+=u}}}}class si{constructor(e,n){this.gen=qc(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ke);return this.curr}}class oi{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Yc=t=>An(t,Zs,fn),Gc=(t,e)=>{if(t.constructor===Re){const{client:n,clock:r}=t.id;return new Re(z(n,r+e),t.length-e)}else if(t.constructor===ke){const{client:n,clock:r}=t.id;return new ke(z(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ae(z(r,i+e),null,z(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},An=(t,e=Mt,n=dt)=>{if(t.length===1)return t[0];const r=t.map(f=>new e(Pe(f)));let i=r.map(f=>new si(f,!0)),s=null;const a=new n,l=new oi(a);for(;i=i.filter(b=>b.curr!==null),i.sort((b,E)=>{if(b.curr.id.client===E.curr.id.client){const k=b.curr.id.clock-E.curr.id.clock;return k===0?b.curr.constructor===E.curr.constructor?0:b.curr.constructor===ke?1:-1:k}else return E.curr.id.client-b.curr.id.client}),i.length!==0;){const f=i[0],w=f.curr.id.client;if(s!==null){let b=f.curr,E=!1;for(;b!==null&&b.id.clock+b.length<=s.struct.id.clock+s.struct.length&&b.id.client>=s.struct.id.client;)b=f.next(),E=!0;if(b===null||b.id.client!==w||E&&b.id.clock>s.struct.id.clock+s.struct.length)continue;if(w!==s.struct.id.client)Qe(l,s.struct,s.offset),s={struct:b,offset:0},f.next();else if(s.struct.id.clock+s.struct.length<b.id.clock)if(s.struct.constructor===ke)s.struct.length=b.id.clock+b.length-s.struct.id.clock;else{Qe(l,s.struct,s.offset);const k=b.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ke(z(w,s.struct.id.clock+s.struct.length),k),offset:0}}else{const k=s.struct.id.clock+s.struct.length-b.id.clock;k>0&&(s.struct.constructor===ke?s.struct.length-=k:b=Gc(b,k)),s.struct.mergeWith(b)||(Qe(l,s.struct,s.offset),s={struct:b,offset:0},f.next())}}else s={struct:f.curr,offset:0},f.next();for(let b=f.curr;b!==null&&b.id.client===w&&b.id.clock===s.struct.id.clock+s.struct.length&&b.constructor!==ke;b=f.next())Qe(l,s.struct,s.offset),s={struct:b,offset:0}}s!==null&&(Qe(l,s.struct,s.offset),s=null),li(l);const u=r.map(f=>ri(f)),d=Ec(u);return jt(a,d),a.toUint8Array()},zc=(t,e,n=Mt,r=dt)=>{const i=no(e),s=new r,a=new oi(s),l=new n(Pe(t)),u=new si(l,!1);for(;u.curr;){const f=u.curr,w=f.id.client,b=i.get(w)||0;if(u.curr.constructor===ke){u.next();continue}if(f.id.clock+f.length>b)for(Qe(a,f,yt(b-f.id.clock,0)),u.next();u.curr&&u.curr.id.client===w;)Qe(a,u.curr,0),u.next();else for(;u.curr&&u.curr.id.client===w&&u.curr.id.clock+u.curr.length<=b;)u.next()}li(a);const d=ri(l);return jt(s,d),s.toUint8Array()},ao=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:ne(t.encoder.restEncoder)}),t.encoder.restEncoder=fe(),t.written=0)},Qe=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&ao(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),N(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},li=t=>{ao(t);const e=t.encoder.restEncoder;N(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];N(e,r.written),$n(e,r.restEncoder)}},Jc=(t,e,n,r)=>{const i=new n(Pe(t)),s=new si(i,!1),a=new r,l=new oi(a);for(let d=s.curr;d!==null;d=s.next())Qe(l,e(d),0);li(l);const u=ri(i);return jt(a,u),a.toUint8Array()},Kc=t=>Jc(t,Zl,Mt,fn),Wi="You must not compute changes after the event-handler fired.";class Yn{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Xc(this.currentTarget,this.target))}deletes(e){return Js(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(Wi);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let a,l;if(this.adds(s)){let u=s.left;for(;u!==null&&this.adds(u);)u=u.left;if(this.deletes(s))if(u!==null&&this.deletes(u))a="delete",l=Zn(u.content.getContent());else return;else u!==null&&this.deletes(u)?(a="update",l=Zn(u.content.getContent())):(a="add",l=void 0)}else if(this.deletes(s))a="delete",l=Zn(s.content.getContent());else return;e.set(i,{action:a,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Me(Wi);const n=this.target,r=tt(),i=tt(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const u=()=>{l&&s.push(l)};for(let d=n._start;d!==null;d=d.right)d.deleted?this.deletes(d)&&!this.adds(d)&&((l===null||l.delete===void 0)&&(u(),l={delete:0}),l.delete+=d.length,i.add(d)):this.adds(d)?((l===null||l.insert===void 0)&&(u(),l={insert:[]}),l.insert=l.insert.concat(d.content.getContent()),r.add(d)):((l===null||l.retain===void 0)&&(u(),l={retain:0}),l.retain+=d.length);l!==null&&l.retain===void 0&&u()}this._changes=e}return e}}const Xc=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},we=()=>{wc("Invalid access: Add Yjs type to a document before reading data.")},uo=80;let ci=0;class Zc{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=ci++}}const Qc=t=>{t.timestamp=ci++},ho=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=ci++},ea=(t,e,n)=>{if(t.length>=uo){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return ho(r,e,n),r}else{const r=new Zc(e,n);return t.push(r),r}},Gn=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,a)=>En(e-s.index)<En(e-a.index)?s:a);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Qc(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&En(n.index-i)<r.parent.length/uo?(ho(n,r,i),n):ea(t._searchMarker,r,i)},on=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=yt(e,i.index+n))}},zn=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Ee(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;io(r._eH,n,e)};class ye{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Fi(),this._dEH=Fi(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Be()}clone(){throw Be()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ui(this._eH,e)}observeDeep(e){Ui(this._dEH,e)}unobserve(e){Pi(this._eH,e)}unobserveDeep(e){Pi(this._dEH,e)}toJSON(){}}const fo=(t,e,n)=>{t.doc??we(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const a=s.content.getContent();if(a.length<=e)e-=a.length;else{for(let l=e;l<a.length&&r>0;l++)i.push(a[l]),r--;e=0}}s=s.right}return i},go=t=>{t.doc??we();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},ln=(t,e)=>{let n=0,r=t._start;for(t.doc??we();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},po=(t,e)=>{const n=[];return ln(t,(r,i)=>{n.push(e(r,i,t))}),n},ta=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},yo=(t,e)=>{t.doc??we();const n=Gn(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Tn=(t,e,n,r)=>{let i=n;const s=t.doc,a=s.clientID,l=s.store,u=n===null?e._start:n.right;let d=[];const f=()=>{d.length>0&&(i=new ae(z(a,ge(l,a)),i,i&&i.lastId,u,u&&u.id,e,null,new gt(d)),i.integrate(t,0),d=[])};r.forEach(w=>{if(w===null)d.push(w);else switch(w.constructor){case Number:case Object:case Boolean:case Array:case String:d.push(w);break;default:switch(f(),w.constructor){case Uint8Array:case ArrayBuffer:i=new ae(z(a,ge(l,a)),i,i&&i.lastId,u,u&&u.id,e,null,new gn(new Uint8Array(w))),i.integrate(t,0);break;case $t:i=new ae(z(a,ge(l,a)),i,i&&i.lastId,u,u&&u.id,e,null,new pn(w)),i.integrate(t,0);break;default:if(w instanceof ye)i=new ae(z(a,ge(l,a)),i,i&&i.lastId,u,u&&u.id,e,null,new ze(w)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},wo=()=>Me("Length exceeded!"),mo=(t,e,n,r)=>{if(n>e._length)throw wo();if(n===0)return e._searchMarker&&on(e._searchMarker,n,r.length),Tn(t,e,null,r);const i=n,s=Gn(e,n);let a=e._start;for(s!==null&&(a=s.p,n-=s.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&nt(t,z(a.id.client,a.id.clock+n));break}n-=a.length}return e._searchMarker&&on(e._searchMarker,i,r.length),Tn(t,e,a,r)},na=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,a)=>a.index>s.index?a:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Tn(t,e,i,n)},bo=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,a=Gn(e,n);let l=e._start;for(a!==null&&(l=a.p,n-=a.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&nt(t,z(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&nt(t,z(l.id.client,l.id.clock+r)),l.delete(t),r-=l.length),l=l.right;if(r>0)throw wo();e._searchMarker&&on(e._searchMarker,i,-s+r)},xn=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},ai=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,a=s.clientID;let l;if(r==null)l=new gt([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new gt([r]);break;case Uint8Array:l=new gn(r);break;case $t:l=new pn(r);break;default:if(r instanceof ye)l=new ze(r);else throw new Error("Unexpected content type")}new ae(z(a,ge(s.store,a)),i,i&&i.lastId,null,null,e,n,l).integrate(t,0)},ui=(t,e)=>{t.doc??we();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},_o=t=>{const e={};return t.doc??we(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Eo=(t,e)=>{t.doc??we();const n=t._map.get(e);return n!==void 0&&!n.deleted},ra=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&At(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},bn=t=>(t.doc??we(),bc(t._map.entries(),e=>!e[1].deleted));class ia extends Yn{}class xt extends ye{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new xt;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new xt}clone(){const e=new xt;return e.insert(0,this.toArray().map(n=>n instanceof ye?n.clone():n)),e}get length(){return this.doc??we(),this._length}_callObserver(e,n){super._callObserver(e,n),zn(this,e,new ia(this,e))}insert(e,n){this.doc!==null?X(this.doc,r=>{mo(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?X(this.doc,n=>{na(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?X(this.doc,r=>{bo(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return yo(this,e)}toArray(){return go(this)}slice(e=0,n=this.length){return fo(this,e,n)}toJSON(){return this.map(e=>e instanceof ye?e.toJSON():e)}map(e){return po(this,e)}forEach(e){ln(this,e)}[Symbol.iterator](){return ta(this)}_write(e){e.writeTypeRef(xa)}}const sa=t=>new xt;class oa extends Yn{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Nt extends ye{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Nt}clone(){const e=new Nt;return this.forEach((n,r)=>{e.set(r,n instanceof ye?n.clone():n)}),e}_callObserver(e,n){zn(this,e,new oa(this,e,n))}toJSON(){this.doc??we();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof ye?i.toJSON():i}}),e}get size(){return[...bn(this)].length}keys(){return ir(bn(this),e=>e[0])}values(){return ir(bn(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ir(bn(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??we(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?X(this.doc,n=>{xn(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?X(this.doc,r=>{ai(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return ui(this,e)}has(e){return Eo(this,e)}clear(){this.doc!==null?X(this.doc,e=>{this.forEach(function(n,r,i){xn(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Ia)}}const la=t=>new Nt,et=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Jl(t,e);class Or{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ne(),this.right.content.constructor){case ue:this.right.deleted||Ht(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Vi=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case ue:e.right.deleted||Ht(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&nt(t,z(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},_n=(t,e,n,r)=>{const i=new Map,s=r?Gn(e,n):null;if(s){const a=new Or(s.p.left,s.p,s.index,i);return Vi(t,a,n-s.index)}else{const a=new Or(null,e._start,0,i);return Vi(t,a,n)}},Co=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ue&&et(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((a,l)=>{const u=n.left,d=n.right,f=new ae(z(s,ge(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new ue(l,a));f.integrate(t,0),n.right=f,n.forward()})},Ht=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},So=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===ue&&et(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Ro=(t,e,n,r)=>{const i=t.doc,s=i.clientID,a=new Map;for(const l in r){const u=r[l],d=n.currentAttributes.get(l)??null;if(!et(d,u)){a.set(l,d);const{left:f,right:w}=n;n.right=new ae(z(s,ge(i.store,s)),f,f&&f.lastId,w,w&&w.id,e,null,new ue(l,u)),n.right.integrate(t,0),n.forward()}}return a},or=(t,e,n,r,i)=>{n.currentAttributes.forEach((b,E)=>{i[E]===void 0&&(i[E]=null)});const s=t.doc,a=s.clientID;So(n,i);const l=Ro(t,e,n,i),u=r.constructor===String?new Ue(r):r instanceof ye?new ze(r):new wt(r);let{left:d,right:f,index:w}=n;e._searchMarker&&on(e._searchMarker,n.index,u.getLength()),f=new ae(z(a,ge(s.store,a)),d,d&&d.lastId,f,f&&f.id,e,null,u),f.integrate(t,0),n.right=f,n.index=w,n.forward(),Co(t,e,n,l)},qi=(t,e,n,r,i)=>{const s=t.doc,a=s.clientID;So(n,i);const l=Ro(t,e,n,i);e:for(;n.right!==null&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===ue));){if(!n.right.deleted)switch(n.right.content.constructor){case ue:{const{key:u,value:d}=n.right.content,f=i[u];if(f!==void 0){if(et(f,d))l.delete(u);else{if(r===0)break e;l.set(u,d)}n.right.delete(t)}else n.currentAttributes.set(u,d);break}default:r<n.right.length&&nt(t,z(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let u="";for(;r>0;r--)u+=`
`;n.right=new ae(z(a,ge(s.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ue(u)),n.right.integrate(t,0),n.forward()}Co(t,e,n,l)},ko=(t,e,n,r,i)=>{let s=e;const a=me();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ue){const d=s.content;a.set(d.key,d)}s=s.right}let l=0,u=!1;for(;e!==s;){if(n===e&&(u=!0),!e.deleted){const d=e.content;switch(d.constructor){case ue:{const{key:f,value:w}=d,b=r.get(f)??null;(a.get(f)!==d||b===w)&&(e.delete(t),l++,!u&&(i.get(f)??null)===w&&b!==w&&(b===null?i.delete(f):i.set(f,b))),!u&&!e.deleted&&Ht(i,d);break}}}e=e.right}return l},ca=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ue){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},aa=t=>{let e=0;return X(t.doc,n=>{let r=t._start,i=t._start,s=me();const a=Ar(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case ue:Ht(a,i.content);break;default:e+=ko(n,r,i,s,a),s=Ar(a),r=i;break}i=i.right}}),e},ua=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&lo(t,n.store.clients.get(r),s,i,a=>{!a.deleted&&a.content.constructor===ue&&a.constructor!==Re&&e.add(a.parent)})}X(n,r=>{zs(t,t.deleteSet,i=>{if(i instanceof Re||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===ue?e.add(s):ca(r,i)});for(const i of e)aa(i)})},Yi=(t,e,n)=>{const r=n,i=Ar(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ze:case wt:case Ue:n<e.right.length&&nt(t,z(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&ko(t,s,e.right,i,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&on(a._searchMarker,e.index,-r+n),e};class ha extends Yn{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];X(e,r=>{const i=new Map,s=new Map;let a=this.target._start,l=null;const u={};let d="",f=0,w=0;const b=()=>{if(l!==null){let E=null;switch(l){case"delete":w>0&&(E={delete:w}),w=0;break;case"insert":(typeof d=="object"||d.length>0)&&(E={insert:d},i.size>0&&(E.attributes={},i.forEach((k,A)=>{k!==null&&(E.attributes[A]=k)}))),d="";break;case"retain":f>0&&(E={retain:f},Gl(u)||(E.attributes=ql({},u))),f=0;break}E&&n.push(E),l=null}};for(;a!==null;){switch(a.content.constructor){case ze:case wt:this.adds(a)?this.deletes(a)||(b(),l="insert",d=a.content.getContent()[0],b()):this.deletes(a)?(l!=="delete"&&(b(),l="delete"),w+=1):a.deleted||(l!=="retain"&&(b(),l="retain"),f+=1);break;case Ue:this.adds(a)?this.deletes(a)||(l!=="insert"&&(b(),l="insert"),d+=a.content.str):this.deletes(a)?(l!=="delete"&&(b(),l="delete"),w+=a.length):a.deleted||(l!=="retain"&&(b(),l="retain"),f+=a.length);break;case ue:{const{key:E,value:k}=a.content;if(this.adds(a)){if(!this.deletes(a)){const A=i.get(E)??null;et(A,k)?k!==null&&a.delete(r):(l==="retain"&&b(),et(k,s.get(E)??null)?delete u[E]:u[E]=k)}}else if(this.deletes(a)){s.set(E,k);const A=i.get(E)??null;et(A,k)||(l==="retain"&&b(),u[E]=A)}else if(!a.deleted){s.set(E,k);const A=u[E];A!==void 0&&(et(A,k)?A!==null&&a.delete(r):(l==="retain"&&b(),k===null?delete u[E]:u[E]=k))}a.deleted||(l==="insert"&&b(),Ht(i,a.content));break}}a=a.right}for(b();n.length>0;){const E=n[n.length-1];if(E.retain!==void 0&&E.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ft extends ye{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??we(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ft}clone(){const e=new Ft;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new ha(this,e,n);zn(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??we();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ue&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?X(this.doc,r=>{const i=new Or(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const a=e[s];if(a.insert!==void 0){const l=!n&&typeof a.insert=="string"&&s===e.length-1&&i.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof l!="string"||l.length>0)&&or(r,this,i,l,a.attributes||{})}else a.retain!==void 0?qi(r,this,i,a.retain,a.attributes||{}):a.delete!==void 0&&Yi(r,i,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??we();const i=[],s=new Map,a=this.doc;let l="",u=this._start;function d(){if(l.length>0){const w={};let b=!1;s.forEach((k,A)=>{b=!0,w[A]=k});const E={insert:l};b&&(E.attributes=w),i.push(E),l=""}}const f=()=>{for(;u!==null;){if(At(u,e)||n!==void 0&&At(u,n))switch(u.content.constructor){case Ue:{const w=s.get("ychange");e!==void 0&&!At(u,e)?(w===void 0||w.user!==u.id.client||w.type!=="removed")&&(d(),s.set("ychange",r?r("removed",u.id):{type:"removed"})):n!==void 0&&!At(u,n)?(w===void 0||w.user!==u.id.client||w.type!=="added")&&(d(),s.set("ychange",r?r("added",u.id):{type:"added"})):w!==void 0&&(d(),s.delete("ychange")),l+=u.content.str;break}case ze:case wt:{d();const w={insert:u.content.getContent()[0]};if(s.size>0){const b={};w.attributes=b,s.forEach((E,k)=>{b[k]=E})}i.push(w);break}case ue:At(u,e)&&(d(),Ht(s,u.content));break}u=u.right}d()};return e||n?X(a,w=>{e&&Lr(w,e),n&&Lr(w,n),f()},"cleanup"):f(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?X(i,s=>{const a=_n(s,this,e,!r);r||(r={},a.currentAttributes.forEach((l,u)=>{r[u]=l})),or(s,this,a,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?X(i,s=>{const a=_n(s,this,e,!r);or(s,this,a,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?X(r,i=>{Yi(i,_n(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?X(i,s=>{const a=_n(s,this,e,!1);a.right!==null&&qi(s,this,a,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?X(this.doc,n=>{xn(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?X(this.doc,r=>{ai(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return ui(this,e)}getAttributes(){return _o(this)}_write(e){e.writeTypeRef(Da)}}const da=t=>new Ft;class lr{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??we()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Ut||n.constructor===ft)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ft extends ye{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ft}clone(){const e=new ft;return e.insert(0,this.toArray().map(n=>n instanceof ye?n.clone():n)),e}get length(){return this.doc??we(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new lr(this,e)}querySelector(e){e=e.toUpperCase();const r=new lr(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ve(new lr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){zn(this,e,new pa(this,n,e))}toString(){return po(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),ln(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?X(this.doc,r=>{mo(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)X(this.doc,r=>{const i=e&&e instanceof ye?e._item:e;Tn(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Me("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?X(this.doc,r=>{bo(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return go(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return yo(this,e)}slice(e=0,n=this.length){return fo(this,e,n)}forEach(e){ln(this,e)}_write(e){e.writeTypeRef(Ba)}}const fa=t=>new ft;class Ut extends ft{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ut(this.nodeName)}clone(){const e=new Ut(this.nodeName),n=this.getAttributes();return Yl(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ye?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const l in e)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const u=r[l];n.push(u+'="'+e[u]+'"')}const s=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${s}${a}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?X(this.doc,n=>{xn(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?X(this.doc,r=>{ai(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return ui(this,e)}hasAttribute(e){return Eo(this,e)}getAttributes(e){return e?ra(this,e):_o(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const a in s){const l=s[a];typeof l=="string"&&i.setAttribute(a,l)}return ln(this,a=>{i.appendChild(a.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(La),e.writeKey(this.nodeName)}}const ga=t=>new Ut(t.readKey());class pa extends Yn{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class In extends Nt{constructor(e){super(),this.hookName=e}_copy(){return new In(this.hookName)}clone(){const e=new In(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Oa),e.writeKey(this.hookName)}}const ya=t=>new In(t.readKey());class Dn extends Ft{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Dn}clone(){const e=new Dn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const a in e.attributes[i])s.push({key:a,value:e.attributes[i][a]});s.sort((a,l)=>a.key<l.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let a=0;a<s.attrs.length;a++){const l=s.attrs[a];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Ma)}}const wa=t=>new Dn;class hi{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Be()}mergeWith(e){return!1}write(e,n,r){throw Be()}integrate(e,n){throw Be()}}const ma=0;class Re extends hi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),oo(e.doc.store,this)}write(e,n){e.writeInfo(ma),e.writeLen(this.length-n)}getMissing(e,n){return null}}class gn{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new gn(this.content)}splice(e){throw Be()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const ba=t=>new gn(t.readBuf());class cn{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new cn(this.len)}splice(e){const n=new cn(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){vn(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const _a=t=>new cn(t.readLen()),vo=(t,e)=>new $t({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class pn{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new pn(vo(this.doc.guid,this.opts))}splice(e){throw Be()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Ea=t=>new pn(vo(t.readString(),t.readAny()));class wt{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new wt(this.embed)}splice(e){throw Be()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Ca=t=>new wt(t.readJSON());class ue{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ue(this.key,this.value)}splice(e){throw Be()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Sa=t=>new ue(t.readKey(),t.readJSON());class Ln{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ln(this.arr)}splice(e){const n=new Ln(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Ra=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ln(n)},ka=sn("node_env")==="development";class gt{constructor(e){this.arr=e,ka&&Os(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new gt(this.arr)}splice(e){const n=new gt(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const va=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new gt(n)};class Ue{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ue(this.str)}splice(e){const n=new Ue(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Aa=t=>new Ue(t.readString()),Ta=[sa,la,da,ga,fa,ya,wa],xa=0,Ia=1,Da=2,La=3,Ba=4,Oa=5,Ma=6;class ze{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ze(this.type._copy())}splice(e){throw Be()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Na=t=>new ze(Ta[t.readTypeRef()](t)),Bn=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ae(z(r,i+n),e,z(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=z(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class ae extends hi{constructor(e,n,r,i,s,a,l,u){super(e,u.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=a,this.parentSub=l,this.redone=null,this.content=u,this.info=this.content.isCountable()?Ci:0}set marker(e){(this.info&er)>0!==e&&(this.info^=er)}get marker(){return(this.info&er)>0}get keep(){return(this.info&Ei)>0}set keep(e){this.keep!==e&&(this.info^=Ei)}get countable(){return(this.info&Ci)>0}get deleted(){return(this.info&Qn)>0}set deleted(e){this.deleted!==e&&(this.info^=Qn)}markDeleted(){this.info|=Qn}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ge(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ge(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Tt&&this.id.client!==this.parent.client&&this.parent.clock>=ge(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ji(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=nt(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Re||this.right&&this.right.constructor===Re)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ae?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ae&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Tt){const r=sr(n,this.parent);r.constructor===Re?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=ji(e,e.doc.store,z(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,a=new Set;for(;i!==null&&i!==this.right;){if(a.add(i),s.add(i),mn(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(mn(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&a.has(sr(e.doc.store,i.origin)))s.has(sr(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),oo(e.doc.store,this),this.content.integrate(e,this),Hi(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Re(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:z(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&mn(e.origin,this.lastId)&&this.right===e&&mn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),vn(e.deleteSet,this.id.client,this.id.clock,this.length),Hi(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ne();this.content.gc(e),n?$c(e,this,new Re(this.id,this.length)):this.content=new cn(this.length)}write(e,n){const r=n>0?z(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,a=this.content.getRef()&jn|(r===null?0:_e)|(i===null?0:He)|(s===null?0:tn);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const u=l._item;if(u===null){const d=Pc(l);e.writeParentInfo(!0),e.writeString(d)}else e.writeParentInfo(!1),e.writeLeftID(u.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===Tt?(e.writeParentInfo(!1),e.writeLeftID(l)):Ne();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Ao=(t,e)=>Fa[e&jn](t),Fa=[()=>{Ne()},_a,Ra,ba,Aa,Ca,Sa,Na,va,Ea,()=>{Ne()}],Ua=10;class ke extends hi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Ne()}write(e,n){e.writeInfo(Ua),N(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const To=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{},xo="__ $YJS$ __";To[xo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");To[xo]=!0;const Pa=1200,ja=2500,On=3e4,Mr=t=>{if(t.shouldConnect&&t.ws===null){const e=new WebSocket(t.url),n=t.binaryType;let r=null;n&&(e.binaryType=n),t.ws=e,t.connecting=!0,t.connected=!1,e.onmessage=a=>{t.lastMessageReceived=qe();const l=a.data,u=typeof l=="string"?JSON.parse(l):l;u&&u.type==="pong"&&(clearTimeout(r),r=setTimeout(s,On/2)),t.emit("message",[u,t])};const i=a=>{t.ws!==null&&(t.ws=null,t.connecting=!1,t.connected?(t.connected=!1,t.emit("disconnect",[{type:"disconnect",error:a},t])):t.unsuccessfulReconnects++,setTimeout(Mr,Yr(al(t.unsuccessfulReconnects+1)*Pa,ja),t)),clearTimeout(r)},s=()=>{t.ws===e&&t.send({type:"ping"})};e.onclose=()=>i(null),e.onerror=a=>i(a),e.onopen=()=>{t.lastMessageReceived=qe(),t.connecting=!1,t.connected=!0,t.unsuccessfulReconnects=0,t.emit("connect",[{type:"connect"},t]),r=setTimeout(s,On/2)}}};class $a extends Ss{constructor(e,{binaryType:n}={}){super(),this.url=e,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&On<qe()-this.lastMessageReceived&&this.ws.close()},On/2),Mr(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&Mr(this)}}const Io=new Map;class Ha{constructor(e){this.room=e,this.onmessage=null,this._onChange=n=>n.key===e&&this.onmessage!==null&&this.onmessage({data:Ps(n.newValue||"")}),Wl(this._onChange)}postMessage(e){Ds.setItem(this.room,Us(ic(e)))}close(){Vl(this._onChange)}}const Wa=typeof BroadcastChannel>"u"?Ha:BroadcastChannel,di=t=>Ee(Io,t,()=>{const e=tt(),n=new Wa(t);return n.onmessage=r=>e.forEach(i=>i(r.data,"broadcastchannel")),{bc:n,subs:e}}),Va=(t,e)=>(di(t).subs.add(e),e),qa=(t,e)=>{const n=di(t),r=n.subs.delete(e);return r&&n.subs.size===0&&(n.bc.close(),Io.delete(t)),r},Ya=(t,e,n=null)=>{const r=di(t);r.bc.postMessage(e),r.subs.forEach(i=>i(e,n))},Ga=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else n!==void 0&&n()}};function za(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ja(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Nr={exports:{}},cr,Gi;function Ka(){if(Gi)return cr;Gi=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;cr=function(f,w){w=w||{};var b=typeof f;if(b==="string"&&f.length>0)return a(f);if(b==="number"&&isFinite(f))return w.long?u(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(w){var b=parseFloat(w[1]),E=(w[2]||"ms").toLowerCase();switch(E){case"years":case"year":case"yrs":case"yr":case"y":return b*s;case"weeks":case"week":case"w":return b*i;case"days":case"day":case"d":return b*r;case"hours":case"hour":case"hrs":case"hr":case"h":return b*n;case"minutes":case"minute":case"mins":case"min":case"m":return b*e;case"seconds":case"second":case"secs":case"sec":case"s":return b*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:return}}}}function l(f){var w=Math.abs(f);return w>=r?Math.round(f/r)+"d":w>=n?Math.round(f/n)+"h":w>=e?Math.round(f/e)+"m":w>=t?Math.round(f/t)+"s":f+"ms"}function u(f){var w=Math.abs(f);return w>=r?d(f,w,r,"day"):w>=n?d(f,w,n,"hour"):w>=e?d(f,w,e,"minute"):w>=t?d(f,w,t,"second"):f+" ms"}function d(f,w,b,E){var k=w>=b*1.5;return Math.round(f/b)+" "+E+(k?"s":"")}return cr}function Xa(t){n.debug=n,n.default=n,n.coerce=u,n.disable=a,n.enable=i,n.enabled=l,n.humanize=Ka(),n.destroy=d,Object.keys(t).forEach(f=>{n[f]=t[f]}),n.names=[],n.skips=[],n.formatters={};function e(f){let w=0;for(let b=0;b<f.length;b++)w=(w<<5)-w+f.charCodeAt(b),w|=0;return n.colors[Math.abs(w)%n.colors.length]}n.selectColor=e;function n(f){let w,b=null,E,k;function A(...D){if(!A.enabled)return;const _=A,x=Number(new Date),L=x-(w||x);_.diff=L,_.prev=w,_.curr=x,w=x,D[0]=n.coerce(D[0]),typeof D[0]!="string"&&D.unshift("%O");let B=0;D[0]=D[0].replace(/%([a-zA-Z%])/g,(P,Z)=>{if(P==="%%")return"%";B++;const H=n.formatters[Z];if(typeof H=="function"){const j=D[B];P=H.call(_,j),D.splice(B,1),B--}return P}),n.formatArgs.call(_,D),(_.log||n.log).apply(_,D)}return A.namespace=f,A.useColors=n.useColors(),A.color=n.selectColor(f),A.extend=r,A.destroy=n.destroy,Object.defineProperty(A,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(E!==n.namespaces&&(E=n.namespaces,k=n.enabled(f)),k),set:D=>{b=D}}),typeof n.init=="function"&&n.init(A),A}function r(f,w){const b=n(this.namespace+(typeof w>"u"?":":w)+f);return b.log=this.log,b}function i(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];const w=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const b of w)b[0]==="-"?n.skips.push(b.slice(1)):n.names.push(b)}function s(f,w){let b=0,E=0,k=-1,A=0;for(;b<f.length;)if(E<w.length&&(w[E]===f[b]||w[E]==="*"))w[E]==="*"?(k=E,A=b,E++):(b++,E++);else if(k!==-1)E=k+1,A++,b=A;else return!1;for(;E<w.length&&w[E]==="*";)E++;return E===w.length}function a(){const f=[...n.names,...n.skips.map(w=>"-"+w)].join(",");return n.enable(""),f}function l(f){for(const w of n.skips)if(s(f,w))return!1;for(const w of n.names)if(s(f,w))return!0;return!1}function u(f){return f instanceof Error?f.stack||f.message:f}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Za=Xa;(function(t,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=n,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let f=0,w=0;u[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(f++,b==="%c"&&(w=f))}),u.splice(w,0,d)}e.log=console.debug||console.log||(()=>{});function i(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function s(){let u;try{u=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u={}.DEBUG),u}function a(){try{return localStorage}catch{}}t.exports=Za(e);const{formatters:l}=t.exports;l.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(Nr,Nr.exports);var Qa=Nr.exports,eu=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},Fr={exports:{}},Ur={exports:{}},Wt={},Jn={};Jn.byteLength=ru;Jn.toByteArray=su;Jn.fromByteArray=cu;var De=[],Se=[],tu=typeof Uint8Array<"u"?Uint8Array:Array,ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var vt=0,nu=ar.length;vt<nu;++vt)De[vt]=ar[vt],Se[ar.charCodeAt(vt)]=vt;Se["-".charCodeAt(0)]=62;Se["_".charCodeAt(0)]=63;function Do(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function ru(t){var e=Do(t),n=e[0],r=e[1];return(n+r)*3/4-r}function iu(t,e,n){return(e+n)*3/4-n}function su(t){var e,n=Do(t),r=n[0],i=n[1],s=new tu(iu(t,r,i)),a=0,l=i>0?r-4:r,u;for(u=0;u<l;u+=4)e=Se[t.charCodeAt(u)]<<18|Se[t.charCodeAt(u+1)]<<12|Se[t.charCodeAt(u+2)]<<6|Se[t.charCodeAt(u+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=e&255;return i===2&&(e=Se[t.charCodeAt(u)]<<2|Se[t.charCodeAt(u+1)]>>4,s[a++]=e&255),i===1&&(e=Se[t.charCodeAt(u)]<<10|Se[t.charCodeAt(u+1)]<<4|Se[t.charCodeAt(u+2)]>>2,s[a++]=e>>8&255,s[a++]=e&255),s}function ou(t){return De[t>>18&63]+De[t>>12&63]+De[t>>6&63]+De[t&63]}function lu(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(ou(r));return i.join("")}function cu(t){for(var e,n=t.length,r=n%3,i=[],s=16383,a=0,l=n-r;a<l;a+=s)i.push(lu(t,a,a+s>l?l:a+s));return r===1?(e=t[n-1],i.push(De[e>>2]+De[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(De[e>>10]+De[e>>4&63]+De[e<<2&63]+"=")),i.join("")}var fi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */fi.read=function(t,e,n,r,i){var s,a,l=i*8-r-1,u=(1<<l)-1,d=u>>1,f=-7,w=n?i-1:0,b=n?-1:1,E=t[e+w];for(w+=b,s=E&(1<<-f)-1,E>>=-f,f+=l;f>0;s=s*256+t[e+w],w+=b,f-=8);for(a=s&(1<<-f)-1,s>>=-f,f+=r;f>0;a=a*256+t[e+w],w+=b,f-=8);if(s===0)s=1-d;else{if(s===u)return a?NaN:(E?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-d}return(E?-1:1)*a*Math.pow(2,s-r)};fi.write=function(t,e,n,r,i,s){var a,l,u,d=s*8-i-1,f=(1<<d)-1,w=f>>1,b=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=r?0:s-1,k=r?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+w>=1?e+=b/u:e+=b*Math.pow(2,1-w),e*u>=2&&(a++,u/=2),a+w>=f?(l=0,a=f):a+w>=1?(l=(e*u-1)*Math.pow(2,i),a=a+w):(l=e*Math.pow(2,w-1)*Math.pow(2,i),a=0));i>=8;t[n+E]=l&255,E+=k,l/=256,i-=8);for(a=a<<i|l,d+=i;d>0;t[n+E]=a&255,E+=k,a/=256,d-=8);t[n+E-k]|=A*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Jn,n=fi,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,l.TYPED_ARRAY_SUPPORT=s(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const h=new Uint8Array(1),o={foo:function(){return 42}};return Object.setPrototypeOf(o,Uint8Array.prototype),Object.setPrototypeOf(h,o),h.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function a(h){if(h>i)throw new RangeError('The value "'+h+'" is invalid for option "size"');const o=new Uint8Array(h);return Object.setPrototypeOf(o,l.prototype),o}function l(h,o,c){if(typeof h=="number"){if(typeof o=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(h)}return u(h,o,c)}l.poolSize=8192;function u(h,o,c){if(typeof h=="string")return b(h,o);if(ArrayBuffer.isView(h))return k(h);if(h==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(be(h,ArrayBuffer)||h&&be(h.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(be(h,SharedArrayBuffer)||h&&be(h.buffer,SharedArrayBuffer)))return A(h,o,c);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const g=h.valueOf&&h.valueOf();if(g!=null&&g!==h)return l.from(g,o,c);const m=D(h);if(m)return m;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return l.from(h[Symbol.toPrimitive]("string"),o,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}l.from=function(h,o,c){return u(h,o,c)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function f(h,o,c){return d(h),h<=0?a(h):o!==void 0?typeof c=="string"?a(h).fill(o,c):a(h).fill(o):a(h)}l.alloc=function(h,o,c){return f(h,o,c)};function w(h){return d(h),a(h<0?0:_(h)|0)}l.allocUnsafe=function(h){return w(h)},l.allocUnsafeSlow=function(h){return w(h)};function b(h,o){if((typeof o!="string"||o==="")&&(o="utf8"),!l.isEncoding(o))throw new TypeError("Unknown encoding: "+o);const c=L(h,o)|0;let g=a(c);const m=g.write(h,o);return m!==c&&(g=g.slice(0,m)),g}function E(h){const o=h.length<0?0:_(h.length)|0,c=a(o);for(let g=0;g<o;g+=1)c[g]=h[g]&255;return c}function k(h){if(be(h,Uint8Array)){const o=new Uint8Array(h);return A(o.buffer,o.byteOffset,o.byteLength)}return E(h)}function A(h,o,c){if(o<0||h.byteLength<o)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<o+(c||0))throw new RangeError('"length" is outside of buffer bounds');let g;return o===void 0&&c===void 0?g=new Uint8Array(h):c===void 0?g=new Uint8Array(h,o):g=new Uint8Array(h,o,c),Object.setPrototypeOf(g,l.prototype),g}function D(h){if(l.isBuffer(h)){const o=_(h.length)|0,c=a(o);return c.length===0||h.copy(c,0,0,o),c}if(h.length!==void 0)return typeof h.length!="number"||st(h.length)?a(0):E(h);if(h.type==="Buffer"&&Array.isArray(h.data))return E(h.data)}function _(h){if(h>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return h|0}function x(h){return+h!=h&&(h=0),l.alloc(+h)}l.isBuffer=function(o){return o!=null&&o._isBuffer===!0&&o!==l.prototype},l.compare=function(o,c){if(be(o,Uint8Array)&&(o=l.from(o,o.offset,o.byteLength)),be(c,Uint8Array)&&(c=l.from(c,c.offset,c.byteLength)),!l.isBuffer(o)||!l.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(o===c)return 0;let g=o.length,m=c.length;for(let S=0,v=Math.min(g,m);S<v;++S)if(o[S]!==c[S]){g=o[S],m=c[S];break}return g<m?-1:m<g?1:0},l.isEncoding=function(o){switch(String(o).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(o,c){if(!Array.isArray(o))throw new TypeError('"list" argument must be an Array of Buffers');if(o.length===0)return l.alloc(0);let g;if(c===void 0)for(c=0,g=0;g<o.length;++g)c+=o[g].length;const m=l.allocUnsafe(c);let S=0;for(g=0;g<o.length;++g){let v=o[g];if(be(v,Uint8Array))S+v.length>m.length?(l.isBuffer(v)||(v=l.from(v)),v.copy(m,S)):Uint8Array.prototype.set.call(m,v,S);else if(l.isBuffer(v))v.copy(m,S);else throw new TypeError('"list" argument must be an Array of Buffers');S+=v.length}return m};function L(h,o){if(l.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||be(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);const c=h.length,g=arguments.length>2&&arguments[2]===!0;if(!g&&c===0)return 0;let m=!1;for(;;)switch(o){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return J(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Yt(h).length;default:if(m)return g?-1:J(h).length;o=(""+o).toLowerCase(),m=!0}}l.byteLength=L;function B(h,o,c){let g=!1;if((o===void 0||o<0)&&(o=0),o>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,o>>>=0,c<=o))return"";for(h||(h="utf8");;)switch(h){case"hex":return Ke(this,o,c);case"utf8":case"utf-8":return bt(this,o,c);case"ascii":return je(this,o,c);case"latin1":case"binary":return _t(this,o,c);case"base64":return Je(this,o,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,o,c);default:if(g)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),g=!0}}l.prototype._isBuffer=!0;function O(h,o,c){const g=h[o];h[o]=h[c],h[c]=g}l.prototype.swap16=function(){const o=this.length;if(o%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<o;c+=2)O(this,c,c+1);return this},l.prototype.swap32=function(){const o=this.length;if(o%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<o;c+=4)O(this,c,c+3),O(this,c+1,c+2);return this},l.prototype.swap64=function(){const o=this.length;if(o%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<o;c+=8)O(this,c,c+7),O(this,c+1,c+6),O(this,c+2,c+5),O(this,c+3,c+4);return this},l.prototype.toString=function(){const o=this.length;return o===0?"":arguments.length===0?bt(this,0,o):B.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(o){if(!l.isBuffer(o))throw new TypeError("Argument must be a Buffer");return this===o?!0:l.compare(this,o)===0},l.prototype.inspect=function(){let o="";const c=t.INSPECT_MAX_BYTES;return o=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(o+=" ... "),"<Buffer "+o+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(o,c,g,m,S){if(be(o,Uint8Array)&&(o=l.from(o,o.offset,o.byteLength)),!l.isBuffer(o))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof o);if(c===void 0&&(c=0),g===void 0&&(g=o?o.length:0),m===void 0&&(m=0),S===void 0&&(S=this.length),c<0||g>o.length||m<0||S>this.length)throw new RangeError("out of range index");if(m>=S&&c>=g)return 0;if(m>=S)return-1;if(c>=g)return 1;if(c>>>=0,g>>>=0,m>>>=0,S>>>=0,this===o)return 0;let v=S-m,q=g-c;const ie=Math.min(v,q),te=this.slice(m,S),se=o.slice(c,g);for(let K=0;K<ie;++K)if(te[K]!==se[K]){v=te[K],q=se[K];break}return v<q?-1:q<v?1:0};function P(h,o,c,g,m){if(h.length===0)return-1;if(typeof c=="string"?(g=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,st(c)&&(c=m?0:h.length-1),c<0&&(c=h.length+c),c>=h.length){if(m)return-1;c=h.length-1}else if(c<0)if(m)c=0;else return-1;if(typeof o=="string"&&(o=l.from(o,g)),l.isBuffer(o))return o.length===0?-1:Z(h,o,c,g,m);if(typeof o=="number")return o=o&255,typeof Uint8Array.prototype.indexOf=="function"?m?Uint8Array.prototype.indexOf.call(h,o,c):Uint8Array.prototype.lastIndexOf.call(h,o,c):Z(h,[o],c,g,m);throw new TypeError("val must be string, number or Buffer")}function Z(h,o,c,g,m){let S=1,v=h.length,q=o.length;if(g!==void 0&&(g=String(g).toLowerCase(),g==="ucs2"||g==="ucs-2"||g==="utf16le"||g==="utf-16le")){if(h.length<2||o.length<2)return-1;S=2,v/=2,q/=2,c/=2}function ie(se,K){return S===1?se[K]:se.readUInt16BE(K*S)}let te;if(m){let se=-1;for(te=c;te<v;te++)if(ie(h,te)===ie(o,se===-1?0:te-se)){if(se===-1&&(se=te),te-se+1===q)return se*S}else se!==-1&&(te-=te-se),se=-1}else for(c+q>v&&(c=v-q),te=c;te>=0;te--){let se=!0;for(let K=0;K<q;K++)if(ie(h,te+K)!==ie(o,K)){se=!1;break}if(se)return te}return-1}l.prototype.includes=function(o,c,g){return this.indexOf(o,c,g)!==-1},l.prototype.indexOf=function(o,c,g){return P(this,o,c,g,!0)},l.prototype.lastIndexOf=function(o,c,g){return P(this,o,c,g,!1)};function H(h,o,c,g){c=Number(c)||0;const m=h.length-c;g?(g=Number(g),g>m&&(g=m)):g=m;const S=o.length;g>S/2&&(g=S/2);let v;for(v=0;v<g;++v){const q=parseInt(o.substr(v*2,2),16);if(st(q))return v;h[c+v]=q}return v}function j(h,o,c,g){return kt(J(o,h.length-c),h,c,g)}function Ae(h,o,c,g){return kt(Xe(o),h,c,g)}function rt(h,o,c,g){return kt(Yt(o),h,c,g)}function Vt(h,o,c,g){return kt(Rt(o,h.length-c),h,c,g)}l.prototype.write=function(o,c,g,m){if(c===void 0)m="utf8",g=this.length,c=0;else if(g===void 0&&typeof c=="string")m=c,g=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(g)?(g=g>>>0,m===void 0&&(m="utf8")):(m=g,g=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const S=this.length-c;if((g===void 0||g>S)&&(g=S),o.length>0&&(g<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");m||(m="utf8");let v=!1;for(;;)switch(m){case"hex":return H(this,o,c,g);case"utf8":case"utf-8":return j(this,o,c,g);case"ascii":case"latin1":case"binary":return Ae(this,o,c,g);case"base64":return rt(this,o,c,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vt(this,o,c,g);default:if(v)throw new TypeError("Unknown encoding: "+m);m=(""+m).toLowerCase(),v=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Je(h,o,c){return o===0&&c===h.length?e.fromByteArray(h):e.fromByteArray(h.slice(o,c))}function bt(h,o,c){c=Math.min(h.length,c);const g=[];let m=o;for(;m<c;){const S=h[m];let v=null,q=S>239?4:S>223?3:S>191?2:1;if(m+q<=c){let ie,te,se,K;switch(q){case 1:S<128&&(v=S);break;case 2:ie=h[m+1],(ie&192)===128&&(K=(S&31)<<6|ie&63,K>127&&(v=K));break;case 3:ie=h[m+1],te=h[m+2],(ie&192)===128&&(te&192)===128&&(K=(S&15)<<12|(ie&63)<<6|te&63,K>2047&&(K<55296||K>57343)&&(v=K));break;case 4:ie=h[m+1],te=h[m+2],se=h[m+3],(ie&192)===128&&(te&192)===128&&(se&192)===128&&(K=(S&15)<<18|(ie&63)<<12|(te&63)<<6|se&63,K>65535&&K<1114112&&(v=K))}}v===null?(v=65533,q=1):v>65535&&(v-=65536,g.push(v>>>10&1023|55296),v=56320|v&1023),g.push(v),m+=q}return qt(g)}const it=4096;function qt(h){const o=h.length;if(o<=it)return String.fromCharCode.apply(String,h);let c="",g=0;for(;g<o;)c+=String.fromCharCode.apply(String,h.slice(g,g+=it));return c}function je(h,o,c){let g="";c=Math.min(h.length,c);for(let m=o;m<c;++m)g+=String.fromCharCode(h[m]&127);return g}function _t(h,o,c){let g="";c=Math.min(h.length,c);for(let m=o;m<c;++m)g+=String.fromCharCode(h[m]);return g}function Ke(h,o,c){const g=h.length;(!o||o<0)&&(o=0),(!c||c<0||c>g)&&(c=g);let m="";for(let S=o;S<c;++S)m+=Gt[h[S]];return m}function Et(h,o,c){const g=h.slice(o,c);let m="";for(let S=0;S<g.length-1;S+=2)m+=String.fromCharCode(g[S]+g[S+1]*256);return m}l.prototype.slice=function(o,c){const g=this.length;o=~~o,c=c===void 0?g:~~c,o<0?(o+=g,o<0&&(o=0)):o>g&&(o=g),c<0?(c+=g,c<0&&(c=0)):c>g&&(c=g),c<o&&(c=o);const m=this.subarray(o,c);return Object.setPrototypeOf(m,l.prototype),m};function re(h,o,c){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+o>c)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(o,c,g){o=o>>>0,c=c>>>0,g||re(o,c,this.length);let m=this[o],S=1,v=0;for(;++v<c&&(S*=256);)m+=this[o+v]*S;return m},l.prototype.readUintBE=l.prototype.readUIntBE=function(o,c,g){o=o>>>0,c=c>>>0,g||re(o,c,this.length);let m=this[o+--c],S=1;for(;c>0&&(S*=256);)m+=this[o+--c]*S;return m},l.prototype.readUint8=l.prototype.readUInt8=function(o,c){return o=o>>>0,c||re(o,1,this.length),this[o]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(o,c){return o=o>>>0,c||re(o,2,this.length),this[o]|this[o+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(o,c){return o=o>>>0,c||re(o,2,this.length),this[o]<<8|this[o+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(o,c){return o=o>>>0,c||re(o,4,this.length),(this[o]|this[o+1]<<8|this[o+2]<<16)+this[o+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(o,c){return o=o>>>0,c||re(o,4,this.length),this[o]*16777216+(this[o+1]<<16|this[o+2]<<8|this[o+3])},l.prototype.readBigUInt64LE=Ce(function(o){o=o>>>0,T(o,"offset");const c=this[o],g=this[o+7];(c===void 0||g===void 0)&&M(o,this.length-8);const m=c+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24,S=this[++o]+this[++o]*2**8+this[++o]*2**16+g*2**24;return BigInt(m)+(BigInt(S)<<BigInt(32))}),l.prototype.readBigUInt64BE=Ce(function(o){o=o>>>0,T(o,"offset");const c=this[o],g=this[o+7];(c===void 0||g===void 0)&&M(o,this.length-8);const m=c*2**24+this[++o]*2**16+this[++o]*2**8+this[++o],S=this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+g;return(BigInt(m)<<BigInt(32))+BigInt(S)}),l.prototype.readIntLE=function(o,c,g){o=o>>>0,c=c>>>0,g||re(o,c,this.length);let m=this[o],S=1,v=0;for(;++v<c&&(S*=256);)m+=this[o+v]*S;return S*=128,m>=S&&(m-=Math.pow(2,8*c)),m},l.prototype.readIntBE=function(o,c,g){o=o>>>0,c=c>>>0,g||re(o,c,this.length);let m=c,S=1,v=this[o+--m];for(;m>0&&(S*=256);)v+=this[o+--m]*S;return S*=128,v>=S&&(v-=Math.pow(2,8*c)),v},l.prototype.readInt8=function(o,c){return o=o>>>0,c||re(o,1,this.length),this[o]&128?(255-this[o]+1)*-1:this[o]},l.prototype.readInt16LE=function(o,c){o=o>>>0,c||re(o,2,this.length);const g=this[o]|this[o+1]<<8;return g&32768?g|4294901760:g},l.prototype.readInt16BE=function(o,c){o=o>>>0,c||re(o,2,this.length);const g=this[o+1]|this[o]<<8;return g&32768?g|4294901760:g},l.prototype.readInt32LE=function(o,c){return o=o>>>0,c||re(o,4,this.length),this[o]|this[o+1]<<8|this[o+2]<<16|this[o+3]<<24},l.prototype.readInt32BE=function(o,c){return o=o>>>0,c||re(o,4,this.length),this[o]<<24|this[o+1]<<16|this[o+2]<<8|this[o+3]},l.prototype.readBigInt64LE=Ce(function(o){o=o>>>0,T(o,"offset");const c=this[o],g=this[o+7];(c===void 0||g===void 0)&&M(o,this.length-8);const m=this[o+4]+this[o+5]*2**8+this[o+6]*2**16+(g<<24);return(BigInt(m)<<BigInt(32))+BigInt(c+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24)}),l.prototype.readBigInt64BE=Ce(function(o){o=o>>>0,T(o,"offset");const c=this[o],g=this[o+7];(c===void 0||g===void 0)&&M(o,this.length-8);const m=(c<<24)+this[++o]*2**16+this[++o]*2**8+this[++o];return(BigInt(m)<<BigInt(32))+BigInt(this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+g)}),l.prototype.readFloatLE=function(o,c){return o=o>>>0,c||re(o,4,this.length),n.read(this,o,!0,23,4)},l.prototype.readFloatBE=function(o,c){return o=o>>>0,c||re(o,4,this.length),n.read(this,o,!1,23,4)},l.prototype.readDoubleLE=function(o,c){return o=o>>>0,c||re(o,8,this.length),n.read(this,o,!0,52,8)},l.prototype.readDoubleBE=function(o,c){return o=o>>>0,c||re(o,8,this.length),n.read(this,o,!1,52,8)};function ce(h,o,c,g,m,S){if(!l.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(o>m||o<S)throw new RangeError('"value" argument is out of bounds');if(c+g>h.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(o,c,g,m){if(o=+o,c=c>>>0,g=g>>>0,!m){const q=Math.pow(2,8*g)-1;ce(this,o,c,g,q,0)}let S=1,v=0;for(this[c]=o&255;++v<g&&(S*=256);)this[c+v]=o/S&255;return c+g},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(o,c,g,m){if(o=+o,c=c>>>0,g=g>>>0,!m){const q=Math.pow(2,8*g)-1;ce(this,o,c,g,q,0)}let S=g-1,v=1;for(this[c+S]=o&255;--S>=0&&(v*=256);)this[c+S]=o/v&255;return c+g},l.prototype.writeUint8=l.prototype.writeUInt8=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,1,255,0),this[c]=o&255,c+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,2,65535,0),this[c]=o&255,this[c+1]=o>>>8,c+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,2,65535,0),this[c]=o>>>8,this[c+1]=o&255,c+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,4,4294967295,0),this[c+3]=o>>>24,this[c+2]=o>>>16,this[c+1]=o>>>8,this[c]=o&255,c+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,4,4294967295,0),this[c]=o>>>24,this[c+1]=o>>>16,this[c+2]=o>>>8,this[c+3]=o&255,c+4};function xe(h,o,c,g,m){y(o,g,m,h,c,7);let S=Number(o&BigInt(4294967295));h[c++]=S,S=S>>8,h[c++]=S,S=S>>8,h[c++]=S,S=S>>8,h[c++]=S;let v=Number(o>>BigInt(32)&BigInt(4294967295));return h[c++]=v,v=v>>8,h[c++]=v,v=v>>8,h[c++]=v,v=v>>8,h[c++]=v,c}function Ct(h,o,c,g,m){y(o,g,m,h,c,7);let S=Number(o&BigInt(4294967295));h[c+7]=S,S=S>>8,h[c+6]=S,S=S>>8,h[c+5]=S,S=S>>8,h[c+4]=S;let v=Number(o>>BigInt(32)&BigInt(4294967295));return h[c+3]=v,v=v>>8,h[c+2]=v,v=v>>8,h[c+1]=v,v=v>>8,h[c]=v,c+8}l.prototype.writeBigUInt64LE=Ce(function(o,c=0){return xe(this,o,c,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Ce(function(o,c=0){return Ct(this,o,c,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(o,c,g,m){if(o=+o,c=c>>>0,!m){const ie=Math.pow(2,8*g-1);ce(this,o,c,g,ie-1,-ie)}let S=0,v=1,q=0;for(this[c]=o&255;++S<g&&(v*=256);)o<0&&q===0&&this[c+S-1]!==0&&(q=1),this[c+S]=(o/v>>0)-q&255;return c+g},l.prototype.writeIntBE=function(o,c,g,m){if(o=+o,c=c>>>0,!m){const ie=Math.pow(2,8*g-1);ce(this,o,c,g,ie-1,-ie)}let S=g-1,v=1,q=0;for(this[c+S]=o&255;--S>=0&&(v*=256);)o<0&&q===0&&this[c+S+1]!==0&&(q=1),this[c+S]=(o/v>>0)-q&255;return c+g},l.prototype.writeInt8=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,1,127,-128),o<0&&(o=255+o+1),this[c]=o&255,c+1},l.prototype.writeInt16LE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,2,32767,-32768),this[c]=o&255,this[c+1]=o>>>8,c+2},l.prototype.writeInt16BE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,2,32767,-32768),this[c]=o>>>8,this[c+1]=o&255,c+2},l.prototype.writeInt32LE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,4,2147483647,-2147483648),this[c]=o&255,this[c+1]=o>>>8,this[c+2]=o>>>16,this[c+3]=o>>>24,c+4},l.prototype.writeInt32BE=function(o,c,g){return o=+o,c=c>>>0,g||ce(this,o,c,4,2147483647,-2147483648),o<0&&(o=4294967295+o+1),this[c]=o>>>24,this[c+1]=o>>>16,this[c+2]=o>>>8,this[c+3]=o&255,c+4},l.prototype.writeBigInt64LE=Ce(function(o,c=0){return xe(this,o,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Ce(function(o,c=0){return Ct(this,o,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function St(h,o,c,g,m,S){if(c+g>h.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function R(h,o,c,g,m){return o=+o,c=c>>>0,m||St(h,o,c,4),n.write(h,o,c,g,23,4),c+4}l.prototype.writeFloatLE=function(o,c,g){return R(this,o,c,!0,g)},l.prototype.writeFloatBE=function(o,c,g){return R(this,o,c,!1,g)};function C(h,o,c,g,m){return o=+o,c=c>>>0,m||St(h,o,c,8),n.write(h,o,c,g,52,8),c+8}l.prototype.writeDoubleLE=function(o,c,g){return C(this,o,c,!0,g)},l.prototype.writeDoubleBE=function(o,c,g){return C(this,o,c,!1,g)},l.prototype.copy=function(o,c,g,m){if(!l.isBuffer(o))throw new TypeError("argument should be a Buffer");if(g||(g=0),!m&&m!==0&&(m=this.length),c>=o.length&&(c=o.length),c||(c=0),m>0&&m<g&&(m=g),m===g||o.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("sourceEnd out of bounds");m>this.length&&(m=this.length),o.length-c<m-g&&(m=o.length-c+g);const S=m-g;return this===o&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(c,g,m):Uint8Array.prototype.set.call(o,this.subarray(g,m),c),S},l.prototype.fill=function(o,c,g,m){if(typeof o=="string"){if(typeof c=="string"?(m=c,c=0,g=this.length):typeof g=="string"&&(m=g,g=this.length),m!==void 0&&typeof m!="string")throw new TypeError("encoding must be a string");if(typeof m=="string"&&!l.isEncoding(m))throw new TypeError("Unknown encoding: "+m);if(o.length===1){const v=o.charCodeAt(0);(m==="utf8"&&v<128||m==="latin1")&&(o=v)}}else typeof o=="number"?o=o&255:typeof o=="boolean"&&(o=Number(o));if(c<0||this.length<c||this.length<g)throw new RangeError("Out of range index");if(g<=c)return this;c=c>>>0,g=g===void 0?this.length:g>>>0,o||(o=0);let S;if(typeof o=="number")for(S=c;S<g;++S)this[S]=o;else{const v=l.isBuffer(o)?o:l.from(o,m),q=v.length;if(q===0)throw new TypeError('The value "'+o+'" is invalid for argument "value"');for(S=0;S<g-c;++S)this[S+c]=v[S%q]}return this};const I={};function F(h,o,c){I[h]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:o.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${h}]`,this.stack,delete this.name}get code(){return h}set code(m){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:m,writable:!0})}toString(){return`${this.name} [${h}]: ${this.message}`}}}F("ERR_BUFFER_OUT_OF_BOUNDS",function(h){return h?`${h} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),F("ERR_INVALID_ARG_TYPE",function(h,o){return`The "${h}" argument must be of type number. Received type ${typeof o}`},TypeError),F("ERR_OUT_OF_RANGE",function(h,o,c){let g=`The value of "${h}" is out of range.`,m=c;return Number.isInteger(c)&&Math.abs(c)>2**32?m=W(String(c)):typeof c=="bigint"&&(m=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(m=W(m)),m+="n"),g+=` It must be ${o}. Received ${m}`,g},RangeError);function W(h){let o="",c=h.length;const g=h[0]==="-"?1:0;for(;c>=g+4;c-=3)o=`_${h.slice(c-3,c)}${o}`;return`${h.slice(0,c)}${o}`}function p(h,o,c){T(o,"offset"),(h[o]===void 0||h[o+c]===void 0)&&M(o,h.length-(c+1))}function y(h,o,c,g,m,S){if(h>c||h<o){const v=typeof o=="bigint"?"n":"";let q;throw S>3?o===0||o===BigInt(0)?q=`>= 0${v} and < 2${v} ** ${(S+1)*8}${v}`:q=`>= -(2${v} ** ${(S+1)*8-1}${v}) and < 2 ** ${(S+1)*8-1}${v}`:q=`>= ${o}${v} and <= ${c}${v}`,new I.ERR_OUT_OF_RANGE("value",q,h)}p(g,m,S)}function T(h,o){if(typeof h!="number")throw new I.ERR_INVALID_ARG_TYPE(o,"number",h)}function M(h,o,c){throw Math.floor(h)!==h?(T(h,c),new I.ERR_OUT_OF_RANGE(c||"offset","an integer",h)):o<0?new I.ERR_BUFFER_OUT_OF_BOUNDS:new I.ERR_OUT_OF_RANGE(c||"offset",`>= ${c?1:0} and <= ${o}`,h)}const ee=/[^+/0-9A-Za-z-_]/g;function V(h){if(h=h.split("=")[0],h=h.trim().replace(ee,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function J(h,o){o=o||1/0;let c;const g=h.length;let m=null;const S=[];for(let v=0;v<g;++v){if(c=h.charCodeAt(v),c>55295&&c<57344){if(!m){if(c>56319){(o-=3)>-1&&S.push(239,191,189);continue}else if(v+1===g){(o-=3)>-1&&S.push(239,191,189);continue}m=c;continue}if(c<56320){(o-=3)>-1&&S.push(239,191,189),m=c;continue}c=(m-55296<<10|c-56320)+65536}else m&&(o-=3)>-1&&S.push(239,191,189);if(m=null,c<128){if((o-=1)<0)break;S.push(c)}else if(c<2048){if((o-=2)<0)break;S.push(c>>6|192,c&63|128)}else if(c<65536){if((o-=3)<0)break;S.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((o-=4)<0)break;S.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return S}function Xe(h){const o=[];for(let c=0;c<h.length;++c)o.push(h.charCodeAt(c)&255);return o}function Rt(h,o){let c,g,m;const S=[];for(let v=0;v<h.length&&!((o-=2)<0);++v)c=h.charCodeAt(v),g=c>>8,m=c%256,S.push(m),S.push(g);return S}function Yt(h){return e.toByteArray(V(h))}function kt(h,o,c,g){let m;for(m=0;m<g&&!(m+c>=o.length||m>=h.length);++m)o[m+c]=h[m];return m}function be(h,o){return h instanceof o||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===o.name}function st(h){return h!==h}const Gt=function(){const h="0123456789abcdef",o=new Array(256);for(let c=0;c<16;++c){const g=c*16;for(let m=0;m<16;++m)o[g+m]=h[c]+h[m]}return o}();function Ce(h){return typeof BigInt>"u"?ot:h}function ot(){throw new Error("BigInt not supported")}})(Wt);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var n=Wt,r=n.Buffer;function i(a,l){for(var u in a)l[u]=a[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=s);function s(a,l,u){return r(a,l,u)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(a,l,u){if(typeof a=="number")throw new TypeError("Argument must not be a number");return r(a,l,u)},s.alloc=function(a,l,u){if(typeof a!="number")throw new TypeError("Argument must be a number");var d=r(a);return l!==void 0?typeof u=="string"?d.fill(l,u):d.fill(l):d.fill(0),d},s.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r(a)},s.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(a)}})(Ur,Ur.exports);var Lo=Ur.exports,ur=65536,au=4294967295;function uu(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var hu=Lo.Buffer,Mn=globalThis.crypto||globalThis.msCrypto;Mn&&Mn.getRandomValues?Fr.exports=du:Fr.exports=uu;function du(t,e){if(t>au)throw new RangeError("requested too many random bytes");var n=hu.allocUnsafe(t);if(t>0)if(t>ur)for(var r=0;r<t;r+=ur)Mn.getRandomValues(n.slice(r,r+ur));else Mn.getRandomValues(n);return typeof e=="function"?process.nextTick(function(){e(null,n)}):n}var fu=Fr.exports,Pr={exports:{}};const gu={},pu=Object.freeze(Object.defineProperty({__proto__:null,default:gu},Symbol.toStringTag,{value:"Module"})),Nn=Ja(pu);var Bo=Nn.EventEmitter,hr,zi;function yu(){if(zi)return hr;zi=1;function t(k,A){var D=Object.keys(k);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(k);A&&(_=_.filter(function(x){return Object.getOwnPropertyDescriptor(k,x).enumerable})),D.push.apply(D,_)}return D}function e(k){for(var A=1;A<arguments.length;A++){var D=arguments[A]!=null?arguments[A]:{};A%2?t(Object(D),!0).forEach(function(_){n(k,_,D[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(D)):t(Object(D)).forEach(function(_){Object.defineProperty(k,_,Object.getOwnPropertyDescriptor(D,_))})}return k}function n(k,A,D){return A=a(A),A in k?Object.defineProperty(k,A,{value:D,enumerable:!0,configurable:!0,writable:!0}):k[A]=D,k}function r(k,A){if(!(k instanceof A))throw new TypeError("Cannot call a class as a function")}function i(k,A){for(var D=0;D<A.length;D++){var _=A[D];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(k,a(_.key),_)}}function s(k,A,D){return A&&i(k.prototype,A),D&&i(k,D),Object.defineProperty(k,"prototype",{writable:!1}),k}function a(k){var A=l(k,"string");return typeof A=="symbol"?A:String(A)}function l(k,A){if(typeof k!="object"||k===null)return k;var D=k[Symbol.toPrimitive];if(D!==void 0){var _=D.call(k,A||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(k)}var u=Wt,d=u.Buffer,f=Nn,w=f.inspect,b=w&&w.custom||"inspect";function E(k,A,D){d.prototype.copy.call(k,A,D)}return hr=function(){function k(){r(this,k),this.head=null,this.tail=null,this.length=0}return s(k,[{key:"push",value:function(D){var _={data:D,next:null};this.length>0?this.tail.next=_:this.head=_,this.tail=_,++this.length}},{key:"unshift",value:function(D){var _={data:D,next:this.head};this.length===0&&(this.tail=_),this.head=_,++this.length}},{key:"shift",value:function(){if(this.length!==0){var D=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,D}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(D){if(this.length===0)return"";for(var _=this.head,x=""+_.data;_=_.next;)x+=D+_.data;return x}},{key:"concat",value:function(D){if(this.length===0)return d.alloc(0);for(var _=d.allocUnsafe(D>>>0),x=this.head,L=0;x;)E(x.data,_,L),L+=x.data.length,x=x.next;return _}},{key:"consume",value:function(D,_){var x;return D<this.head.data.length?(x=this.head.data.slice(0,D),this.head.data=this.head.data.slice(D)):D===this.head.data.length?x=this.shift():x=_?this._getString(D):this._getBuffer(D),x}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(D){var _=this.head,x=1,L=_.data;for(D-=L.length;_=_.next;){var B=_.data,O=D>B.length?B.length:D;if(O===B.length?L+=B:L+=B.slice(0,D),D-=O,D===0){O===B.length?(++x,_.next?this.head=_.next:this.head=this.tail=null):(this.head=_,_.data=B.slice(O));break}++x}return this.length-=x,L}},{key:"_getBuffer",value:function(D){var _=d.allocUnsafe(D),x=this.head,L=1;for(x.data.copy(_),D-=x.data.length;x=x.next;){var B=x.data,O=D>B.length?B.length:D;if(B.copy(_,_.length-D,0,O),D-=O,D===0){O===B.length?(++L,x.next?this.head=x.next:this.head=this.tail=null):(this.head=x,x.data=B.slice(O));break}++L}return this.length-=L,_}},{key:b,value:function(D,_){return w(this,e(e({},_),{},{depth:0,customInspect:!1}))}}]),k}(),hr}function wu(t,e){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(jr,this,t)):process.nextTick(jr,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?n._writableState?n._writableState.errorEmitted?process.nextTick(kn,n):(n._writableState.errorEmitted=!0,process.nextTick(Ji,n,s)):process.nextTick(Ji,n,s):e?(process.nextTick(kn,n),e(s)):process.nextTick(kn,n)}),this)}function Ji(t,e){jr(t,e),kn(t)}function kn(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function mu(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function jr(t,e){t.emit("error",e)}function bu(t,e){var n=t._readableState,r=t._writableState;n&&n.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var Oo={destroy:wu,undestroy:mu,errorOrDestroy:bu},mt={};function _u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Mo={};function ve(t,e,n){n||(n=Error);function r(s,a,l){return typeof e=="string"?e:e(s,a,l)}var i=function(s){_u(a,s);function a(l,u,d){return s.call(this,r(l,u,d))||this}return a}(n);i.prototype.name=n.name,i.prototype.code=t,Mo[t]=i}function Ki(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map(function(r){return String(r)}),n>2?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:n===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Eu(t,e,n){return t.substr(!n||n<0?0:+n,e.length)===e}function Cu(t,e,n){return(n===void 0||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}function Su(t,e,n){return typeof n!="number"&&(n=0),n+e.length>t.length?!1:t.indexOf(e,n)!==-1}ve("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);ve("ERR_INVALID_ARG_TYPE",function(t,e,n){var r;typeof e=="string"&&Eu(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var i;if(Cu(t," argument"))i="The ".concat(t," ").concat(r," ").concat(Ki(e,"type"));else{var s=Su(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(Ki(e,"type"))}return i+=". Received type ".concat(typeof n),i},TypeError);ve("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");ve("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});ve("ERR_STREAM_PREMATURE_CLOSE","Premature close");ve("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});ve("ERR_MULTIPLE_CALLBACK","Callback called multiple times");ve("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");ve("ERR_STREAM_WRITE_AFTER_END","write after end");ve("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);ve("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);ve("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");mt.codes=Mo;var Ru=mt.codes.ERR_INVALID_OPT_VALUE;function ku(t,e,n){return t.highWaterMark!=null?t.highWaterMark:e?t[n]:null}function vu(t,e,n,r){var i=ku(e,r,n);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=r?n:"highWaterMark";throw new Ru(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var No={getHighWaterMark:vu},$r={exports:{}};typeof Object.create=="function"?$r.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:$r.exports=function(e,n){if(n){e.super_=n;var r=function(){};r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e}};var yn=$r.exports,Au=Tu;function Tu(t,e){if(dr("noDeprecation"))return t;var n=!1;function r(){if(!n){if(dr("throwDeprecation"))throw new Error(e);dr("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}return r}function dr(t){try{if(!globalThis.localStorage)return!1}catch{return!1}var e=globalThis.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var fr,Xi;function Fo(){if(Xi)return fr;Xi=1,fr=H;function t(R){var C=this;this.next=null,this.entry=null,this.finish=function(){St(C,R)}}var e;H.WritableState=P;var n={deprecate:Au},r=Bo,i=Wt.Buffer,s=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(R){return i.from(R)}function l(R){return i.isBuffer(R)||R instanceof s}var u=Oo,d=No,f=d.getHighWaterMark,w=mt.codes,b=w.ERR_INVALID_ARG_TYPE,E=w.ERR_METHOD_NOT_IMPLEMENTED,k=w.ERR_MULTIPLE_CALLBACK,A=w.ERR_STREAM_CANNOT_PIPE,D=w.ERR_STREAM_DESTROYED,_=w.ERR_STREAM_NULL_VALUES,x=w.ERR_STREAM_WRITE_AFTER_END,L=w.ERR_UNKNOWN_ENCODING,B=u.errorOrDestroy;yn(H,r);function O(){}function P(R,C,I){e=e||Pt(),R=R||{},typeof I!="boolean"&&(I=C instanceof e),this.objectMode=!!R.objectMode,I&&(this.objectMode=this.objectMode||!!R.writableObjectMode),this.highWaterMark=f(this,R,"writableHighWaterMark",I),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var F=R.decodeStrings===!1;this.decodeStrings=!F,this.defaultEncoding=R.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(W){qt(C,W)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=R.emitClose!==!1,this.autoDestroy=!!R.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}P.prototype.getBuffer=function(){for(var C=this.bufferedRequest,I=[];C;)I.push(C),C=C.next;return I},function(){try{Object.defineProperty(P.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Z;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Z=Function.prototype[Symbol.hasInstance],Object.defineProperty(H,Symbol.hasInstance,{value:function(C){return Z.call(this,C)?!0:this!==H?!1:C&&C._writableState instanceof P}})):Z=function(C){return C instanceof this};function H(R){e=e||Pt();var C=this instanceof e;if(!C&&!Z.call(H,this))return new H(R);this._writableState=new P(R,this,C),this.writable=!0,R&&(typeof R.write=="function"&&(this._write=R.write),typeof R.writev=="function"&&(this._writev=R.writev),typeof R.destroy=="function"&&(this._destroy=R.destroy),typeof R.final=="function"&&(this._final=R.final)),r.call(this)}H.prototype.pipe=function(){B(this,new A)};function j(R,C){var I=new x;B(R,I),process.nextTick(C,I)}function Ae(R,C,I,F){var W;return I===null?W=new _:typeof I!="string"&&!C.objectMode&&(W=new b("chunk",["string","Buffer"],I)),W?(B(R,W),process.nextTick(F,W),!1):!0}H.prototype.write=function(R,C,I){var F=this._writableState,W=!1,p=!F.objectMode&&l(R);return p&&!i.isBuffer(R)&&(R=a(R)),typeof C=="function"&&(I=C,C=null),p?C="buffer":C||(C=F.defaultEncoding),typeof I!="function"&&(I=O),F.ending?j(this,I):(p||Ae(this,F,R,I))&&(F.pendingcb++,W=Vt(this,F,p,R,C,I)),W},H.prototype.cork=function(){this._writableState.corked++},H.prototype.uncork=function(){var R=this._writableState;R.corked&&(R.corked--,!R.writing&&!R.corked&&!R.bufferProcessing&&R.bufferedRequest&&Ke(this,R))},H.prototype.setDefaultEncoding=function(C){if(typeof C=="string"&&(C=C.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((C+"").toLowerCase())>-1))throw new L(C);return this._writableState.defaultEncoding=C,this},Object.defineProperty(H.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function rt(R,C,I){return!R.objectMode&&R.decodeStrings!==!1&&typeof C=="string"&&(C=i.from(C,I)),C}Object.defineProperty(H.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Vt(R,C,I,F,W,p){if(!I){var y=rt(C,F,W);F!==y&&(I=!0,W="buffer",F=y)}var T=C.objectMode?1:F.length;C.length+=T;var M=C.length<C.highWaterMark;if(M||(C.needDrain=!0),C.writing||C.corked){var ee=C.lastBufferedRequest;C.lastBufferedRequest={chunk:F,encoding:W,isBuf:I,callback:p,next:null},ee?ee.next=C.lastBufferedRequest:C.bufferedRequest=C.lastBufferedRequest,C.bufferedRequestCount+=1}else Je(R,C,!1,T,F,W,p);return M}function Je(R,C,I,F,W,p,y){C.writelen=F,C.writecb=y,C.writing=!0,C.sync=!0,C.destroyed?C.onwrite(new D("write")):I?R._writev(W,C.onwrite):R._write(W,p,C.onwrite),C.sync=!1}function bt(R,C,I,F,W){--C.pendingcb,I?(process.nextTick(W,F),process.nextTick(xe,R,C),R._writableState.errorEmitted=!0,B(R,F)):(W(F),R._writableState.errorEmitted=!0,B(R,F),xe(R,C))}function it(R){R.writing=!1,R.writecb=null,R.length-=R.writelen,R.writelen=0}function qt(R,C){var I=R._writableState,F=I.sync,W=I.writecb;if(typeof W!="function")throw new k;if(it(I),C)bt(R,I,F,C,W);else{var p=Et(I)||R.destroyed;!p&&!I.corked&&!I.bufferProcessing&&I.bufferedRequest&&Ke(R,I),F?process.nextTick(je,R,I,p,W):je(R,I,p,W)}}function je(R,C,I,F){I||_t(R,C),C.pendingcb--,F(),xe(R,C)}function _t(R,C){C.length===0&&C.needDrain&&(C.needDrain=!1,R.emit("drain"))}function Ke(R,C){C.bufferProcessing=!0;var I=C.bufferedRequest;if(R._writev&&I&&I.next){var F=C.bufferedRequestCount,W=new Array(F),p=C.corkedRequestsFree;p.entry=I;for(var y=0,T=!0;I;)W[y]=I,I.isBuf||(T=!1),I=I.next,y+=1;W.allBuffers=T,Je(R,C,!0,C.length,W,"",p.finish),C.pendingcb++,C.lastBufferedRequest=null,p.next?(C.corkedRequestsFree=p.next,p.next=null):C.corkedRequestsFree=new t(C),C.bufferedRequestCount=0}else{for(;I;){var M=I.chunk,ee=I.encoding,V=I.callback,J=C.objectMode?1:M.length;if(Je(R,C,!1,J,M,ee,V),I=I.next,C.bufferedRequestCount--,C.writing)break}I===null&&(C.lastBufferedRequest=null)}C.bufferedRequest=I,C.bufferProcessing=!1}H.prototype._write=function(R,C,I){I(new E("_write()"))},H.prototype._writev=null,H.prototype.end=function(R,C,I){var F=this._writableState;return typeof R=="function"?(I=R,R=null,C=null):typeof C=="function"&&(I=C,C=null),R!=null&&this.write(R,C),F.corked&&(F.corked=1,this.uncork()),F.ending||Ct(this,F,I),this},Object.defineProperty(H.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Et(R){return R.ending&&R.length===0&&R.bufferedRequest===null&&!R.finished&&!R.writing}function re(R,C){R._final(function(I){C.pendingcb--,I&&B(R,I),C.prefinished=!0,R.emit("prefinish"),xe(R,C)})}function ce(R,C){!C.prefinished&&!C.finalCalled&&(typeof R._final=="function"&&!C.destroyed?(C.pendingcb++,C.finalCalled=!0,process.nextTick(re,R,C)):(C.prefinished=!0,R.emit("prefinish")))}function xe(R,C){var I=Et(C);if(I&&(ce(R,C),C.pendingcb===0&&(C.finished=!0,R.emit("finish"),C.autoDestroy))){var F=R._readableState;(!F||F.autoDestroy&&F.endEmitted)&&R.destroy()}return I}function Ct(R,C,I){C.ending=!0,xe(R,C),I&&(C.finished?process.nextTick(I):R.once("finish",I)),C.ended=!0,R.writable=!1}function St(R,C,I){var F=R.entry;for(R.entry=null;F;){var W=F.callback;C.pendingcb--,W(I),F=F.next}C.corkedRequestsFree.next=R}return Object.defineProperty(H.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(C){this._writableState&&(this._writableState.destroyed=C)}}),H.prototype.destroy=u.destroy,H.prototype._undestroy=u.undestroy,H.prototype._destroy=function(R,C){C(R)},fr}var gr,Zi;function Pt(){if(Zi)return gr;Zi=1;var t=Object.keys||function(d){var f=[];for(var w in d)f.push(w);return f};gr=a;var e=Po(),n=Fo();yn(a,e);for(var r=t(n.prototype),i=0;i<r.length;i++){var s=r[i];a.prototype[s]||(a.prototype[s]=n.prototype[s])}function a(d){if(!(this instanceof a))return new a(d);e.call(this,d),n.call(this,d),this.allowHalfOpen=!0,d&&(d.readable===!1&&(this.readable=!1),d.writable===!1&&(this.writable=!1),d.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",l)))}Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function l(){this._writableState.ended||process.nextTick(u,this)}function u(d){d.end()}return Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(f){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=f,this._writableState.destroyed=f)}}),gr}var pr={},Qi;function es(){if(Qi)return pr;Qi=1;var t=Lo.Buffer,e=t.isEncoding||function(_){switch(_=""+_,_&&_.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(_){if(!_)return"utf8";for(var x;;)switch(_){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return _;default:if(x)return;_=(""+_).toLowerCase(),x=!0}}function r(_){var x=n(_);if(typeof x!="string"&&(t.isEncoding===e||!e(_)))throw new Error("Unknown encoding: "+_);return x||_}pr.StringDecoder=i;function i(_){this.encoding=r(_);var x;switch(this.encoding){case"utf16le":this.text=w,this.end=b,x=4;break;case"utf8":this.fillLast=u,x=4;break;case"base64":this.text=E,this.end=k,x=3;break;default:this.write=A,this.end=D;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(x)}i.prototype.write=function(_){if(_.length===0)return"";var x,L;if(this.lastNeed){if(x=this.fillLast(_),x===void 0)return"";L=this.lastNeed,this.lastNeed=0}else L=0;return L<_.length?x?x+this.text(_,L):this.text(_,L):x||""},i.prototype.end=f,i.prototype.text=d,i.prototype.fillLast=function(_){if(this.lastNeed<=_.length)return _.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);_.copy(this.lastChar,this.lastTotal-this.lastNeed,0,_.length),this.lastNeed-=_.length};function s(_){return _<=127?0:_>>5===6?2:_>>4===14?3:_>>3===30?4:_>>6===2?-1:-2}function a(_,x,L){var B=x.length-1;if(B<L)return 0;var O=s(x[B]);return O>=0?(O>0&&(_.lastNeed=O-1),O):--B<L||O===-2?0:(O=s(x[B]),O>=0?(O>0&&(_.lastNeed=O-2),O):--B<L||O===-2?0:(O=s(x[B]),O>=0?(O>0&&(O===2?O=0:_.lastNeed=O-3),O):0))}function l(_,x,L){if((x[0]&192)!==128)return _.lastNeed=0,"";if(_.lastNeed>1&&x.length>1){if((x[1]&192)!==128)return _.lastNeed=1,"";if(_.lastNeed>2&&x.length>2&&(x[2]&192)!==128)return _.lastNeed=2,""}}function u(_){var x=this.lastTotal-this.lastNeed,L=l(this,_);if(L!==void 0)return L;if(this.lastNeed<=_.length)return _.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);_.copy(this.lastChar,x,0,_.length),this.lastNeed-=_.length}function d(_,x){var L=a(this,_,x);if(!this.lastNeed)return _.toString("utf8",x);this.lastTotal=L;var B=_.length-(L-this.lastNeed);return _.copy(this.lastChar,0,B),_.toString("utf8",x,B)}function f(_){var x=_&&_.length?this.write(_):"";return this.lastNeed?x+"":x}function w(_,x){if((_.length-x)%2===0){var L=_.toString("utf16le",x);if(L){var B=L.charCodeAt(L.length-1);if(B>=55296&&B<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1],L.slice(0,-1)}return L}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=_[_.length-1],_.toString("utf16le",x,_.length-1)}function b(_){var x=_&&_.length?this.write(_):"";if(this.lastNeed){var L=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,L)}return x}function E(_,x){var L=(_.length-x)%3;return L===0?_.toString("base64",x):(this.lastNeed=3-L,this.lastTotal=3,L===1?this.lastChar[0]=_[_.length-1]:(this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1]),_.toString("base64",x,_.length-L))}function k(_){var x=_&&_.length?this.write(_):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function A(_){return _.toString(this.encoding)}function D(_){return _&&_.length?this.write(_):""}return pr}var ts=mt.codes.ERR_STREAM_PREMATURE_CLOSE;function xu(t){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.apply(this,r)}}}function Iu(){}function Du(t){return t.setHeader&&typeof t.abort=="function"}function Uo(t,e,n){if(typeof e=="function")return Uo(t,null,e);e||(e={}),n=xu(n||Iu);var r=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||l()},a=t._writableState&&t._writableState.finished,l=function(){i=!1,a=!0,r||n.call(t)},u=t._readableState&&t._readableState.endEmitted,d=function(){r=!1,u=!0,i||n.call(t)},f=function(k){n.call(t,k)},w=function(){var k;if(r&&!u)return(!t._readableState||!t._readableState.ended)&&(k=new ts),n.call(t,k);if(i&&!a)return(!t._writableState||!t._writableState.ended)&&(k=new ts),n.call(t,k)},b=function(){t.req.on("finish",l)};return Du(t)?(t.on("complete",l),t.on("abort",w),t.req?b():t.on("request",b)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",d),t.on("finish",l),e.error!==!1&&t.on("error",f),t.on("close",w),function(){t.removeListener("complete",l),t.removeListener("abort",w),t.removeListener("request",b),t.req&&t.req.removeListener("finish",l),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",f),t.removeListener("close",w)}}var gi=Uo,yr,ns;function Lu(){if(ns)return yr;ns=1;var t;function e(L,B,O){return B=n(B),B in L?Object.defineProperty(L,B,{value:O,enumerable:!0,configurable:!0,writable:!0}):L[B]=O,L}function n(L){var B=r(L,"string");return typeof B=="symbol"?B:String(B)}function r(L,B){if(typeof L!="object"||L===null)return L;var O=L[Symbol.toPrimitive];if(O!==void 0){var P=O.call(L,B||"default");if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(B==="string"?String:Number)(L)}var i=gi,s=Symbol("lastResolve"),a=Symbol("lastReject"),l=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),f=Symbol("handlePromise"),w=Symbol("stream");function b(L,B){return{value:L,done:B}}function E(L){var B=L[s];if(B!==null){var O=L[w].read();O!==null&&(L[d]=null,L[s]=null,L[a]=null,B(b(O,!1)))}}function k(L){process.nextTick(E,L)}function A(L,B){return function(O,P){L.then(function(){if(B[u]){O(b(void 0,!0));return}B[f](O,P)},P)}}var D=Object.getPrototypeOf(function(){}),_=Object.setPrototypeOf((t={get stream(){return this[w]},next:function(){var B=this,O=this[l];if(O!==null)return Promise.reject(O);if(this[u])return Promise.resolve(b(void 0,!0));if(this[w].destroyed)return new Promise(function(j,Ae){process.nextTick(function(){B[l]?Ae(B[l]):j(b(void 0,!0))})});var P=this[d],Z;if(P)Z=new Promise(A(P,this));else{var H=this[w].read();if(H!==null)return Promise.resolve(b(H,!1));Z=new Promise(this[f])}return this[d]=Z,Z}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var B=this;return new Promise(function(O,P){B[w].destroy(null,function(Z){if(Z){P(Z);return}O(b(void 0,!0))})})}),t),D),x=function(B){var O,P=Object.create(_,(O={},e(O,w,{value:B,writable:!0}),e(O,s,{value:null,writable:!0}),e(O,a,{value:null,writable:!0}),e(O,l,{value:null,writable:!0}),e(O,u,{value:B._readableState.endEmitted,writable:!0}),e(O,f,{value:function(H,j){var Ae=P[w].read();Ae?(P[d]=null,P[s]=null,P[a]=null,H(b(Ae,!1))):(P[s]=H,P[a]=j)},writable:!0}),O));return P[d]=null,i(B,function(Z){if(Z&&Z.code!=="ERR_STREAM_PREMATURE_CLOSE"){var H=P[a];H!==null&&(P[d]=null,P[s]=null,P[a]=null,H(Z)),P[l]=Z;return}var j=P[s];j!==null&&(P[d]=null,P[s]=null,P[a]=null,j(b(void 0,!0))),P[u]=!0}),B.on("readable",k.bind(null,P)),P};return yr=x,yr}var wr,rs;function Bu(){return rs||(rs=1,wr=function(){throw new Error("Readable.from is not available in the browser")}),wr}var mr,is;function Po(){if(is)return mr;is=1,mr=j;var t;j.ReadableState=H,Nn.EventEmitter;var e=function(y,T){return y.listeners(T).length},n=Bo,r=Wt.Buffer,i=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(p){return r.from(p)}function a(p){return r.isBuffer(p)||p instanceof i}var l=Nn,u;l&&l.debuglog?u=l.debuglog("stream"):u=function(){};var d=yu(),f=Oo,w=No,b=w.getHighWaterMark,E=mt.codes,k=E.ERR_INVALID_ARG_TYPE,A=E.ERR_STREAM_PUSH_AFTER_EOF,D=E.ERR_METHOD_NOT_IMPLEMENTED,_=E.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,x,L,B;yn(j,n);var O=f.errorOrDestroy,P=["error","close","destroy","pause","resume"];function Z(p,y,T){if(typeof p.prependListener=="function")return p.prependListener(y,T);!p._events||!p._events[y]?p.on(y,T):Array.isArray(p._events[y])?p._events[y].unshift(T):p._events[y]=[T,p._events[y]]}function H(p,y,T){t=t||Pt(),p=p||{},typeof T!="boolean"&&(T=y instanceof t),this.objectMode=!!p.objectMode,T&&(this.objectMode=this.objectMode||!!p.readableObjectMode),this.highWaterMark=b(this,p,"readableHighWaterMark",T),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=p.emitClose!==!1,this.autoDestroy=!!p.autoDestroy,this.destroyed=!1,this.defaultEncoding=p.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,p.encoding&&(x||(x=es().StringDecoder),this.decoder=new x(p.encoding),this.encoding=p.encoding)}function j(p){if(t=t||Pt(),!(this instanceof j))return new j(p);var y=this instanceof t;this._readableState=new H(p,this,y),this.readable=!0,p&&(typeof p.read=="function"&&(this._read=p.read),typeof p.destroy=="function"&&(this._destroy=p.destroy)),n.call(this)}Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(y){this._readableState&&(this._readableState.destroyed=y)}}),j.prototype.destroy=f.destroy,j.prototype._undestroy=f.undestroy,j.prototype._destroy=function(p,y){y(p)},j.prototype.push=function(p,y){var T=this._readableState,M;return T.objectMode?M=!0:typeof p=="string"&&(y=y||T.defaultEncoding,y!==T.encoding&&(p=r.from(p,y),y=""),M=!0),Ae(this,p,y,!1,M)},j.prototype.unshift=function(p){return Ae(this,p,null,!0,!1)};function Ae(p,y,T,M,ee){u("readableAddChunk",y);var V=p._readableState;if(y===null)V.reading=!1,qt(p,V);else{var J;if(ee||(J=Vt(V,y)),J)O(p,J);else if(V.objectMode||y&&y.length>0)if(typeof y!="string"&&!V.objectMode&&Object.getPrototypeOf(y)!==r.prototype&&(y=s(y)),M)V.endEmitted?O(p,new _):rt(p,V,y,!0);else if(V.ended)O(p,new A);else{if(V.destroyed)return!1;V.reading=!1,V.decoder&&!T?(y=V.decoder.write(y),V.objectMode||y.length!==0?rt(p,V,y,!1):Ke(p,V)):rt(p,V,y,!1)}else M||(V.reading=!1,Ke(p,V))}return!V.ended&&(V.length<V.highWaterMark||V.length===0)}function rt(p,y,T,M){y.flowing&&y.length===0&&!y.sync?(y.awaitDrain=0,p.emit("data",T)):(y.length+=y.objectMode?1:T.length,M?y.buffer.unshift(T):y.buffer.push(T),y.needReadable&&je(p)),Ke(p,y)}function Vt(p,y){var T;return!a(y)&&typeof y!="string"&&y!==void 0&&!p.objectMode&&(T=new k("chunk",["string","Buffer","Uint8Array"],y)),T}j.prototype.isPaused=function(){return this._readableState.flowing===!1},j.prototype.setEncoding=function(p){x||(x=es().StringDecoder);var y=new x(p);this._readableState.decoder=y,this._readableState.encoding=this._readableState.decoder.encoding;for(var T=this._readableState.buffer.head,M="";T!==null;)M+=y.write(T.data),T=T.next;return this._readableState.buffer.clear(),M!==""&&this._readableState.buffer.push(M),this._readableState.length=M.length,this};var Je=1073741824;function bt(p){return p>=Je?p=Je:(p--,p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,p|=p>>>16,p++),p}function it(p,y){return p<=0||y.length===0&&y.ended?0:y.objectMode?1:p!==p?y.flowing&&y.length?y.buffer.head.data.length:y.length:(p>y.highWaterMark&&(y.highWaterMark=bt(p)),p<=y.length?p:y.ended?y.length:(y.needReadable=!0,0))}j.prototype.read=function(p){u("read",p),p=parseInt(p,10);var y=this._readableState,T=p;if(p!==0&&(y.emittedReadable=!1),p===0&&y.needReadable&&((y.highWaterMark!==0?y.length>=y.highWaterMark:y.length>0)||y.ended))return u("read: emitReadable",y.length,y.ended),y.length===0&&y.ended?I(this):je(this),null;if(p=it(p,y),p===0&&y.ended)return y.length===0&&I(this),null;var M=y.needReadable;u("need readable",M),(y.length===0||y.length-p<y.highWaterMark)&&(M=!0,u("length less than watermark",M)),y.ended||y.reading?(M=!1,u("reading or ended",M)):M&&(u("do read"),y.reading=!0,y.sync=!0,y.length===0&&(y.needReadable=!0),this._read(y.highWaterMark),y.sync=!1,y.reading||(p=it(T,y)));var ee;return p>0?ee=C(p,y):ee=null,ee===null?(y.needReadable=y.length<=y.highWaterMark,p=0):(y.length-=p,y.awaitDrain=0),y.length===0&&(y.ended||(y.needReadable=!0),T!==p&&y.ended&&I(this)),ee!==null&&this.emit("data",ee),ee};function qt(p,y){if(u("onEofChunk"),!y.ended){if(y.decoder){var T=y.decoder.end();T&&T.length&&(y.buffer.push(T),y.length+=y.objectMode?1:T.length)}y.ended=!0,y.sync?je(p):(y.needReadable=!1,y.emittedReadable||(y.emittedReadable=!0,_t(p)))}}function je(p){var y=p._readableState;u("emitReadable",y.needReadable,y.emittedReadable),y.needReadable=!1,y.emittedReadable||(u("emitReadable",y.flowing),y.emittedReadable=!0,process.nextTick(_t,p))}function _t(p){var y=p._readableState;u("emitReadable_",y.destroyed,y.length,y.ended),!y.destroyed&&(y.length||y.ended)&&(p.emit("readable"),y.emittedReadable=!1),y.needReadable=!y.flowing&&!y.ended&&y.length<=y.highWaterMark,R(p)}function Ke(p,y){y.readingMore||(y.readingMore=!0,process.nextTick(Et,p,y))}function Et(p,y){for(;!y.reading&&!y.ended&&(y.length<y.highWaterMark||y.flowing&&y.length===0);){var T=y.length;if(u("maybeReadMore read 0"),p.read(0),T===y.length)break}y.readingMore=!1}j.prototype._read=function(p){O(this,new D("_read()"))},j.prototype.pipe=function(p,y){var T=this,M=this._readableState;switch(M.pipesCount){case 0:M.pipes=p;break;case 1:M.pipes=[M.pipes,p];break;default:M.pipes.push(p);break}M.pipesCount+=1,u("pipe count=%d opts=%j",M.pipesCount,y);var ee=(!y||y.end!==!1)&&p!==process.stdout&&p!==process.stderr,V=ee?Xe:ot;M.endEmitted?process.nextTick(V):T.once("end",V),p.on("unpipe",J);function J(h,o){u("onunpipe"),h===T&&o&&o.hasUnpiped===!1&&(o.hasUnpiped=!0,kt())}function Xe(){u("onend"),p.end()}var Rt=re(T);p.on("drain",Rt);var Yt=!1;function kt(){u("cleanup"),p.removeListener("close",Gt),p.removeListener("finish",Ce),p.removeListener("drain",Rt),p.removeListener("error",st),p.removeListener("unpipe",J),T.removeListener("end",Xe),T.removeListener("end",ot),T.removeListener("data",be),Yt=!0,M.awaitDrain&&(!p._writableState||p._writableState.needDrain)&&Rt()}T.on("data",be);function be(h){u("ondata");var o=p.write(h);u("dest.write",o),o===!1&&((M.pipesCount===1&&M.pipes===p||M.pipesCount>1&&W(M.pipes,p)!==-1)&&!Yt&&(u("false write response, pause",M.awaitDrain),M.awaitDrain++),T.pause())}function st(h){u("onerror",h),ot(),p.removeListener("error",st),e(p,"error")===0&&O(p,h)}Z(p,"error",st);function Gt(){p.removeListener("finish",Ce),ot()}p.once("close",Gt);function Ce(){u("onfinish"),p.removeListener("close",Gt),ot()}p.once("finish",Ce);function ot(){u("unpipe"),T.unpipe(p)}return p.emit("pipe",T),M.flowing||(u("pipe resume"),T.resume()),p};function re(p){return function(){var T=p._readableState;u("pipeOnDrain",T.awaitDrain),T.awaitDrain&&T.awaitDrain--,T.awaitDrain===0&&e(p,"data")&&(T.flowing=!0,R(p))}}j.prototype.unpipe=function(p){var y=this._readableState,T={hasUnpiped:!1};if(y.pipesCount===0)return this;if(y.pipesCount===1)return p&&p!==y.pipes?this:(p||(p=y.pipes),y.pipes=null,y.pipesCount=0,y.flowing=!1,p&&p.emit("unpipe",this,T),this);if(!p){var M=y.pipes,ee=y.pipesCount;y.pipes=null,y.pipesCount=0,y.flowing=!1;for(var V=0;V<ee;V++)M[V].emit("unpipe",this,{hasUnpiped:!1});return this}var J=W(y.pipes,p);return J===-1?this:(y.pipes.splice(J,1),y.pipesCount-=1,y.pipesCount===1&&(y.pipes=y.pipes[0]),p.emit("unpipe",this,T),this)},j.prototype.on=function(p,y){var T=n.prototype.on.call(this,p,y),M=this._readableState;return p==="data"?(M.readableListening=this.listenerCount("readable")>0,M.flowing!==!1&&this.resume()):p==="readable"&&!M.endEmitted&&!M.readableListening&&(M.readableListening=M.needReadable=!0,M.flowing=!1,M.emittedReadable=!1,u("on readable",M.length,M.reading),M.length?je(this):M.reading||process.nextTick(xe,this)),T},j.prototype.addListener=j.prototype.on,j.prototype.removeListener=function(p,y){var T=n.prototype.removeListener.call(this,p,y);return p==="readable"&&process.nextTick(ce,this),T},j.prototype.removeAllListeners=function(p){var y=n.prototype.removeAllListeners.apply(this,arguments);return(p==="readable"||p===void 0)&&process.nextTick(ce,this),y};function ce(p){var y=p._readableState;y.readableListening=p.listenerCount("readable")>0,y.resumeScheduled&&!y.paused?y.flowing=!0:p.listenerCount("data")>0&&p.resume()}function xe(p){u("readable nexttick read 0"),p.read(0)}j.prototype.resume=function(){var p=this._readableState;return p.flowing||(u("resume"),p.flowing=!p.readableListening,Ct(this,p)),p.paused=!1,this};function Ct(p,y){y.resumeScheduled||(y.resumeScheduled=!0,process.nextTick(St,p,y))}function St(p,y){u("resume",y.reading),y.reading||p.read(0),y.resumeScheduled=!1,p.emit("resume"),R(p),y.flowing&&!y.reading&&p.read(0)}j.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function R(p){var y=p._readableState;for(u("flow",y.flowing);y.flowing&&p.read()!==null;);}j.prototype.wrap=function(p){var y=this,T=this._readableState,M=!1;p.on("end",function(){if(u("wrapped end"),T.decoder&&!T.ended){var J=T.decoder.end();J&&J.length&&y.push(J)}y.push(null)}),p.on("data",function(J){if(u("wrapped data"),T.decoder&&(J=T.decoder.write(J)),!(T.objectMode&&J==null)&&!(!T.objectMode&&(!J||!J.length))){var Xe=y.push(J);Xe||(M=!0,p.pause())}});for(var ee in p)this[ee]===void 0&&typeof p[ee]=="function"&&(this[ee]=function(Xe){return function(){return p[Xe].apply(p,arguments)}}(ee));for(var V=0;V<P.length;V++)p.on(P[V],this.emit.bind(this,P[V]));return this._read=function(J){u("wrapped _read",J),M&&(M=!1,p.resume())},this},typeof Symbol=="function"&&(j.prototype[Symbol.asyncIterator]=function(){return L===void 0&&(L=Lu()),L(this)}),Object.defineProperty(j.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(j.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(j.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(y){this._readableState&&(this._readableState.flowing=y)}}),j._fromList=C,Object.defineProperty(j.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function C(p,y){if(y.length===0)return null;var T;return y.objectMode?T=y.buffer.shift():!p||p>=y.length?(y.decoder?T=y.buffer.join(""):y.buffer.length===1?T=y.buffer.first():T=y.buffer.concat(y.length),y.buffer.clear()):T=y.buffer.consume(p,y.decoder),T}function I(p){var y=p._readableState;u("endReadable",y.endEmitted),y.endEmitted||(y.ended=!0,process.nextTick(F,y,p))}function F(p,y){if(u("endReadableNT",p.endEmitted,p.length),!p.endEmitted&&p.length===0&&(p.endEmitted=!0,y.readable=!1,y.emit("end"),p.autoDestroy)){var T=y._writableState;(!T||T.autoDestroy&&T.finished)&&y.destroy()}}typeof Symbol=="function"&&(j.from=function(p,y){return B===void 0&&(B=Bu()),B(j,p,y)});function W(p,y){for(var T=0,M=p.length;T<M;T++)if(p[T]===y)return T;return-1}return mr}var jo=Ye,Kn=mt.codes,Ou=Kn.ERR_METHOD_NOT_IMPLEMENTED,Mu=Kn.ERR_MULTIPLE_CALLBACK,Nu=Kn.ERR_TRANSFORM_ALREADY_TRANSFORMING,Fu=Kn.ERR_TRANSFORM_WITH_LENGTH_0,Xn=Pt();yn(Ye,Xn);function Uu(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(r===null)return this.emit("error",new Mu);n.writechunk=null,n.writecb=null,e!=null&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Ye(t){if(!(this instanceof Ye))return new Ye(t);Xn.call(this,t),this._transformState={afterTransform:Uu.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Pu)}function Pu(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,n){ss(t,e,n)}):ss(this,null,null)}Ye.prototype.push=function(t,e){return this._transformState.needTransform=!1,Xn.prototype.push.call(this,t,e)};Ye.prototype._transform=function(t,e,n){n(new Ou("_transform()"))};Ye.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Ye.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Ye.prototype._destroy=function(t,e){Xn.prototype._destroy.call(this,t,function(n){e(n)})};function ss(t,e,n){if(e)return t.emit("error",e);if(n!=null&&t.push(n),t._writableState.length)throw new Fu;if(t._transformState.transforming)throw new Nu;return t.push(null)}var ju=an,$o=jo;yn(an,$o);function an(t){if(!(this instanceof an))return new an(t);$o.call(this,t)}an.prototype._transform=function(t,e,n){n(null,t)};var br;function $u(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Ho=mt.codes,Hu=Ho.ERR_MISSING_ARGS,Wu=Ho.ERR_STREAM_DESTROYED;function os(t){if(t)throw t}function Vu(t){return t.setHeader&&typeof t.abort=="function"}function qu(t,e,n,r){r=$u(r);var i=!1;t.on("close",function(){i=!0}),br===void 0&&(br=gi),br(t,{readable:e,writable:n},function(a){if(a)return r(a);i=!0,r()});var s=!1;return function(a){if(!i&&!s){if(s=!0,Vu(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(a||new Wu("pipe"))}}}function ls(t){t()}function Yu(t,e){return t.pipe(e)}function Gu(t){return!t.length||typeof t[t.length-1]!="function"?os:t.pop()}function zu(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=Gu(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Hu("streams");var i,s=e.map(function(a,l){var u=l<e.length-1,d=l>0;return qu(a,u,d,function(f){i||(i=f),f&&s.forEach(ls),!u&&(s.forEach(ls),r(i))})});return e.reduce(Yu)}var Ju=zu;(function(t,e){e=t.exports=Po(),e.Stream=e,e.Readable=e,e.Writable=Fo(),e.Duplex=Pt(),e.Transform=jo,e.PassThrough=ju,e.finished=gi,e.pipeline=Ju})(Pr,Pr.exports);var Ku=Pr.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let cs;var Xu=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):t=>(cs||(cs=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function as(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function Zu(t,e,n){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return as(t,n)}catch{n.message=t.message,n.stack=t.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),as(new i,n)}}var Qu=Zu;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const eh=Qa("simple-peer"),Wo=eu,us=fu,th=Ku,_r=Xu,Y=Qu,{Buffer:nh}=Wt,Er=64*1024,rh=5*1e3,ih=5*1e3;function hs(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function sh(t){console.warn(t)}class pt extends th.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=us(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||us(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||pt.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},pt.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(n=>n),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||rh,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Wo(),!this._wrtc)throw Y(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(Y(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(Y(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(Y(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(Y(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch(r=>{!n.address||n.address.endsWith(".local")?sh("Ignoring unsupported ICE candidate."):this.destroy(Y(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,n){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(r){this.destroy(Y(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this.destroying)return;if(this.destroyed)throw Y(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(n);if(!i)i=this._pc.addTrack(e,n),r.set(n,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?Y(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Y(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,r){if(this.destroying)return;if(this.destroyed)throw Y(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),s=i?i.get(r):null;if(!s)throw Y(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,i),s.replaceTrack!=null?s.replaceTrack(n):this.destroy(Y(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this.destroying)return;if(this.destroyed)throw Y(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw Y(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(Y(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,_r(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw Y(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),_r(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),n()}))}_setupData(e){if(!e.channel)return this.destroy(Y(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Er),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(Y(i,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},ih)}_read(){}_write(e,n,r){if(this.destroyed)return r(Y(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(Y(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Er?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=hs(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(Y(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(Y(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=hs(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(Y(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(Y(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(Y(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),this.emit("iceStateChange",e,n),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(Y(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(Y(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const n=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(s=>{i.push(n(s))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(s=>{const a={};s.names().forEach(l=>{a[l]=s.stat(l)}),a.id=s.id,a.type=s.type,a.timestamp=s.timestamp,i.push(n(a))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((n,r)=>{if(this.destroyed)return;n&&(r=[]);const i={},s={},a={};let l=!1;r.forEach(d=>{(d.type==="remotecandidate"||d.type==="remote-candidate")&&(i[d.id]=d),(d.type==="localcandidate"||d.type==="local-candidate")&&(s[d.id]=d),(d.type==="candidatepair"||d.type==="candidate-pair")&&(a[d.id]=d)});const u=d=>{l=!0;let f=s[d.localCandidateId];f&&(f.ip||f.address)?(this.localAddress=f.ip||f.address,this.localPort=Number(f.port)):f&&f.ipAddress?(this.localAddress=f.ipAddress,this.localPort=Number(f.portNumber)):typeof d.googLocalAddress=="string"&&(f=d.googLocalAddress.split(":"),this.localAddress=f[0],this.localPort=Number(f[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let w=i[d.remoteCandidateId];w&&(w.ip||w.address)?(this.remoteAddress=w.ip||w.address,this.remotePort=Number(w.port)):w&&w.ipAddress?(this.remoteAddress=w.ipAddress,this.remotePort=Number(w.portNumber)):typeof d.googRemoteAddress=="string"&&(w=d.googRemoteAddress.split(":"),this.remoteAddress=w[0],this.remotePort=Number(w[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(d=>{d.type==="transport"&&d.selectedCandidatePairId&&u(a[d.selectedCandidatePairId]),(d.type==="googCandidatePair"&&d.googActiveConnection==="true"||(d.type==="candidatepair"||d.type==="candidate-pair")&&d.selected)&&u(d)}),!l&&(!Object.keys(a).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(f){return this.destroy(Y(f,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const d=this._cb;this._cb=null,d(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Er||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=nh.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(r=>r.id===n.id)&&(this._remoteStreams.push(n),_r(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],eh.apply(null,e)}}pt.WEBRTC_SUPPORT=!!Wo();pt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:globalThis.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};pt.channelConfig={};var oh=pt;const lh=za(oh),pi=0,yi=1,Vo=2,qo=(t,e)=>{N(t,pi);const n=Fc(e);oe(t,n)},Yo=(t,e,n)=>{N(t,yi),oe(t,Bc(e,n))},ch=(t,e,n)=>Yo(e,n,de(t)),Go=(t,e,n)=>{try{Ic(e,de(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},ah=(t,e)=>{N(t,Vo),oe(t,e)},uh=Go,hh=(t,e,n,r)=>{const i=$(t);switch(i){case pi:ch(t,e,n);break;case yi:Go(t,n,r);break;case Vo:uh(t,n,r);break;default:throw new Error("Unknown message type")}return i},Cr=3e4;class dh extends Ss{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=qe();this.getLocalState()!==null&&Cr/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&Cr<=n-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Hr(this,r,"timeout")},Oe(Cr/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,s=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:qe()});const a=[],l=[],u=[],d=[];e===null?d.push(n):s==null?e!=null&&a.push(n):(l.push(n),Qt(s,e)||u.push(n)),(a.length>0||u.length>0||d.length>0)&&this.emit("change",[{added:a,updated:u,removed:d},"local"]),this.emit("update",[{added:a,updated:l,removed:d},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const Hr=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const s=e[i];if(t.states.has(s)){if(t.states.delete(s),s===t.clientID){const a=t.meta.get(s);t.meta.set(s,{clock:a.clock+1,lastUpdated:qe()})}r.push(s)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},Fn=(t,e,n=t.states)=>{const r=e.length,i=fe();N(i,r);for(let s=0;s<r;s++){const a=e[s],l=n.get(a)||null,u=t.meta.get(a).clock;N(i,a),N(i,u),Le(i,JSON.stringify(l))}return ne(i)},fh=(t,e,n)=>{const r=Pe(e),i=qe(),s=[],a=[],l=[],u=[],d=$(r);for(let f=0;f<d;f++){const w=$(r);let b=$(r);const E=JSON.parse(We(r)),k=t.meta.get(w),A=t.states.get(w),D=k===void 0?0:k.clock;(D<b||D===b&&E===null&&t.states.has(w))&&(E===null?w===t.clientID&&t.getLocalState()!=null?b++:t.states.delete(w):t.states.set(w,E),t.meta.set(w,{clock:b,lastUpdated:i}),k===void 0&&E!==null?s.push(w):k!==void 0&&E===null?u.push(w):E!==null&&(Qt(E,A)||l.push(w),a.push(w)))}(s.length>0||l.length>0||u.length>0)&&t.emit("change",[{added:s,updated:l,removed:u},n]),(s.length>0||a.length>0||u.length>0)&&t.emit("update",[{added:s,updated:a,removed:u},n])},gh=(t,e)=>{const n=xr(t).buffer,r=xr(e).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},zo=(t,e)=>{if(!e)return Xr(t);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,t).then(r=>{const i=fe();return Le(i,"AES-GCM"),oe(i,n),oe(i,new Uint8Array(r)),ne(i)})},ph=(t,e)=>{const n=fe();return Lt(n,t),zo(ne(n),e)},Jo=(t,e)=>{if(!e)return Xr(t);const n=Pe(t);We(n)!=="AES-GCM"&&$l(Me("Unknown encryption algorithm"));const i=de(n),s=de(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},e,s).then(a=>new Uint8Array(a))},yh=(t,e)=>Jo(t,e).then(n=>Bt(Pe(new Uint8Array(n)))),G=mc("y-webrtc");console.log(" PATCHED Y-WEBRTC LIBRARY LOADED - Version with TURN servers and enhanced logging");const It=0,Ko=3,un=1,wi=4,Un=new Map,at=new Map,Xo=t=>{let e=!0;t.webrtcConns.forEach(n=>{n.synced||(e=!1)}),(!e&&t.synced||e&&!t.synced)&&(t.synced=e,t.provider.emit("synced",[{synced:e}]),G("synced ",le,t.name,ht," with all peers"))},Zo=(t,e,n)=>{const r=Pe(e),i=fe(),s=$(r);if(t===void 0)return null;const a=t.awareness,l=t.doc;let u=!1;switch(s){case It:{N(i,It);const d=hh(r,i,l,t);d===yi&&!t.synced&&n(),d===pi&&(u=!0);break}case Ko:N(i,un),oe(i,Fn(a,Array.from(a.getStates().keys()))),u=!0;break;case un:fh(a,de(r),t);break;case wi:{const d=ut(r)===1,f=We(r);if(f!==t.peerId&&(t.bcConns.has(f)&&!d||!t.bcConns.has(f)&&d)){const w=[],b=[];d?(t.bcConns.add(f),b.push(f)):(t.bcConns.delete(f),w.push(f)),t.provider.emit("peers",[{added:b,removed:w,webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]),Qo(t)}break}default:return console.error("Unable to compute message"),i}return u?i:null},wh=(t,e)=>{const n=t.room;return G("received message from ",le,t.remotePeerId,ei," (",n.name,")",ht,Vn),Zo(n,e,()=>{t.synced=!0,G("synced ",le,n.name,ht," with ",le,t.remotePeerId),Xo(n)})},Sr=(t,e)=>{G("send message to ",le,t.remotePeerId,ht,ei," (",t.room.name,")",Vn);try{t.peer.send(ne(e))}catch{}},mh=(t,e)=>{G("broadcast message in ",le,t.name,ht),t.webrtcConns.forEach(n=>{try{n.peer.send(e)}catch{}})};class ds{constructor(e,n,r,i){console.log(" PATCHED LIBRARY: WebrtcConn constructor called for",r),G("establishing connection to ",le,r),this.room=i,this.remotePeerId=r,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1;const s=i.provider.iceServers||Ch,a={initiator:n,config:{iceServers:s,iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},...i.provider.peerOpts};console.log(" PATCHED LIBRARY: Creating peer with config:",a),console.log(" PATCHED LIBRARY: ICE servers:",s.map(l=>l.urls)),G("Creating peer with ICE servers:",s.map(l=>l.urls)),this.peer=new lh(a),console.log(" PATCHED LIBRARY: Peer created successfully"),this.peer.on("signal",l=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),mi(e,i,{to:r,from:i.peerId,type:"signal",token:this.glareToken,signal:l})}),this.peer.on("connect",()=>{G("connected to ",le,r),this.connected=!0;const u=i.provider.doc,d=i.awareness,f=fe();N(f,It),qo(f,u),Sr(this,f);const w=d.getStates();if(w.size>0){const b=fe();N(b,un),oe(b,Fn(d,Array.from(w.keys()))),Sr(this,b)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),Xo(i),this.peer.destroy(),G("closed connection to ",le,r),Wr(i)}),this.peer.on("error",l=>{G("Error in connection to ",le,r,": ",l),G("Error details:",{type:l.type||"unknown",message:l.message||"no message",code:l.code||"no code"}),Wr(i)}),this.peer.on("iceStateChange",(l,u)=>{G("ICE state change for",le,r,":",{connection:l,gathering:u}),l==="failed"?G(" ICE connection failed for",le,r):l==="connected"?G(" ICE connection established for",le,r):l==="disconnected"&&G(" ICE connection disconnected for",le,r)}),this.peer.on("signalingStateChange",l=>{G("Signaling state change for",le,r,":",l)}),this.peer._pc.addEventListener("icecandidate",l=>{l.candidate?G("ICE candidate for",le,r,":",{type:l.candidate.type,protocol:l.candidate.protocol,address:l.candidate.address,port:l.candidate.port,candidate:l.candidate.candidate}):G("ICE gathering complete for",le,r)}),this.peer._pc.addEventListener("connectionstatechange",()=>{G("Connection state for",le,r,":",this.peer._pc.connectionState)}),this.peer.on("data",l=>{const u=wh(this,l);u!==null&&Sr(this,u)})}destroy(){this.peer.destroy()}}const Ze=(t,e)=>zo(e,t.key).then(n=>t.mux(()=>Ya(t.name,n))),fs=(t,e)=>{t.bcconnected&&Ze(t,e),mh(t,e)},Wr=t=>{console.log(" PATCHED LIBRARY: Announcing signaling info for room",t.name,"peerId:",t.peerId),Un.forEach((e,n)=>{console.log(` PATCHED LIBRARY: Checking signaling conn ${n}:`,e.url,"connected:",e.connected),e.connected?(console.log(` PATCHED LIBRARY: Subscribing to room ${t.name} on ${e.url}`),e.send({type:"subscribe",topics:[t.name]}),t.webrtcConns.size<t.provider.maxConns&&(console.log(` PATCHED LIBRARY: Announcing presence in room ${t.name} from ${t.peerId}`),mi(e,t,{type:"announce",from:t.peerId}))):console.log(` PATCHED LIBRARY: Signaling conn ${n} not connected:`,e.url)})},Qo=t=>{if(t.provider.filterBcConns){const e=fe();N(e,wi),rn(e,1),Le(e,t.peerId),Ze(t,ne(e))}};class bh{constructor(e,n,r,i){this.peerId=xs(),this.doc=e,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Ga(),this.bcconnected=!1,this._bcSubscriber=s=>Jo(new Uint8Array(s),i).then(a=>this.mux(()=>{const l=Zo(this,a,()=>{});l&&Ze(this,ne(l))})),this._docUpdateHandler=(s,a)=>{const l=fe();N(l,It),ah(l,s),fs(this,ne(l))},this._awarenessUpdateHandler=({added:s,updated:a,removed:l},u)=>{const d=s.concat(a).concat(l),f=fe();N(f,un),oe(f,Fn(this.awareness,d)),fs(this,ne(f))},this._beforeUnloadHandler=()=>{Hr(this.awareness,[e.clientID],"window unload"),at.forEach(s=>{s.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Wr(this);const e=this.name;Va(e,this._bcSubscriber),this.bcconnected=!0,Qo(this);const n=fe();N(n,It),qo(n,this.doc),Ze(this,ne(n));const r=fe();N(r,It),Yo(r,this.doc),Ze(this,ne(r));const i=fe();N(i,Ko),Ze(this,ne(i));const s=fe();N(s,un),oe(s,Fn(this.awareness,[this.doc.clientID])),Ze(this,ne(s))}disconnect(){Un.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),Hr(this.awareness,[this.doc.clientID],"disconnect");const e=fe();N(e,wi),rn(e,0),Le(e,this.peerId),Ze(this,ne(e)),qa(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const _h=(t,e,n,r)=>{if(at.has(n))throw Me(`A Yjs Doc connected to room "${n}" already exists!`);const i=new bh(t,e,n,r);return at.set(n,i),i},mi=(t,e,n)=>{e.key?ph(n,e.key).then(r=>{t.send({type:"publish",topic:e.name,data:Us(r)})}):t.send({type:"publish",topic:e.name,data:n})};class Eh extends $a{constructor(e){super(e),this.providers=new Set,this.connectionAttempts=0,this.maxRetries=5,this.retryDelay=1e3,this.on("connect",()=>{console.log(` PATCHED LIBRARY: Connected to signaling server ${e}`),G(`connected to signaling server (${e})`),this.connectionAttempts=0;const n=Array.from(at.keys());this.send({type:"subscribe",topics:n}),at.forEach(r=>{mi(this,r,{type:"announce",from:r.peerId}),console.log(` PATCHED LIBRARY: Announced presence in room ${r.name} via ${e}`),G(`announced presence in room: ${r.name}`)})}),this.on("disconnect",()=>{if(console.log(` PATCHED LIBRARY: Disconnected from signaling server ${e}`),G(`disconnected from signaling server (${e})`),this.connectionAttempts<this.maxRetries){this.connectionAttempts++;const n=this.retryDelay*Math.pow(2,this.connectionAttempts-1);console.log(` PATCHED LIBRARY: Attempting to reconnect to ${e} in ${n}ms (attempt ${this.connectionAttempts}/${this.maxRetries})`),G(`attempting to reconnect to ${e} in ${n}ms (attempt ${this.connectionAttempts}/${this.maxRetries})`),setTimeout(()=>{this.providers.size>0&&this.connect()},n)}else console.log(` PATCHED LIBRARY: Max reconnection attempts reached for ${e}`),G(`max reconnection attempts reached for ${e}`)}),this.on("message",n=>{var r;switch(n.type){case"publish":{const i=n.topic,s=at.get(i);if(s==null||typeof i!="string"){G("received message for unknown room:",i);return}G("received signaling message for room:",i,"type:",(r=n.data)==null?void 0:r.type);const a=l=>{const u=s.webrtcConns,d=s.peerId;if(l==null||l.from===d||l.to!==void 0&&l.to!==d||s.bcConns.has(l.from))return;const f=u.has(l.from)?()=>{}:()=>s.provider.emit("peers",[{removed:[],added:[l.from],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}]);switch(l.type){case"announce":console.log(" PATCHED LIBRARY: Peer announced:",l.from,"to room:",s.name),G("peer announced:",l.from,"current connections:",u.size,"max:",s.provider.maxConns),u.size<s.provider.maxConns?(console.log(" PATCHED LIBRARY: Creating WebRTC connection to peer:",l.from),Ee(u,l.from,()=>new ds(this,!0,l.from,s)),f()):(console.log(" PATCHED LIBRARY: Max connections reached, ignoring announce from:",l.from),G("max connections reached, ignoring announce from:",l.from));break;case"signal":if(G("received signal from:",l.from,"type:",l.signal.type,"to:",l.to),l.signal.type==="offer"){const w=u.get(l.from);if(w){const b=l.token,E=w.glareToken;if(E&&E>b){G("offer rejected due to glare resolution: ",l.from);return}w.glareToken=void 0}}if(l.signal.type==="answer"){G("offer answered by: ",l.from);const w=u.get(l.from);w&&(w.glareToken=void 0)}if(l.to===d){const w=Ee(u,l.from,()=>new ds(this,!1,l.from,s));try{w.peer.signal(l.signal),f()}catch(b){G("error processing signal from",l.from,":",b)}}else G("signal not addressed to this peer, ignoring");break}};s.key?typeof n.data=="string"&&yh(Ps(n.data),s.key).then(a):a(n.data)}}}),this.on("disconnect",()=>G(`disconnect (${e})`))}}const Ch=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:relay1.expressturn.com:3478",username:"efSLANXM7179I8RTB5",credential:"T0C0Ej5r6eWBjNppC"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"},{urls:"turn:192.158.29.39:3478?transport=udp",username:"28224511:1379330808",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA="},{urls:"turn:192.158.29.39:3478?transport=tcp",username:"28224511:1379330808",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA="}],Rr=t=>{t.emit("status",[{connected:t.connected}])};class Sh extends Cs{constructor(e,n,{signaling:r=["wss://demos.yjs.dev/ws","wss://y-webrtc-signaling.herokuapp.com"],password:i=null,awareness:s=new dh(n),maxConns:a=20+Oe(Pl()*15),filterBcConns:l=!0,peerOpts:u={},iceServers:d=null}={}){console.log(" PATCHED LIBRARY: WebrtcProvider constructor called for room",e),super(),this.roomName=e,this.doc=n,this.filterBcConns=l,this.awareness=s,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=a,this.peerOpts=u,this.iceServers=d,G("WebRTC Provider initialized:",{roomName:e,signalingUrls:r,maxConns:a,hasPassword:!!i,iceServers:d||"default"}),this.key=i?gh(i,e):Xr(null),this.room=null,this.key.then(f=>{this.room=_h(n,this,e,f),this.shouldConnect?this.room.connect():this.room.disconnect(),Rr(this)}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{const n=Ee(Un,e,()=>new Eh(e));this.signalingConns.push(n),n.providers.add(this)}),this.room&&(this.room.connect(),Rr(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),e.providers.size===0&&(e.destroy(),Un.delete(e.url))}),this.room&&(this.room.disconnect(),Rr(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),at.delete(this.roomName)}),super.destroy()}}const gs=["#FF5733","#33A8FF","#33FF57","#FF33A8","#A833FF","#FFBD33","#33FFC1","#FF5733"],Q=document.getElementById("editor"),en=document.getElementById("status"),bi=document.getElementById("username"),ps=document.getElementById("session-id"),Rh=document.getElementById("join-btn"),kh=document.getElementById("save-btn"),vh=document.getElementById("session-display"),Ah=document.getElementById("current-session"),ys=document.getElementById("copy-notification"),Th=document.getElementById("theme-toggle"),ws=document.getElementById("moon-icon"),ms=document.getElementById("sun-icon");bi.value="User"+Math.floor(Math.random()*1e3);let Te=null,Jt=[];function xh(){if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.location.search.includes("debug=true")){Te=document.createElement("div"),Te.id="mobile-debug-console",Te.style.cssText=`
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      font-family: monospace;
      font-size: 10px;
      padding: 10px;
      padding-top: 40px;
      overflow-y: auto;
      z-index: 10000;
      border-top: 2px solid #333;
      display: none;
    `;const e=document.createElement("button");e.textContent=" Copy",e.style.cssText=`
      position: fixed;
      top: auto;
      bottom: 160px;
      right: 10px;
      background: #444;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      z-index: 10002;
      min-height: 32px;
      min-width: 70px;
      touch-action: manipulation;
    `,e.onclick=async()=>{try{const l=Jt.map(d=>`[${d.timestamp}] ${d.type}: ${d.message}`).join(`
`);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else{const d=document.createElement("textarea");d.value=l,d.style.position="fixed",d.style.left="-999999px",d.style.top="-999999px",document.body.appendChild(d),d.focus(),d.select(),document.execCommand("copy"),document.body.removeChild(d)}const u=e.textContent;e.textContent=" Copied!",e.style.background="#28a745",setTimeout(()=>{e.textContent=u,e.style.background="#444"},2e3)}catch(l){console.error("Failed to copy debug console:",l),e.textContent=" Failed",e.style.background="#dc3545",setTimeout(()=>{e.textContent=" Copy",e.style.background="#444"},2e3)}};const n=()=>{e.style.display=Te.style.display==="block"?"block":"none"};document.body.appendChild(e),document.body.appendChild(Te);const r=document.createElement("button");r.textContent=" Debug",r.style.cssText=`
      position: fixed;
      bottom: 63px;
      right: 16px;
      z-index: 10001;
      background: #333;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
    `,r.onclick=()=>{const l=Te.style.display==="block";Te.style.display=l?"none":"block",r.textContent=l?" Debug":" Close",n()},document.body.appendChild(r),n();const i=console.log,s=console.error,a=console.warn;console.log=function(...l){i.apply(console,l),kr("LOG",l.join(" "))},console.error=function(...l){s.apply(console,l),kr("ERROR",l.join(" "))},console.warn=function(...l){a.apply(console,l),kr("WARN",l.join(" "))}}}function kr(t,e){if(!Te)return;const n=new Date().toLocaleTimeString(),r=t==="ERROR"?"#ff4444":t==="WARN"?"#ffaa00":"#00ff00";Jt.push({type:t,message:e,timestamp:n}),Jt.length>50&&Jt.shift(),Te.innerHTML=Jt.map(i=>`<div style="color: ${r}; margin-bottom: 2px;">[${i.timestamp}] ${i.type}: ${i.message}</div>`).join(""),Te.scrollTop=Te.scrollHeight}xh();function Ih(){const t=localStorage.getItem("theme");if(t)Vr(t);else{const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;Vr(e?"dark":"light")}}function Vr(t){t==="dark"?(document.documentElement.setAttribute("data-theme","dark"),ws.style.display="none",ms.style.display="block"):(document.documentElement.removeAttribute("data-theme"),ws.style.display="block",ms.style.display="none")}function Dh(){const e=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";Vr(e),localStorage.setItem("theme",e)}Ih();Th.addEventListener("click",Dh);const Pn=document.getElementById("header-toggle"),qr=document.querySelector(".header");let Kt=!1;function el(){Kt=!Kt,Kt?(qr.classList.add("header--hidden"),Pn.classList.add("header-toggle--hidden")):(qr.classList.remove("header--hidden"),Pn.classList.remove("header-toggle--hidden")),localStorage.setItem("headerHidden",Kt)}function Lh(){localStorage.getItem("headerHidden")==="true"&&(Kt=!0,qr.classList.add("header--hidden"),Pn.classList.add("header-toggle--hidden"))}Pn.addEventListener("click",el);Lh();function tl(){return crypto===void 0||!crypto.randomUUID?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}):crypto.randomUUID()}function Bh(){return new URLSearchParams(window.location.search).get("session")||tl()}function Oh(t){const e=new URL(window.location);e.searchParams.set("session",t),window.history.pushState({},"",e)}function Mh(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}let lt,U,pe,wn=Bh(),Dt={},Xt={};function nl(t){U&&U.destroy(),lt&&lt.destroy(),lt=new $t,pe=lt.getText("content"),U=new Sh(`vibe_notes_${t}`,lt,{signaling:["ws://localhost:4444","wss://demos.yjs.dev/ws","wss://signaling.yjs.dev"],maxConns:20,filterBcConns:!0,peerOpts:{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.voiparound.com"},{urls:"stun:stun.voipbuster.com"},{urls:"stun:stun.services.mozilla.com"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:relay1.expressturn.com:3478",username:"efSLANXM7179I8RTB5",credential:"T0C0Ej5r6eWBjNppC"},{urls:"stun.ekiga.net"},{urls:"stun.ideasip.com"},{urls:"stun.rixtelecom.se"},{urls:"stun.schlund.de"},{urls:"stun.stunprotocol.org:3478"},{urls:"stun.voiparound.com"},{urls:"stun.voipbuster.com"},{urls:"stun.voipstunt.com"},{urls:"stun.voxgratia.org"},{urls:"23.21.150.121:3478"},{urls:"iphone-stun.strato-iphone.de:3478"},{urls:"numb.viagenie.ca:3478"},{urls:"s1.taraba.net:3478"},{urls:"s2.taraba.net:3478"},{urls:"stun.12connect.com:3478"},{urls:"stun.12voip.com:3478"},{urls:"stun.1und1.de:3478"},{urls:"stun.2talk.co.nz:3478"},{urls:"stun.2talk.com:3478"},{urls:"stun.3clogic.com:3478"},{urls:"stun.3cx.com:3478"},{urls:"stun.a-mm.tv:3478"},{urls:"stun.aa.net.uk:3478"},{urls:"stun.acrobits.cz:3478"}],iceCandidatePoolSize:10,iceTransportPolicy:"all"}}}),console.log("=== WebRTC Debug Info ==="),console.log(`Session ID: ${t}`),console.log(`Room: ${U.roomName}`),console.log(`URL: ${window.location.href}`),console.log(`User Agent: ${navigator.userAgent}`),console.log(`Is Secure Context: ${window.isSecureContext}`),U.on("status",n=>{console.log(`[${new Date().toISOString()}] Provider Status:`,n),n.status==="connected"?console.log(" Connected to signaling server"):n.status==="disconnected"&&console.log(" Disconnected from signaling server")}),setTimeout(()=>{U.signalingConns&&U.signalingConns.length>0?U.signalingConns.forEach((n,r)=>{console.log(`Signaling connection ${r}:`,n.url||n),n&&typeof n.addEventListener=="function"?(n.addEventListener("open",()=>{console.log(` Signaling WebSocket opened: ${n.url}`)}),n.addEventListener("close",i=>{console.log(` Signaling WebSocket closed: ${n.url}`,i.code,i.reason)}),n.addEventListener("error",i=>{console.log(` Signaling WebSocket error: ${n.url}`,i)})):console.log(`Signaling connection ${r} is not a WebSocket:`,typeof n,n)}):console.log(" No signaling connections found")},500),U.on("peers",n=>{console.log(`[${new Date().toISOString()}] Peers Event:`,n);const r=U.awareness.getStates().size-1;console.log(`Current peer count: ${r}`)}),U.awareness.on("change",n=>{console.log(`[${new Date().toISOString()}] Awareness Change:`,n);const r=U.awareness.getStates();console.log("All connected clients:",Array.from(r.keys())),r.forEach((i,s)=>{var a;s!==U.awareness.clientID&&console.log(`Peer ${s}:`,((a=i.user)==null?void 0:a.name)||"Anonymous")})}),U.on("connection-error",n=>{console.error(`[${new Date().toISOString()}] WebRTC Connection Error:`,n)}),U.on("sync",n=>{console.log(`[${new Date().toISOString()}] Document Sync:`,n?" Synced":" Syncing...")}),setTimeout(()=>{var n,r;console.log(`Provider Client ID: ${U.awareness.clientID}`),console.log(`Connected Peers: ${U.awareness.getStates().size-1}`),console.log(`Provider roomName property: ${U.roomName}`),console.log(`Provider connected: ${U.connected}`),console.log(`Signaling connections: ${((n=U.signalingConns)==null?void 0:n.length)||0}`),console.log("Provider properties:",Object.getOwnPropertyNames(U)),(r=U.signalingConns)==null||r.forEach((i,s)=>{console.log(`Signaling ${s}: ${i.url||"no url"} - connected: ${i.connected||"false"}`)})},2e3),U.on("peers",n=>{console.log("Peer connection event:",n)}),vh.textContent=t,wn=t,Oh(t);const e=bi.value.trim()||"User"+Math.floor(Math.random()*1e3);U.awareness.setLocalStateField("user",{name:e,cursor:null}),U.awareness.on("change",()=>{bs(),Ph()}),U.on("status",n=>{n.status==="connected"?en.style.backgroundColor="rgba(0,255,0,0.2)":en.style.backgroundColor="rgba(255,0,0,0.2)"}),bs(),Uh()}function Nh(t,e,n){let r=0;const i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let s;for(;s=i.nextNode();){if(s===e)return r+n;r+=s.textContent.length}return t.textContent.length}function Fh(t,e){const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let r=0,i;for(;i=n.nextNode();){const s=i.textContent.length;if(r+s>=e){const a=document.createRange();return a.setStart(i,Math.min(e-r,s)),a.setEnd(i,Math.min(e-r,s)),a}r+=s}if(t.lastChild&&t.lastChild.nodeType===Node.TEXT_NODE){const s=document.createRange();return s.setStart(t.lastChild,t.lastChild.textContent.length),s.setEnd(t.lastChild,t.lastChild.textContent.length),s}return null}function Uh(){let t=!1;Q.textContent=pe.toString(),pe.observe(e=>{if(e.transaction.origin!==U.awareness.clientID&&!t){const n=window.getSelection(),r=n.rangeCount>0;let i=null;if(r&&Q.contains(n.anchorNode)){const s=n.getRangeAt(0);i=Nh(Q,s.startContainer,s.startOffset)}if(Q.textContent=pe.toString(),r&&i!==null)try{const s=Fh(Q,i);s&&(n.removeAllRanges(),n.addRange(s))}catch(s){console.warn("Failed to restore cursor position:",s)}}}),Q.addEventListener("input",()=>{t=!0;const e=Mh(Q.innerText);pe.delete(0,pe.length),pe.insert(0,e),t=!1,zt()}),Q.addEventListener("mouseup",zt),Q.addEventListener("keyup",zt),Q.addEventListener("click",zt),Q.addEventListener("keydown",e=>{if(e.key==="Tab"){e.preventDefault();const n=window.getSelection();if(n.rangeCount>0){const r=n.getRangeAt(0);r.deleteContents();const i=document.createTextNode("	");r.insertNode(i),r.setStartAfter(i),r.setEndAfter(i),n.removeAllRanges(),n.addRange(r),Q.dispatchEvent(new Event("input",{bubbles:!0}))}}}),setTimeout(()=>{Q.focus(),zt()},100)}function bs(){if(!U)return;const t=U.awareness.getStates().size;en.textContent=`Connected with ${t-1} peer${t!==2?"s":""}`,t>1?en.style.backgroundColor="rgba(0,255,0,0.2)":en.style.backgroundColor="rgba(255,165,0,0.2)"}Rh.addEventListener("click",()=>{const t=ps.value.trim()||tl();_i(),Xt={},nl(t),ps.value=""});nl(wn);Ah.addEventListener("click",()=>{const t=new URL(window.location);t.searchParams.set("session",wn);const e=t.toString();navigator.clipboard.writeText(e).then(()=>{ys.classList.add("show"),setTimeout(()=>{ys.classList.remove("show")},2e3)}).catch(n=>{console.error("Failed to copy URL: ",n)})});window.addEventListener("beforeunload",()=>{U&&U.destroy(),lt&&lt.destroy(),_i()});function zt(){if(!U||!U.awareness)return;const t=window.getSelection();if(!t.rangeCount)return;const e=t.getRangeAt(0);if(!Q.contains(e.startContainer))return;let n;const r=document.createElement("span");if(r.innerHTML="&#8203;",e.cloneRange().insertNode(r),n=r.getBoundingClientRect(),n.height===0){const u=(r.parentNode||Q).getBoundingClientRect(),d=window.getComputedStyle(Q),f=parseInt(d.lineHeight)||27;n={left:u.left+24,top:u.top,width:0,height:f}}if(r.parentNode&&r.parentNode.removeChild(r),t.removeAllRanges(),t.addRange(e),e.startContainer===Q&&e.startOffset===0){const l=Q.getBoundingClientRect();n={left:l.left+24,top:l.top+24,width:0,height:27}}const s=Q.getBoundingClientRect(),a={left:n.left-s.left,top:n.top-s.top};U.awareness.setLocalStateField("user",{name:bi.value.trim()||"User"+Math.floor(Math.random()*1e3),cursor:a})}function Ph(){if(!U||!U.awareness)return;_i();const t=U.awareness.getStates(),e=U.awareness.clientID;t.forEach((n,r)=>{r===e||!n.user||!n.user.cursor||$h(r,n.user)})}function jh(){if(!U||!U.awareness)return;const t=U.awareness.getStates(),e=U.awareness.clientID;t.forEach((n,r)=>{if(r===e||!n.user||!n.user.cursor)return;const i=Dt[r];if(i){const s=n.user.cursor,a=Q.getBoundingClientRect(),l=a.left+s.left,u=a.top+s.top;i.style.left=`${l}px`,i.style.top=`${u}px`}})}function $h(t,e){if(!Xt[t]){const u=Object.keys(Xt).length%gs.length;Xt[t]=gs[u]}const n=Xt[t],r=e.cursor;if(!r||typeof r.left!="number"||typeof r.top!="number")return;if(!Dt[t]){const u=document.createElement("div");u.className="remote-cursor",u.style.backgroundColor=n;const d=document.createElement("div");d.className="cursor-label",d.style.backgroundColor=n,d.textContent=e.name||"Anonymous",u.appendChild(d),document.body.appendChild(u),Dt[t]=u}const i=Dt[t],s=Q.getBoundingClientRect(),a=s.left+r.left,l=s.top+r.top;i.style.left=`${a}px`,i.style.top=`${l}px`,i.style.display="block"}function _i(){Object.values(Dt).forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),Dt={}}async function rl(){var i;const t=Q.innerText||Q.textContent||"";if(!t.trim()){alert("No content to save!");return}const e=new Date,n=e.toISOString().slice(0,19).replace(/[T:]/g,"-"),r=`${U.roomName??"vibe_notes"}_${n}`;if("showSaveFilePicker"in window&&window.isSecureContext)try{const s=await window.showSaveFilePicker({suggestedName:r,excludeAcceptAllOption:!1,types:[{description:"All files",accept:{"*/*":[]}}]}),a=s.name,l=((i=a.split(".").pop())==null?void 0:i.toLowerCase())||"txt";let u=t;switch(l){case"html":case"htm":u=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${a.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":u=JSON.stringify({title:a.replace(/\.[^/.]+$/,""),content:t,timestamp:e.toISOString(),sessionId:wn},null,2);break;default:u=t}const d=await s.createWritable();await d.write(u),await d.close(),console.log(` Notes saved as: ${a}`);return}catch(s){if(s.name==="AbortError"){console.log("User cancelled save dialog");return}console.error("Native save dialog failed:",s.message)}Hh(t,r)}function Hh(t,e){var d;const n=prompt("Enter filename with extension:",e);if(n===null||!n.trim())return;const r=((d=n.split(".").pop())==null?void 0:d.toLowerCase())||"txt";let i=t,s="text/plain;charset=utf-8";switch(r){case"md":case"markdown":s="text/markdown;charset=utf-8";break;case"html":case"htm":s="text/html;charset=utf-8",i=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${n.replace(/\.[^/.]+$/,"")}</title>
</head>
<body>
    <pre>${t}</pre>
</body>
</html>`;break;case"json":s="application/json;charset=utf-8",i=JSON.stringify({title:n.replace(/\.[^/.]+$/,""),content:t,timestamp:new Date().toISOString(),sessionId:wn},null,2);break;default:s="text/plain;charset=utf-8"}const a=new Blob([i],{type:s}),l=URL.createObjectURL(a),u=document.createElement("a");u.href=l,u.download=n,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),console.log(` Notes downloaded as: ${n}`)}let vr=!1;async function il(){if(vr){console.log(" Load already in progress, ignoring duplicate call");return}vr=!0;try{if("showOpenFilePicker"in window&&window.isSecureContext){const[t]=await window.showOpenFilePicker({multiple:!1,excludeAcceptAllOption:!1,types:[{description:"Text files",accept:{"text/plain":[".txt",".md",".markdown"],"text/javascript":[".js",".mjs"],"text/typescript":[".ts"],"text/html":[".html",".htm"],"application/json":[".json"],"text/css":[".css"],"text/xml":[".xml"],"application/xml":[".xml"],"text/*":[".log",".conf",".ini",".cfg"]}}]}),e=await t.getFile(),n=await e.text();Q&&pe&&pe.doc.transact(()=>{pe.delete(0,pe.length),pe.insert(0,n)}),console.log(` Loaded file: ${e.name} (${e.size} bytes)`)}else _s()}catch(t){t.name==="AbortError"?console.log("User cancelled file selection"):(console.error("Error loading file:",t),_s())}finally{vr=!1}}function _s(){const t=document.createElement("input");t.type="file",t.accept=".txt,.md,.markdown,.js,.mjs,.ts,.html,.htm,.json,.css,.xml,.log,.conf,.ini,.cfg,text/*",t.style.display="none",t.addEventListener("change",async e=>{const n=e.target.files[0];if(n)try{const r=await n.text();Q&&pe&&pe.doc.transact(()=>{pe.delete(0,pe.length),pe.insert(0,r)}),console.log(` Loaded file: ${n.name} (${n.size} bytes)`)}catch(r){console.error("Error reading file:",r),alert("Error reading file: "+r.message)}finally{document.body.removeChild(t)}}),document.body.appendChild(t),t.click()}kh.addEventListener("click",rl);const Wh=document.getElementById("load-btn");Wh.addEventListener("click",il);let Es;window.addEventListener("resize",()=>{clearTimeout(Es),Es=setTimeout(()=>{jh()},100)});document.addEventListener("keydown",t=>{var e,n,r;(t.ctrlKey||t.metaKey)&&t.key==="o"&&(t.preventDefault(),il()),(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),rl()),t.key==="F11"&&(t.preventDefault(),el()),t.ctrlKey&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),console.log(" Manual diagnostics triggered..."),U?(console.log("Provider exists:",!!U),console.log("Provider room:",U.room),console.log("Signaling connections:",((e=U.signalingConns)==null?void 0:e.length)||0),console.log("WebRTC connections:",((r=(n=U.room)==null?void 0:n.webrtcConns)==null?void 0:r.size)||0),console.log("Awareness states:",U.awareness.getStates().size),console.log("Document synced:",U.synced)):console.log(" No provider found"))});
