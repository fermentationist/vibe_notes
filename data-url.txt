data:text/html;charset=utf-8,%3C!DOCTYPE%20html%3E%0A%3Chtml%20lang%3D%22en%22%3E%0A%20%20%3Chead%3E%0A%20%20%20%20%3Cmeta%20charset%3D%22UTF-8%22%20%2F%3E%0A%20%20%20%20%3Cmeta%20name%3D%22viewport%22%20content%3D%22width%3Ddevice-width%2C%20initial-scale%3D1.0%22%20%2F%3E%0A%20%20%20%20%3Ctitle%3EMinimal%20P2P%20Notes%3C%2Ftitle%3E%0A%20%20%20%20%3Cstyle%3E%0A%20%20%20%20%20%20body%20%7B%0A%20%20%20%20%20%20%20%20margin%3A%200%3B%0A%20%20%20%20%20%20%20%20padding%3A%200%3B%0A%20%20%20%20%20%20%20%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20%22Segoe%20UI%22%2C%20Roboto%2C%0A%20%20%20%20%20%20%20%20%20%20sans-serif%3B%0A%20%20%20%20%20%20%20%20line-height%3A%201.6%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23editor%20%7B%0A%20%20%20%20%20%20%20%20min-height%3A%20calc(100vh%20-%2050px)%3B%0A%20%20%20%20%20%20%20%20padding%3A%2020px%3B%0A%20%20%20%20%20%20%20%20outline%3A%20none%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2016px%3B%0A%20%20%20%20%20%20%20%20box-sizing%3A%20border-box%3B%0A%20%20%20%20%20%20%20%20margin-top%3A%2050px%3B%0A%20%20%20%20%20%20%20%20white-space%3A%20pre-wrap%3B%0A%20%20%20%20%20%20%20%20word-wrap%3A%20break-word%3B%0A%20%20%20%20%20%20%20%20line-height%3A%201.6%3B%0A%20%20%20%20%20%20%20%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20%22Segoe%20UI%22%2C%20Roboto%2C%0A%20%20%20%20%20%20%20%20%20%20sans-serif%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20Ensure%20proper%20display%20of%20line%20breaks%20*%2F%0A%20%20%20%20%20%20%23editor%20br%20%7B%0A%20%20%20%20%20%20%20%20display%3A%20block%3B%0A%20%20%20%20%20%20%20%20content%3A%20%22%22%3B%0A%20%20%20%20%20%20%20%20margin-top%3A%200%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23controls%20%7B%0A%20%20%20%20%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20%20%20%20%20top%3A%200%3B%0A%20%20%20%20%20%20%20%20left%3A%200%3B%0A%20%20%20%20%20%20%20%20right%3A%200%3B%0A%20%20%20%20%20%20%20%20height%3A%2050px%3B%0A%20%20%20%20%20%20%20%20background%3A%20%23f5f5f5%3B%0A%20%20%20%20%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20%20%20%20%20padding%3A%200%2020px%3B%0A%20%20%20%20%20%20%20%20box-shadow%3A%200%201px%203px%20rgba(0%2C%200%2C%200%2C%200.1)%3B%0A%20%20%20%20%20%20%20%20z-index%3A%2010%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23username%2C%0A%20%20%20%20%20%20%23session-id%20%7B%0A%20%20%20%20%20%20%20%20margin-right%3A%2010px%3B%0A%20%20%20%20%20%20%20%20padding%3A%205px%3B%0A%20%20%20%20%20%20%20%20border%3A%201px%20solid%20%23ddd%3B%0A%20%20%20%20%20%20%20%20border-radius%3A%204px%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2014px%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%23username%20%7B%0A%20%20%20%20%20%20%20%20width%3A%20120px%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%23session-id%20%7B%0A%20%20%20%20%20%20%20%20width%3A%20200px%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20.remote-cursor%20%7B%0A%20%20%20%20%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20%20%20%20%20width%3A%202px%3B%0A%20%20%20%20%20%20%20%20height%3A%2020px%3B%0A%20%20%20%20%20%20%20%20background-color%3A%20%234285f4%3B%0A%20%20%20%20%20%20%20%20animation%3A%20blink%201s%20infinite%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20.cursor-label%20%7B%0A%20%20%20%20%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2012px%3B%0A%20%20%20%20%20%20%20%20padding%3A%202px%204px%3B%0A%20%20%20%20%20%20%20%20border-radius%3A%202px%3B%0A%20%20%20%20%20%20%20%20white-space%3A%20nowrap%3B%0A%20%20%20%20%20%20%20%20color%3A%20white%3B%0A%20%20%20%20%20%20%20%20transform%3A%20translateY(-100%25)%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%40keyframes%20blink%20%7B%0A%20%20%20%20%20%20%20%200%25%2C%0A%20%20%20%20%20%20%20%20100%25%20%7B%0A%20%20%20%20%20%20%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%2050%25%20%7B%0A%20%20%20%20%20%20%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23join-btn%20%7B%0A%20%20%20%20%20%20%20%20padding%3A%205px%2010px%3B%0A%20%20%20%20%20%20%20%20background%3A%20%234285f4%3B%0A%20%20%20%20%20%20%20%20color%3A%20white%3B%0A%20%20%20%20%20%20%20%20border%3A%20none%3B%0A%20%20%20%20%20%20%20%20border-radius%3A%204px%3B%0A%20%20%20%20%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2014px%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23join-btn%3Ahover%20%7B%0A%20%20%20%20%20%20%20%20background%3A%20%233367d6%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23status%20%7B%0A%20%20%20%20%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20%20%20%20%20bottom%3A%2010px%3B%0A%20%20%20%20%20%20%20%20right%3A%2010px%3B%0A%20%20%20%20%20%20%20%20background%3A%20rgba(0%2C%200%2C%200%2C%200.1)%3B%0A%20%20%20%20%20%20%20%20padding%3A%205px%2010px%3B%0A%20%20%20%20%20%20%20%20border-radius%3A%204px%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2012px%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%23current-session%20%7B%0A%20%20%20%20%20%20%20%20margin-left%3A%20auto%3B%0A%20%20%20%20%20%20%20%20font-size%3A%2014px%3B%0A%20%20%20%20%20%20%20%20color%3A%20%23666%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%3C%2Fstyle%3E%0A%20%20%3C%2Fhead%3E%0A%20%20%3Cbody%3E%0A%20%20%20%20%3Cdiv%20id%3D%22controls%22%3E%0A%20%20%20%20%20%20%3Cinput%20type%3D%22text%22%20id%3D%22username%22%20placeholder%3D%22Your%20name%22%20maxlength%3D%2220%22%20%2F%3E%0A%20%20%20%20%20%20%3Cinput%0A%20%20%20%20%20%20%20%20type%3D%22text%22%0A%20%20%20%20%20%20%20%20id%3D%22session-id%22%0A%20%20%20%20%20%20%20%20placeholder%3D%22Enter%20session%20ID%20or%20leave%20empty%20for%20new%20session%22%0A%20%20%20%20%20%20%2F%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22join-btn%22%3EJoin%20Session%3C%2Fbutton%3E%0A%20%20%20%20%20%20%3Cdiv%20id%3D%22current-session%22%3E%0A%20%20%20%20%20%20%20%20Current%20session%3A%20%3Cspan%20id%3D%22session-display%22%3E-%3C%2Fspan%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22editor%22%20contenteditable%3D%22true%22%20spellcheck%3D%22false%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22status%22%3EConnecting...%3C%2Fdiv%3E%0A%20%20%20%20%3Cscript%20type%3D%22module%22%3E%0Aimport%20*%20as%20Y%20from%20%22yjs%22%3B%0Aimport%20%7B%20WebrtcProvider%20%7D%20from%20%22y-webrtc%22%3B%0A%0A%2F%2F%20Color%20palette%20for%20peer%20cursors%0Aconst%20CURSOR_COLORS%20%3D%20%5B%0A%20%20%22%23FF5733%22%2C%20%2F%2F%20Red-orange%0A%20%20%22%2333A8FF%22%2C%20%2F%2F%20Blue%0A%20%20%22%2333FF57%22%2C%20%2F%2F%20Green%0A%20%20%22%23FF33A8%22%2C%20%2F%2F%20Pink%0A%20%20%22%23A833FF%22%2C%20%2F%2F%20Purple%0A%20%20%22%23FFBD33%22%2C%20%2F%2F%20Yellow-orange%0A%20%20%22%2333FFC1%22%2C%20%2F%2F%20Teal%0A%20%20%22%23FF5733%22%2C%20%2F%2F%20Fallback%0A%5D%3B%0A%0A%2F%2F%20DOM%20Elements%0Aconst%20editor%20%3D%20document.getElementById(%22editor%22)%3B%0Aconst%20statusElement%20%3D%20document.getElementById(%22status%22)%3B%0Aconst%20usernameInput%20%3D%20document.getElementById(%22username%22)%3B%0Aconst%20sessionIdInput%20%3D%20document.getElementById(%22session-id%22)%3B%0Aconst%20joinButton%20%3D%20document.getElementById(%22join-btn%22)%3B%0Aconst%20sessionDisplay%20%3D%20document.getElementById(%22session-display%22)%3B%0A%0A%2F%2F%20Set%20default%20username%0AusernameInput.value%20%3D%20%22User%22%20%2B%20Math.floor(Math.random()%20*%201000)%3B%0A%0A%2F%2F%20Generate%20a%20random%20session%20ID%20(6%20characters)%0Afunction%20generateSessionId()%20%7B%0A%20%20return%20Math.random().toString(36).substring(2%2C%208)%3B%0A%7D%0A%0A%2F%2F%20Get%20session%20ID%20from%20URL%20or%20generate%20a%20new%20one%0Afunction%20getSessionIdFromUrl()%20%7B%0A%20%20const%20urlParams%20%3D%20new%20URLSearchParams(window.location.search)%3B%0A%20%20return%20urlParams.get(%22session%22)%20%7C%7C%20generateSessionId()%3B%0A%7D%0A%0A%2F%2F%20Update%20URL%20with%20session%20ID%0Afunction%20updateUrl(sessionId)%20%7B%0A%20%20const%20url%20%3D%20new%20URL(window.location)%3B%0A%20%20url.searchParams.set(%22session%22%2C%20sessionId)%3B%0A%20%20window.history.pushState(%7B%7D%2C%20%22%22%2C%20url)%3B%0A%7D%0A%0A%2F%2F%20utility%20function%20to%20strip%20html%20tags%0Afunction%20stripHtmlTags(html)%20%7B%0A%20%20return%20html.replace(%2F%3C%5B%5E%3E%5D*%3E%2Fg%2C%20%22%22)%3B%0A%7D%0A%0A%2F%2F%20Variables%0Alet%20doc%3B%0Alet%20provider%3B%0Alet%20yText%3B%0Alet%20currentSessionId%20%3D%20getSessionIdFromUrl()%3B%0Alet%20isInitialSync%20%3D%20true%3B%0Alet%20peerCursors%20%3D%20%7B%7D%3B%20%2F%2F%20Store%20peer%20cursor%20elements%0Alet%20colorAssignments%20%3D%20%7B%7D%3B%20%2F%2F%20Map%20client%20IDs%20to%20colors%0A%0A%2F%2F%20Initialize%20the%20collaborative%20editor%20with%20a%20session%20ID%0Afunction%20initCollaboration(sessionId)%20%7B%0A%20%20%2F%2F%20Clean%20up%20previous%20instances%20if%20they%20exist%0A%20%20if%20(provider)%20%7B%0A%20%20%20%20provider.destroy()%3B%0A%20%20%7D%0A%20%20if%20(doc)%20%7B%0A%20%20%20%20doc.destroy()%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Create%20a%20new%20Yjs%20document%0A%20%20doc%20%3D%20new%20Y.Doc()%3B%0A%20%20yText%20%3D%20doc.getText(%22content%22)%3B%0A%0A%20%20%2F%2F%20Connect%20to%20peers%20using%20the%20session%20ID%0A%20%20provider%20%3D%20new%20WebrtcProvider(%60minimal-p2p-notes-%24%7BsessionId%7D%60%2C%20doc%2C%20%7B%0A%20%20%20%20signaling%3A%20%5B%22wss%3A%2F%2Fsignaling.yjs.dev%22%5D%2C%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Update%20UI%20with%20current%20session%20ID%0A%20%20sessionDisplay.textContent%20%3D%20sessionId%3B%0A%20%20currentSessionId%20%3D%20sessionId%3B%0A%20%20updateUrl(sessionId)%3B%0A%0A%20%20%2F%2F%20Set%20up%20awareness%20(presence)%20handling%0A%20%20const%20username%20%3D%0A%20%20%20%20usernameInput.value.trim()%20%7C%7C%20%22User%22%20%2B%20Math.floor(Math.random()%20*%201000)%3B%0A%20%20provider.awareness.setLocalStateField(%22user%22%2C%20%7B%0A%20%20%20%20name%3A%20username%2C%0A%20%20%20%20cursor%3A%20null%2C%20%2F%2F%20Will%20be%20updated%20when%20cursor%20moves%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Update%20connection%20status%20when%20peers%20connect%2Fdisconnect%0A%20%20provider.awareness.on(%22change%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20updateStatus()%3B%0A%20%20%20%20updatePeerCursors()%3B%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Handle%20WebRTC%20connection%20status%0A%20%20provider.on(%22status%22%2C%20(event)%20%3D%3E%20%7B%0A%20%20%20%20if%20(event.status%20%3D%3D%3D%20%22connected%22)%20%7B%0A%20%20%20%20%20%20statusElement.style.backgroundColor%20%3D%20%22rgba(0%2C255%2C0%2C0.2)%22%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20statusElement.style.backgroundColor%20%3D%20%22rgba(255%2C0%2C0%2C0.2)%22%3B%0A%20%20%20%20%7D%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Initial%20status%20update%0A%20%20updateStatus()%3B%0A%0A%20%20%2F%2F%20Set%20up%20editor%20binding%0A%20%20setupEditorBinding()%3B%0A%7D%0A%0A%2F%2F%20Set%20up%20the%20binding%20between%20the%20editor%20and%20Yjs%0Afunction%20setupEditorBinding()%20%7B%0A%20%20%2F%2F%20Flag%20to%20prevent%20update%20loops%0A%20%20let%20preventObservation%20%3D%20false%3B%0A%0A%20%20%2F%2F%20Set%20initial%20content%20-%20use%20textContent%20to%20handle%20line%20breaks%20naturally%0A%20%20editor.textContent%20%3D%20yText.toString()%3B%0A%0A%20%20%2F%2F%20Listen%20for%20Yjs%20updates%0A%20%20yText.observe((event)%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20Only%20update%20if%20the%20change%20didn't%20come%20from%20this%20client%0A%20%20%20%20if%20(%0A%20%20%20%20%20%20event.transaction.origin%20!%3D%3D%20provider.awareness.clientID%20%26%26%0A%20%20%20%20%20%20!preventObservation%0A%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%2F%2F%20Get%20current%20selection%0A%20%20%20%20%20%20const%20selection%20%3D%20window.getSelection()%3B%0A%20%20%20%20%20%20const%20selectionExists%20%3D%20selection.rangeCount%20%3E%200%3B%0A%20%20%20%20%20%20let%20selectionInfo%20%3D%20null%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Save%20selection%20position%20if%20it%20exists%0A%20%20%20%20%20%20if%20(selectionExists)%20%7B%0A%20%20%20%20%20%20%20%20const%20range%20%3D%20selection.getRangeAt(0)%3B%0A%20%20%20%20%20%20%20%20selectionInfo%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20startContainer%3A%20range.startContainer%2C%0A%20%20%20%20%20%20%20%20%20%20startOffset%3A%20range.startOffset%2C%0A%20%20%20%20%20%20%20%20%20%20endContainer%3A%20range.endContainer%2C%0A%20%20%20%20%20%20%20%20%20%20endOffset%3A%20range.endOffset%2C%0A%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F%2F%20Update%20editor%20content%20with%20preserved%20line%20breaks%0A%20%20%20%20%20%20editor.innerText%20%3D%20yText.toString()%3B%0A%0A%20%20%20%20%20%20%2F%2F%20Try%20to%20restore%20selection%20if%20it%20existed%0A%20%20%20%20%20%20if%20(selectionExists%20%26%26%20selectionInfo)%20%7B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20Wait%20a%20tick%20for%20the%20DOM%20to%20update%0A%20%20%20%20%20%20%20%20%20%20setTimeout(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Try%20to%20find%20equivalent%20positions%20in%20the%20new%20DOM%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20newRange%20%3D%20document.createRange()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20nodeIndex%20%3D%20Array.from(editor.childNodes).findIndex(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20(node)%20%3D%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20node.textContent%20%3D%3D%3D%20selectionInfo.startContainer.textContent%0A%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(nodeIndex%20%3E%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20node%20%3D%20editor.childNodes%5BnodeIndex%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20newRange.setStart(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20node%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Math.min(selectionInfo.startOffset%2C%20node.textContent.length)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20newRange.setEnd(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20node%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Math.min(selectionInfo.endOffset%2C%20node.textContent.length)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20selection.removeAllRanges()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20selection.addRange(newRange)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%2C%200)%3B%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20If%20restoring%20selection%20fails%2C%20don't%20worry%20about%20it%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Handle%20input%20events%20to%20update%20Yjs%20document%0A%20%20editor.addEventListener(%22input%22%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20Prevent%20update%20loops%0A%20%20%20%20preventObservation%20%3D%20true%3B%0A%0A%20%20%20%20%2F%2F%20Get%20content%20directly%20from%20textContent%0A%20%20%20%20%2F%2F%20This%20avoids%20HTML%20parsing%20issues%20and%20handles%20line%20breaks%20naturally%0A%20%20%20%20let%20html%20%3D%20editor.innerHTML%3B%0A%20%20%20%20const%20htmlWithNewlines%20%3D%20html.replace(%2F%3Cbr%3E%2Fg%2C%20%22%5Cn%22)%3B%0A%20%20%20%20const%20content%20%3D%20stripHtmlTags(htmlWithNewlines)%3B%0A%20%20%20%20console.log(%7B%20html%2C%20htmlWithNewlines%2C%20content%20%7D)%3B%0A%0A%20%20%20%20%2F%2F%20Update%20Yjs%20document%0A%20%20%20%20yText.delete(0%2C%20yText.length)%3B%0A%20%20%20%20yText.insert(0%2C%20content)%3B%0A%0A%20%20%20%20%2F%2F%20Allow%20observation%20again%0A%20%20%20%20preventObservation%20%3D%20false%3B%0A%0A%20%20%20%20%2F%2F%20Update%20cursor%20position%20after%20input%0A%20%20%20%20updateLocalCursorPosition()%3B%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20Track%20cursor%20position%0A%20%20editor.addEventListener(%22mouseup%22%2C%20updateLocalCursorPosition)%3B%0A%20%20editor.addEventListener(%22keyup%22%2C%20updateLocalCursorPosition)%3B%0A%20%20editor.addEventListener(%22click%22%2C%20updateLocalCursorPosition)%3B%0A%0A%20%20%2F%2F%20Focus%20editor%20on%20load%0A%20%20setTimeout(()%20%3D%3E%20%7B%0A%20%20%20%20editor.focus()%3B%0A%20%20%20%20updateLocalCursorPosition()%3B%0A%20%20%7D%2C%20100)%3B%0A%7D%0A%0A%2F%2F%20Update%20connection%20status%0Afunction%20updateStatus()%20%7B%0A%20%20if%20(!provider)%20return%3B%0A%0A%20%20const%20peers%20%3D%20provider.awareness.getStates().size%3B%0A%20%20statusElement.textContent%20%3D%20%60Connected%20with%20%24%7Bpeers%20-%201%7D%20peer%24%7B%0A%20%20%20%20peers%20!%3D%3D%202%20%3F%20%22s%22%20%3A%20%22%22%0A%20%20%7D%60%3B%0A%0A%20%20%2F%2F%20Visual%20indicator%0A%20%20if%20(peers%20%3E%201)%20%7B%0A%20%20%20%20statusElement.style.backgroundColor%20%3D%20%22rgba(0%2C255%2C0%2C0.2)%22%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20statusElement.style.backgroundColor%20%3D%20%22rgba(255%2C165%2C0%2C0.2)%22%3B%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20Join%20button%20click%20handler%0AjoinButton.addEventListener(%22click%22%2C%20()%20%3D%3E%20%7B%0A%20%20const%20sessionId%20%3D%20sessionIdInput.value.trim()%20%7C%7C%20generateSessionId()%3B%0A%0A%20%20%2F%2F%20Clean%20up%20existing%20peer%20cursors%20before%20joining%20a%20new%20session%0A%20%20clearPeerCursors()%3B%0A%0A%20%20%2F%2F%20Reset%20color%20assignments%20when%20joining%20a%20new%20session%0A%20%20colorAssignments%20%3D%20%7B%7D%3B%0A%0A%20%20%2F%2F%20Initialize%20the%20new%20collaboration%20session%0A%20%20initCollaboration(sessionId)%3B%0A%20%20sessionIdInput.value%20%3D%20%22%22%3B%0A%7D)%3B%0A%0A%2F%2F%20Initialize%20with%20the%20current%20session%20ID%0AinitCollaboration(currentSessionId)%3B%0A%0A%2F%2F%20Handle%20browser%20unload%0Awindow.addEventListener(%22beforeunload%22%2C%20()%20%3D%3E%20%7B%0A%20%20if%20(provider)%20provider.destroy()%3B%0A%20%20if%20(doc)%20doc.destroy()%3B%0A%20%20clearPeerCursors()%3B%0A%7D)%3B%0A%0A%2F%2F%20Update%20local%20cursor%20position%20and%20broadcast%20to%20peers%0Afunction%20updateLocalCursorPosition()%20%7B%0A%20%20if%20(!provider%20%7C%7C%20!provider.awareness)%20return%3B%0A%0A%20%20const%20selection%20%3D%20window.getSelection()%3B%0A%20%20if%20(!selection.rangeCount)%20return%3B%0A%0A%20%20const%20range%20%3D%20selection.getRangeAt(0)%3B%0A%20%20if%20(!editor.contains(range.startContainer))%20return%3B%0A%0A%20%20%2F%2F%20Get%20cursor%20position%20relative%20to%20editor%0A%20%20let%20cursorRect%3B%0A%0A%20%20%2F%2F%20Special%20handling%20for%20empty%20lines%20or%20beginning%20of%20lines%0A%20%20if%20(%0A%20%20%20%20range.startContainer.nodeType%20%3D%3D%3D%20Node.TEXT_NODE%20%26%26%0A%20%20%20%20range.startContainer.textContent%20%3D%3D%3D%20%22%22%20%26%26%0A%20%20%20%20range.startOffset%20%3D%3D%3D%200%0A%20%20)%20%7B%0A%20%20%20%20%2F%2F%20For%20empty%20text%20nodes%2C%20use%20the%20parent%20node's%20position%0A%20%20%20%20const%20parentRect%20%3D%20range.startContainer.parentNode.getBoundingClientRect()%3B%0A%20%20%20%20cursorRect%20%3D%20%7B%0A%20%20%20%20%20%20left%3A%20parentRect.left%2C%0A%20%20%20%20%20%20top%3A%20parentRect.top%2C%0A%20%20%20%20%20%20width%3A%200%2C%0A%20%20%20%20%20%20height%3A%20parentRect.height%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%20else%20if%20(range.startContainer%20%3D%3D%3D%20editor%20%26%26%20range.startOffset%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%2F%2F%20For%20cursor%20at%20the%20very%20beginning%20of%20the%20editor%0A%20%20%20%20const%20editorRect%20%3D%20editor.getBoundingClientRect()%3B%0A%20%20%20%20cursorRect%20%3D%20%7B%0A%20%20%20%20%20%20left%3A%20editorRect.left%20%2B%2020%2C%20%2F%2F%20Add%20padding%0A%20%20%20%20%20%20top%3A%20editorRect.top%20%2B%2020%2C%20%2F%2F%20Add%20padding%0A%20%20%20%20%20%20width%3A%200%2C%0A%20%20%20%20%20%20height%3A%2020%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20%2F%2F%20Normal%20case%0A%20%20%20%20cursorRect%20%3D%20range.getBoundingClientRect()%3B%0A%20%20%7D%0A%0A%20%20const%20editorRect%20%3D%20editor.getBoundingClientRect()%3B%0A%0A%20%20const%20cursorPosition%20%3D%20%7B%0A%20%20%20%20left%3A%20cursorRect.left%20-%20editorRect.left%2C%0A%20%20%20%20top%3A%20cursorRect.top%20-%20editorRect.top%2C%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20Broadcast%20cursor%20position%20to%20peers%0A%20%20provider.awareness.setLocalStateField(%22user%22%2C%20%7B%0A%20%20%20%20name%3A%0A%20%20%20%20%20%20usernameInput.value.trim()%20%7C%7C%20%22User%22%20%2B%20Math.floor(Math.random()%20*%201000)%2C%0A%20%20%20%20cursor%3A%20cursorPosition%2C%0A%20%20%7D)%3B%0A%7D%0A%0A%2F%2F%20Update%20peer%20cursors%20based%20on%20awareness%20information%0Afunction%20updatePeerCursors()%20%7B%0A%20%20if%20(!provider%20%7C%7C%20!provider.awareness)%20return%3B%0A%0A%20%20%2F%2F%20Clear%20existing%20cursors%20first%0A%20%20clearPeerCursors()%3B%0A%0A%20%20%2F%2F%20Get%20all%20user%20states%0A%20%20const%20states%20%3D%20provider.awareness.getStates()%3B%0A%20%20const%20localClientId%20%3D%20provider.awareness.clientID%3B%0A%0A%20%20%2F%2F%20Create%20a%20cursor%20for%20each%20remote%20peer%0A%20%20states.forEach((state%2C%20clientId)%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20Skip%20local%20user%0A%20%20%20%20if%20(clientId%20%3D%3D%3D%20localClientId%20%7C%7C%20!state.user%20%7C%7C%20!state.user.cursor)%20return%3B%0A%0A%20%20%20%20%2F%2F%20Create%20or%20update%20cursor%20element%0A%20%20%20%20createPeerCursor(clientId%2C%20state.user)%3B%0A%20%20%7D)%3B%0A%7D%0A%0A%2F%2F%20Create%20a%20cursor%20element%20for%20a%20peer%0Afunction%20createPeerCursor(clientId%2C%20userData)%20%7B%0A%20%20%2F%2F%20Assign%20a%20color%20if%20not%20already%20assigned%0A%20%20if%20(!colorAssignments%5BclientId%5D)%20%7B%0A%20%20%20%20const%20colorIndex%20%3D%0A%20%20%20%20%20%20Object.keys(colorAssignments).length%20%25%20CURSOR_COLORS.length%3B%0A%20%20%20%20colorAssignments%5BclientId%5D%20%3D%20CURSOR_COLORS%5BcolorIndex%5D%3B%0A%20%20%7D%0A%0A%20%20const%20color%20%3D%20colorAssignments%5BclientId%5D%3B%0A%20%20const%20cursorPosition%20%3D%20userData.cursor%3B%0A%0A%20%20%2F%2F%20Skip%20if%20cursor%20position%20is%20invalid%0A%20%20if%20(%0A%20%20%20%20!cursorPosition%20%7C%7C%0A%20%20%20%20typeof%20cursorPosition.left%20!%3D%3D%20%22number%22%20%7C%7C%0A%20%20%20%20typeof%20cursorPosition.top%20!%3D%3D%20%22number%22%0A%20%20)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Create%20cursor%20element%20if%20it%20doesn't%20exist%0A%20%20if%20(!peerCursors%5BclientId%5D)%20%7B%0A%20%20%20%20const%20cursorElement%20%3D%20document.createElement(%22div%22)%3B%0A%20%20%20%20cursorElement.className%20%3D%20%22remote-cursor%22%3B%0A%20%20%20%20cursorElement.style.backgroundColor%20%3D%20color%3B%0A%0A%20%20%20%20const%20labelElement%20%3D%20document.createElement(%22div%22)%3B%0A%20%20%20%20labelElement.className%20%3D%20%22cursor-label%22%3B%0A%20%20%20%20labelElement.style.backgroundColor%20%3D%20color%3B%0A%20%20%20%20labelElement.textContent%20%3D%20userData.name%20%7C%7C%20%22Anonymous%22%3B%0A%0A%20%20%20%20cursorElement.appendChild(labelElement)%3B%0A%20%20%20%20document.body.appendChild(cursorElement)%3B%0A%0A%20%20%20%20peerCursors%5BclientId%5D%20%3D%20cursorElement%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Position%20the%20cursor%0A%20%20const%20cursorElement%20%3D%20peerCursors%5BclientId%5D%3B%0A%0A%20%20%2F%2F%20Calculate%20absolute%20position%0A%20%20const%20editorRect%20%3D%20editor.getBoundingClientRect()%3B%0A%20%20const%20absoluteLeft%20%3D%20editorRect.left%20%2B%20cursorPosition.left%3B%0A%20%20const%20absoluteTop%20%3D%20editorRect.top%20%2B%20cursorPosition.top%3B%0A%0A%20%20cursorElement.style.left%20%3D%20%60%24%7BabsoluteLeft%7Dpx%60%3B%0A%20%20cursorElement.style.top%20%3D%20%60%24%7BabsoluteTop%7Dpx%60%3B%0A%0A%20%20%2F%2F%20Make%20sure%20cursor%20is%20visible%0A%20%20cursorElement.style.display%20%3D%20%22block%22%3B%0A%7D%0A%0A%2F%2F%20Clear%20all%20peer%20cursors%0Afunction%20clearPeerCursors()%20%7B%0A%20%20Object.values(peerCursors).forEach((cursor)%20%3D%3E%20%7B%0A%20%20%20%20if%20(cursor%20%26%26%20cursor.parentNode)%20%7B%0A%20%20%20%20%20%20cursor.parentNode.removeChild(cursor)%3B%0A%20%20%20%20%7D%0A%20%20%7D)%3B%0A%0A%20%20peerCursors%20%3D%20%7B%7D%3B%0A%7D%0A%0A%3C%2Fscript%3E%0A%20%20%3C%2Fbody%3E%0A%3C%2Fhtml%3E%0A